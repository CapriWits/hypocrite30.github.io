<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å…³äºè®¾è®¡ç»å¯¹å€¼absçš„ä¸€äº›æ€è€ƒ</title>
    <link href="/2021/09/18/JavaSE/%E5%85%B3%E4%BA%8E%E8%AE%BE%E8%AE%A1%E7%BB%9D%E5%AF%B9%E5%80%BCabs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
    <url>/2021/09/18/JavaSE/%E5%85%B3%E4%BA%8E%E8%AE%BE%E8%AE%A1%E7%BB%9D%E5%AF%B9%E5%80%BCabs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³äºè®¾è®¡ç»å¯¹å€¼absçš„ä¸€äº›æ€è€ƒ"><a href="#å…³äºè®¾è®¡ç»å¯¹å€¼absçš„ä¸€äº›æ€è€ƒ" class="headerlink" title="å…³äºè®¾è®¡ç»å¯¹å€¼absçš„ä¸€äº›æ€è€ƒ"></a>å…³äºè®¾è®¡ç»å¯¹å€¼absçš„ä¸€äº›æ€è€ƒ</h1><p><img src="https://img.shields.io/badge/JDK-1.8-red"></p><p>ã€Œ<strong>å–ç»å¯¹å€¼</strong>ã€å¯¹äº <code>Integer</code> æ¯«æ— ç–‘é—®ç›´æ¥åˆ¤æ–­æ­£è´Ÿ</p><ul><li><code>Math::abs(int)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> (a &lt; <span class="hljs-number">0</span>) ? -a : a;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ³¨æ„åˆ°åŒç²¾åº¦æµ®ç‚¹æ•° <code>Double</code> å®˜æ–¹ä½¿ç”¨ä»¥ä¸‹å®ç°</p><ul><li><code>Math::abs(double)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> a)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> (a &lt;= <span class="hljs-number">0.0D</span>) ? <span class="hljs-number">0.0D</span> - a : a;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>Java éµå¾ª <a href="https://en.wikipedia.org/wiki/IEEE_754-2008">IEEE-754</a> æ ‡å‡†ï¼Œå› æ­¤å®ç°ä¸Šå­˜åœ¨ <code>+0.0</code> &amp; <code>-0.0</code>ï¼Œä¸¤è€…é™¤äº†æ–‡æœ¬è¡¨ç¤ºä¸åŒï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¹Ÿä¸åŒã€‚å¦‚ï¼š<code>1 / +- 0.0</code> å¾—åˆ°çš„ç»“æœæ˜¯ <code>+Infinity</code> &amp; <code>-Infinity</code> </p><ul><li><code>abs</code> è®¡ç®—ç»“æœä»ç„¶æ˜¯è´Ÿæ•°ï¼Œå‡ºç°<strong>é”™è¯¯</strong>ï¼ŒåŸå› æ—¢æ˜¯ <code>+0.0 == -0.0 </code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">double</span> x = -<span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> / abs(x) &lt; <span class="hljs-number">0</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;abs(x) &lt; 0&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> a)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (a &lt; <span class="hljs-number">0</span>) ? -a : a;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å°è¯•è§£å†³é—®é¢˜ï¼Œæ·»åŠ åˆ¤æ–­æ¡ä»¶ï¼š<code>if (val &lt; 0 || val == -0.0)</code> å¯¹ <code>-0.0</code> å•ç‹¬è€ƒè™‘ï¼Œè¿›è¡ŒåŒé‡åˆ¤æ–­ï¼Œè¿™é‡Œé‡‡ç”¨ <code>Double::compare(double, double)</code> å®ç°</p><ul><li><strong>æˆåŠŸå®ç°</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span> || Double.compare(value, -<span class="hljs-number">0.0</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> -value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å†è¿½æ±‚æè‡´çš„ä¼˜åŒ–ã€‚æŸ¥çœ‹  <a href="https://github.com/openjdk/jdk/blob/36e2ddad4d2ef3ce27475af6244d0246a8315c0c/src/java.base/share/classes/java/lang/Double.java#L1117">Double::compare</a> å®ç°ã€‚</p><ul><li>å¯¹äº<strong>æ­£æ•°</strong>è¿›è¡Œé¢å¤–çš„<strong>ä¸¤æ¬¡</strong>æ¯”è¾ƒ</li><li>å¯¹äº <strong>-0.0</strong> è¿›è¡Œé¢å¤–çš„<strong>ä¸‰æ¬¡</strong>æ¯”è¾ƒ</li><li>å¯¹äº <strong>+0.0</strong> è¿›è¡Œé¢å¤–çš„<strong>å››æ¬¡</strong>æ¯”è¾ƒ</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-keyword">double</span> d1, <span class="hljs-keyword">double</span> d2)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (d1 &lt; d2)<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;           <span class="hljs-comment">// Neither val is NaN, thisVal is smaller</span><br>    <span class="hljs-keyword">if</span> (d1 &gt; d2)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;            <span class="hljs-comment">// Neither val is NaN, thisVal is larger</span><br><br>    <span class="hljs-comment">// Cannot use doubleToRawLongBits because of possibility of NaNs.</span><br>    <span class="hljs-keyword">long</span> thisBits    = Double.doubleToLongBits(d1);<br>    <span class="hljs-keyword">long</span> anotherBits = Double.doubleToLongBits(d2);<br><br>    <span class="hljs-keyword">return</span> (thisBits == anotherBits ?  <span class="hljs-number">0</span> : <span class="hljs-comment">// Values are equal</span><br>            (thisBits &lt; anotherBits ? -<span class="hljs-number">1</span> : <span class="hljs-comment">// (-0.0, 0.0) or (!NaN, NaN)</span><br>             <span class="hljs-number">1</span>));                          <span class="hljs-comment">// (0.0, -0.0) or (NaN, !NaN)</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>è€Œå®é™…ä¸Šï¼Œè¦æƒ³å®ç°åªéœ€è¦ <code>Double::doubleToLongBits</code> æ–¹æ³•ï¼Œå°† <code>Double</code> è½¬ <code>Long</code> </p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> MINUS_ZERO_LONG_BITS =<br>        Double.doubleToLongBits(-<span class="hljs-number">0.0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span> ||<br>            Double.doubleToLongBits(value) == MINUS_ZERO_LONG_BITS) &#123;<br>        <span class="hljs-keyword">return</span> -value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ä¸è¿‡ <code>Double::doubleToLongBits</code> ä¹Ÿåªæœ‰å¾®ä¸è¶³é“çš„æ€§èƒ½æå‡ï¼Œå› ä¸ºå®ƒä¼šå¯¹ <code>NaN</code> è¿›è¡Œçº¦æŸï¼Œ<code>NaN</code> ä¼šèµ‹å€¼ä¸º <code>0x7ff8000000000000L</code> ï¼Œå¦‚æœç¡®ä¿ <code>abs</code> å…¥å‚è‚¯å®šæ˜¯ <code>double</code>ï¼Œåˆ™åªéœ€è¦å–å‡º <code>Double::doubleToRawLongBits</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">doubleToLongBits</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!isNaN(value)) &#123;<br>        <span class="hljs-keyword">return</span> doubleToRawLongBits(value);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0x7ff8000000000000L</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>äºæ˜¯å°±å˜æˆè¿™æ ·å®ç°</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> MINUS_ZERO_LONG_BITS =<br>  Double.doubleToRawLongBits(-<span class="hljs-number">0.0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span> ||<br>      Double.doubleToRawLongBits(value) == MINUS_ZERO_LONG_BITS) &#123;<br>    <span class="hljs-keyword">return</span> -value;<br>  &#125;<br>  <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>åˆ° <code>JDK8</code> å°±ç»“æŸäº†ï¼Œè€Œ <code>JDK9</code> å¼€å§‹å¼•å…¥ <code>@HotSpotIntrinsicCandidate</code> æ³¨è§£ï¼Œå³ <code>HotSpot JVM</code> å†…éƒ¨çš„ <code>JIT compiler</code> ä¼šç§»é™¤ <code>JDK</code> ä¸­çš„å®ç°æ–¹æ³•ï¼Œé‡‡ç”¨ <code>CPU</code> æŒ‡ä»¤ç›´æ¥å®ç°ï¼Œè¿™ä¼šæ¯”é«˜çº§è¯­è¨€è½¬æ±‡ç¼–è½¬æœºå™¨è¯­è¨€è¦å¿«å¾ˆå¤šï¼Œæ¯•ç«Ÿ CPU å¹¶ä¸ä¼šåœ¨ä¹æ•°æ®ç±»å‹çš„é—®é¢˜ï¼Œåªéœ€è¦é‡æ–°è§£é‡Š(reinterpreting) å‚¨å­˜åœ¨ CPU å¯„å­˜å™¨çš„ä¸€ç»„ä½çš„é—®é¢˜ï¼Œä»¥ä¾¿äºä¸ Java æ•°æ®ç±»å‹ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">long</span> <span class="hljs-title">doubleToRawLongBits</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span></span>;<br></code></pre></div></td></tr></table></figure><p>ä½†è¿™ä¹ˆå®ç°ï¼Œä»ç„¶æœ‰æ¡ä»¶åˆ†æ”¯ï¼Œå¦‚æœ CPU åˆ†æ”¯é¢„æµ‹(branch predictor) å¤±è¯¯ï¼Œæ€§èƒ½å¼€é”€å°±ä¼šå¢å¤§ã€‚æ¥ä¸‹æ¥è€ƒè™‘å‡å°‘æ¡ä»¶åˆ†æ”¯ã€‚</p><p>åˆ©ç”¨ <code>0.0</code> ä¸ <code>+/0.0</code> ä½œå·®ï¼Œéƒ½ä¼šä½¿æ­£è´Ÿé›¶è½¬åŒ–ä¸ºæ­£é›¶</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">System.out.println(<span class="hljs-number">0.0</span> - (-<span class="hljs-number">0.0</span>)); <span class="hljs-comment">// 0.0</span><br>System.out.println(<span class="hljs-number">0.0</span> - (+<span class="hljs-number">0.0</span>)); <span class="hljs-comment">// 0.0</span><br></code></pre></div></td></tr></table></figure><p>å¯¹æ–¹æ³•è¿›è¡Œæ”¹å†™</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (value == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span> - value;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> -value;<br>  &#125;<br>  <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ³¨æ„åˆ°å¯¹äºæ™®é€šè´Ÿæ•°è€Œè¨€ï¼Œ<code>0.0 - value</code> ä¸ <code>-value</code> çš„ç»“æœç›¸åŒï¼Œæ‰€ä»¥åˆå¹¶åˆ†æ”¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (value &lt;= <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span> - value;<br>  &#125;<br>  <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>AKA</strong></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> a)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> (a &lt;= <span class="hljs-number">0.0</span>) ? <span class="hljs-number">0.0</span> - a : a;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä¼šå‘ç°ï¼ŒJDK <code>Math::abs(double,double)</code> å®ç°ç›¸åŒï¼ˆé€ƒ</li></ul><p>éµå¾ª <code>IEEE-754</code> çš„åŒç²¾åº¦æµ®ç‚¹æ•°äºŒè¿›åˆ¶è¡¨è¾¾å½¢å¼ï¼Œåªéœ€è¦å°†äºŒè¿›åˆ¶åœ¨é«˜ä½ç¬¦å·ä½æ”¹æˆ 0 å³å¯å®ç°è½¬æ­£æ•°(abs)ï¼Œéœ€è¦æ©ç  <code>0x7fffffffffffffffL</code> == 63ä½ 1 bit</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">System.out.println(Long.bitCount(<span class="hljs-number">0x7fffffffffffffffL</span>)); <span class="hljs-comment">// 63</span><br></code></pre></div></td></tr></table></figure><h2 id="æœ€ç»ˆå®ç°"><a href="#æœ€ç»ˆå®ç°" class="headerlink" title="æœ€ç»ˆå®ç°"></a>æœ€ç»ˆå®ç°</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> value)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> Double.longBitsToDouble(<br>    Double.doubleToRawLongBits(value) &amp; <span class="hljs-number">0x7fffffffffffffffL</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œæ­¤ç‰ˆæœ¬ä¸å­˜åœ¨åˆ†æ”¯ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹çš„ååé‡å¢åŠ  **10%**ï¼Œå•åˆ†æ”¯å®ç°åœ¨ Java æ ‡å‡†åº“å­˜åœ¨å¤šå¹´ï¼Œåœ¨éšå³åˆ°æ¥çš„ JDK 18 ä¸­ï¼Œæ”¹è¿›ç‰ˆæœ¬å·²ç»æäº¤ã€ŒFrom: 2021/9/18ã€</p><p>ç„¶è€Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™äº›æ”¹è¿›å¹¶æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼Œå› ä¸º JIT ç¼–è¯‘å™¨ä¼šé€‚å½“ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤(if available) ä¼šå®Œå…¨æ›¿ä»£ Java codeï¼Œæ‰€ä»¥è¿™ç§æ”¹åŠ¨å¹¶<strong>ä¸èƒ½</strong>ä½¿ç¨‹åºæ˜¾è‘—æ€§æå‡å¾ˆå¤šï¼ˆé€ƒ</p><h2 id="ğŸ”—Reference"><a href="#ğŸ”—Reference" class="headerlink" title="ğŸ”—Reference"></a>ğŸ”—Reference</h2><blockquote><p><a href="https://habr.com/en/post/574082/">One does not simply calculate the absolute value</a></p><p><a href="https://github.com/openjdk/jdk/blob/36e2ddad4d2ef3ce27475af6244d0246a8315c0c/src/java.base/share/classes/java/lang/Double.java#L1117">OpenJDK Double::compare</a></p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Double.html#doubleToLongBits-double-">JavaSE 8 doubleToLongBits</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ConcurrentHashMapæºç åˆ†æJDK8</title>
    <link href="/2021/08/29/JavaSE/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90JDK8/"/>
    <url>/2021/08/29/JavaSE/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90JDK8/</url>
    
    <content type="html"><![CDATA[<h2 id="ConcurrentHashMapæºç åˆ†æJDK8"><a href="#ConcurrentHashMapæºç åˆ†æJDK8" class="headerlink" title="ConcurrentHashMapæºç åˆ†æJDK8"></a>ConcurrentHashMapæºç åˆ†æJDK8</h2><h3 id="ä¸€ã€jdk1-8å®¹å™¨åˆå§‹åŒ–"><a href="#ä¸€ã€jdk1-8å®¹å™¨åˆå§‹åŒ–" class="headerlink" title="ä¸€ã€jdk1.8å®¹å™¨åˆå§‹åŒ–"></a>ä¸€ã€jdk1.8å®¹å™¨åˆå§‹åŒ–</h3><h4 id="1ã€æºç åˆ†æ"><a href="#1ã€æºç åˆ†æ" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><blockquote><p>åœ¨<code>jdk8</code>çš„<code>ConcurrentHashMap</code>ä¸­ä¸€å…±æœ‰5ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™å››ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ²¡æœ‰å¯¹å†…éƒ¨çš„æ•°ç»„åšåˆå§‹åŒ–ï¼Œ åªæ˜¯å¯¹ä¸€äº›å˜é‡çš„åˆå§‹å€¼åšäº†å¤„ç†</p><p>jdk8çš„ConcurrentHashMapçš„æ•°ç»„åˆå§‹åŒ–æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶å®Œæˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ²¡æœ‰ç»´æŠ¤ä»»ä½•å˜é‡çš„æ“ä½œï¼Œå¦‚æœè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ•°ç»„é•¿åº¦é»˜è®¤æ˜¯16</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentHashMap</span><span class="hljs-params">()</span> </span>&#123;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ä¼ é€’è¿›æ¥ä¸€ä¸ªåˆå§‹å®¹é‡ï¼ŒConcurrentHashMapä¼šåŸºäºè¿™ä¸ªå€¼è®¡ç®—ä¸€ä¸ªæ¯”è¿™ä¸ªå€¼å¤§çš„2çš„å¹‚æ¬¡æ–¹æ•°ä½œä¸ºåˆå§‹å®¹é‡</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();<br>    <span class="hljs-keyword">int</span> cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="hljs-number">1</span>)) ?<br>               MAXIMUM_CAPACITY :<br>               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>)); <span class="hljs-comment">// 1.5n + 1</span><br>    <span class="hljs-keyword">this</span>.sizeCtl = cap;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>ğŸ“Œæ³¨æ„ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¾—åˆ°çš„åˆå§‹å®¹é‡å’Œ <code>HashMap</code> ä»¥åŠ<code>jdk7</code>çš„<code>ConcurrentHashMap</code>ä¸åŒï¼Œå³ä½¿ä½ ä¼ é€’çš„æ˜¯ä¸€ä¸ª2çš„å¹‚æ¬¡æ–¹æ•°ï¼Œè¯¥æ–¹æ³•è®¡ç®—å‡ºæ¥çš„åˆå§‹å®¹é‡ä¾ç„¶æ˜¯<strong>æ¯”è¿™ä¸ªå€¼å¤§</strong>çš„2çš„å¹‚æ¬¡æ–¹æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//è°ƒç”¨å››ä¸ªå‚æ•°çš„æ„é€ </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>(initialCapacity, loadFactor, <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//è®¡ç®—ä¸€ä¸ªå¤§äºæˆ–è€…ç­‰äºç»™å®šçš„å®¹é‡å€¼ï¼Œè¯¥å€¼æ˜¯2çš„å¹‚æ¬¡æ–¹æ•°ä½œä¸ºåˆå§‹å®¹é‡</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity,</span></span><br><span class="hljs-function"><span class="hljs-params">                         <span class="hljs-keyword">float</span> loadFactor, <span class="hljs-keyword">int</span> concurrencyLevel)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!(loadFactor &gt; <span class="hljs-number">0.0f</span>) || initialCapacity &lt; <span class="hljs-number">0</span> || concurrencyLevel &lt;= <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();<br>    <span class="hljs-keyword">if</span> (initialCapacity &lt; concurrencyLevel)   <span class="hljs-comment">// Use at least as many bins</span><br>        initialCapacity = concurrencyLevel;   <span class="hljs-comment">// as estimated threads</span><br>    <span class="hljs-keyword">long</span> size = (<span class="hljs-keyword">long</span>)(<span class="hljs-number">1.0</span> + (<span class="hljs-keyword">long</span>)initialCapacity / loadFactor);<br>    <span class="hljs-keyword">int</span> cap = (size &gt;= (<span class="hljs-keyword">long</span>)MAXIMUM_CAPACITY) ?<br>        MAXIMUM_CAPACITY : tableSizeFor((<span class="hljs-keyword">int</span>)size);<br>    <span class="hljs-keyword">this</span>.sizeCtl = cap;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åŸºäºä¸€ä¸ªMapé›†åˆï¼Œæ„å»ºä¸€ä¸ªConcurrentHashMap</span><br><span class="hljs-comment">//åˆå§‹å®¹é‡ä¸º16</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentHashMap</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.sizeCtl = DEFAULT_CAPACITY;<br>    putAll(m);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2ã€sizeCtlå«ä¹‰è§£é‡Š"><a href="#2ã€sizeCtlå«ä¹‰è§£é‡Š" class="headerlink" title="2ã€sizeCtlå«ä¹‰è§£é‡Š"></a>2ã€<code>sizeCtl</code>å«ä¹‰è§£é‡Š</h4><blockquote><p><strong>æ³¨æ„ï¼šä»¥ä¸Šè¿™äº›æ„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ¶‰åŠåˆ°ä¸€ä¸ªå˜é‡<code>sizeCtl</code>ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å˜é‡ï¼Œè€Œä¸”å…·æœ‰éå¸¸ä¸°å¯Œçš„å«ä¹‰ï¼Œå®ƒçš„å€¼ä¸åŒï¼Œå¯¹åº”çš„å«ä¹‰ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªå˜é‡ä¸åŒçš„å€¼çš„å«ä¹‰åšä¸€ä¸‹è¯´æ˜ï¼Œåç»­æºç åˆ†æè¿‡ç¨‹ä¸­ï¼Œè¿›ä¸€æ­¥è§£é‡Š</strong></p><p><code>sizeCtl</code>ä¸º0ï¼Œä»£è¡¨æ•°ç»„æœªåˆå§‹åŒ–ï¼Œ ä¸”æ•°ç»„çš„åˆå§‹å®¹é‡ä¸º16</p><p><code>sizeCtl</code>ä¸ºæ­£æ•°ï¼Œå¦‚æœæ•°ç»„æœªåˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„åˆå§‹å®¹é‡ï¼Œå¦‚æœæ•°ç»„å·²ç»åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„æ‰©å®¹é˜ˆå€¼0.75n</p><p><code>sizeCtl</code>ä¸º-1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–</p><p><code>sizeCtl</code>å°äº0ï¼Œå¹¶ä¸”ä¸æ˜¯-1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨æ‰©å®¹ï¼Œ -(1+n)ï¼Œè¡¨ç¤ºæ­¤æ—¶æœ‰nä¸ªçº¿ç¨‹æ­£åœ¨å…±åŒå®Œæˆæ•°ç»„çš„æ‰©å®¹æ“ä½œ</p></blockquote><h3 id="äºŒã€jdk1-8æ·»åŠ å®‰å…¨"><a href="#äºŒã€jdk1-8æ·»åŠ å®‰å…¨" class="headerlink" title="äºŒã€jdk1.8æ·»åŠ å®‰å…¨"></a>äºŒã€jdk1.8æ·»åŠ å®‰å…¨</h3><h4 id="1ã€æºç åˆ†æ-1"><a href="#1ã€æºç åˆ†æ-1" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><h5 id="1-1ã€æ·»åŠ å…ƒç´ put-putValæ–¹æ³•"><a href="#1-1ã€æ·»åŠ å…ƒç´ put-putValæ–¹æ³•" class="headerlink" title="1.1ã€æ·»åŠ å…ƒç´ put/putValæ–¹æ³•"></a>1.1ã€æ·»åŠ å…ƒç´ put/putValæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> putVal(key, value, <span class="hljs-keyword">false</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>CHM</code> ä¸å…è®¸æœ‰ <strong>ç©ºå€¼æˆ–ç©ºé”®</strong></li><li><code>int hash = spread(key.hashCode())</code> æ‰°åŠ¨å‡½æ•°ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œ<code>(h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS</code>ï¼šé«˜åå…­ä½å‚ä¸å“ˆå¸Œå€¼è¿ç®—ï¼ŒåŒæ—¶ <code>&amp; 0x7fffffff</code> å³ <code>0111 1111 1111 1111 1111 1111 1111 1111</code> é«˜ä½ä¸º0ï¼Œå¾—åˆ°çš„å“ˆå¸Œå€¼å¿…ç„¶ä¸º <strong>æ­£æ•°</strong> </li><li>åœ¨ <code>else</code> é‡Œåªå¯¹å¾…æ’å…¥æ¡¶ <code>f</code> åŠ é”ï¼Œä¸å½±å“ <code>table</code> çš„å…¶ä»–å…ƒç´ ï¼Œä¿è¯äº†å®‰å…¨å’Œé«˜æ•ˆ</li><li>è¿›å…¥ <code>else</code> ååˆè¿›è¡Œæ¡¶å¤´ç»“ç‚¹çš„åˆ¤æ–­ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹åœ¨æ’å…¥ä¹‹å‰ï¼Œå°†æ¡¶ç»“æ„æ ‘åŒ–ï¼Œå› ä¸º æ ‘åŒ– <code>treeifyBin</code> åœ¨ <code>synchronized</code> ä¹‹å¤–</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;<br>    <span class="hljs-comment">//å¦‚æœæœ‰ç©ºå€¼æˆ–è€…ç©ºé”®ï¼Œç›´æ¥æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span> || value == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>    <span class="hljs-comment">//åŸºäºkeyè®¡ç®—hashå€¼ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„æ‰°åŠ¨</span><br>    <span class="hljs-keyword">int</span> hash = spread(key.hashCode());<br>    <span class="hljs-comment">//è®°å½•æŸä¸ªæ¡¶ä¸Šå…ƒç´ çš„ä¸ªæ•°ï¼Œå¦‚æœè¶…è¿‡8ä¸ªï¼Œä¼šè½¬æˆçº¢é»‘æ ‘</span><br>    <span class="hljs-keyword">int</span> binCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// æ­»å¾ªç¯</span><br>    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;<br>        Node&lt;K,V&gt; f; <span class="hljs-keyword">int</span> n, i, fh;<br>        <span class="hljs-comment">//å¦‚æœæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–</span><br>        <span class="hljs-keyword">if</span> (tab == <span class="hljs-keyword">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>            tab = initTable();<br>    <span class="hljs-comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ©ç”¨caså°†å…ƒç´ æ·»åŠ </span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">//cas+è‡ªæ—‹ï¼ˆå’Œå¤–ä¾§çš„foræ„æˆè‡ªæ—‹å¾ªç¯ï¼‰ï¼Œæ·»åŠ å‰å†åˆ¤ç©ºï¼Œä¿è¯å…ƒç´ æ·»åŠ å®‰å…¨</span><br>            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-keyword">null</span>,<br>                         <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="hljs-keyword">null</span>)))<br>                <span class="hljs-keyword">break</span>;                   <span class="hljs-comment">// no lock when adding to empty bin</span><br>        &#125;<br>        <span class="hljs-comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®å…ƒç´ çš„hashå€¼ä¸ºMOVEDï¼Œè¯æ˜æ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆååŠ©æ‰©å®¹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)<br>            tab = helpTransfer(tab, f);<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//hashè®¡ç®—çš„æ¡¶ä½ç½®å…ƒç´ ä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ²¡æœ‰å¤„äºæ‰©å®¹æ“ä½œï¼Œè¿›è¡Œå…ƒç´ æ·»åŠ </span><br>            V oldVal = <span class="hljs-keyword">null</span>;<br>            <span class="hljs-comment">//å¯¹å½“å‰æ¡¶å¤´ç»“ç‚¹è¿›è¡ŒåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰§è¡Œå…ƒç´ æ·»åŠ æ“ä½œ</span><br>            <span class="hljs-keyword">synchronized</span> (f) &#123;<br>                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) &#123;<br>                    <span class="hljs-comment">//æ™®é€šé“¾è¡¨èŠ‚ç‚¹</span><br>                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) &#123;<br>                        binCount = <span class="hljs-number">1</span>;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;<br>                            K ek;<br>                            <span class="hljs-comment">// keyç›¸åŒï¼Œåˆ™å°†å€¼è¦†ç›–æ‰ã€Œæ˜¯å¦è¦†ç›–å–å†³äºonlyIfAbsentã€</span><br>                            <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                                ((ek = e.key) == key ||<br>                                 (ek != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;<br>                                oldVal = e.val;<br>                                <span class="hljs-keyword">if</span> (!onlyIfAbsent)<br>                                    e.val = value;<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br>                            Node&lt;K,V&gt; pred = e;<br>                            <span class="hljs-comment">// å°¾æ’æ³•</span><br>                            <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-keyword">null</span>) &#123;<br>                                pred.next = <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(hash, key,<br>                                                          value, <span class="hljs-keyword">null</span>);<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-comment">//æ ‘ç»“æ„ï¼Œå°†å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­</span><br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) &#123;<br>                        Node&lt;K,V&gt; p;<br>                        binCount = <span class="hljs-number">2</span>;<br>                        <span class="hljs-keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,<br>                                                       value)) != <span class="hljs-keyword">null</span>) &#123;<br>                            oldVal = p.val;<br>                            <span class="hljs-keyword">if</span> (!onlyIfAbsent)<br>                                p.val = value;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">//é“¾è¡¨é•¿åº¦å¤§äº/ ç­‰äº8ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘</span><br>                <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)<br>                    treeifyBin(tab, i); <span class="hljs-comment">// é‡Œé¢è¿˜è¦åˆ¤æ–­æ•°ç»„é•¿åº¦å¤§äºç­‰äº64ï¼Œæ‰ä¼šæ ‘åŒ–</span><br>                <span class="hljs-comment">//å¦‚æœæ˜¯é‡å¤é”®ï¼Œç›´æ¥å°†æ—§å€¼è¿”å›</span><br>                <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-keyword">null</span>)<br>                    <span class="hljs-keyword">return</span> oldVal;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//æ·»åŠ çš„æ˜¯æ–°å…ƒç´ ï¼Œç»´æŠ¤é›†åˆé•¿åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œæ‰©å®¹æ“ä½œ</span><br>    addCount(<span class="hljs-number">1L</span>, binCount);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>é€šè¿‡ä»¥ä¸Šæºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“éœ€è¦æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šé’ˆå¯¹å½“å‰å…ƒç´ æ‰€å¯¹åº”çš„æ¡¶ä½è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¿™æ ·ä¸€æ–¹é¢ä¿è¯å…ƒç´ æ·»åŠ æ—¶ï¼Œå¤šçº¿ç¨‹çš„å®‰å…¨ï¼ŒåŒæ—¶å¯¹æŸä¸ªæ¡¶ä½åŠ é”ä¸ä¼šå½±å“å…¶ä»–æ¡¶ä½çš„æ“ä½œï¼Œè¿›ä¸€æ­¥æå‡å¤šçº¿ç¨‹çš„å¹¶å‘æ•ˆç‡</p></blockquote><h5 id="1-2ã€æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTableæ–¹æ³•"><a href="#1-2ã€æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTableæ–¹æ³•" class="headerlink" title="1.2ã€æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTableæ–¹æ³•"></a>1.2ã€æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTableæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;<br>    Node&lt;K,V&gt;[] tab; <span class="hljs-keyword">int</span> sc;<br>    <span class="hljs-comment">//cas+è‡ªæ—‹ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span><br>    <span class="hljs-keyword">while</span> ((tab = table) == <span class="hljs-keyword">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">//å¦‚æœsizeCtlçš„å€¼ï¼ˆ-1ï¼‰å°äº0ï¼Œè¯´æ˜æ­¤æ—¶æ­£åœ¨åˆå§‹åŒ–ï¼Œ è®©å‡ºcpu</span><br>        <span class="hljs-keyword">if</span> ((sc = sizeCtl) &lt; <span class="hljs-number">0</span>)<br>            Thread.yield(); <span class="hljs-comment">// lost initialization race; just spin</span><br>        <span class="hljs-comment">//casä¿®æ”¹sizeCtlçš„å€¼ä¸º-1ï¼Œä¿®æ”¹æˆåŠŸï¼Œè¿›è¡Œæ•°ç»„åˆå§‹åŒ–ï¼Œå¤±è´¥ï¼Œç»§ç»­è‡ªæ—‹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc, -<span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// double-checked</span><br>                <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-keyword">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">//sizeCtlä¸º0ï¼Œå–é»˜è®¤é•¿åº¦16ï¼Œå¦åˆ™å–sizeCtlçš„å€¼ï¼Œå³è‡ªå®šä¹‰å€¼</span><br>                    <span class="hljs-keyword">int</span> n = (sc &gt; <span class="hljs-number">0</span>) ? sc : DEFAULT_CAPACITY;<br>                    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-comment">//åŸºäºåˆå§‹é•¿åº¦ï¼Œæ„å»ºæ•°ç»„å¯¹è±¡</span><br>                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> Node&lt;?,?&gt;[n];<br>                    table = tab = nt;<br>                    <span class="hljs-comment">//è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œå¹¶èµ‹å€¼ç»™sc</span><br>                    sc = n - (n &gt;&gt;&gt; <span class="hljs-number">2</span>); <span class="hljs-comment">// 0.75n</span><br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">//å°†æ‰©å®¹é˜ˆå€¼ï¼Œèµ‹å€¼ç»™sizeCtl</span><br>                sizeCtl = sc;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> tab;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2ã€å›¾è§£"><a href="#2ã€å›¾è§£" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h4><h5 id="2-1ã€putåŠ é”å›¾è§£"><a href="#2-1ã€putåŠ é”å›¾è§£" class="headerlink" title="2.1ã€putåŠ é”å›¾è§£"></a>2.1ã€putåŠ é”å›¾è§£</h5><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/CHM1.8%E6%B7%BB%E5%8A%A0%E5%AE%89%E5%85%A8.jpg" alt="CHM1.8æ·»åŠ å®‰å…¨"></p><h3 id="ä¸‰ã€jdk1-8æ‰©å®¹å®‰å…¨"><a href="#ä¸‰ã€jdk1-8æ‰©å®¹å®‰å…¨" class="headerlink" title="ä¸‰ã€jdk1.8æ‰©å®¹å®‰å…¨"></a>ä¸‰ã€jdk1.8æ‰©å®¹å®‰å…¨</h3><ul><li>çº¿ç¨‹</li></ul><h4 id="1ã€æºç åˆ†æ-2"><a href="#1ã€æºç åˆ†æ-2" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> n = tab.length, stride;<br>    <span class="hljs-comment">//å¦‚æœæ˜¯å¤šcpuï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹åˆ’åˆ†ä»»åŠ¡ï¼Œæœ€å°ä»»åŠ¡é‡æ˜¯16ä¸ªæ¡¶ä½çš„è¿ç§»</span><br>    <span class="hljs-keyword">if</span> ((stride = (NCPU &gt; <span class="hljs-number">1</span>) ? (n &gt;&gt;&gt; <span class="hljs-number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)<br>        stride = MIN_TRANSFER_STRIDE; <span class="hljs-comment">// subdivide range</span><br>    <span class="hljs-comment">//å¦‚æœæ˜¯æ‰©å®¹çº¿ç¨‹ï¼Œæ­¤æ—¶æ–°æ•°ç»„ä¸ºnull</span><br>    <span class="hljs-keyword">if</span> (nextTab == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-comment">// initiating</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            <span class="hljs-comment">//ä¸¤å€æ‰©å®¹åˆ›å»ºæ–°æ•°ç»„</span><br>            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> Node&lt;?,?&gt;[n &lt;&lt; <span class="hljs-number">1</span>];<br>            nextTab = nt;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable ex) &#123;      <span class="hljs-comment">// try to cope with OOME</span><br>            sizeCtl = Integer.MAX_VALUE;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        nextTable = nextTab;<br>        <span class="hljs-comment">//è®°å½•çº¿ç¨‹å¼€å§‹è¿ç§»çš„æ¡¶ä½ï¼Œä»åå¾€å‰è¿ç§»</span><br>        transferIndex = n;<br>    &#125;<br>    <span class="hljs-comment">//è®°å½•æ–°æ•°ç»„çš„æœ«å°¾</span><br>    <span class="hljs-keyword">int</span> nextn = nextTab.length;<br>    <span class="hljs-comment">//å·²ç»è¿ç§»çš„æ¡¶ä½ï¼Œä¼šç”¨è¿™ä¸ªèŠ‚ç‚¹å ä½ï¼ˆè¿™ä¸ªèŠ‚ç‚¹çš„hashå€¼ä¸º-1--MOVEDï¼‰</span><br>    ForwardingNode&lt;K,V&gt; fwd = <span class="hljs-keyword">new</span> ForwardingNode&lt;K,V&gt;(nextTab);<br>    <span class="hljs-keyword">boolean</span> advance = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">boolean</span> finishing = <span class="hljs-keyword">false</span>; <span class="hljs-comment">// to ensure sweep before committing nextTab</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, bound = <span class="hljs-number">0</span>;;) &#123;<br>        Node&lt;K,V&gt; f; <span class="hljs-keyword">int</span> fh;<br>        <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹åªè¿ç§»ä¸€æ®µæ¡¶ï¼Œå…ˆè®¡ç®—è¯¥çº¿ç¨‹è¿ç§»å“ªæ®µ</span><br>        <span class="hljs-keyword">while</span> (advance) &#123;<br>            <span class="hljs-keyword">int</span> nextIndex, nextBound;<br>            <span class="hljs-comment">//iè®°å½•å½“å‰æ­£åœ¨è¿ç§»æ¡¶ä½çš„ç´¢å¼•å€¼</span><br>            <span class="hljs-comment">//boundè®°å½•ä¸‹ä¸€æ¬¡ä»»åŠ¡è¿ç§»çš„å¼€å§‹æ¡¶ä½</span><br>            <br>            <span class="hljs-comment">//--i &gt;= bound æˆç«‹è¡¨ç¤ºå½“å‰çº¿ç¨‹åˆ†é…çš„è¿ç§»ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆ</span><br>            <span class="hljs-keyword">if</span> (--i &gt;= bound || finishing)<br>                advance = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">//æ²¡æœ‰å…ƒç´ éœ€è¦è¿ç§» -- åç»­ä¼šå»å°†æ‰©å®¹çº¿ç¨‹æ•°å‡1ï¼Œå¹¶åˆ¤æ–­æ‰©å®¹æ˜¯å¦å®Œæˆ</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="hljs-number">0</span>) &#123;<br>                i = -<span class="hljs-number">1</span>;<br>                advance = <span class="hljs-keyword">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//è®¡ç®—ä¸‹ä¸€æ¬¡ä»»åŠ¡è¿ç§»çš„å¼€å§‹æ¡¶ä½ï¼Œå¹¶å°†è¿™ä¸ªå€¼èµ‹å€¼ç»™transferIndex</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt<br>                     (<span class="hljs-keyword">this</span>, TRANSFERINDEX, nextIndex,<br>                      nextBound = (nextIndex &gt; stride ?<br>                                   nextIndex - stride : <span class="hljs-number">0</span>))) &#123;<br>                bound = nextBound;<br>                i = nextIndex - <span class="hljs-number">1</span>;<br>                advance = <span class="hljs-keyword">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//å¦‚æœæ²¡æœ‰æ›´å¤šçš„éœ€è¦è¿ç§»çš„æ¡¶ä½ï¼Œå°±è¿›å…¥è¯¥if</span><br>        <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;<br>            <span class="hljs-keyword">int</span> sc;<br>            <span class="hljs-comment">//æ‰©å®¹ç»“æŸåï¼Œä¿å­˜æ–°æ•°ç»„ï¼Œå¹¶é‡æ–°è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œèµ‹å€¼ç»™sizeCtl</span><br>            <span class="hljs-comment">//è¿™é‡Œæ‰æ˜¯çœŸæ­£çš„ç»“æŸæ‰©å®¹ï¼Œæ–°è¡¨æ›¿æ¢æ—§è¡¨ï¼Œé‡æ–°è®¡ç®—sizeCtl</span><br>            <span class="hljs-keyword">if</span> (finishing) &#123;<br>                nextTable = <span class="hljs-keyword">null</span>;<br>                table = nextTab;<br>                <span class="hljs-comment">//2n-0.5n = 1.5n = 0.75 * 2nï¼Œæ‰©å®¹2å€åçš„ä¸‹ä¸€æ¬¡æ‰©å®¹é˜ˆå€¼</span><br>                sizeCtl = (n &lt;&lt; <span class="hljs-number">1</span>) - (n &gt;&gt;&gt; <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>   <span class="hljs-comment">//æ‰©å®¹ä»»åŠ¡çº¿ç¨‹æ•°å‡1</span><br>            <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ‰€æœ‰æ‰©å®¹ä»»åŠ¡çº¿ç¨‹æ˜¯å¦éƒ½æ‰§è¡Œå®Œæˆ</span><br>                <span class="hljs-comment">//åœ¨addCount()é‡Œæœ€ä¸‹é¢çš„transferä¹‹å‰ï¼Œcaså°†scèµ‹å€¼ä¸º</span><br>                <span class="hljs-comment">//(rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2ï¼Œä¸ä¸‹é¢åˆ¤æ–­ç›¸åŒï¼Œåˆ™è¯æ˜æ‰©å®¹å®Œæ¯•</span><br>                <span class="hljs-keyword">if</span> ((sc - <span class="hljs-number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)<br>                    <span class="hljs-keyword">return</span>;<br>                <span class="hljs-comment">//æ‰€æœ‰æ‰©å®¹çº¿ç¨‹éƒ½æ‰§è¡Œå®Œï¼Œæ ‡è¯†ç»“æŸ</span><br>                finishing = advance = <span class="hljs-keyword">true</span>;<br>                i = n; <span class="hljs-comment">// recheck before commit</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//å½“å‰è¿ç§»çš„æ¡¶ä½æ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥åœ¨è¯¥ä½ç½®æ·»åŠ ä¸€ä¸ªfwdèŠ‚ç‚¹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i)) == <span class="hljs-keyword">null</span>)<br>            advance = casTabAt(tab, i, <span class="hljs-keyword">null</span>, fwd);<br>        <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹å·²ç»è¢«è¿ç§»</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)<br>            advance = <span class="hljs-keyword">true</span>; <span class="hljs-comment">// already processed</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹éœ€è¦è¿ç§»ï¼ŒåŠ é”è¿ç§»ï¼Œä¿è¯å¤šçº¿ç¨‹å®‰å…¨</span><br>            <span class="hljs-comment">//æ­¤å¤„è¿ç§»é€»è¾‘å’Œjdk7çš„ConcurrentHashMapç›¸åŒï¼Œä¸å†èµ˜è¿°</span><br>            <span class="hljs-keyword">synchronized</span> (f) &#123;<br>                <span class="hljs-comment">//double-checkedï¼Œé˜²æ­¢æ¡¶å‡çº§ä¸ºæ ‘ç»“æ„è€Œå‡ºé”™</span><br>                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) &#123;<br>                    Node&lt;K,V&gt; ln, hn;<br>                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">int</span> runBit = fh &amp; n;<br>                        Node&lt;K,V&gt; lastRun = f;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="hljs-keyword">null</span>; p = p.next) &#123;<br>                            <span class="hljs-keyword">int</span> b = p.hash &amp; n;<br>                            <span class="hljs-keyword">if</span> (b != runBit) &#123;<br>                                runBit = b;<br>                                lastRun = p;<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (runBit == <span class="hljs-number">0</span>) &#123;<br>                            ln = lastRun;<br>                            hn = <span class="hljs-keyword">null</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            hn = lastRun;<br>                            ln = <span class="hljs-keyword">null</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;<br>                            <span class="hljs-keyword">int</span> ph = p.hash; K pk = p.key; V pv = p.val;<br>                            <span class="hljs-keyword">if</span> ((ph &amp; n) == <span class="hljs-number">0</span>)<br>                                ln = <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, ln);<br>                            <span class="hljs-keyword">else</span><br>                                hn = <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, hn);<br>                        &#125;<br>                        setTabAt(nextTab, i, ln);<br>                        setTabAt(nextTab, i + n, hn);<br>                        <span class="hljs-comment">//è¿ç§»è¿‡åï¼ŒåŸæ¡¶åŠ å…¥fwd</span><br>                        setTabAt(tab, i, fwd);<br>                        advance = <span class="hljs-keyword">true</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) &#123;<br>                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;<br>                        TreeNode&lt;K,V&gt; lo = <span class="hljs-keyword">null</span>, loTail = <span class="hljs-keyword">null</span>;<br>                        TreeNode&lt;K,V&gt; hi = <span class="hljs-keyword">null</span>, hiTail = <span class="hljs-keyword">null</span>;<br>                        <span class="hljs-keyword">int</span> lc = <span class="hljs-number">0</span>, hc = <span class="hljs-number">0</span>;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class="hljs-keyword">null</span>; e = e.next) &#123;<br>                            <span class="hljs-keyword">int</span> h = e.hash;<br>                            TreeNode&lt;K,V&gt; p = <span class="hljs-keyword">new</span> TreeNode&lt;K,V&gt;<br>                                (h, e.key, e.val, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);<br>                            <span class="hljs-keyword">if</span> ((h &amp; n) == <span class="hljs-number">0</span>) &#123;<br>                                <span class="hljs-keyword">if</span> ((p.prev = loTail) == <span class="hljs-keyword">null</span>)<br>                                    lo = p;<br>                                <span class="hljs-keyword">else</span><br>                                    loTail.next = p;<br>                                loTail = p;<br>                                ++lc;<br>                            &#125;<br>                            <span class="hljs-keyword">else</span> &#123;<br>                                <span class="hljs-keyword">if</span> ((p.prev = hiTail) == <span class="hljs-keyword">null</span>)<br>                                    hi = p;<br>                                <span class="hljs-keyword">else</span><br>                                    hiTail.next = p;<br>                                hiTail = p;<br>                                ++hc;<br>                            &#125;<br>                        &#125;<br>                        ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :<br>                            (hc != <span class="hljs-number">0</span>) ? <span class="hljs-keyword">new</span> TreeBin&lt;K,V&gt;(lo) : t;<br>                        hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :<br>                            (lc != <span class="hljs-number">0</span>) ? <span class="hljs-keyword">new</span> TreeBin&lt;K,V&gt;(hi) : t;<br>                        setTabAt(nextTab, i, ln);<br>                        setTabAt(nextTab, i + n, hn);<br>                        setTabAt(tab, i, fwd);<br>                        advance = <span class="hljs-keyword">true</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2ã€å›¾è§£-1"><a href="#2ã€å›¾è§£-1" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h4><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/CHM1.8%E6%89%A9%E5%AE%B9%E5%AE%89%E5%85%A8.png" alt="CHM1.8æ‰©å®¹å®‰å…¨"></p><h3 id="å››ã€jdk1-8å¤šçº¿ç¨‹æ‰©å®¹æ•ˆç‡æ”¹è¿›"><a href="#å››ã€jdk1-8å¤šçº¿ç¨‹æ‰©å®¹æ•ˆç‡æ”¹è¿›" class="headerlink" title="å››ã€jdk1.8å¤šçº¿ç¨‹æ‰©å®¹æ•ˆç‡æ”¹è¿›"></a>å››ã€jdk1.8å¤šçº¿ç¨‹æ‰©å®¹æ•ˆç‡æ”¹è¿›</h3><blockquote><p>å¤šçº¿ç¨‹ååŠ©æ‰©å®¹çš„æ“ä½œä¼šåœ¨ä¸¤ä¸ªåœ°æ–¹è¢«è§¦å‘ï¼š</p><p>â‘  å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œå‘ç°æ·»åŠ çš„å…ƒç´ å¯¹ç”¨çš„æ¡¶ä½ä¸ºfwdèŠ‚ç‚¹ï¼Œå°±ä¼šå…ˆå»ååŠ©æ‰©å®¹ï¼Œç„¶åå†æ·»åŠ å…ƒç´ </p><p>â‘¡ å½“æ·»åŠ å®Œå…ƒç´ åï¼Œåˆ¤æ–­å½“å‰å…ƒç´ ä¸ªæ•°è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼Œæ­¤æ—¶å‘ç°sizeCtlçš„å€¼å°äº0ï¼Œå¹¶ä¸”æ–°æ•°ç»„ä¸ä¸ºç©ºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šå»ååŠ©æ‰©å®¹</p></blockquote><h4 id="1ã€æºç åˆ†æ-3"><a href="#1ã€æºç åˆ†æ-3" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><h5 id="1-1ã€å…ƒç´ æœªæ·»åŠ ï¼Œå…ˆååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œåå†æ·»åŠ å…ƒç´ "><a href="#1-1ã€å…ƒç´ æœªæ·»åŠ ï¼Œå…ˆååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œåå†æ·»åŠ å…ƒç´ " class="headerlink" title="1.1ã€å…ƒç´ æœªæ·»åŠ ï¼Œå…ˆååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œåå†æ·»åŠ å…ƒç´ "></a>1.1ã€å…ƒç´ æœªæ·»åŠ ï¼Œå…ˆååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œåå†æ·»åŠ å…ƒç´ </h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span> || value == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>    <span class="hljs-keyword">int</span> hash = spread(key.hashCode());<br>    <span class="hljs-keyword">int</span> binCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;<br>        Node&lt;K,V&gt; f; <span class="hljs-keyword">int</span> n, i, fh;<br>        <span class="hljs-keyword">if</span> (tab == <span class="hljs-keyword">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>            tab = initTable();<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-keyword">null</span>,<br>                         <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="hljs-keyword">null</span>)))<br>                <span class="hljs-keyword">break</span>;                   <span class="hljs-comment">// no lock when adding to empty bin</span><br>        &#125;<br>        <span class="hljs-comment">//å‘ç°æ­¤å¤„ä¸ºfwdèŠ‚ç‚¹ï¼ŒååŠ©æ‰©å®¹ï¼Œæ‰©å®¹ç»“æŸåï¼Œå†å¾ªç¯å›æ¥æ·»åŠ å…ƒç´ </span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)<br>            tab = helpTransfer(tab, f);<br>        <br>        <span class="hljs-comment">//çœç•¥ä»£ç </span><br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) &#123;<br>    Node&lt;K,V&gt;[] nextTab; <span class="hljs-keyword">int</span> sc;<br>    <span class="hljs-keyword">if</span> (tab != <span class="hljs-keyword">null</span> &amp;&amp; (f <span class="hljs-keyword">instanceof</span> ForwardingNode) &amp;&amp;<br>        (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">int</span> rs = resizeStamp(tab.length);<br>        <span class="hljs-keyword">while</span> (nextTab == nextTable &amp;&amp; table == tab &amp;&amp;<br>               (sc = sizeCtl) &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                sc == rs + MAX_RESIZERS || transferIndex &lt;= <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">//æ‰©å®¹ï¼Œä¼ é€’ä¸€ä¸ªä¸æ˜¯nullçš„nextTab</span><br>                transfer(tab, nextTab);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> nextTab;<br>    &#125;<br>    <span class="hljs-keyword">return</span> table;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="1-2ã€å…ˆæ·»åŠ å…ƒç´ ï¼Œå†ååŠ©æ‰©å®¹"><a href="#1-2ã€å…ˆæ·»åŠ å…ƒç´ ï¼Œå†ååŠ©æ‰©å®¹" class="headerlink" title="1.2ã€å…ˆæ·»åŠ å…ƒç´ ï¼Œå†ååŠ©æ‰©å®¹"></a>1.2ã€å…ˆæ·»åŠ å…ƒç´ ï¼Œå†ååŠ©æ‰©å®¹</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCount</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">int</span> check)</span> </span>&#123;<br>    <span class="hljs-comment">//çœç•¥ä»£ç </span><br>    <br>    <span class="hljs-keyword">if</span> (check &gt;= <span class="hljs-number">0</span>) &#123;<br>        Node&lt;K,V&gt;[] tab, nt; <span class="hljs-keyword">int</span> n, sc;<br>      <span class="hljs-comment">//å…ƒç´ ä¸ªæ•°è¾¾åˆ°æ‰©å®¹é˜ˆå€¼</span><br>        <span class="hljs-keyword">while</span> (s &gt;= (<span class="hljs-keyword">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="hljs-keyword">null</span> &amp;&amp;<br>               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;<br>            <span class="hljs-keyword">int</span> rs = resizeStamp(n);<br>            <span class="hljs-comment">//sizeCtlå°äº0ï¼Œè¯´æ˜æ­£åœ¨æ‰§è¡Œæ‰©å®¹ï¼Œé‚£ä¹ˆååŠ©æ‰©å®¹ï¼Œè¿™é‡Œä¸helpTransfer()æ˜¯ä¸€æ ·çš„</span><br>            <span class="hljs-keyword">if</span> (sc &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="hljs-keyword">null</span> ||<br>                    transferIndex &lt;= <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>))<br>                    transfer(tab, nt); <span class="hljs-comment">// è¿™é‡Œä¼ å…¥ newTable</span><br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc,<br>                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="hljs-number">2</span>))<br>                transfer(tab, <span class="hljs-keyword">null</span>); <span class="hljs-comment">// è¿™é‡Œä¼ å…¥ç©ºçš„ newTable è¡¨ç¤ºæ²¡æœ‰åˆ›å»ºæ–°æ•°ç»„</span><br>            s = sumCount();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šæ‰©å®¹çš„ä»£ç éƒ½åœ¨transferæ–¹æ³•ä¸­ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p></blockquote><h4 id="2ã€å›¾è§£-2"><a href="#2ã€å›¾è§£-2" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h4><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/CHM1.8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%A9%E5%AE%B9.png" alt="CHM1.8å¤šçº¿ç¨‹æ‰©å®¹"></p><h3 id="äº”ã€é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼"><a href="#äº”ã€é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼" class="headerlink" title="äº”ã€é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼"></a>äº”ã€é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼</h3><h4 id="1ã€æºç åˆ†æ-4"><a href="#1ã€æºç åˆ†æ-4" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><h5 id="1-1ã€addCountæ–¹æ³•"><a href="#1-1ã€addCountæ–¹æ³•" class="headerlink" title="1.1ã€addCountæ–¹æ³•"></a>1.1ã€addCountæ–¹æ³•</h5><blockquote><p><strong>â‘  CounterCellæ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆåˆ©ç”¨æ•°ç»„ä¸­çš„CounterCellè®°å½•æ•°é‡</strong></p><p><strong>â‘¡ å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œå°è¯•å¯¹baseCountè¿›è¡Œç´¯åŠ ï¼Œå¤±è´¥åï¼Œä¼šæ‰§è¡ŒfullAddCounté€»è¾‘</strong></p><p><strong>â‘¢ å¦‚æœæ˜¯æ·»åŠ å…ƒç´ æ“ä½œï¼Œä¼šç»§ç»­åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCount</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">int</span> check)</span> </span>&#123;<br>    CounterCell[] as; <span class="hljs-keyword">long</span> b, s;<br>    <span class="hljs-comment">//å½“CounterCellæ•°ç»„ä¸ä¸ºç©ºï¼Œåˆ™ä¼˜å…ˆåˆ©ç”¨æ•°ç»„ä¸­çš„CounterCellè®°å½•æ•°é‡</span><br>    <span class="hljs-comment">//æˆ–è€…å½“baseCountçš„ç´¯åŠ æ“ä½œå¤±è´¥ï¼Œä¼šåˆ©ç”¨æ•°ç»„ä¸­çš„CounterCellè®°å½•æ•°é‡</span><br>    <span class="hljs-keyword">if</span> ((as = counterCells) != <span class="hljs-keyword">null</span> ||<br>        !U.compareAndSwapLong(<span class="hljs-keyword">this</span>, BASECOUNT, b = baseCount, s = b + x)) &#123;<br>        CounterCell a; <span class="hljs-keyword">long</span> v; <span class="hljs-keyword">int</span> m;<br>        <span class="hljs-comment">//æ ‡è¯†æ˜¯å¦æœ‰å¤šçº¿ç¨‹ç«äº‰</span><br>        <span class="hljs-keyword">boolean</span> uncontended = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-comment">//å½“asæ•°ç»„ä¸ºç©º</span><br>        <span class="hljs-comment">//æˆ–è€…å½“asé•¿åº¦ä¸º0</span><br>        <span class="hljs-comment">//æˆ–è€…å½“å‰çº¿ç¨‹å¯¹åº”çš„asæ•°ç»„æ¡¶ä½çš„å…ƒç´ ä¸ºç©º</span><br>        <span class="hljs-comment">//æˆ–è€…å½“å‰çº¿ç¨‹å¯¹åº”çš„asæ•°ç»„æ¡¶ä½ä¸ä¸ºç©ºï¼Œä½†æ˜¯ç´¯åŠ å¤±è´¥</span><br>        <span class="hljs-keyword">if</span> (as == <span class="hljs-keyword">null</span> || (m = as.length - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> ||<br>            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == <span class="hljs-keyword">null</span> ||<br>            !(uncontended =<br>              U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123;<br>            <span class="hljs-comment">//ä»¥ä¸Šä»»ä½•ä¸€ç§æƒ…å†µæˆç«‹ï¼Œéƒ½ä¼šè¿›å…¥è¯¥æ–¹æ³•ï¼Œä¼ å…¥çš„uncontendedæ˜¯false</span><br>            fullAddCount(x, uncontended);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (check &lt;= <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">//è®¡ç®—å…ƒç´ ä¸ªæ•°</span><br>        s = sumCount();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (check &gt;= <span class="hljs-number">0</span>) &#123;<br>        Node&lt;K,V&gt;[] tab, nt; <span class="hljs-keyword">int</span> n, sc;<br>        <span class="hljs-comment">//å½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°æ‰©å®¹é˜ˆå€¼</span><br>        <span class="hljs-comment">//å¹¶ä¸”æ•°ç»„ä¸ä¸ºç©º</span><br>        <span class="hljs-comment">//å¹¶ä¸”æ•°ç»„é•¿åº¦å°äºé™å®šçš„æœ€å¤§å€¼</span><br>        <span class="hljs-comment">//æ»¡è¶³ä»¥ä¸Šæ‰€æœ‰æ¡ä»¶ï¼Œæ‰§è¡Œæ‰©å®¹</span><br>        <span class="hljs-keyword">while</span> (s &gt;= (<span class="hljs-keyword">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="hljs-keyword">null</span> &amp;&amp;<br>               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;<br>            <span class="hljs-comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°</span><br>            <span class="hljs-keyword">int</span> rs = resizeStamp(n);<br>            <span class="hljs-comment">//scå°äº0ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆä¼šååŠ©æ‰©å®¹</span><br>            <span class="hljs-keyword">if</span> (sc &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">//æ‰©å®¹ç»“æŸæˆ–è€…æ‰©å®¹çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æˆ–è€…æ‰©å®¹åçš„æ•°ç»„ä¸ºnullæˆ–è€…æ²¡æœ‰æ›´å¤šçš„æ¡¶ä½éœ€è¦è½¬ç§»ï¼Œç»“æŸæ“ä½œ</span><br>                <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="hljs-keyword">null</span> ||<br>                    transferIndex &lt;= <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-comment">//æ‰©å®¹çº¿ç¨‹åŠ 1ï¼ŒæˆåŠŸåï¼Œè¿›è¡ŒååŠ©æ‰©å®¹æ“ä½œ</span><br>                <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>))<br>                    <span class="hljs-comment">//ååŠ©æ‰©å®¹ï¼ŒnewTableä¸ä¸ºnull</span><br>                    transfer(tab, nt);<br>            &#125;<br>            <span class="hljs-comment">//æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨è¿›è¡Œæ‰©å®¹ï¼Œè¾¾åˆ°æ‰©å®¹é˜ˆå€¼åï¼Œç»™sizeCtlèµ‹äº†ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°</span><br>            <span class="hljs-comment">//1+1=2 --ã€‹ ä»£è¡¨æ­¤æ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰©å®¹</span><br>            <br>            <span class="hljs-comment">//rs &lt;&lt; RESIZE_STAMP_SHIFT)æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°</span><br>            <span class="hljs-comment">//rså·¦ç§»16ä½ï¼Œæœ€é«˜ä½æ˜¯1ï¼Œç¡®ä¿ sc èµ‹å€¼ä¸ºè´Ÿæ•°</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-keyword">this</span>, SIZECTL, sc,<br>                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="hljs-number">2</span>))<br>                <span class="hljs-comment">//æ‰©å®¹ï¼ŒnewTableä¸ºnull</span><br>                transfer(tab, <span class="hljs-keyword">null</span>);<br>            s = sumCount();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="1-2ã€fullAddCountæ–¹æ³•"><a href="#1-2ã€fullAddCountæ–¹æ³•" class="headerlink" title="1.2ã€fullAddCountæ–¹æ³•"></a>1.2ã€fullAddCountæ–¹æ³•</h5><blockquote><p><strong>â‘  å½“CounterCellæ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆå¯¹CounterCellæ•°ç»„ä¸­çš„CounterCellçš„valueç´¯åŠ </strong></p><p><strong>â‘¡ å½“CounterCellæ•°ç»„ä¸ºç©ºï¼Œä¼šå»åˆ›å»ºCounterCellæ•°ç»„ï¼Œé»˜è®¤é•¿åº¦ä¸º2ï¼Œå¹¶å¯¹æ•°ç»„ä¸­çš„CounterCellçš„valueç´¯åŠ </strong></p><p><strong>â‘¢ å½“æ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æ­¤æ—¶æœ‰åˆ«çš„çº¿ç¨‹æ­£åœ¨åˆ›å»ºæ•°ç»„ï¼Œé‚£ä¹ˆå°è¯•å¯¹baseCountåšç´¯åŠ ï¼ŒæˆåŠŸå³è¿”å›ï¼Œå¦åˆ™è‡ªæ—‹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fullAddCount</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">boolean</span> wasUncontended)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> h;<br>    <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹çš„hashå€¼</span><br>    <span class="hljs-keyword">if</span> ((h = ThreadLocalRandom.getProbe()) == <span class="hljs-number">0</span>) &#123;<br>        ThreadLocalRandom.localInit();      <span class="hljs-comment">// force initialization</span><br>        h = ThreadLocalRandom.getProbe();<br>        wasUncontended = <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <span class="hljs-comment">//æ ‡è¯†æ˜¯å¦æœ‰å†²çªï¼Œå¦‚æœæœ€åä¸€ä¸ªæ¡¶ä¸æ˜¯nullï¼Œé‚£ä¹ˆä¸ºtrue</span><br>    <span class="hljs-keyword">boolean</span> collide = <span class="hljs-keyword">false</span>;                <span class="hljs-comment">// True if last slot nonempty</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        CounterCell[] as; CounterCell a; <span class="hljs-keyword">int</span> n; <span class="hljs-keyword">long</span> v;<br>        <span class="hljs-comment">//æ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆå¯¹æ•°ç»„ä¸­CouterCellçš„valueç´¯åŠ </span><br>        <span class="hljs-keyword">if</span> ((as = counterCells) != <span class="hljs-keyword">null</span> &amp;&amp; (n = as.length) &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//çº¿ç¨‹å¯¹åº”çš„æ¡¶ä½ä¸ºnull</span><br>            <span class="hljs-keyword">if</span> ((a = as[(n - <span class="hljs-number">1</span>) &amp; h]) == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span>) &#123;            <span class="hljs-comment">// Try to attach new Cell</span><br>                    <span class="hljs-comment">//åˆ›å»ºCounterCellå¯¹è±¡</span><br>                    CounterCell r = <span class="hljs-keyword">new</span> CounterCell(x); <span class="hljs-comment">// Optimistic create</span><br>                    <span class="hljs-comment">//åˆ©ç”¨CASä¿®æ”¹cellBusyçŠ¶æ€ä¸º1ï¼ŒæˆåŠŸåˆ™å°†åˆšæ‰åˆ›å»ºçš„CounterCellå¯¹è±¡æ”¾å…¥æ•°ç»„ä¸­</span><br>                    <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp;<br>                        U.compareAndSwapInt(<span class="hljs-keyword">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                        <span class="hljs-keyword">boolean</span> created = <span class="hljs-keyword">false</span>;<br>                        <span class="hljs-keyword">try</span> &#123;               <span class="hljs-comment">// Recheck under lock</span><br>                            CounterCell[] rs; <span class="hljs-keyword">int</span> m, j;<br>                            <span class="hljs-comment">//æ¡¶ä½ä¸ºç©ºï¼Œ å°†CounterCellå¯¹è±¡æ”¾å…¥æ•°ç»„</span><br>                            <span class="hljs-keyword">if</span> ((rs = counterCells) != <span class="hljs-keyword">null</span> &amp;&amp;<br>                                (m = rs.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>                                rs[j = (m - <span class="hljs-number">1</span>) &amp; h] == <span class="hljs-keyword">null</span>) &#123;<br>                                rs[j] = r;<br>                                <span class="hljs-comment">//è¡¨ç¤ºæ”¾å…¥æˆåŠŸ</span><br>                                created = <span class="hljs-keyword">true</span>;<br>                            &#125;<br>                        &#125; <span class="hljs-keyword">finally</span> &#123;<br>                            cellsBusy = <span class="hljs-number">0</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (created) <span class="hljs-comment">//æˆåŠŸé€€å‡ºå¾ªç¯</span><br>                            <span class="hljs-keyword">break</span>;<br>                        <span class="hljs-comment">//æ¡¶ä½å·²ç»è¢«åˆ«çš„çº¿ç¨‹æ”¾ç½®äº†å·²ç»™CounterCellå¯¹è±¡ï¼Œç»§ç»­å¾ªç¯</span><br>                        <span class="hljs-keyword">continue</span>;           <span class="hljs-comment">// Slot is now non-empty</span><br>                    &#125;<br>                &#125;<br>                collide = <span class="hljs-keyword">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//æ¡¶ä½ä¸ä¸ºç©ºï¼Œé‡æ–°è®¡ç®—çº¿ç¨‹hashå€¼ï¼Œç„¶åç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!wasUncontended)       <span class="hljs-comment">// CAS already known to fail</span><br>                wasUncontended = <span class="hljs-keyword">true</span>;      <span class="hljs-comment">// Continue after rehash</span><br>            <span class="hljs-comment">//é‡æ–°è®¡ç®—äº†hashå€¼åï¼Œå¯¹åº”çš„æ¡¶ä½ä¾ç„¶ä¸ä¸ºç©ºï¼Œå¯¹valueç´¯åŠ </span><br>            <span class="hljs-comment">//æˆåŠŸåˆ™ç»“æŸå¾ªç¯</span><br>            <span class="hljs-comment">//å¤±è´¥åˆ™ç»§ç»­ä¸‹é¢åˆ¤æ–­</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">//æ•°ç»„è¢«åˆ«çš„çº¿ç¨‹æ”¹å˜äº†ï¼Œæˆ–è€…æ•°ç»„é•¿åº¦è¶…è¿‡äº†å¯ç”¨cpuå¤§å°ï¼Œé‡æ–°è®¡ç®—çº¿ç¨‹hashå€¼ï¼Œå¦åˆ™ç»§ç»­ä¸‹ä¸€ä¸ªåˆ¤æ–­</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (counterCells != as || n &gt;= NCPU)<br>                collide = <span class="hljs-keyword">false</span>;            <span class="hljs-comment">// At max size or stale</span><br>            <span class="hljs-comment">//å½“æ²¡æœ‰å†²çªï¼Œä¿®æ”¹ä¸ºæœ‰å†²çªï¼Œå¹¶é‡æ–°è®¡ç®—çº¿ç¨‹hashï¼Œç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!collide)<br>                collide = <span class="hljs-keyword">true</span>;<br>            <span class="hljs-comment">//å¦‚æœCounterCellçš„æ•°ç»„é•¿åº¦æ²¡æœ‰è¶…è¿‡cpuæ ¸æ•°ï¼Œå¯¹æ•°ç»„è¿›è¡Œä¸¤å€æ‰©å®¹</span><br>            <span class="hljs-comment">//å¹¶ç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp;<br>                     U.compareAndSwapInt(<span class="hljs-keyword">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (counterCells == as) &#123;<span class="hljs-comment">// Expand table unless stale</span><br>                        CounterCell[] rs = <span class="hljs-keyword">new</span> CounterCell[n &lt;&lt; <span class="hljs-number">1</span>];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)<br>                            rs[i] = as[i];<br>                        counterCells = rs;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    cellsBusy = <span class="hljs-number">0</span>;<br>                &#125;<br>                collide = <span class="hljs-keyword">false</span>;<br>                <span class="hljs-keyword">continue</span>;                   <span class="hljs-comment">// Retry with expanded table</span><br>            &#125;<br>            h = ThreadLocalRandom.advanceProbe(h);<br>        &#125;<br>        <span class="hljs-comment">//CounterCellæ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æ²¡æœ‰çº¿ç¨‹åœ¨åˆ›å»ºæ•°ç»„ï¼Œä¿®æ”¹æ ‡è®°ï¼Œå¹¶åˆ›å»ºæ•°ç»„</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp; counterCells == as &amp;&amp;<br>                 U.compareAndSwapInt(<span class="hljs-keyword">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-keyword">boolean</span> init = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-keyword">try</span> &#123;                           <span class="hljs-comment">// Initialize table</span><br>                <span class="hljs-keyword">if</span> (counterCells == as) &#123;<br>                    CounterCell[] rs = <span class="hljs-keyword">new</span> CounterCell[<span class="hljs-number">2</span>];<br>                    rs[h &amp; <span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> CounterCell(x);<br>                    counterCells = rs;<br>                    init = <span class="hljs-keyword">true</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                cellsBusy = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (init)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">//æ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æœ‰åˆ«çš„çº¿ç¨‹åœ¨åˆ›å»ºæ•°ç»„ï¼Œé‚£ä¹ˆå°è¯•å¯¹baseCountåšç´¯åŠ ï¼ŒæˆåŠŸå°±é€€å‡ºå¾ªç¯ï¼Œå¤±è´¥å°±ç»§ç»­å¾ªç¯</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapLong(<span class="hljs-keyword">this</span>, BASECOUNT, v = baseCount, v + x))<br>            <span class="hljs-keyword">break</span>;                          <span class="hljs-comment">// Fall back on using base</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2ã€å›¾è§£-3"><a href="#2ã€å›¾è§£-3" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h4><blockquote><p>fullAddCountæ–¹æ³•ä¸­ï¼Œå½“asæ•°ç»„ä¸ä¸ºç©ºçš„é€»è¾‘å›¾è§£</p></blockquote><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/CHM1.8%E9%9B%86%E5%90%88%E9%95%BF%E5%BA%A6%E8%8E%B7%E5%8F%96.png" alt="CHM1.8é›†åˆé•¿åº¦è·å–"></p><h3 id="å…­ã€jdk1-8é›†åˆé•¿åº¦è·å–"><a href="#å…­ã€jdk1-8é›†åˆé•¿åº¦è·å–" class="headerlink" title="å…­ã€jdk1.8é›†åˆé•¿åº¦è·å–"></a>å…­ã€jdk1.8é›†åˆé•¿åº¦è·å–</h3><ul><li><code>size</code> çš„è·å–ï¼Œå¦‚æœçº¿ç¨‹å¯ä»¥å°†å¤§å°ç›´æ¥åŠ å…¥åˆ° <code>baseCount</code> åˆ™ç»“æŸ</li><li>å¦åˆ™å°±å°è¯•åŠ åˆ° <code>counterCells</code> é‡Œï¼Œæ­¤æ•°ç»„ä¼šæœ‰æ‰©å®¹æœºåˆ¶ã€‚åŠ ä¸è¿›å»ï¼Œåˆ™éšæœºåŠ å…¥åˆ° <code>counterCells</code> çš„å…¶ä»–ä½ç½®ï¼Œè¿™ç‚¹åœ¨ <code>fullAddCount</code> æœ‰ä½“ç°å‡ºæ¥</li></ul><h4 id="1ã€æºç åˆ†æ-5"><a href="#1ã€æºç åˆ†æ-5" class="headerlink" title="1ã€æºç åˆ†æ"></a>1ã€æºç åˆ†æ</h4><h5 id="1-1ã€sizeæ–¹æ³•"><a href="#1-1ã€sizeæ–¹æ³•" class="headerlink" title="1.1ã€sizeæ–¹æ³•"></a>1.1ã€sizeæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">long</span> n = sumCount();<br>    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> :<br>            (n &gt; (<span class="hljs-keyword">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :<br>            (<span class="hljs-keyword">int</span>)n);<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="1-2ã€sumCountæ–¹æ³•"><a href="#1-2ã€sumCountæ–¹æ³•" class="headerlink" title="1.2ã€sumCountæ–¹æ³•"></a>1.2ã€sumCountæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sumCount</span><span class="hljs-params">()</span> </span>&#123;<br>    CounterCell[] as = counterCells; CounterCell a;<br>    <span class="hljs-comment">//è·å–baseCountçš„å€¼</span><br>    <span class="hljs-keyword">long</span> sum = baseCount;<br>    <span class="hljs-keyword">if</span> (as != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">//éå†CounterCellæ•°ç»„ï¼Œç´¯åŠ æ¯ä¸€ä¸ªCounterCellçš„valueå€¼</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; as.length; ++i) &#123;<br>            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-keyword">null</span>)<br>                sum += a.value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p></blockquote><h2 id="ğŸ”—Reference"><a href="#ğŸ”—Reference" class="headerlink" title="ğŸ”—Reference"></a>ğŸ”—Reference</h2><blockquote><p><a href="https://www.bilibili.com/video/BV17i4y1x71z">https://www.bilibili.com/video/BV17i4y1x71z</a></p><p><a href="https://blog.csdn.net/woaiwym/article/details/80675789">https://blog.csdn.net/woaiwym/article/details/80675789</a></p><p><a href="https://www.cnblogs.com/lonely-wolf/p/14502194.html">https://www.cnblogs.com/lonely-wolf/p/14502194.html</a></p><p><a href="https://segmentfault.com/a/1190000021237438">https://segmentfault.com/a/1190000021237438</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â…¡</title>
    <link href="/2021/08/16/JavaSE/Java%E5%B8%B8%E7%94%A8%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E2%85%A1/"/>
    <url>/2021/08/16/JavaSE/Java%E5%B8%B8%E7%94%A8%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E2%85%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaå¸¸ç”¨é›†åˆæºç åˆ†æ-â…¡"><a href="#Javaå¸¸ç”¨é›†åˆæºç åˆ†æ-â…¡" class="headerlink" title="Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â…¡"></a>Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â…¡</h1><blockquote><p>@Version: JDK 1.8</p><p>@IDE: IntellJ IDEA 2021.1</p><p>@Date: 2021/8/10</p><p>@Author: Hypocrite30</p></blockquote><h2 id="ä¸€ã€é›†åˆ"><a href="#ä¸€ã€é›†åˆ" class="headerlink" title="ä¸€ã€é›†åˆ"></a>ä¸€ã€é›†åˆ</h2><h3 id="â… ã€Setæ¥å£"><a href="#â… ã€Setæ¥å£" class="headerlink" title="â… ã€Setæ¥å£"></a>â… ã€Setæ¥å£</h3><ul><li>æ— åºã€Œæ·»åŠ å’Œå–å‡ºçš„é¡ºåºä¸ä¸€è‡´ã€ï¼Œæ²¡æœ‰ç´¢å¼•</li><li>ä¸å…è®¸<strong>é‡å¤å…ƒç´ </strong>ï¼Œæ‰€ä»¥æœ€å¤šåŒ…å«ä¸€ä¸ª <code>null</code></li><li>å¸¸ç”¨å®ç°ç±»æœ‰ <code>HashSet</code> &amp; <code>TreeSet</code></li></ul><h3 id="â…¡ã€Mapæ¥å£"><a href="#â…¡ã€Mapæ¥å£" class="headerlink" title="â…¡ã€Mapæ¥å£"></a>â…¡ã€Mapæ¥å£</h3><ul><li><code>Map</code> ä¸ <code>Collection</code> å¹¶åˆ—å­˜åœ¨ã€‚ç”¨äºä¿å­˜å…·æœ‰<strong>æ˜ å°„å…³ç³»</strong>çš„æ•°æ®ï¼š<strong>Key-Value</strong></li><li><code>Map</code> ä¸­çš„ <code>key</code> å’Œ <code>value</code> å¯ä»¥æ˜¯ä»»ä½•å¼•ç”¨ç±»å‹çš„æ•°æ®ï¼Œä¼šå°è£…åˆ° <code>HashMap$Node</code> å¯¹è±¡ä¸­</li><li><code>Map</code> ä¸­çš„ <code>key</code> ä¸å…è®¸é‡å¤ï¼ŒåŸå› å’Œ <code>HashSet</code> ä¸€æ ·ï¼Œ<code>Map</code> ä¸­çš„ <code>value</code> å¯ä»¥é‡å¤</li><li><code>Map</code> çš„ <code>key </code>å¯ä»¥ä¸º <code>null</code> , <code>value</code> ä¹Ÿå¯ä»¥ä¸º <code>null</code>ï¼Œæ³¨æ„ <code>key</code>ä¸º <code>null</code>, åªèƒ½æœ‰<strong>ä¸€ä¸ª</strong>ï¼Œ<code>value</code> ä¸º <code>null</code> ï¼Œå¯ä»¥å¤šä¸ª.</li><li>å¸¸ç”¨ <code>String</code> ç±»ä½œä¸º <code>Map</code> çš„ <code>key</code></li><li><code>key</code> å’Œ <code>value</code> ä¹‹é—´å­˜åœ¨<strong>å•å‘ä¸€å¯¹ä¸€</strong>å…³ç³»ï¼Œå³é€šè¿‡æŒ‡å®šçš„ <code>key</code> æ€»èƒ½æ‰¾åˆ°å¯¹åº”çš„ <code>value</code></li></ul><h2 id="äºŒã€HashMap"><a href="#äºŒã€HashMap" class="headerlink" title="äºŒã€HashMap"></a>äºŒã€HashMap</h2><h3 id="â… ã€Field"><a href="#â… ã€Field" class="headerlink" title="â… ã€Field"></a>â… ã€Field</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤åˆå§‹åŒ–å®¹é‡ï¼Œä¸”å®¹é‡å¿…é¡»æ˜¯ 2 æ¬¡å¹‚</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>; <span class="hljs-comment">// aka 16</span><br><span class="hljs-comment">// æœ€å¤§å®¹é‡ï¼Œåœ¨ä¸¤ä¸ªå¸¦å‚æ„é€ ä¸­çš„ä»»ä½•ä¸€ä¸ªéšå¼æŒ‡å®šæ›´é«˜çš„å€¼æ—¶ä½¿ç”¨ã€‚</span><br><span class="hljs-comment">// å¿…é¡»æ˜¯ 2 çš„æ¬¡å¹‚ &lt;= 1&lt;&lt;30</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAXIMUM_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;<br><span class="hljs-comment">// é»˜è®¤ç¼ºçœè´Ÿè½½å› å­å¤§å°</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="hljs-number">0.75f</span>;<br><span class="hljs-comment">// æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼šå³ é“¾è¡¨è½¬æˆçº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œå½“é“¾è¡¨é•¿åº¦ &gt; è¯¥å€¼æ—¶ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TREEIFY_THRESHOLD = <span class="hljs-number">8</span>;<br><span class="hljs-comment">// æ¡¶çš„é“¾è¡¨è¿˜åŸé˜ˆå€¼</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> UNTREEIFY_THRESHOLD = <span class="hljs-number">6</span>;<br><span class="hljs-comment">// å­˜å‚¨ç®±å¯æ ‘åŒ–çš„æœ€å°è¡¨å®¹é‡</span><br><span class="hljs-comment">// å½“Map table æ•°ç»„æ•°é‡ã€Œæ¡¶æ•°é‡ã€è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œè¡¨ä¸­çš„æ¡¶æ‰èƒ½è¿›è¡Œæ ‘å½¢åŒ–,</span><br><span class="hljs-comment">// å¦åˆ™æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ä¼šå¯¹æ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– </span><br><span class="hljs-comment">// ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äº 4 * TREEIFY_THRESHOLD</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="hljs-number">64</span>;<br><span class="hljs-comment">// å“ˆå¸Œè¡¨ï¼Œå³ Node æ•°ç»„</span><br><span class="hljs-keyword">transient</span> Node&lt;K,V&gt;[] table;<br><span class="hljs-comment">// Seté›†åˆï¼Œå­˜ Node èŠ‚ç‚¹ï¼Œå› ä¸º Node implements Entryï¼Œå¤šæ€çš„å½¢å¼</span><br><span class="hljs-keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;<br><span class="hljs-comment">// å“ˆå¸Œè¡¨å…ƒç´ ä¸ªæ•°</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> size;<br><span class="hljs-comment">// å“ˆå¸Œè¡¨ä¿®æ”¹æ¬¡æ•°ï¼Œä¸åŒ…æ‹¬ K-V çš„æ›¿æ¢</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> modCount;<br><span class="hljs-comment">// è¦è°ƒæ•´å¤§å°çš„ä¸‹ä¸€ä¸ªå¤§å°å€¼ï¼Œä¸ºã€Œå®¹é‡ * è´Ÿè½½ç³»æ•°ã€</span><br><span class="hljs-keyword">int</span> threshold;<br><span class="hljs-comment">// è´Ÿè½½å› å­ï¼Œå»ºè®®ç”¨é»˜è®¤çš„ 0.75</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> loadFactor;<br></code></pre></div></td></tr></table></figure><h3 id="â…¡ã€Constructor"><a href="#â…¡ã€Constructor" class="headerlink" title="â…¡ã€Constructor"></a>â…¡ã€Constructor</h3><h4 id="æ— å‚æ„é€ "><a href="#æ— å‚æ„é€ " class="headerlink" title="æ— å‚æ„é€ "></a>æ— å‚æ„é€ </h4><ul><li>ä½¿ç”¨é»˜è®¤çš„ è´Ÿè½½å› å­ï¼Œå®¹é‡è¿˜æ˜¯æœ‰å…¶å®ƒçš„åˆå§‹åŒ–è®¾ç½®éƒ½æ˜¯é»˜è®¤çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="hljs-comment">// all other fields defaulted</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æœ‰å‚æ„é€ "><a href="#æœ‰å‚æ„é€ " class="headerlink" title="æœ‰å‚æ„é€ "></a>æœ‰å‚æ„é€ </h4><ol><li>è‡ªå®šä¹‰ <code>table</code> å®¹é‡ï¼Œè´Ÿè½½å› å­æ˜¯é»˜è®¤çš„ <code>0.75</code></li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è‡ªå®šä¹‰ å®¹é‡ å’Œ è´Ÿè½½å› å­</li></ol><ul><li>æ£€éªŒ <strong>å®¹é‡</strong> çš„åˆæ³•æ€§ï¼Œä¸åˆæ³•æŠ›å¼‚å¸¸</li><li><strong>if</strong> è‡ªå®šä¹‰å®¹é‡è¶…è¿‡é™åˆ¶æœ€å¤§å€¼ <code>1 &lt;&lt; 30</code>ï¼Œå®¹é‡æŒ‰æœ€å¤§å€¼æ¥å–</li><li>æ£€éªŒ <strong>è´Ÿè½½å› å­</strong> æ˜¯å¦ã€Œå°äº0 || ä¸æ˜¯ä¸€ä¸ªæ•°ã€ï¼Œä¸åˆæ³•æŠ›å¼‚å¸¸</li><li>é˜ˆå€¼ <code>threshold</code> ã€Œè¦è°ƒæ•´å¤§å°çš„ä¸‹ä¸€ä¸ªå¤§å°å€¼ã€éœ€è¦ ã€Œ<a href="#%E8%AE%A1%E7%AE%97%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E7%BB%99%E5%AE%9A%E6%95%B0%E7%9A%84%E6%9C%80%E8%BF%912%E6%AC%A1%E5%B9%82%E6%95%B0">è®¡ç®—å¤§äºç­‰äºç»™å®šæ•°çš„æœ€è¿‘2æ¬¡å¹‚æ•°</a>ã€ï¼Œå› ä¸ºé˜ˆå€¼å¿…é¡»æ˜¯ 2 æ¬¡å¹‚çš„æ•°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal initial capacity: &quot;</span> +<br>                                           initialCapacity);<br>    <span class="hljs-comment">// MAXIMUM_CAPACITY = 1 &lt;&lt; 30;</span><br>    <span class="hljs-keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)<br>        initialCapacity = MAXIMUM_CAPACITY;<br>    <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>                                           loadFactor);<br>    <span class="hljs-keyword">this</span>.loadFactor = loadFactor;<br>    <span class="hljs-keyword">this</span>.threshold = tableSizeFor(initialCapacity);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œï¼šæŒ‰ç…§é€»è¾‘ (<strong>å½“sizeåˆ°è¾¾thresholdæ—¶æ‰©å®¹</strong>) <code>threshold</code> åº”è¯¥è¿™æ ·å†™ ã€Œ<code>this.threshold = tableSizeFor(initialCapacity) * this.loadFactor;</code>ã€ä½† jdk8 ä¹‹åçš„æ„é€ æ–¹æ³•ï¼Œæ²¡æœ‰å¯¹ <code>table</code> æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯æ¨ç§»åˆ° <code>HashMap::put</code>ï¼Œåœ¨ [put](#Map.put å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• putVal(â€¦)) ä¸­å¯¹ <code>threshold</code> é‡æ–°è®¡ç®—ã€‚</p><ol start="3"><li>ä¼ å…¥ <code>Map</code>ï¼Œä½¿ç”¨é»˜è®¤ è´Ÿè½½å› å­ï¼Œå®¹é‡è¶³å¤Ÿå­˜ä¸‹å…¥å‚çš„ <code>Map</code></li></ol><ul><li>è´Ÿè½½å› å­ä½¿ç”¨é»˜è®¤ <strong>0.75</strong></li><li>ç„¶ååˆ›å»ºtableï¼Œå°†å…¥å‚ map å€¼å­˜å…¥ï¼š [putMapEntries](#Map.putAll å®ç°æ–¹æ³•åŠMapæ„é€ æ–¹æ³• putMapEntries(â€¦))ï¼Œ<code>boolean evict = false</code> è¯´æ˜æ˜¯è¡¨åˆ›å»ºæ¨¡å¼</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;<br>    putMapEntries(m, <span class="hljs-keyword">false</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="â…¢ã€Method"><a href="#â…¢ã€Method" class="headerlink" title="â…¢ã€Method"></a>â…¢ã€Method</h3><h4 id="æ’å…¥å…ƒç´ -put-K-key-V-value"><a href="#æ’å…¥å…ƒç´ -put-K-key-V-value" class="headerlink" title="æ’å…¥å…ƒç´  put(K key, V value)"></a>æ’å…¥å…ƒç´  put(K key, V value)</h4><ul><li>å®é™…çš„å®ç°å‡½æ•°æ˜¯ [putVal(â€¦)](#Map.put å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• putVal(â€¦))</li><li><code>putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)</code><ul><li>å“ˆå¸Œå€¼éœ€è¦é‡æ–°è®¡ç®—ï¼Œä½¿ç”¨ [hash()](#hash è®¡ç®—) å†æ¬¡è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½¿å¾—å“ˆå¸Œå€¼æ›´åˆ†æ•£</li><li><code>onlyIfAbsent = false</code>ï¼šé‡åˆ°ç›¸åŒçš„ <code>key</code>ï¼Œåˆ™ä¼šæ›¿æ¢åŸå…ˆçš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ï¼Œå¦åˆ™è¿”å› <code>null</code></li><li><code>evict = true</code>ï¼šä¸æ˜¯åˆ›å»ºæ¨¡å¼</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="Map-put-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-putVal-â€¦"><a href="#Map-put-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-putVal-â€¦" class="headerlink" title="Map.put å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• putVal(â€¦)"></a>Map.put å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• putVal(â€¦)</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * å®ç° Map.put å’Œ ç›¸å…³æ–¹æ³•</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> hash keyçš„å“ˆå¸Œå€¼</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> value value</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> onlyIfAbsent true: ä¸æ›¿æ¢å·²å­˜åœ¨å…ƒç´ ; false: æ›¿æ¢</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> evict false: è¡¨ä¸ºåˆ›å»ºæ¨¡å¼</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@return</span> ä»¥å‰çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸º null</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">putVal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, K key, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent,</span></span><br><span class="hljs-function"><span class="hljs-params">               <span class="hljs-keyword">boolean</span> evict)</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">      * tab: æ¡¶æ•°ç»„</span><br><span class="hljs-comment">      * p: å½“å‰çš„æ¡¶</span><br><span class="hljs-comment">      * n: æ¡¶æ•°ç»„é•¿åº¦</span><br><span class="hljs-comment">      * i: è·¯ç”±åœ°å€ã€Œä¸‹æ ‡ä½ç½®ã€</span><br><span class="hljs-comment">      */</span><br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-keyword">int</span> n, i;<br>    <span class="hljs-comment">// å¦‚æœ table æ²¡åˆå§‹åŒ–æˆ–é•¿åº¦ä¸º0ï¼Œåˆ™æ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-keyword">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>        n = (tab = resize()).length;<br>    <span class="hljs-comment">// å¦‚æœ hash ä½ç½®æ¡¶æ²¡æœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥æ’å…¥æ•°æ®</span><br>    <span class="hljs-comment">// (length - 1) &amp; hash == hash % length</span><br>    <span class="hljs-keyword">if</span> ((p = tab[i = (n - <span class="hljs-number">1</span>) &amp; hash]) == <span class="hljs-keyword">null</span>)<br>        tab[i] = newNode(hash, key, value, <span class="hljs-keyword">null</span>);<br>    <span class="hljs-comment">// å¦‚æœæ¡¶æœ‰æ•°æ®ï¼Œå†æ”¾å…¥æ¡¶ä¸­</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// e: ä¸´æ—¶çš„ Node; k: ä¸´æ—¶çš„ key</span><br>        Node&lt;K,V&gt; e; K k;<br>        <span class="hljs-comment">// åˆ¤æ–­putçš„å…ƒç´ å’Œå·²ç»å­˜åœ¨çš„å…ƒç´ æ˜¯ç›¸åŒ(hashä¸€è‡´ï¼Œå¹¶ä¸”equalsè¿”å›true)</span><br>        <span class="hljs-comment">// åˆ™å°†å·²å­˜åœ¨çš„èŠ‚ç‚¹æš‚å­˜</span><br>        <span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>            ((k = p.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>            e = p;<br>        <span class="hljs-comment">// putçš„å…ƒç´ ä¸å·²å­˜åœ¨å…ƒç´ ä¸åŒ</span><br>        <span class="hljs-comment">// å¦‚æœæ¡¶å†…ç±»å‹æ—¶æ ‘ç»“æ„ï¼Œåˆ™æ’å…¥åˆ°æ ‘ä¸­</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="hljs-keyword">this</span>, tab, hash, key, value);<br>        <span class="hljs-comment">// ä¸æ˜¯æ ‘ç»“æ„ï¼Œåˆ™æ’å…¥åˆ°é“¾è¡¨ä¸­</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// éå†åˆ°é“¾è¡¨ç»“å°¾æ’å…¥</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> binCount = <span class="hljs-number">0</span>; ; ++binCount) &#123;<br>                <span class="hljs-keyword">if</span> ((e = p.next) == <span class="hljs-keyword">null</span>) &#123;<br>                    p.next = newNode(hash, key, value, <span class="hljs-keyword">null</span>);<br>                    <span class="hljs-comment">// å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼Œåˆ™è½¬åŒ–ä¸ºæ ‘ç»“æ„</span><br>                    <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="hljs-number">1</span>) <span class="hljs-comment">// -1 for 1st</span><br>                        treeifyBin(tab, hash);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">// å¦‚æœå·²ç»å­˜åœ¨keyï¼Œåœæ­¢éå†ï¼Œè¿›è¡Œä¸‹é¢çš„æ›¿æ¢æ“ä½œ</span><br>                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-comment">// æ¸¸æ ‡å‘åç§»åŠ¨</span><br>                p = e;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// åˆ¤æ–­ K-V æœ‰æ²¡æœ‰æ’å…¥è¿›å“ˆå¸Œè¡¨é‡Œ</span><br>        <span class="hljs-comment">// ä¸Šé¢æ“ä½œï¼Œåªè¦æ’å…¥è¿›æ¡¶é‡Œï¼Œe != nullï¼Œå¦åˆ™è¿˜æ˜¯åˆå§‹çš„ null å€¼</span><br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// existing mapping for key</span><br>            V oldValue = e.value;<br>            <span class="hljs-comment">// onlyIfAbsent = true: ä¸æ›¿æ¢æ—§å€¼</span><br>            <span class="hljs-keyword">if</span> (!onlyIfAbsent || oldValue == <span class="hljs-keyword">null</span>)<br>                e.value = value;<br>            afterNodeAccess(e);<br>            <span class="hljs-keyword">return</span> oldValue;<br>        &#125;<br>    &#125;<br>    ++modCount;<br>    <span class="hljs-comment">// K-V è¶…è¿‡é˜ˆå€¼ï¼Œæ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> (++size &gt; threshold)<br>        resize();<br>    afterNodeInsertion(evict);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/Map.put.png" alt="HashMap.putVal"></p><h4 id="Map-putAll-å®ç°æ–¹æ³•åŠMapæ„é€ æ–¹æ³•-putMapEntries-â€¦"><a href="#Map-putAll-å®ç°æ–¹æ³•åŠMapæ„é€ æ–¹æ³•-putMapEntries-â€¦" class="headerlink" title="Map.putAll å®ç°æ–¹æ³•åŠMapæ„é€ æ–¹æ³• putMapEntries(â€¦)"></a>Map.putAll å®ç°æ–¹æ³•åŠMapæ„é€ æ–¹æ³• putMapEntries(â€¦)</h4><ul><li><p><code>((float)s / loadFactor) + 1.0F</code> åŠ  1 çš„ç›®çš„ï¼šè®¡ç®—å¾—åˆ°å®¹é‡æœ‰å¯èƒ½ä¸ºå°æ•°ï¼Œåé¢éœ€è¦å¯¹é•¿åº¦è¿›è¡Œå–æ•´ï¼Œå®¹é‡å°±ä¼šç®—å°ï¼Œæ‰€ä»¥åŠ ä¸€å–æ•´ï¼Œå°±æ˜¯å‘ä¸Šå–æ•´ã€‚</p></li><li><p><code>if (t &gt; threshold)</code>ï¼Œæ­¤ <code>threshold</code> å­˜æ”¾çš„æ˜¯ <code>capacity</code> çš„å€¼ã€‚åœ¨ table æœªåˆå§‹åŒ–æ—¶ï¼Œå¸¦åˆå§‹åŒ–å®¹é‡çš„æ„é€ å™¨ä¼šä¼ å…¥ <code>capacity</code>ï¼Œå¹¶é€šè¿‡ <code>tableSizeFor</code> è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œè®© <code>threshold</code> æš‚å­˜è¿™ä¸ªå€¼ã€‚åœ¨ <code>HashMap</code> ä¸­æ²¡æœ‰<code>capacity</code> è¿™ä¸ªå˜é‡ï¼Œåªæ˜¯ä½œä¸º table æ•°ç»„çš„å¤§å°è€Œéšå¼å­˜åœ¨ã€‚</p></li><li><p><code>else if (s &gt; threshold)</code> è¯´æ˜å…¥å‚ map çš„ <code>size</code> å·²ç»å¤§äºå½“å‰ <code>map</code> çš„ <code>threshold</code>ï¼Œå³å½“å‰ <code>map</code> è‚¯å®šè£…ä¸ä¸‹ä¸¤ä¸ª map çš„å¹¶é›†ï¼Œæ‰€ä»¥éœ€è¦æ‰©å®¹</p></li><li><p><code>putVal</code> è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½å‡ºç°æ‰©å®¹</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putMapEntries</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m, <span class="hljs-keyword">boolean</span> evict)</span> </span>&#123;<br>    <span class="hljs-comment">// å…¥å‚é›†åˆé•¿åº¦</span><br>    <span class="hljs-keyword">int</span> s = m.size();<br>    <span class="hljs-keyword">if</span> (s &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// table æ²¡æœ‰è¢«åˆå§‹åŒ–</span><br>        <span class="hljs-keyword">if</span> (table == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// pre-size</span><br>            <span class="hljs-comment">// s/loadFactor è®¡ç®—å…¥å‚mapé•¿åº¦æ˜¯å¦è¾¾åˆ°æ‰©å®¹é˜ˆå€¼</span><br>            <span class="hljs-keyword">float</span> ft = ((<span class="hljs-keyword">float</span>)s / loadFactor) + <span class="hljs-number">1.0F</span>;<br>            <span class="hljs-comment">// å…¥å‚mapé•¿åº¦æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œå¦åˆ™å–æ•´</span><br>            <span class="hljs-keyword">int</span> t = ((ft &lt; (<span class="hljs-keyword">float</span>)MAXIMUM_CAPACITY) ?<br>                     (<span class="hljs-keyword">int</span>)ft : MAXIMUM_CAPACITY);<br>            <span class="hljs-comment">// å¦‚æœè®¡ç®—å‡ºæ¥çš„å®¹é‡t &gt; å½“å‰æš‚å­˜å®¹é‡ï¼Œä¼šç”¨tè®¡ç®—å‡ºæ–°æ‰©å®¹é˜ˆå€¼</span><br>            <span class="hljs-keyword">if</span> (t &gt; threshold)<br>                threshold = tableSizeFor(t);<br>        &#125;<br>        <span class="hljs-comment">// table å·²ç»åˆå§‹åŒ–ï¼Œä¸” m å…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œæ‰©å®¹å¤„ç†</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s &gt; threshold)<br>            resize();<br>        <span class="hljs-comment">// å°† m ä¸­æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ° table ä¸­</span><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;<br>            K key = e.getKey();<br>            V value = e.getValue();<br>            putVal(hash(key), key, value, <span class="hljs-keyword">false</span>, evict);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ‰©å®¹æ–¹æ³•-resize"><a href="#æ‰©å®¹æ–¹æ³•-resize" class="headerlink" title="æ‰©å®¹æ–¹æ³• resize()"></a>æ‰©å®¹æ–¹æ³• resize()</h4><ul><li>æ³¨é‡Šâ‘ ï¼š<code>public HashMap(int initialCapacity, float loadFactor)</code> ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¼šä½¿ç”¨ <a href="#%E8%AE%A1%E7%AE%97%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E7%BB%99%E5%AE%9A%E6%95%B0%E7%9A%84%E6%9C%80%E8%BF%912%E6%AC%A1%E5%B9%82%E6%95%B0">tableSizeFor()</a> è·å¾—å¤§äºç­‰äºåˆå§‹å®¹é‡çš„æœ€è¿‘2æ¬¡å¹‚æ•°ï¼Œå¹¶ç»™ <code>threshold</code> èµ‹å€¼ï¼Œå¯¼è‡´åœ¨ <code>else if (oldThr &gt; 0)</code> åˆ¤æ–­æ—¶æˆç«‹ï¼Œæœ‰å‚æ„é€ éƒ½ä¼šç›´æ¥æˆ–é—´æ¥ä½¿ç”¨åˆ° <code>tableSizeFor</code>ï¼Œæ‰€ä»¥éƒ½ä¼šèµ°è¿™æ®µç¨‹åº</li><li>æ³¨é‡Šâ‘¡ï¼š<code>if (newThr == 0)</code> çš„æƒ…å†µï¼Œæœ‰ä¸¤ç§ã€‚<ul><li>ä¸€ã€åœ¨ä¸Šé¢ <code>else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</code> çš„åˆ¤æ–­ï¼Œå¦‚æœ<strong>ä¸æ»¡è¶³</strong> <code>oldCap &gt;= DEFAULT_INITIAL_CAPACITY(16)</code>ï¼Œå³ä¼ å…¥çš„åˆå§‹åŒ–å®¹é‡å°äº 16ï¼Œåˆ™æ²¡æ³•å®Œæˆ <code>newThr</code> çš„èµ‹å€¼ï¼Œåˆ™ <code>newThr == 0</code>  </li><li>äºŒã€<code>else if (oldThr &gt; 0)</code> ä¸­ï¼Œä¹Ÿæ²¡æœ‰å¯¹ <code>newThr</code> è¿›è¡Œèµ‹å€¼ï¼Œæ‰€ä»¥æ­¤æ—¶ä¹Ÿæ˜¯ <code>newThr == 0</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;<br>    <span class="hljs-comment">// æ—§å“ˆå¸Œè¡¨</span><br>    Node&lt;K,V&gt;[] oldTab = table;<br>    <span class="hljs-comment">// æ—§tableæ•°ç»„é•¿åº¦</span><br>    <span class="hljs-keyword">int</span> oldCap = (oldTab == <span class="hljs-keyword">null</span>) ? <span class="hljs-number">0</span> : oldTab.length;<br>    <span class="hljs-comment">// æ‰©å®¹ä¹‹å‰çš„æ‰©å®¹é˜ˆå€¼ï¼Œè§¦å‘æœ¬æ¬¡æ‰©å®¹</span><br>    <span class="hljs-keyword">int</span> oldThr = threshold;<br>    <span class="hljs-comment">// newCap: æ‰©å®¹ä¹‹åçš„å®¹é‡å¤§å°</span><br>    <span class="hljs-comment">// newThr: æ‰©å®¹ä¹‹åï¼Œä¸‹æ¬¡æ‰©å®¹çš„è§¦å‘æ¡ä»¶</span><br>    <span class="hljs-keyword">int</span> newCap, newThr = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-comment">// å“ˆå¸Œè¡¨å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œæ­£å¸¸æ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> (oldCap &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// æ—§å®¹é‡è¶…å‡ºæœ€å¤§å®¹é‡ï¼Œåˆ™ä¸æ‰©å®¹ï¼Œé˜ˆå€¼ä¿æŒä¸ºintæœ€å¤§å€¼ï¼Œè¿”å›æ—§è¡¨</span><br>        <span class="hljs-keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;<br>            threshold = Integer.MAX_VALUE;<br>            <span class="hljs-keyword">return</span> oldTab;<br>        &#125;<br>        <span class="hljs-comment">// æ–°å®¹é‡ä¸ºæ—§å®¹é‡æ‰©å¤§ä¸€å€ï¼Œä¸”å°äºæœ€å¤§å®¹é‡</span><br>        <span class="hljs-comment">// è¿˜è¦æ»¡è¶³ï¼šæ—§å®¹é‡ &lt;= 16ï¼Œæ‰å°†æ–°æ‰©å®¹é˜ˆå€¼æ‰©å¤§ä¸€å€</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="hljs-number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;<br>                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)<br>            newThr = oldThr &lt;&lt; <span class="hljs-number">1</span>; <span class="hljs-comment">// double threshold</span><br>    &#125;<br>    <span class="hljs-comment">// ä¸‹é¢éƒ½æ˜¯æœªåˆå§‹åŒ–æƒ…å†µ</span><br>    <span class="hljs-comment">// æ³¨é‡Šâ‘ </span><br>    <span class="hljs-comment">// æœªåˆå§‹åŒ–ï¼ŒoldThræ—§æ‰©å®¹é˜ˆå€¼å·²ç»è®¡ç®—çš„æƒ…å†µæ˜¯æœ‰å‚æ„é€ ä¸­è®¡ç®—çš„</span><br>    <span class="hljs-comment">// 1. public HashMap(int initialCapacity, float loadFactor)</span><br>    <span class="hljs-comment">// 2. public HashMap(int initialCapacity</span><br>    <span class="hljs-comment">// 3. public HashMap(Map&lt;? extends K, ? extends V&gt; m)</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldThr &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// åˆå§‹å®¹é‡è®¾ç½®ä¸ºé˜ˆå€¼ï¼Œå®¹é‡ä¸º2çš„æ¬¡å¹‚</span><br>        newCap = oldThr;<br>    <span class="hljs-comment">// 1. oldThr == 0 -&gt; æ— å‚æ„é€ åˆ›å»ºçš„table</span><br>    <span class="hljs-comment">// 2. oldCap == 0 -&gt; å› ä¸ºå®¹é‡æœ€å°ä¸º0ï¼Œä¸ä¸ºè´Ÿæ•°</span><br>    <span class="hljs-keyword">else</span> &#123;               <span class="hljs-comment">// é›¶åˆå§‹é˜ˆå€¼è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼</span><br>        newCap = DEFAULT_INITIAL_CAPACITY; <span class="hljs-comment">// 16</span><br>        newThr = (<span class="hljs-keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); <span class="hljs-comment">// 16 * 0.75 = 12</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// æ³¨é‡Šâ‘¡</span><br>    <span class="hljs-comment">// newThr == 0æ—¶ï¼Œé€šè¿‡ newCap * loadFactor è®¡ç®— newThrï¼Œå³æ–°çš„æ‰©å®¹ä¸Šé™</span><br>    <span class="hljs-keyword">if</span> (newThr == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">float</span> ft = (<span class="hljs-keyword">float</span>)newCap * loadFactor;<br>        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="hljs-keyword">float</span>)MAXIMUM_CAPACITY ?<br>                  (<span class="hljs-keyword">int</span>)ft : Integer.MAX_VALUE);<br>    &#125;<br>    <span class="hljs-comment">// æ›´æ–° thresholdï¼Œä¸‹æ¬¡æŒ‰ç…§æœ¬æ¬¡è®¡ç®—çš„ç»“æœä½œä¸ºæ‰©å®¹ä¸Šé™</span><br>    threshold = newThr;<br>    <span class="hljs-comment">// ä»¥ä¸Šåšäº†ä¸¤ä»¶äº‹ï¼šè®¡ç®— newCap &amp; newThr</span><br>    <span class="hljs-comment">// ä»¥ä¸‹å®Œæˆæ‰©å®¹æ“ä½œ</span><br>    <span class="hljs-meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br>    <span class="hljs-comment">// åˆ›å»ºæ–°æ•°ç»„ï¼Œå¹¶èµ‹å€¼æ›¿æ¢åŸtableï¼Œåœ¨ä¸€å¼€å§‹å°±å°†åŸtable ç”¨ oldTab æ ‡è®°å‡ºæ¥</span><br>    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> Node[newCap];<br>    table = newTab;<br>    <span class="hljs-comment">// æ‰©å®¹å‰ï¼Œtableä¸ä¸ºnull</span><br>    <span class="hljs-keyword">if</span> (oldTab != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; oldCap; ++j) &#123;<br>            <span class="hljs-comment">// å½“å‰ node èŠ‚ç‚¹</span><br>            Node&lt;K,V&gt; e;<br>            <span class="hljs-comment">// è¯´æ˜å½“å‰èŠ‚ç‚¹æœ‰æ•°æ®ï¼Œä½†æ•°æ®ç»“æ„å¹¶ä¸æ¸…æ¥š</span><br>            <span class="hljs-keyword">if</span> ((e = oldTab[j]) != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">// help GC</span><br>                oldTab[j] = <span class="hljs-keyword">null</span>;<br>                <span class="hljs-comment">// nextæ— å€¼ï¼Œæ²¡æœ‰å‘ç”Ÿç¢°æ’ï¼Œç›´æ¥å­˜å…¥æ–°æ¡¶ä¸­</span><br>                <span class="hljs-comment">// å¯»å€ç®—æ³•ï¼š(length - 1) &amp; hash == hash % lengthï¼Œå…¶å®lengthä¸º2æ¬¡å¹‚æ•°</span><br>                <span class="hljs-keyword">if</span> (e.next == <span class="hljs-keyword">null</span>)<br>                    newTab[e.hash &amp; (newCap - <span class="hljs-number">1</span>)] = e;<br>                <span class="hljs-comment">// æ ‘ç»“æ„</span><br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> TreeNode)<br>                    ((TreeNode&lt;K,V&gt;)e).split(<span class="hljs-keyword">this</span>, newTab, j, oldCap);<br>                <span class="hljs-comment">// é“¾è¡¨ç»“æ„</span><br>                <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// preserve order</span><br>                    <span class="hljs-comment">// ä½ä½é“¾è¡¨:å­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ï¼Œä¸å½“å‰æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ä¸€è‡´</span><br>                    Node&lt;K,V&gt; loHead = <span class="hljs-keyword">null</span>, loTail = <span class="hljs-keyword">null</span>;<br>                    <span class="hljs-comment">// é«˜ä½é“¾è¡¨:å­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ï¼Œä¸ºå½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®+æ‰©å®¹ä¹‹å‰æ•°ç»„çš„é•¿åº¦</span><br>                    Node&lt;K,V&gt; hiHead = <span class="hljs-keyword">null</span>, hiTail = <span class="hljs-keyword">null</span>;<br>                    <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸ªå…ƒç´ </span><br>                    Node&lt;K,V&gt; next;<br>                    <span class="hljs-keyword">do</span> &#123;<br>                        next = e.next;<br>                        <span class="hljs-comment">/**</span><br><span class="hljs-comment">                          * hash: .... 1 1111</span><br><span class="hljs-comment">                          * hash: .... 0 1111</span><br><span class="hljs-comment">                          * oldCap: ...1 0000</span><br><span class="hljs-comment">                          * if èµ°ä½ä½ï¼Œelse èµ°é«˜ä½</span><br><span class="hljs-comment">                          */</span><br>                        <span class="hljs-keyword">if</span> ((e.hash &amp; oldCap) == <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (loTail == <span class="hljs-keyword">null</span>)<br>                                loHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                loTail.next = e;<br>                            loTail = e;<br>                        &#125;<br>                        <span class="hljs-comment">// æ–°tableçš„ä½ç½®åœ¨é«˜ä½ã€ŒåŸç´¢å¼•+æ—§å®¹é‡ã€</span><br>                        <span class="hljs-keyword">else</span> &#123;<br>                            <span class="hljs-keyword">if</span> (hiTail == <span class="hljs-keyword">null</span>)<br>                                hiHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                hiTail.next = e;<br>                            hiTail = e;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">while</span> ((e = next) != <span class="hljs-keyword">null</span>);<br>                    <span class="hljs-comment">// åŸç´¢å¼•æ”¾åˆ°æ–°æ¡¶é‡Œé¢</span><br>                    <span class="hljs-keyword">if</span> (loTail != <span class="hljs-keyword">null</span>) &#123;<br>                        loTail.next = <span class="hljs-keyword">null</span>;<br>                        newTab[j] = loHead;<br>                    &#125;<br>                    <span class="hljs-comment">// åŸç´¢å¼• + oldCap æ”¾åˆ°æ–°æ¡¶é‡Œ</span><br>                    <span class="hljs-keyword">if</span> (hiTail != <span class="hljs-keyword">null</span>) &#123;<br>                        hiTail.next = <span class="hljs-keyword">null</span>;<br>                        newTab[j + oldCap] = hiHead;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> newTab;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œè¡¥å……ï¼š</p><ol><li>å½“HashMapä¸­çš„å…¶ä¸­ä¸€ä¸ªé“¾è¡¨çš„å¯¹è±¡ä¸ªæ•°å¦‚æœè¾¾åˆ°äº† 8 ä¸ªï¼Œæ­¤æ—¶å¦‚æœæ•°ç»„é•¿åº¦æ²¡æœ‰è¾¾åˆ° 64ï¼Œé‚£ä¹ˆHashMap ä¼šå…ˆæ‰©å®¹è§£å†³ï¼Œå¦‚æœå·²ç»è¾¾åˆ°äº† 64ï¼Œé‚£ä¹ˆè¿™ä¸ªé“¾è¡¨ä¼šå˜æˆçº¢é»‘æ ‘ï¼ŒèŠ‚ç‚¹ç±»å‹ç”± Node å˜æˆTreeNode ç±»å‹ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜ å°„å…³ç³»è¢«ç§»é™¤åï¼Œä¸‹æ¬¡æ‰§è¡Œresizeæ–¹æ³•æ—¶åˆ¤æ–­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ä½äº 6ï¼Œä¹Ÿä¼šå†æŠŠæ ‘è½¬æ¢ä¸ºé“¾è¡¨ã€‚</li><li>HashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„ rehash æ–¹å¼éå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸åŸæ¥è®¡ç®—çš„ <code>(n - 1) &amp; hash</code> çš„ç»“æœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†<strong>ä¸€ä¸ª</strong> bit ä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨<strong>åŸæ¥çš„ä½ç½®</strong>ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ° â€œ<strong>åŸä½ç½®+æ—§å®¹é‡</strong>â€œ è¿™ä¸ªä½ç½®ã€‚</li></ol><p>ä¾‹å¦‚ï¼š16 æ‰©å±•åˆ°32æ—¶</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/16%E6%89%A9%E5%B1%95%E5%88%B032.png" alt="16æ‰©å±•åˆ°32"></p><p> å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸º n å˜ä¸º 2 å€ï¼Œé‚£ä¹ˆ n-1 çš„æ ‡è®°èŒƒå›´åœ¨é«˜ä½å¤š<strong>1bit</strong>(<font color='red'>çº¢è‰²</font>)ï¼Œå› æ­¤æ–°çš„ index å°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š </p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/rehash%E5%90%8E%E7%9A%84index%E5%8F%98%E5%8C%96.png" alt="rehashåçš„indexå˜åŒ–"></p><ol start="3"><li>ä¸¤ç§æƒ…å†µä¼šè¿›è¡Œæ‰©å®¹ï¼šâ‘ å…ƒç´ ä¸ªæ•°è¶…è¿‡ã€Œæ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­ã€â‘¡æ¡¶é“¾è¡¨é•¿åº¦å¤§äº 8 ä¸” table æ•°ç»„é•¿åº¦å°äº 64ï¼Œåˆ™ä¼šè¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯å˜æˆæ ‘ç»“æ„</li></ol><h4 id="è·å–é”®å€¼å¯¹çš„å€¼-get-Object-key"><a href="#è·å–é”®å€¼å¯¹çš„å€¼-get-Object-key" class="headerlink" title="è·å–é”®å€¼å¯¹çš„å€¼ get(Object key)"></a>è·å–é”®å€¼å¯¹çš„å€¼ get(Object key)</h4><ul><li>æ ¸å¿ƒæ–¹æ³•æ˜¯ [getNode(â€¦)](#Map.get å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• getNode(int hash, Object key))ï¼Œæ ¹æ® <code>key</code> æ‰¾ <code>value</code> å¹¶è¿”å›ï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å› <code>null</code></li><li><code>key</code> ä¼ å…¥æ—¶éœ€è¦ [hash(int)](#hash è®¡ç®—) è®¡ç®—ä¸€æ¬¡ï¼Œå› ä¸º [put(K, V)](#æ’å…¥å…ƒç´  put(K key, V value)) æ—¶ä¹Ÿç”¨åˆ° <code>hash(int)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">get</span><span class="hljs-params">(Object key)</span> </span>&#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-keyword">return</span> (e = getNode(hash(key), key)) == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : e.value;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="Map-get-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-getNode-int-hash-Object-key"><a href="#Map-get-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-getNode-int-hash-Object-key" class="headerlink" title="Map.get å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• getNode(int hash, Object key)"></a>Map.get å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• getNode(int hash, Object key)</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title">getNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, Object key)</span> </span>&#123;<br>    <span class="hljs-comment">// tab: å½“å‰ hashmap çš„æ•£åˆ—è¡¨</span><br>    <span class="hljs-comment">// first: æ¡¶ä¸­çš„é¦–èŠ‚ç‚¹</span><br>    <span class="hljs-comment">// e: ä¸´æ—¶èŠ‚ç‚¹</span><br><span class="hljs-comment">// n: table æ•°ç»„é•¿åº¦</span><br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-keyword">int</span> n; K k;<br>    <span class="hljs-comment">// ç»™ tab, n, first åˆå§‹åŒ–èµ‹å€¼ï¼Œå¹¶åˆ¤ç©º</span><br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// (key != null &amp;&amp; key.equals(k)) æ­£å¥½å¤´ç»“ç‚¹å°±æ˜¯éœ€è¦æ‰¾çš„èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span><br>            ((k = first.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>            <span class="hljs-keyword">return</span> first;<br>        <span class="hljs-comment">// å½“å‰æ¡¶æ˜¯é“¾è¡¨æˆ–çº¢é»‘æ ‘</span><br>        <span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// æ¡¶å‡çº§æˆçº¢é»‘æ ‘</span><br>            <span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)<br>                <span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);<br>            <span class="hljs-comment">// æ¡¶ç»“æ„ä¸ºé“¾è¡¨</span><br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-comment">// å¾ªç¯æŸ¥æ‰¾</span><br>                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>                    <span class="hljs-keyword">return</span> e;<br>            &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="åˆ é™¤-remove"><a href="#åˆ é™¤-remove" class="headerlink" title="åˆ é™¤ remove"></a>åˆ é™¤ remove</h4><ul><li>å®ç°æ–¹æ³•ä¸º [removeNode(â€¦)](#Map.remove å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• removeNode(â€¦)) <ul><li><code>removeNode(int hash, Object key, Object value, boolean matchValue boolean movable)</code></li><li><code>matchValue == false</code> è¡¨ç¤ºå¿…é¡»æ˜¯ <code>key &amp; value</code> éƒ½ç›¸åŒæ‰åˆ é™¤</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">remove</span><span class="hljs-params">(Object key)</span> </span>&#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-keyword">return</span> (e = removeNode(hash(key), key, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) == <span class="hljs-keyword">null</span> ?<br>        <span class="hljs-keyword">null</span> : e.value;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>key &amp; value</code> éƒ½ç›¸åŒæ‰èƒ½åˆ é™¤èŠ‚ç‚¹<ul><li><code>matchValue == true</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object key, Object value)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> removeNode(hash(key), key, value, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>) != <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="Map-remove-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-removeNode-â€¦"><a href="#Map-remove-å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³•-removeNode-â€¦" class="headerlink" title="Map.remove å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• removeNode(â€¦)"></a>Map.remove å®ç°æ–¹æ³•åŠç›¸å…³æ–¹æ³• removeNode(â€¦)</h4><ul><li><code>matchValue</code>ï¼š <strong>true</strong>: <code>key &amp; value</code> éƒ½ç›¸åŒæ‰èƒ½åˆ é™¤ï¼›<strong>false</strong>: <code>key</code> ç›¸åŒå°±å¯åˆ é™¤</li><li><code>movable</code>ï¼š <strong>false</strong>: åˆ é™¤è¿‡ç¨‹ä¸­ä¸ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹ </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title">removeNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, Object key, Object value,</span></span><br><span class="hljs-function"><span class="hljs-params">                           <span class="hljs-keyword">boolean</span> matchValue, <span class="hljs-keyword">boolean</span> movable)</span> </span>&#123;<br>    <span class="hljs-comment">// tab: å¼•ç”¨ hashmap ä¸­çš„æ•£åˆ—è¡¨</span><br>    <span class="hljs-comment">// p: å½“å‰ node èŠ‚ç‚¹</span><br>    <span class="hljs-comment">// n: tableæ•£åˆ—è¡¨çš„æ•°ç»„é•¿åº¦</span><br>    <span class="hljs-comment">// index: å¯»å€ç»“æœ</span><br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-keyword">int</span> n, index;<br>    <span class="hljs-comment">// å¯¹å˜é‡åˆå§‹åŒ–èµ‹å€¼ï¼Œåˆ¤ç©º</span><br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (p = tab[index = (n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// node: æŸ¥æ‰¾åˆ°çš„ç»“æœ</span><br>        <span class="hljs-comment">// e: å½“å‰nodeçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br>        Node&lt;K,V&gt; node = <span class="hljs-keyword">null</span>, e; K k; V v;<br>        <span class="hljs-comment">// å½“å‰æ¡¶ä¸­å…ƒç´ å°±æ˜¯å¾…åˆ é™¤å…ƒç´ </span><br>        <span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>            ((k = p.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>            node = p;<br>        <span class="hljs-comment">// æ¡¶ä¸­éå†å…¶ä»–å…ƒç´ è¿›è¡Œåˆ é™¤</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((e = p.next) != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// æ¡¶ä¸ºæ ‘ç»“æ„</span><br>            <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>                <span class="hljs-comment">// æ ‘ä¸­æŸ¥æ‰¾</span><br>                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);<br>            <span class="hljs-comment">// æ¡¶ä¸ºé“¾è¡¨ç»“æ„</span><br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">do</span> &#123;<br>                    <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                        ((k = e.key) == key ||<br>                         (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k)))) &#123;<br>                        node = e;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    p = e;<br>                &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-keyword">null</span>);<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-comment">// matchValueä¸ºfalseï¼Œå°±ä¸è¿›è¡Œåé¢çš„valueå€¼åˆ¤æ–­</span><br>        <span class="hljs-comment">// ä¸ºtrueï¼Œåˆ™æ‰¾åˆ°valueä¹ŸåŒ¹é…çš„æƒ…å†µ</span><br>        <span class="hljs-keyword">if</span> (node != <span class="hljs-keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||<br>                             (value != <span class="hljs-keyword">null</span> &amp;&amp; value.equals(v)))) &#123;<br>            <span class="hljs-comment">// æ ‘èŠ‚ç‚¹åˆ é™¤</span><br>            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> TreeNode)<br>                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="hljs-keyword">this</span>, tab, movable);<br>            <span class="hljs-comment">// ä¸Šé¢çš„ if çš„æƒ…å†µï¼Œæ¡¶ä¸­çš„é¦–å…ƒç´ ä¸ºå¾…åˆ é™¤å…ƒç´ </span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node == p)<br>                tab[index] = node.next;<br>            <span class="hljs-comment">// é“¾è¡¨ç»“æ„åˆ é™¤èŠ‚ç‚¹</span><br>            <span class="hljs-keyword">else</span><br>                p.next = node.next;<br>            ++modCount;<br>            --size;<br>            <span class="hljs-comment">// åœ¨HashMapä¸­æ˜¯ç©ºæ–¹æ³•ï¼Œä¸ºäº†ç»™å…¶å­ç±»LinkedHashMapç»§æ‰¿é‡å†™</span><br>            afterNodeRemoval(node);<br>            <span class="hljs-keyword">return</span> node;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="è·å–-get-Object-key"><a href="#è·å–-get-Object-key" class="headerlink" title="è·å– get(Object key)"></a>è·å– get(Object key)</h4><ul><li>å®ç°æ–¹æ³• [getNode(â€¦)](#Map.get çš„å®ç°æ–¹æ³•åŠå…¶ç›¸å…³æ–¹æ³•)ï¼Œæ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å› <code>null</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">get</span><span class="hljs-params">(Object key)</span> </span>&#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-keyword">return</span> (e = getNode(hash(key), key)) == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : e.value;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="Map-get-çš„å®ç°æ–¹æ³•åŠå…¶ç›¸å…³æ–¹æ³•"><a href="#Map-get-çš„å®ç°æ–¹æ³•åŠå…¶ç›¸å…³æ–¹æ³•" class="headerlink" title="Map.get çš„å®ç°æ–¹æ³•åŠå…¶ç›¸å…³æ–¹æ³•"></a>Map.get çš„å®ç°æ–¹æ³•åŠå…¶ç›¸å…³æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title">getNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, Object key)</span> </span>&#123;<br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-keyword">int</span> n; K k;<br>    <span class="hljs-comment">// å¯¹æˆå‘˜å˜é‡èµ‹å€¼ï¼Œå¹¶åˆ¤ç©º</span><br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// å¦‚æœæ¡¶é¡¶å…ƒç´ ç¬¦åˆkeyï¼Œåˆ™ç›´æ¥è¿”å›</span><br>        <span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span><br>            ((k = first.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>            <span class="hljs-keyword">return</span> first;<br>        <span class="hljs-comment">// æ¡¶åé¢æœ‰å…¶ä»–å…ƒç´ ç¢°æ’</span><br>        <span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// çº¢é»‘æ ‘ç»“æ„ï¼ŒäºŒåˆ†æŸ¥æ‰¾ï¼ŒO(logn)</span><br>            <span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)<br>                <span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);<br>            <span class="hljs-comment">// é“¾è¡¨</span><br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))<br>                    <span class="hljs-keyword">return</span> e;<br>            &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="hash-è®¡ç®—"><a href="#hash-è®¡ç®—" class="headerlink" title="hash è®¡ç®—"></a>hash è®¡ç®—</h4><ul><li>å†æ¬¡è®¡ç®— <code>key.hashCode()</code>ï¼Œå°† <strong>é«˜ 16 ä½</strong> å‚ä¸è¿›æ¥ï¼Œä½¿å¾—å“ˆå¸Œå€¼<strong>æ›´åŠ åˆ†æ•£</strong></li><li><code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code></li><li>å³ç§» 16 ä½ï¼Œ ä¸åŸå…ˆçš„å“ˆå¸Œå€¼<strong>å¼‚æˆ–</strong></li><li>å°† é«˜ 16 ä½ ä¸åŸå“ˆå¸Œå€¼å¼‚æˆ–ï¼Œå³å°†é«˜ 16 ä½ å‚ä¸è¿›å“ˆå¸Œå€¼çš„è¿ç®—ä¸­ã€‚éšç€å…ƒç´ çš„å¢åŠ ï¼Œå“ˆå¸Œç¢°æ’çš„å‡ ç‡ä¼šæ›´ä½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hash</span><span class="hljs-params">(Object key)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> h;<br>    <span class="hljs-keyword">return</span> (key == <span class="hljs-keyword">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="è®¡ç®—å¤§äºç­‰äºç»™å®šæ•°çš„æœ€è¿‘2æ¬¡å¹‚æ•°"><a href="#è®¡ç®—å¤§äºç­‰äºç»™å®šæ•°çš„æœ€è¿‘2æ¬¡å¹‚æ•°" class="headerlink" title="è®¡ç®—å¤§äºç­‰äºç»™å®šæ•°çš„æœ€è¿‘2æ¬¡å¹‚æ•°"></a>è®¡ç®—å¤§äºç­‰äºç»™å®šæ•°çš„æœ€è¿‘2æ¬¡å¹‚æ•°</h4><p>è¾“å…¥7ï¼Œç»“æœä¸º8ï¼›è¾“å…¥10ï¼Œç»“æœä¸º16ï¼›</p><p>ğŸŒ°ï¼šä»¥å…¥å‚ä¸º 10 ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">tableSizeFor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cap)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> n = cap - <span class="hljs-number">1</span>; <span class="hljs-comment">// 9</span><br>    n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>; <span class="hljs-comment">// 0b1001 | 0b0100 = 0b1101</span><br>    n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>; <span class="hljs-comment">// 0b1101 | 0b0011 = 0b1111</span><br>    n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>; <span class="hljs-comment">// ä¸‹é¢éƒ½æ˜¯ 0b1111</span><br>    n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;<br>    <span class="hljs-comment">// n = 0b1111</span><br>    <span class="hljs-comment">// (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1</span><br>    <span class="hljs-comment">// n + 1 = 15 + 1 = 16</span><br>    <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œæ³¨ï¼šå¦‚æœä¸€å¼€å§‹ <code>n</code> ä¸å‡ä¸€ï¼Œç®—å‡ºæ¥çš„ç»“æœä¼šå¤§ä¸€å€</p><h3 id="â…£ã€HashMap-åˆå§‹åŒ–å»ºè®®"><a href="#â…£ã€HashMap-åˆå§‹åŒ–å»ºè®®" class="headerlink" title="â…£ã€HashMap åˆå§‹åŒ–å»ºè®®"></a>â…£ã€HashMap åˆå§‹åŒ–å»ºè®®</h3><h4 id="ä¸€ã€åˆå§‹åŒ–é—®é¢˜"><a href="#ä¸€ã€åˆå§‹åŒ–é—®é¢˜" class="headerlink" title="ä¸€ã€åˆå§‹åŒ–é—®é¢˜"></a>ä¸€ã€åˆå§‹åŒ–é—®é¢˜</h4><p>ç”±äº HashMap è‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Œéœ€è¦é‡æ–°è®¡ç®—é”®å€¼å¯¹çš„å“ˆå¸Œå€¼ï¼Œå¹¶è¿›è¡Œæ‹·è´ï¼Œå¼€é”€è¾ƒå¤§ï¼Œä¸ºäº†é¿å…è‡ªåŠ¨æ‰©å®¹ï¼Œå°½é‡åœ¨åˆ›å»ºå“ˆå¸Œè¡¨æ—¶ï¼Œ<a href="#%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0">æœ‰å‚æ„é€ </a> æŒ‡å®šåˆå§‹å®¹é‡ã€‚</p><p>HashMap çš„æ‰©å®¹æœºåˆ¶ åœ¨ [resize()](#æ‰©å®¹æ–¹æ³• resize()) æœ‰ä»‹ç»ï¼Œä¸¤ç§æƒ…å†µä¼šè¿›è¡Œæ‰©å®¹ï¼šâ‘ å…ƒç´ ä¸ªæ•°è¶…è¿‡ã€Œæ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­ã€ï¼ˆthreshold = loadFactor * capacityï¼‰â‘¡æ¡¶é“¾è¡¨é•¿åº¦å¤§äº 8 ä¸” table æ•°ç»„é•¿åº¦å°äº 64ï¼Œåˆ™ä¼šè¿›è¡Œ<strong>æ‰©å®¹</strong>ï¼Œè€Œä¸æ˜¯å˜æˆæ ‘ç»“æ„</p><h4 id="äºŒã€å»ºè®®åˆå§‹åŒ–å¤§å°è®¡ç®—"><a href="#äºŒã€å»ºè®®åˆå§‹åŒ–å¤§å°è®¡ç®—" class="headerlink" title="äºŒã€å»ºè®®åˆå§‹åŒ–å¤§å°è®¡ç®—"></a>äºŒã€å»ºè®®åˆå§‹åŒ–å¤§å°è®¡ç®—</h4><ul><li>æ ¹æ®ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ç¼–ç¨‹è§„çº¦ä¸­ï¼Œå¯¹é›†åˆå¤„ç†æœ‰ä»¥ä¸‹å»ºè®®ï¼š</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/HashMap%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F.png" alt="HashMapåˆ›å»ºæŒ‡å®šåˆå§‹åŒ–å¤§å°"></p><p>ğŸŒ°ä¸¾ä¾‹ï¼š</p><p>å¦‚æœè®¾ç½®çš„é»˜è®¤å€¼ä¸º 7ï¼Œç»è¿‡ <a href="#%E8%AE%A1%E7%AE%97%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E7%BB%99%E5%AE%9A%E6%95%B0%E7%9A%84%E6%9C%80%E8%BF%912%E6%AC%A1%E5%B9%82%E6%95%B0">tableSizeFor()</a> è®¡ç®—åï¼Œè®¾ç½®ä¸º 8ã€‚æ­¤æ—¶ <code>Threshold = 8 * 0.75 = 6</code>ï¼Œä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹ï¼Œå¹¶ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚</p><p>é€šè¿‡ <code>initialCapacity / 0.75F + 1.0F</code> è®¡ç®—ï¼Œå¾—åˆ°è®¾ç½®å€¼ä¸º <code>7 / 0.75 + 1 = 10</code>ï¼Œç»è¿‡ <a href="#%E8%AE%A1%E7%AE%97%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E7%BB%99%E5%AE%9A%E6%95%B0%E7%9A%84%E6%9C%80%E8%BF%912%E6%AC%A1%E5%B9%82%E6%95%B0">tableSizeFor()</a> è®¡ç®—åè®¾ç½®ä¸º 16ï¼Œåœ¨å®¹é‡è¾¾åˆ° <code>16 * 0.75 = 12</code> æ—¶è¿›è¡Œæ‰©å®¹ï¼Œç¬¦åˆé¢„æœŸã€‚</p><h3 id="â…¤ã€çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#â…¤ã€çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="â…¤ã€çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>â…¤ã€çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><h4 id="ä¸€ã€HashMap-çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#ä¸€ã€HashMap-çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸€ã€HashMap çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>ä¸€ã€HashMap çº¿ç¨‹å®‰å…¨é—®é¢˜</h4><p>HashMapçš„çº¿ç¨‹ä¸å®‰å…¨ä½“ç°åœ¨ä¼šé€ æˆ<strong>æ­»å¾ªç¯</strong>ã€<strong>æ•°æ®ä¸¢å¤±</strong>ã€<strong>æ•°æ®è¦†ç›–</strong>è¿™äº›é—®é¢˜ã€‚å…¶ä¸­æ­»å¾ªç¯å’Œæ•°æ®ä¸¢å¤±æ˜¯åœ¨ <code>JDK1.7</code>   ä¸­å‡ºç°çš„é—®é¢˜ï¼Œåœ¨ <code>JDK1.8</code> ä¸­å·²ç»å¾—åˆ°è§£å†³ï¼Œç„¶è€Œ 1.8 ä¸­ä»ä¼šæœ‰<strong>æ•°æ®è¦†ç›–</strong>çš„é—®é¢˜ï¼Œå³åœ¨å¹¶å‘æ‰§è¡Œ <code>HashMap::put</code> æ“ä½œæ—¶ä¼šå‘ç”Ÿæ•°æ®è¦†ç›–çš„æƒ…å†µã€‚</p><h4 id="äºŒã€JDK7-HashMapå¹¶å‘æ­»é“¾é—®é¢˜"><a href="#äºŒã€JDK7-HashMapå¹¶å‘æ­»é“¾é—®é¢˜" class="headerlink" title="äºŒã€JDK7 HashMapå¹¶å‘æ­»é“¾é—®é¢˜"></a>äºŒã€JDK7 HashMapå¹¶å‘æ­»é“¾é—®é¢˜</h4><ul><li>é¦–å…ˆè¯´æ˜ï¼š<code>JDK7</code> ä¸­ <code>HashMap</code> æ’å…¥æ“ä½œæ˜¯ <strong>å¤´æ’æ³•</strong>ã€‚</li></ul><p>å…³æ³¨åˆ° <code>JDK7</code> çš„æ‰©å®¹æ“ä½œï¼Œå®ç°çš„æ–¹æ³•æ˜¯ <code>transfer(...)</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(Entry[] newTable, <span class="hljs-keyword">boolean</span> rehash)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> newCapacity = newTable.length;<br>    <span class="hljs-keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">null</span> != e) &#123;<br>            Entry&lt;K,V&gt; next = e.next; <span class="hljs-comment">// â‘ </span><br>            <span class="hljs-keyword">if</span> (rehash) &#123;<br>                e.hash = <span class="hljs-keyword">null</span> == e.key ? <span class="hljs-number">0</span> : hash(e.key);<br>            &#125;<br>            <span class="hljs-keyword">int</span> i = indexFor(e.hash, newCapacity); <br>            e.next = newTable[i]; <span class="hljs-comment">// â‘¡</span><br>            newTable[i] = e; <span class="hljs-comment">// â‘¢</span><br>            e = next; <span class="hljs-comment">// â‘£</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>â‘ ï¼š<code>Entry&lt;K,V&gt; next = e.next;</code> è·å– e çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</p><p>â‘¡ï¼š<code>e.next = newTable[i];</code> å¾…è½¬ç§»èŠ‚ç‚¹æŒ‡å‘æ–°æ¡¶</p><p>â‘¢ï¼š<code>newTable[i] = e;</code> å¾…è½¬ç§»èŠ‚ç‚¹ç§»åŠ¨åˆ°æ¡¶ä½ç½®</p><p>â‘£ï¼š<code>e = next;</code> æˆåŠŸç§»åŠ¨åï¼Œå°† e æŒ‡é’ˆå›åˆ°åŸæ¥é“¾è¡¨ä½ç½®ï¼Œå¯¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è½¬ç§»\</p><p>ä»¥ä¸‹è§†é¢‘æœ‰è¯¦ç»†è®²è§£ï¼š</p><blockquote><p><a href="https://www.bilibili.com/video/BV1n541177Ea">https://www.bilibili.com/video/BV1n541177Ea</a></p><p><a href="https://coolshell.cn/articles/9606.html#">https://coolshell.cn/articles/9606.html#</a></p></blockquote><h2 id="ä¸‰ã€HashSet"><a href="#ä¸‰ã€HashSet" class="headerlink" title="ä¸‰ã€HashSet"></a>ä¸‰ã€HashSet</h2><ul><li>åŸºäº <code>HashCode</code> å®ç°å…ƒç´ ä¸é‡å¤</li><li>å½“å­˜å…¥å…ƒç´ å“ˆå¸Œç ç›¸åŒæ—¶ï¼Œè°ƒç”¨ <code>equals</code> ç¡®è®¤ï¼Œè‹¥ä¸º <code>true</code>ï¼Œæ‹’ç»åè€…å­˜å…¥ã€Œå®ç°ä¸é‡å¤ã€</li></ul><h3 id="â… ã€Field-1"><a href="#â… ã€Field-1" class="headerlink" title="â… ã€Field"></a>â… ã€Field</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// HashSet åº•å±‚ä½¿ç”¨ HashMap å®ç°</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> HashMap&lt;E,Object&gt; map;<br><span class="hljs-comment">// è™šæ‹Ÿå¯¹è±¡ï¼Œå……å½“ map çš„ value</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object PRESENT = <span class="hljs-keyword">new</span> Object();<br></code></pre></div></td></tr></table></figure><h3 id="â…¡ã€Constructor-1"><a href="#â…¡ã€Constructor-1" class="headerlink" title="â…¡ã€Constructor"></a>â…¡ã€Constructor</h3><h4 id="æ— å‚æ„é€ -1"><a href="#æ— å‚æ„é€ -1" class="headerlink" title="æ— å‚æ„é€ "></a>æ— å‚æ„é€ </h4><ul><li>æ„é€ ä¸€ä¸ªæ–°çš„ç©ºé›†åˆï¼›å¤‡ä»½HashMapå®ä¾‹å…·æœ‰é»˜è®¤çš„åˆå§‹å®¹é‡ï¼ˆ<strong>16</strong>ï¼‰å’Œè´Ÿè½½å› å­ï¼ˆ<strong>0.75</strong>ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashSet</span><span class="hljs-params">()</span> </span>&#123;<br>    map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="ä¸‰ã€TreeSet"><a href="#ä¸‰ã€TreeSet" class="headerlink" title="ä¸‰ã€TreeSet"></a>ä¸‰ã€TreeSet</h2><ul><li>åŸºäºæ’åˆ—é¡ºåºå®ç°å…ƒç´ ä¸é‡å¤</li><li>å®ç° <code>SortedSet</code> æ¥å£ï¼Œå¯¹é›†åˆå…ƒç´ è‡ªåŠ¨æ’åº</li><li>å…ƒç´ å¯¹è±¡çš„ç±»å‹<strong>å¿…é¡»</strong>å®ç° <code>Comparable</code> æ¥å£ï¼ŒæŒ‡å®šæ’åºè§„åˆ™</li><li>é€šè¿‡ <code>CompareTo</code> æ–¹æ³•ç¡®å®šæ˜¯å¦ä¸º<strong>é‡å¤å…ƒç´ </strong></li></ul><h2 id="ğŸ”—Reference"><a href="#ğŸ”—Reference" class="headerlink" title="ğŸ”—Reference"></a>ğŸ”—Reference</h2><blockquote><p><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html">https://tech.meituan.com/2016/06/24/java-hashmap.html</a></p><p><a href="https://developer.aliyun.com/topic/java20">ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ v1.7.0åµ©å±±ç‰ˆã€‹</a></p><p><a href="https://www.bilibili.com/video/BV1n541177Ea">HashMapæ­»é“¾é—®é¢˜</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â… </title>
    <link href="/2021/08/10/JavaSE/Java%E5%B8%B8%E7%94%A8%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E2%85%A0/"/>
    <url>/2021/08/10/JavaSE/Java%E5%B8%B8%E7%94%A8%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E2%85%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaå¸¸ç”¨é›†åˆæºç åˆ†æ-â… "><a href="#Javaå¸¸ç”¨é›†åˆæºç åˆ†æ-â… " class="headerlink" title="Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â… "></a>Javaå¸¸ç”¨é›†åˆæºç åˆ†æ â… </h1><blockquote><p>@Version: JDK 1.8</p><p>@IDE: IntellJ IDEA 2021.1</p><p>@Date: 2021/8/7 </p><p>@Author: Hypocrite30</p></blockquote><h2 id="ä¸€ã€é›†åˆ"><a href="#ä¸€ã€é›†åˆ" class="headerlink" title="ä¸€ã€é›†åˆ"></a>ä¸€ã€é›†åˆ</h2><ul><li>é›†åˆä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<code>Collection</code> &amp; <code>Map</code> </li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/image-20210807224135029.png"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/image-20210807224413506.png"></p><h3 id="â… ã€Collectionæ¥å£"><a href="#â… ã€Collectionæ¥å£" class="headerlink" title="â… ã€Collectionæ¥å£"></a>â… ã€Collectionæ¥å£</h3><ul><li>æœ‰äº›å®ç°ç±»æœ‰åºã€ŒListã€ï¼Œæœ‰äº›æ— åºã€ŒSetã€</li><li>æœ‰äº›å¯æ”¾é‡å¤å…ƒç´ ï¼Œæœ‰äº›ä¸å¯ä»¥</li><li>Collection æ¥å£æ²¡æœ‰ç›´æ¥çš„å®ç°å­ç±»ï¼Œé€šè¿‡å­æ¥å£ã€ŒSetã€ã€ŒListã€å®ç°</li></ul><h3 id="â…¡ã€Iteratoræ¥å£"><a href="#â…¡ã€Iteratoræ¥å£" class="headerlink" title="â…¡ã€Iteratoræ¥å£"></a>â…¡ã€Iteratoræ¥å£</h3><ul><li>å› ä¸º<code>Collection&lt;E&gt; extends Iterable&lt;E&gt;</code> ï¼Œæ‰€ä»¥æ‰€æœ‰å­ç±»éƒ½å¯ä»¥é€šè¿‡è·å– <code>Iterator</code> éå†é›†åˆ</li></ul><p>å¸¸è§æ–¹æ³•ï¼š</p><table><thead><tr><th align="center">boolean</th><th>hashNext()</th><th>Returns: true if the iteration has more elements</th></tr></thead><tbody><tr><td align="center"><b>E</b></td><td><b>next()</b></td><td><b>Returns: the next element in the iteration</b></td></tr><tr><td align="center"><b>void</b></td><td><b>remove()</b></td><td><b>Removes from the underlying collection the last element returned by this iterator</b></td></tr></tbody></table><p>ğŸ“Œï¼šåœ¨è°ƒç”¨ <code>iterator.next()</code> ä¹‹å‰å¿…é¡»è°ƒç”¨ <code>iterator.hasNext()</code> åˆ¤æ–­åé¢æ˜¯å¦å­˜åœ¨å…ƒç´ ã€‚è‹¥ä¸è°ƒç”¨ï¼Œåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè°ƒç”¨ <code>next()</code> ä¼šæŠ›å‡º <code>NoSuchElementException</code></p><h3 id="â…¢ã€Listæ¥å£"><a href="#â…¢ã€Listæ¥å£" class="headerlink" title="â…¢ã€Listæ¥å£"></a>â…¢ã€Listæ¥å£</h3><ul><li>å…ƒç´ æœ‰åº</li><li>å¯é‡å¤</li><li>æ”¯æŒç´¢å¼•</li><li>æ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªæ•´æ•°å‹åºå·ï¼Œè®°å½•å…ƒç´ åœ¨å®¹å™¨ä¸­çš„ä½ç½®ï¼Œå¯ç”¨äºå­˜å–</li></ul><h2 id="äºŒã€ArrayList"><a href="#äºŒã€ArrayList" class="headerlink" title="äºŒã€ArrayList"></a>äºŒã€ArrayList</h2><ul><li><code>ArrayList</code> å¯ä»¥å­˜æ”¾ä»»ä½•æ•°æ®ï¼ŒåŒ…æ‹¬ <code>null</code></li><li><code>ArrayList</code> åŸºæœ¬ç­‰åŒäº <code>Vector</code>ï¼ŒåŒºåˆ«åœ¨äºå‰è€…æ˜¯<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>çš„ã€Œæ‰§è¡Œæ•ˆç‡é«˜ã€</li><li><code>ArrayList</code> å†…éƒ¨å­˜å‚¨æ•°æ®ç»“æ„ä¸º<strong>æ•°ç»„</strong></li></ul><h3 id="â… ã€Field"><a href="#â… ã€Field" class="headerlink" title="â… ã€Field"></a>â… ã€Field</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é»˜è®¤åˆå§‹åŒ–å®¹é‡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_CAPACITY = <span class="hljs-number">10</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç©ºæ•°ç»„å®¹é‡ä¸º0ï¼Œæœ‰å‚æ„é€ é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨æ•°æ®ç»“æ„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç©ºæ•°ç»„å®¹é‡ä¸º0ï¼Œæ— å‚æ„é€ æ—¶é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨æ•°æ®ç»“æ„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿™ArrayListåº•å±‚ç”¨åˆ°çš„å­˜å–æ•°æ®çš„æ•°ç»„</span><br><span class="hljs-comment"> * éç§æœ‰ï¼Œä»¥ç®€åŒ–åµŒå¥—ç±»è®¿é—®</span><br><span class="hljs-comment"> * transient ä¸å…è®¸åºåˆ—åŒ–</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">transient</span> Object[] elementData;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®é™…ArrayListé›†åˆå¤§å°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> size;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯åˆ†é…çš„æœ€å¤§å®¹é‡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="hljs-number">8</span>;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œå‡ ç‚¹è¯´æ˜ï¼š</p><ul><li>æ— å‚æ„é€ ï¼Œæ•°ç»„é»˜è®¤åˆå§‹åŒ–å®¹é‡æ˜¯ <strong>10</strong></li><li>é¢„å…ˆåˆ›å»ºå¥½ä¸¤ä¸ªç©ºæ•°ç»„ï¼Œåœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œç›´æ¥èµ‹å€¼ç»™å­˜å‚¨æ•°ç»„</li><li>çœŸæ­£å­˜å‚¨æ•°æ®çš„æ•°ç»„æ˜¯ <code>Object[] elementData</code>ï¼Œå¹¶ä¸”è¢« <code>transient</code> ä¿®é¥°ï¼Œè¿™æ ·åºåˆ—åŒ–ä¸ä¼šå°†å…¶å†™å…¥æµä¸­ï¼Œä½†æ˜¯è¿™æ ·ååºåˆ—åŒ–ä¼šä¸¢å¤±æ•°æ®ï¼Œéœ€è¦åˆ†æ <code>writeObject(ObjectOutputStream s)</code> å’Œ <code>readObject(ObjectInputStream s)</code> å¾—åˆ°[åºåˆ—åŒ–å¦‚ä½•å®ç°](#ArrayList åºåˆ—åŒ–ä¸ååºåˆ—åŒ–)</li><li>æ³¨æ„åˆ° <code>MAX_ARRAY_SIZE</code> æ•°ç»„æœ€å¤§é•¿åº¦æ˜¯ <code>Integer.MAX_VALUE - 8</code>ï¼Œ[ä¸‹é¢è¯´æ˜](#MAX_ARRAY_SIZE æ•°å€¼è¯´æ˜)</li></ul><h4 id="ArrayList-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#ArrayList-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="ArrayList åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>ArrayList åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h4><ul><li><code>private void writeObject(java.io.ObjectOutputStream s)</code> åºåˆ—åŒ–<ul><li>åºåˆ—åŒ–å†™å…¥åˆ°æµä¸­æœ‰ï¼š<code>size</code> &amp; <code>elementå…ƒç´ å€¼</code> </li><li><code>elementData[]</code> åªåšç¼“å­˜æ•°ç»„ï¼Œé€šå¸¸ä¼šé¢„ç•™å®¹é‡ï¼Œä¸å¤Ÿæ‰æ‰©å®¹ï¼Œå› æ­¤åºåˆ—åŒ–åªå–æ•°ç»„ä¸­éœ€è¦çš„å…ƒç´ ï¼Œ<strong>èŠ‚çœç©ºé—´å’Œæ—¶é—´</strong>ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeObject</span><span class="hljs-params">(java.io.ObjectOutputStream s)</span></span><br><span class="hljs-function">    <span class="hljs-keyword">throws</span> java.io.IOException</span>&#123;<br>    <span class="hljs-comment">// é¢„æœŸçš„ä¿®æ”¹æ¬¡æ•°ï¼Œç”¨äºåˆ¤æ–­å¹¶å‘ä¿®æ”¹çš„é—®é¢˜</span><br>    <span class="hljs-keyword">int</span> expectedModCount = modCount;<br>    s.defaultWriteObject();<br><br>    <span class="hljs-comment">// å†™å…¥ ArrayList size</span><br>    s.writeInt(size);<br><br>    <span class="hljs-comment">// å†™å…¥æ¯ä¸€ä¸ªå…ƒç´ å€¼</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>        s.writeObject(elementData[i]);<br>    &#125;<br><span class="hljs-comment">// åˆ¤æ–­åºåˆ—åŒ–çš„å¹¶å‘é—®é¢˜</span><br>    <span class="hljs-keyword">if</span> (modCount != expectedModCount) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>private void readObject(java.io.ObjectInputStream s)</code> ååºåˆ—åŒ–<ul><li>å› ä¸ºæ„é€ æ­¤ <code>ArrayList</code> å·²ç»æœ‰æ¨¡æ¿å’Œæ•°æ®ã€Œåºåˆ—åŒ–ä¿å­˜çš„size&amp;elementã€æ‰€ä»¥ä½¿ç”¨ <code>EMPTY_ELEMENTDATA</code> ä½œä¸ºç©ºæ•°ç»„ï¼Œè€Œä¸æ˜¯ <code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code></li><li>æ ¹æ® <code>size</code> è¯»å…¥å…ƒç´ æ•°æ®</li><li>æŒ‰åºåˆ—åŒ–æ­£ç¡®é¡ºåºå­˜å…¥å­˜å‚¨æ•°ç»„ä¸­</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span></span><br><span class="hljs-function">    <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;<br>    <span class="hljs-comment">// è¿™é‡Œçš„ EMPTY_ELEMENTDATA å°±æ˜¯å­—æ®µä¸­çš„ç”¨äºç»™æœ‰å‚æ„é€ ç”¨çš„ç©ºæ•°ç»„</span><br>    elementData = EMPTY_ELEMENTDATA;<br><br>    <span class="hljs-comment">// æŒ‰ç…§ size è¯»å…¥æ•°æ®</span><br>    s.defaultReadObject();<br><br>    <span class="hljs-comment">// è¯»å–å®¹é‡</span><br>    s.readInt(); <span class="hljs-comment">// ignored</span><br><br>    <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// ä¸ clone() ç±»ä¼¼ï¼Œæ ¹æ®å¤§å°è€Œä¸æ˜¯å®¹é‡åˆ†é…é˜µåˆ—</span><br>        <span class="hljs-keyword">int</span> capacity = calculateCapacity(elementData, size);<br>        SharedSecrets.getJavaOISAccess().checkArray(s, Object[].class, capacity);<br>        ensureCapacityInternal(size);<br><br>        Object[] a = elementData;<br>        <span class="hljs-comment">// æŒ‰æ­£ç¡®é¡ºåºè¯»å…¥æ‰€æœ‰å…ƒç´ </span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>            a[i] = s.readObject();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="MAX-ARRAY-SIZE-æ•°å€¼è¯´æ˜"><a href="#MAX-ARRAY-SIZE-æ•°å€¼è¯´æ˜" class="headerlink" title="MAX_ARRAY_SIZE æ•°å€¼è¯´æ˜"></a>MAX_ARRAY_SIZE æ•°å€¼è¯´æ˜</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * The maximum size of array to allocate.</span><br><span class="hljs-comment"> * Some VMs reserve some header words in an array.</span><br><span class="hljs-comment"> * Attempts to allocate larger arrays may result in</span><br><span class="hljs-comment"> * OutOfMemoryError: Requested array size exceeds VM limit</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="hljs-number">8</span>;<br></code></pre></div></td></tr></table></figure><p>å®˜æ–¹æ³¨é‡Šè§£é‡Šï¼Œæœ‰äº›è™šæ‹Ÿæœºä¼šä¿ç•™ä¸€äº›å­—æ®µç©ºé—´ï¼Œå¦‚æœç”¨æ»¡ <code>Integer.MAX_VALUE</code> <strong>å¯èƒ½</strong>ä¼š OOMã€‚</p><p>StackOverflow ä¸Šçš„éƒ¨åˆ†è§£é‡ŠæåŠåˆ°ã€Œå†…å­˜æ¨¡å‹é‡Œçš„<strong>å¯¹è±¡å¤´</strong>çš„ç»„æˆã€<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote">&lt;span class=â€hintâ€“top hintâ€“roundedâ€ aria-label=â€Why the maximum array size of ArrayList is Integer.MAX_VALUE - 8?</p><p>â€œ&gt;[1]</span></a></sup></p><p>äºæ˜¯å¯¹äº <strong>Javaæ•°ç»„å¯¹è±¡</strong> å‰–æ<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote">&lt;span class=â€hintâ€“top hintâ€“roundedâ€ aria-label=â€Anatomy of a Java array object</p><p>â€œ&gt;[2]</span></a></sup></p><p>IBMå®˜æ–¹è¯´åˆ°ã€Œä¸Javaå¯¹è±¡ç›¸æ¯”ï¼ŒåŒºåˆ«åœ¨äºæ•°ç»„å¯¹è±¡æœ‰ä¸€ä¸ªé¢å¤–çš„å…ƒæ•°æ®ï¼Œç”¨äºè¡¨ç¤º <strong>æ•°ç»„çš„å¤§å°</strong>ã€</p><p>å‰–æ <strong>Javaå¯¹è±¡</strong>  <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote">&lt;span class=â€hintâ€“top hintâ€“roundedâ€ aria-label=â€Anatomy of a Java object</p><p>â€œ&gt;[3]</span></a></sup></p><p>ä¸åŒçš„JVMå‚å•†å¯¹å…ƒæ•°æ®æ•°é‡çš„è®¾è®¡æœ‰å·®å¼‚ï¼Œä½†é€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li><strong>Class</strong>ï¼šæŒ‡å‘ç±»ä¿¡æ¯çš„æŒ‡é’ˆï¼Œå³ç±»å‹æŒ‡é’ˆã€‚æŒ‡å‘æ–¹æ³•åŒºä¸­çš„ç±»å…ƒä¿¡æ¯ã€‚</li><li><strong>Flags</strong>ï¼šæè¿°å¯¹è±¡çŠ¶æ€çš„æ ‡å¿—é›†åˆï¼ŒåŒ…æ‹¬ hashcode å’Œ shapeã€Œå¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ã€</li><li><strong>Lock</strong>ï¼š å¯¹è±¡çš„åŒæ­¥ä¿¡æ¯ã€Œå½“å‰å¯¹è±¡æ˜¯å¦åŒæ­¥ã€</li></ul><p>è€Œ <strong>Javaæ•°ç»„å¯¹è±¡</strong> è¿˜å¤šä¸€ä¸ª <strong>Size</strong>ï¼Œå³æ•°ç»„çš„å¤§å°ã€‚</p><p>ã€Œ<a href="https://stackoverflow.com/questions/35756277/why-the-maximum-array-size-of-arraylist-is-integer-max-value-8#:~:text=The%20size%20of%20object%20header%20can%20not%20exceed%208%20byte.">å¯¹è±¡å¤´çš„å¤§å°ä¸èƒ½è¶…è¿‡ 8 å­—èŠ‚</a>ã€</p><p><strong>æ ‡è®°å­— Mark Word</strong>ã€Œå“ˆå¸Œå€¼ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€åœ¨ 32 ä½æ¶æ„å  4 byteï¼Œ64 ä½æ¶æ„å  8 byteï¼›<strong>ç±»å‹æŒ‡é’ˆKlass pointer</strong> åœ¨ 32 ä¸ºæ¶æ„ä¸Šå…·æœ‰å­—é•¿ï¼Œä½†å¦‚æœå †åœ°å€å¯ä»¥ç”¨ 4 byte ç¼–ç ï¼Œåˆ™ä¾ç„¶å¯ä»¥å  4 byteã€‚</p><p>ğŸ“Œï¼šæ‰€ä»¥ä¸ºäº†ä¿é™©èµ·è§ã€Œé˜²æ­¢OOMã€ï¼Œæœ€å¤§æ•°ç»„é•¿åº¦è®¾ç½®ä¸º <code>Integer.MAX_VALUE - 8</code> </p><h3 id="â…¡ã€Constructor"><a href="#â…¡ã€Constructor" class="headerlink" title="â…¡ã€Constructor"></a>â…¡ã€Constructor</h3><h4 id="æ— å‚æ„é€ "><a href="#æ— å‚æ„é€ " class="headerlink" title="æ— å‚æ„é€ "></a>æ— å‚æ„é€ </h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ„é€ ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayList</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è¿™é‡Œçš„åˆå§‹å®¹é‡ä¸º 10ï¼Œåœ¨å­—æ®µ <code>DEFAULT_CAPACITY = 10</code> ä½“ç°å‡ºæ¥çš„</li></ul><h4 id="æœ‰å‚æ„é€ "><a href="#æœ‰å‚æ„é€ " class="headerlink" title="æœ‰å‚æ„é€ "></a>æœ‰å‚æ„é€ </h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (initialCapacity &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">this</span>.elementData = <span class="hljs-keyword">new</span> Object[initialCapacity];<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (initialCapacity == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">this</span>.elementData = EMPTY_ELEMENTDATA;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal Capacity: &quot;</span>+<br>                                           initialCapacity);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨</li><li>å¦‚æœå…¥å‚ä¸ºè´Ÿæ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;<br>    <span class="hljs-comment">// æŒ‰æ­£ç¡®é¡ºåºåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„</span><br>    Object[] a = c.toArray();<br>    <span class="hljs-comment">// å…ˆæ›´æ–° size å€¼ï¼Œå†åˆ¤æ–­ã€‚å¦‚æœæ˜¯ç©ºæ•°ç»„åˆ™ç›´æ¥ä½¿ç”¨é»˜è®¤ç©ºæ•°ç»„</span><br>    <span class="hljs-keyword">if</span> ((size = a.length) != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// åˆ¤æ–­ c é›†åˆæ˜¯ä¸æ˜¯ArrayListï¼Œæ˜¯åˆ™ç›´æ¥èµ‹å€¼</span><br>        <span class="hljs-keyword">if</span> (c.getClass() == ArrayList.class) &#123;<br>            elementData = a;<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// å¦åˆ™æ‰‹åŠ¨æ‹·è´ä¸€ä»½ Object[]</span><br>            elementData = Arrays.copyOf(a, size, Object[].class);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// replace with empty array.</span><br>        elementData = EMPTY_ELEMENTDATA;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æŒ‰ç…§é›†åˆè¿­ä»£å™¨è¿”å›çš„é¡ºåºï¼Œæ„é€ åŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„åˆ—è¡¨ã€‚å³ä¼ å…¥ä¸€ä¸ªé›†åˆç±»</li><li>ä¼ å…¥ null åˆ™æŠ›å‡º <code>NullPointerException</code> </li></ul><h3 id="â…¢ã€Method"><a href="#â…¢ã€Method" class="headerlink" title="â…¢ã€Method"></a>â…¢ã€Method</h3><h4 id="å¢æ·»å…ƒç´ -add-E-e"><a href="#å¢æ·»å…ƒç´ -add-E-e" class="headerlink" title="å¢æ·»å…ƒç´  add(E e)"></a>å¢æ·»å…ƒç´  add(E e)</h4><ul><li>æ·»åŠ å…ƒç´  e</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    ensureCapacityInternal(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span><br>    elementData[size++] = e;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p><code>ensureCapacityInternal(int minCapacity)</code> <a href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6">æ£€æŸ¥æ˜¯å¦æ‰©å®¹</a>ï¼Œç¡®ä¿å®¹é‡<strong>è‡³å°‘</strong>è¾¾åˆ° <code>size + 1</code>ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒmodCount ä¼šå¢åŠ ï¼Œå› ä¸ºæ‰©å®¹å±äºä¿®æ”¹æ“ä½œã€‚</p></li><li><p>ç¡®ä¿å®¹é‡å¤Ÿåï¼Œå°†å€¼å­˜å…¥æ•°ç»„ã€Œ<strong>elementData</strong>ã€åŒæ—¶ <code>size ++</code></p></li></ul><h4 id="æ·»åŠ å…ƒç´ -add-int-index-E-element"><a href="#æ·»åŠ å…ƒç´ -add-int-index-E-element" class="headerlink" title="æ·»åŠ å…ƒç´  add(int index, E element)"></a>æ·»åŠ å…ƒç´  add(int index, E element)</h4><ul><li>åœ¨æŒ‡å®š index ä½ç½®æ’å…¥å…ƒç´ ï¼Œå…¶åçš„å…ƒç´ éƒ½å‘å³ç§»åŠ¨</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;<br>    rangeCheckForAdd(index);<br><br>    ensureCapacityInternal(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span><br>    System.arraycopy(elementData, index, elementData, index + <span class="hljs-number">1</span>,<br>                     size - index);<br>    elementData[index] = element;<br>    size++;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rangeCheckForAdd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (index &gt; size || index &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å…ˆæ£€æŸ¥ index çš„åˆæ³•æ€§</li><li><a href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6">æ£€æŸ¥æ˜¯å¦æ‰©å®¹</a>ï¼Œç¡®ä¿å®¹é‡<strong>è‡³å°‘</strong>è¾¾åˆ° <code>size + 1</code>ï¼ŒæœŸé—´ modCount å¢åŠ </li><li>[index, size] çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä¸ªå•ä½</li><li>æ’å…¥å…ƒç´ ï¼Œæ›´æ–° size å€¼</li></ul><h4 id="åˆ é™¤-remove-int-index"><a href="#åˆ é™¤-remove-int-index" class="headerlink" title="åˆ é™¤ remove(int index)"></a>åˆ é™¤ remove(int index)</h4><ul><li>åˆ é™¤ä¸‹æ ‡ä¸º index çš„å…ƒç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    rangeCheck(index);<br><br>    modCount++;<br>    E oldValue = elementData(index);<br><br>    <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)<br>        System.arraycopy(elementData, index + <span class="hljs-number">1</span>, elementData, index,<br>                         numMoved);<br>    elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// æ–¹ä¾¿ GC</span><br><br>    <span class="hljs-keyword">return</span> oldValue;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// ä¸Šè¿°ä½¿ç”¨åˆ°çš„æ–¹æ³•å®ç°</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rangeCheck</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (index &gt;= size)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));<br>&#125;<br><span class="hljs-function">E <span class="hljs-title">elementData</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> (E) elementData[index];<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ£€æŸ¥ index åˆæ³•æ€§ï¼Œä¿®æ”¹è®¡æ•°å™¨ modCount ++</li><li>è·å–æ—§å…ƒç´ ï¼Œä½œä¸ºæ–¹æ³•è¿”å›å€¼</li><li>è®¡ç®—éœ€è¦è¿˜åŸçš„åé¢çš„å…ƒç´ ä¸ªæ•°ä¸º <code>size - index - 1</code></li><li>åé¢çš„å…ƒç´ å…¨éƒ¨å‘å‰ç§»åŠ¨ä¸€ä¸ªå•ä½ï¼Œæ—§å…ƒç´ è¢«<strong>è¦†ç›–</strong></li><li>åˆ é™¤æ“ä½œå‰æ•°ç»„çš„æœ€åä¸€ä½ç½®ç©ºï¼Œæ–¹ä¾¿ GC</li></ul><h4 id="åˆ é™¤-remove-Object-o"><a href="#åˆ é™¤-remove-Object-o" class="headerlink" title="åˆ é™¤ remove(Object o)"></a>åˆ é™¤ remove(Object o)</h4><ul><li>åˆ é™¤æŒ‡å®šå…ƒç´  o</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>; index &lt; size; index++)<br>            <span class="hljs-keyword">if</span> (elementData[index] == <span class="hljs-keyword">null</span>) &#123;<br>                fastRemove(index);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>; index &lt; size; index++)<br>            <span class="hljs-keyword">if</span> (o.equals(elementData[index])) &#123;<br>                fastRemove(index);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// æ²¡æœ‰è¿”å›å€¼çš„ remove(int index)</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fastRemove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    modCount++;<br>    <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)<br>        System.arraycopy(elementData, index+<span class="hljs-number">1</span>, elementData, index,<br>                         numMoved);<br>    elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// æ–¹ä¾¿ GC</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ç®€å•çš„ for - loop æ‰¾å€¼ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ‰¾åˆ°å­˜å‚¨è¿›å»çš„ null å€¼ã€Œéæ‰©å®¹éƒ¨åˆ†çš„ nullã€æ¡ä»¶æ˜¯ <code>index &lt; size</code> </li></ul><h4 id="åˆ é™¤-clear"><a href="#åˆ é™¤-clear" class="headerlink" title="åˆ é™¤ clear()"></a>åˆ é™¤ clear()</h4><ul><li>æ¸…ç©ºæ‰€æœ‰å…ƒç´ å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;<br>    modCount++;<br>    <span class="hljs-comment">// æ–¹ä¾¿ GC</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++)<br>        elementData[i] = <span class="hljs-keyword">null</span>;<br>    size = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä¿®æ”¹è®¡æ•°å™¨è‡ªå¢ï¼›å…ƒç´ ç½®ç©ºï¼Œä¾¿äºGCï¼›æœ€åä¿®æ”¹ size</li></ul><h4 id="ä¿®æ”¹-set-int-index-E-element"><a href="#ä¿®æ”¹-set-int-index-E-element" class="headerlink" title="ä¿®æ”¹ set(int index, E element)"></a>ä¿®æ”¹ set(int index, E element)</h4><ul><li>å°† index ä½ç½®çš„å…ƒç´ å€¼ä¿®æ”¹ä¸º element</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;<br>    rangeCheck(index);<br><br>    E oldValue = elementData(index);<br>    elementData[index] = element;<br>    <span class="hljs-keyword">return</span> oldValue;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å…ˆæ£€æŸ¥ index çš„åˆæ³•æ€§</li><li>è·å–æ—§å€¼ï¼›ä¿®æ”¹</li><li>è¿”å›æ—§å€¼</li></ul><h4 id="æŸ¥æ‰¾-get-int-index"><a href="#æŸ¥æ‰¾-get-int-index" class="headerlink" title="æŸ¥æ‰¾ get(int index)"></a>æŸ¥æ‰¾ get(int index)</h4><ul><li>æŸ¥æ‰¾å¹¶è¿”å› index ä½ç½®çš„å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    rangeCheck(index);<br><br>    <span class="hljs-keyword">return</span> elementData(index);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h4><ul><li>ç¡®ä¿å­˜å‚¨æ•°ç»„çš„å®¹é‡<strong>è‡³å°‘</strong>è¾¾åˆ° <code>minCapacity</code> çš„å¤§å°</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacityInternal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è®¡ç®—<strong>é¢„æœŸ</strong>æ•°ç»„å®¹é‡<ul><li><code>elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code> åˆ¤æ–­å½“å‰æ•°ç»„æ˜¯ä¸æ˜¯<strong>æ— å‚æ„é€ </strong>åˆ›é€ å‡ºæ¥çš„<strong>å®¹é‡ä¸º0</strong>çš„æ•°ç»„</li><li>å¦‚æœæ˜¯ï¼Œåˆ™è®¡ç®—å‡ºæ¥çš„æ•°ç»„å®¹é‡å³ä¸º <code>size + 1</code>ï¼Œå³ <code>0 + 1</code>ï¼Œå› ä¸ºé»˜è®¤ç©ºæ•°ç»„size == 0</li><li>å¦åˆ™ç›´æ¥è¿”å› minCapacityï¼Œå³ä¼ è¿›æ¥çš„ [size + 1](#å¢æ·»å…ƒç´  add(E e))</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">calculateCapacity</span><span class="hljs-params">(Object[] elementData, <span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;<br>        <span class="hljs-keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);<br>    &#125;<br>    <span class="hljs-keyword">return</span> minCapacity;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“ŒQï¼šif è¯­å¥è¿”å›çš„ä¸€ç›´éƒ½æ˜¯ <code>minCapacity</code>ã€Œå› ä¸ºæ­£æ•°minCapacity &gt; DEFAULT_CAPACITY (0)ã€ï¼Œè€Œ if è¯­å¥å¤–ä¹Ÿæ˜¯è¿”å› <code>minCapacity</code>ã€‚è®¾è®¡æ„ä¹‰åœ¨å“ªï¼Ÿ</p><p>Aï¼šå‡è®¾ä¼ å…¥çš„ <code>minCapacity</code> æ˜¯è´Ÿæ•°ï¼Œå³ add() ä¸­çš„ <code>size + 1</code> ä»ä¸ºè´Ÿæ•°ï¼Œåˆ™ä¼šè¿”å› <code>DEFAULT_CAPACITY</code> AKA <strong>10</strong>ï¼Œå³æ— å‚æ„é€ é»˜è®¤åˆ›å»ºå®¹é‡ä¸º <strong>10</strong> çš„æ•°ç»„ï¼Œæ‰€ä»¥è¿™ä¹ˆè®¾è®¡å¯ä»¥è§£å†³éæ³•å…¥å‚ã€‚</p><p>Qï¼šä¸ºä»€ä¹ˆè¦åˆ¤æ–­ã€ŒelementDataã€æ˜¯å¦æ˜¯ é»˜è®¤ç©ºæ•°ç»„<code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code></p><p>Aï¼šå…¶å®æ­¤ if è¯­å¥åªæœ‰ç¬¬ä¸€æ¬¡æ‰©å®¹ä¼šä½¿ç”¨åˆ°ï¼ŒçœŸæ­£çš„æ‰©å®¹ <code>grow()</code> åœ¨æ¯ä¸€æ¬¡æ‰©å®¹éƒ½ä¼šåˆ›å»ºå‡ºæ–°çš„æ•°ç»„è¦†ç›–æ‰ <code>elementData</code>ï¼Œæ‰©å®¹ä¹‹åè‚¯å®šå°±èƒ½ç¡®ä¿å…¥å‚ <code>minCapacity</code> æ˜¯æ­£æ•°ï¼ˆ[size + 1](#å¢æ·»å…ƒç´  add(E e))ï¼‰ï¼Œä¸éœ€è¦å†åˆ¤æ–­ã€‚</p><ul><li>ç¡®ä¿æ˜ç¡®çš„å®¹é‡ï¼Œåšæ‰©å®¹å‰çš„æœ€åä¸€æ¬¡ç¡®è®¤<ul><li>ä¿®æ”¹è®¡æ•°å™¨è‡ªå¢</li><li>åˆ¤æ–­åˆšæ‰è®¡ç®—çš„<strong>é¢„æœŸ</strong>æ•°ç»„å®¹é‡ æ˜¯å¦å¤§äº å½“å‰æ•°ç»„å®¹é‡</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureExplicitCapacity</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    modCount++;<br>    <span class="hljs-comment">// overflow-conscious code</span><br>    <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)<br>        grow(minCapacity);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“Œå®˜æ–¹åœ¨æ¡ä»¶åˆ¤æ–­è¿™é‡Œæ³¨è§£äº† æº¢å‡ºè­¦å‘Šã€Œoverflow-consciousã€ï¼Œè¿™é‡Œæ¶‰åŠåˆ° <code>a &lt; b</code> ä¸ <code>a - b &lt; 0</code> åŒºåˆ«çš„é—®é¢˜ï¼Œ[ä¸‹æ–‡è¯´æ˜](#å…³äº a &lt; b ä¸ a - b &lt; 0 åº”ç”¨è¯´æ˜)ã€‚</p><ul><li>æ‰©å®¹æ“ä½œ<ul><li>è·å–æ—§å®¹é‡ï¼Œæ ¹æ®æ—§å®¹é‡çš„ <strong>1.5</strong> å€å¤§å°ä½œä¸ºæ–°å®¹é‡ï¼Œä½¿ç”¨<strong>ä½è¿ç®—</strong>æé«˜æ•ˆç‡ã€‚</li><li>ä¸¤ä¸ªç‰¹æ®Šåˆ¤æ–­åï¼Œè¿›è¡Œæ‰©å®¹ï¼Œä½¿ç”¨çš„æ˜¯ <code>Arrays.copyOf</code> æ‰©å®¹ï¼Œè¿™ä¼šåˆ›å»ºå‡º<strong>æ–°æ•°ç»„</strong>è¦†ç›–åŸæ•°ç»„</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">grow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    <span class="hljs-comment">// overflow-conscious code</span><br>    <span class="hljs-keyword">int</span> oldCapacity = elementData.length;<br>    <span class="hljs-keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>); <span class="hljs-comment">// AKA 1.5å€æ‰©å®¹</span><br>    <span class="hljs-comment">// åªæœ‰ç¬¬ä¸€æ¬¡æ‰ä¼š true ä¿®æ”¹æ–°å®¹é‡</span><br>    <span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)<br>        newCapacity = minCapacity;<br>    <span class="hljs-comment">// å¦‚æœæ–°å®¹é‡å¤ªå¤§ï¼Œåˆ™æŒ‰ç…§å¤§å®¹é‡å¤„ç†æ–¹å¼</span><br>    <span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)<br>        newCapacity = hugeCapacity(minCapacity);<br>    <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:</span><br>    elementData = Arrays.copyOf(elementData, newCapacity);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ğŸ“ŒQï¼šç¬¬ä¸€ä¸ªæ¡ä»¶ <code>newCapacity &lt; minCapacity</code> åˆ¤æ–­å¥‡æ€ªï¼Œæ–°å®¹é‡ä¸ºä»€ä¹ˆä¼šæ¯”é¢„æµ‹å®¹é‡å°ã€‚é¢„æµ‹å®¹é‡æ˜¯ <code>size + 1</code>ï¼Œå³æ‰€æœ‰æ•°æ®é•¿åº¦ + 1ï¼Œè€Œæ–°å®¹é‡æ˜¯åœ¨åŸå®¹é‡åŸºç¡€ä¸Šæ‰©å¤§ 1.5 å€ï¼Œè‚¯å®šæ¯” <code>minCapacity</code> è¦å¤§ã€‚</p><p>Aï¼šåœ¨æ— å‚æ„é€ åˆ›å»ºç©ºæ•°ç»„æ—¶ï¼Œ<code>oldCapacity</code> åŸå®¹é‡ä¸º 0ï¼Œ<strong>æ‰©å¤§ 1.5 å€ä»ç„¶ä¸º 0</strong>ã€‚æ­¤æ—¶æ–°å®¹é‡è‡ªç„¶æ¯”é¢„æµ‹å®¹é‡è¦å°ï¼Œå°†å€¼ä¸º0çš„ <code>newCapacity</code> æ›´æ–°ä¸º é¢„æµ‹å®¹é‡ã€‚è€Œåœ¨æ­¤ä¹‹åï¼Œè¿™ä¸€æ›´æ–°æ“ä½œéƒ½ä¸ä¼šè¿›è¡Œï¼Œå› ä¸ºæ‰©å®¹å®¹é‡è‚¯å®šæ¯”é¢„æµ‹å®¹é‡å¤§ã€Œ(x1.5) &gt; (+ 1)ã€ã€‚</p><ul><li>å¤§å®¹é‡å¤„ç†æ–¹å¼<ul><li>int å‹ä¸€ç›´ç´¯åŠ åˆ°è´Ÿæ•°ï¼Œè¯´æ˜å·²ç»è¶…å‡º int å­˜å‚¨çš„æœ€å¤§å€¼äº†ï¼ŒæŠ›å¼‚å¸¸</li><li>é¢„æµ‹å®¹é‡ &gt;  å…è®¸çš„æœ€å¤§å®¹é‡ï¼Œåˆ™è®©æ–°å®¹é‡ä¸º int æœ€å¤§å€¼ï¼Œå¦åˆ™ä¸º <code>MAX_ARRAY_SIZE</code>ï¼Œå³ <code>Integer.MAX_VALUE - 8</code>ï¼Œç›¸å½“äºç»™ä¸€ä¸ªç¨³å¦¥çš„å€¼ï¼Œ[ä¸è‡³äºOOM](#MAX_ARRAY_SIZE æ•°å€¼è¯´æ˜)ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hugeCapacity</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (minCapacity &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> OutOfMemoryError();<br>    <span class="hljs-keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?<br>        Integer.MAX_VALUE :<br>        MAX_ARRAY_SIZE;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>Arrays å·¥å…·ç±»æ‰©å®¹<ul><li>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³• <code>arraycopy()</code> è¿›è¡Œæ‰©å®¹</li><li>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„ <code>copy</code> æ•°ç»„éƒ½æ˜¯ new å‡ºæ¥çš„ï¼Œæ‰€ä»¥æ‰©å®¹ä¼šè®©å­˜å‚¨æ•°ç»„å˜æˆä¸åŒå¯¹è±¡</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T[] copyOf(T[] original, <span class="hljs-keyword">int</span> newLength) &#123;<br>    <span class="hljs-keyword">return</span> (T[]) copyOf(original, newLength, original.getClass());<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="hljs-keyword">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;<br>    T[] copy = ((Object)newType == (Object)Object[].class)<br>        ? (T[]) <span class="hljs-keyword">new</span> Object[newLength]<br>        : (T[]) Array.newInstance(newType.getComponentType(), newLength);<br>    System.arraycopy(original, <span class="hljs-number">0</span>, copy, <span class="hljs-number">0</span>,<br>                     Math.min(original.length, newLength));<br>    <span class="hljs-keyword">return</span> copy;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title">arraycopy</span><span class="hljs-params">(Object src,  <span class="hljs-keyword">int</span>  srcPos,</span></span><br><span class="hljs-function"><span class="hljs-params">                                        Object dest, <span class="hljs-keyword">int</span> destPos,</span></span><br><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">int</span> length)</span></span>;<br></code></pre></div></td></tr></table></figure><h3 id="å…³äº-a-lt-b-ä¸-a-b-lt-0-åº”ç”¨è¯´æ˜"><a href="#å…³äº-a-lt-b-ä¸-a-b-lt-0-åº”ç”¨è¯´æ˜" class="headerlink" title="å…³äº a &lt; b ä¸ a - b &lt; 0 åº”ç”¨è¯´æ˜"></a>å…³äº a &lt; b ä¸ a - b &lt; 0 åº”ç”¨è¯´æ˜</h3><p>Qï¼šçœ‹åˆ°ä¸Šè¿°æ‰©å®¹çš„å¾ˆå¤šæ¡ä»¶åˆ¤æ–­ä½¿ç”¨çš„éƒ½æ˜¯ <code>a - b &lt; 0</code> çš„å½¢å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒï¼Œè¿™ç§è®¾è®¡çš„å¥½å¤„åœ¨å“ªï¼Ÿ</p><p>åœ¨æ•°å­¦ä¸­ï¼Œè¿™ä¸¤ä¸ªä¸ç­‰å¼æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚ä½†åœ¨è®¡ç®—æœºä¸­ï¼Œéœ€è¦è€ƒè™‘åˆ°å­˜å‚¨çš„é—®é¢˜ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°å˜é‡ <code>a | b</code> å‡ºç°</p><p><strong>æº¢å‡º</strong>çš„æƒ…å†µã€‚</p><p>ğŸŒ°Demo <sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Difference between if (a - b &lt; 0) and if (a &lt; b)]">[4]</span></a></sup>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">int</span> a = Integer.MAX_VALUE;<br><span class="hljs-keyword">int</span> b = Integer.MIN_VALUE;<br><span class="hljs-keyword">if</span> (a &lt; b) System.out.println(<span class="hljs-string">&quot;a &lt; b&quot;</span>);<br><span class="hljs-keyword">if</span> (a - b &lt; <span class="hljs-number">0</span>) System.out.println(<span class="hljs-string">&quot;a - b &lt; 0&quot;</span>);<br></code></pre></div></td></tr></table></figure><blockquote><p>ç»“æœï¼ša - b &lt; 0</p></blockquote><ul><li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œa è‚¯å®šå°äº b</li><li>ä½†æ˜¯ç»“æœæ˜¯ <code>a - b &lt; 0</code> ä¸º trueï¼Œå³ a &lt; b</li></ul><p>åˆ†æï¼š<code>a - b</code> è¶…å‡º int å­˜å‚¨æœ€å¤§èŒƒå›´ï¼Œäºæ˜¯<strong>æº¢å‡º</strong>ï¼Œå˜æˆè´Ÿæ•°</p><p>ArrayList å‰çš„åˆ¤æ–­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// overflow-conscious code</span><br><span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)<br>    grow(minCapacity);<br></code></pre></div></td></tr></table></figure><p>å®˜æ–¹ä¹Ÿæå‡º æº¢å‡ºè­¦å‘Š</p><ul><li><p>ä½¿ç”¨ <code>a &lt; b</code> å½¢å¼</p><ul><li>å¦‚æœ <code>minCapacity</code> è¿‡å¤§ï¼Œæº¢å‡ºå˜æˆè´Ÿæ•°ï¼Œæ­¤æ—¶ä¸ä¼šæ‰©å®¹ï¼Œç„¶è€Œæ­¤æƒ…å†µæ˜¯æœ‰æ‰©å®¹éœ€æ±‚çš„</li></ul></li><li><p>ä½¿ç”¨ <code>a - b &lt; 0</code> å½¢å¼</p><ul><li>å¦‚æœ <code>minCapacity</code> è¿‡å¤§ï¼Œæº¢å‡ºä¸ºè´Ÿæ•°ï¼Œè€Œå‡å»ä¸€ä¸ªæ­£æ•°åˆä¼šå›åˆ°æ­£æ•°ï¼Œæ­¤æ—¶å°±ä¼šé¡ºåˆ©è¿›å…¥æ‰©å®¹ä¸­</li></ul></li></ul><p><code>grow()</code> :</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// overflow-conscious code</span><br><span class="hljs-keyword">int</span> oldCapacity = elementData.length;<br><span class="hljs-keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>);<br><span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)<br>    newCapacity = minCapacity;<br><span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)<br>    newCapacity = hugeCapacity(minCapacity);<br></code></pre></div></td></tr></table></figure><p>åŒæ ·ä¹Ÿæœ‰æº¢å‡ºè­¦å‘Š</p><ul><li>ä½¿ç”¨ <code>a &lt; b</code> å½¢å¼<ul><li><code>newCapacity</code> å¦‚æœæ‰©å®¹ 1.5 å€åå¤ªå¤§æº¢å‡ºä¸ºè´Ÿæ•°ï¼Œåˆ™ä¼šå°äº <code>minCapacity</code>ï¼Œä¼šæ›´æ–° <code>newCapacity = minCapacity;</code> </li><li>ä¸‹ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œ<code>newCapacity</code> ä¸ºè´Ÿæ•° ä¼šå°äº <code>MAX_ARRAY_SIZE</code>ï¼Œæ‰€ä»¥ä¸ä¼šè¿›è¡Œ è¶…å¤§å®¹é‡å¤„ç†ï¼Œåˆ™ä¼šå‡ºç°é—®é¢˜</li></ul></li><li>ä½¿ç”¨ <code>a - b &lt; 0</code> å½¢å¼<ul><li>ç¬¬ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œæº¢å‡ºä¸ºè´Ÿæ•°çš„ <code>newCapacity</code>ï¼Œå‡å»æ­£æ•° <code>minCapacity</code> ç»“æœå¤§äº 0ï¼Œä¸æ›´æ–° <code>newCapacity</code>ï¼Œå³åªæœ‰ç¬¬ä¸€æ¬¡æ‰©å®¹ã€Œç©ºæ•°ç»„ã€ä¼šæ›´æ–°</li><li>ç¬¬äºŒä¸ªæ¡ä»¶åˆ¤æ–­ï¼ŒåŒç†ï¼Œä¼šæ‰§è¡Œè¶…å¤§å®¹é‡å¤„ç†ï¼Œåˆä¹é€»è¾‘ã€‚</li></ul></li></ul><h2 id="ä¸‰ã€Vector"><a href="#ä¸‰ã€Vector" class="headerlink" title="ä¸‰ã€Vector"></a>ä¸‰ã€Vector</h2><ul><li>å› ä¸ºæ–¹æ³•ä¸ŠåŠ äº† <code>synchronized</code>ï¼Œæ˜¯æ–¹æ³•çº§çš„é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>å¤§éƒ¨åˆ†é€»è¾‘å’Œè®¾è®¡ä¸ <code>ArrayList</code> ç›¸åŒ</li></ul><h3 id="â… ã€Field-1"><a href="#â… ã€Field-1" class="headerlink" title="â… ã€Field"></a>â… ã€Field</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å­˜å‚¨æ•°ç»„</span><br><span class="hljs-keyword">protected</span> Object[] elementData;<br><span class="hljs-comment">// çœŸå®å…ƒç´ çš„æ•°é‡</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> elementCount;<br><span class="hljs-comment">// æ‰©å®¹å› å­ï¼Œè¯¦ç»†ä½œç”¨è§æ‰©å®¹å‡½æ•°</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> capacityIncrement;<br></code></pre></div></td></tr></table></figure><h3 id="â…¡ã€Constructor-1"><a href="#â…¡ã€Constructor-1" class="headerlink" title="â…¡ã€Constructor"></a>â…¡ã€Constructor</h3><h4 id="æ— å‚æ„é€ -1"><a href="#æ— å‚æ„é€ -1" class="headerlink" title="æ— å‚æ„é€ "></a>æ— å‚æ„é€ </h4><ul><li>æ— å‚æ„é€ é»˜è®¤çš„æ•°ç»„é•¿åº¦æ˜¯ <strong>10</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>(<span class="hljs-number">10</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æœ‰å‚æ„é€ -1"><a href="#æœ‰å‚æ„é€ -1" class="headerlink" title="æœ‰å‚æ„é€ "></a>æœ‰å‚æ„é€ </h4><ul><li>è‡ªå®šä¹‰æ•°ç»„é•¿åº¦ï¼Œé»˜è®¤çš„æ‰©å®¹å› å­æ˜¯ <strong>0</strong>ï¼Œå³æ‰©å®¹æ˜¯ <strong>2</strong> å€æ‰©å®¹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>(initialCapacity, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è‡ªå®šä¹‰æ•°ç»„é•¿åº¦ &amp; æ‰©å®¹å› å­</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">int</span> capacityIncrement)</span> </span>&#123;<br>    <span class="hljs-keyword">super</span>();<br>    <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal Capacity: &quot;</span>+<br>                                           initialCapacity);<br>    <span class="hljs-keyword">this</span>.elementData = <span class="hljs-keyword">new</span> Object[initialCapacity];<br>    <span class="hljs-keyword">this</span>.capacityIncrement = capacityIncrement;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æŒ‰ç…§ä¼ å…¥çš„é›†åˆåˆå§‹åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;<br>    Object[] a = c.toArray();<br>    elementCount = a.length;<br>    <span class="hljs-keyword">if</span> (c.getClass() == ArrayList.class) &#123;<br>        elementData = a;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        elementData = Arrays.copyOf(a, elementCount, Object[].class);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="â…¢ã€Method-1"><a href="#â…¢ã€Method-1" class="headerlink" title="â…¢ã€Method"></a>â…¢ã€Method</h3><ul><li>å¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¸ <code>ArrayList</code> ç›¸åŒ</li></ul><h4 id="æ‰©å®¹æœºåˆ¶-1"><a href="#æ‰©å®¹æœºåˆ¶-1" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    modCount++;<br>    ensureCapacityHelper(elementCount + <span class="hljs-number">1</span>);<br>    elementData[elementCount++] = e;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ‰©å®¹å‰çš„æ£€æŸ¥</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacityHelper</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    <span class="hljs-comment">// overflow-conscious code</span><br>    <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)<br>        grow(minCapacity);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ğŸ“Œæ‰©å®¹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">grow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;<br>    <span class="hljs-comment">// overflow-conscious code</span><br>    <span class="hljs-keyword">int</span> oldCapacity = elementData.length;<br>    <span class="hljs-keyword">int</span> newCapacity = oldCapacity + ((capacityIncrement &gt; <span class="hljs-number">0</span>) ?<br>                                     capacityIncrement : oldCapacity); <span class="hljs-comment">// æ‰©å®¹æœºåˆ¶</span><br>    <span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)<br>        newCapacity = minCapacity;<br>    <span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)<br>        newCapacity = hugeCapacity(minCapacity);<br>    elementData = Arrays.copyOf(elementData, newCapacity);<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>newCapacity</code> æ˜¯æ—§å®¹é‡ åŠ ä¸Šä¸€ä¸ªå€¼ï¼Œä¸‰ç›®è¿ç®—ç¬¦åˆ¤æ–­æ‰©å®¹å› å­æ˜¯å¤šå°‘ï¼Œå¦‚æœæ˜¯é»˜è®¤çš„ 0 æˆ–è€…å°äº 0ï¼Œåˆ™æ‰©å®¹ä¸¤å€ã€‚</p><p>å¦åˆ™æ‰©å®¹ <code>1 + capacityIncrement</code> å€</p><h2 id="å››ã€LinkedList"><a href="#å››ã€LinkedList" class="headerlink" title="å››ã€LinkedList"></a>å››ã€LinkedList</h2><ul><li>ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯ <strong>åŒå‘é“¾è¡¨</strong></li><li>ç»§æ‰¿äº† <code>List</code> å’Œ <code>Deque</code>ï¼Œæ‰€ä»¥å¯ä»¥å½“æˆåˆ—è¡¨é›†åˆ å’Œ åŒç«¯é˜Ÿåˆ—</li><li> éçº¿ç¨‹å®‰å…¨ï¼›ä½¿ä¹‹çº¿ç¨‹å®‰å…¨çš„åŠæ³•æ˜¯è°ƒç”¨ <code>Collections</code> å·¥å…·ç±»çš„ <code>synchronizedList(List&lt;T&gt; list)</code> æ–¹æ³•è½¬åŒ–æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">List list = Collections.synchronizedList(<span class="hljs-keyword">new</span> LinkedList(...));<br></code></pre></div></td></tr></table></figure><h3 id="â… ã€Field-2"><a href="#â… ã€Field-2" class="headerlink" title="â… ã€Field"></a>â… ã€Field</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ä¸ªæ•°</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> size = <span class="hljs-number">0</span>;<br><span class="hljs-comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</span><br><span class="hljs-keyword">transient</span> Node&lt;E&gt; first;<br><span class="hljs-comment">// æŒ‡å‘æœ«å°¾èŠ‚ç‚¹</span><br><span class="hljs-keyword">transient</span> Node&lt;E&gt; last;<br></code></pre></div></td></tr></table></figure><p>æ ¹æ®åŒå‘é“¾è¡¨å‚¨å­˜ç‰¹ç‚¹</p><p>åœ¨è¿è¡Œä¸­çš„ä¸å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">(first == <span class="hljs-keyword">null</span> &amp;&amp; last == <span class="hljs-keyword">null</span>) || (first.prev == <span class="hljs-keyword">null</span> &amp;&amp; first.item != <span class="hljs-keyword">null</span>)<br>(first == <span class="hljs-keyword">null</span> &amp;&amp; last == <span class="hljs-keyword">null</span>) || (last.next == <span class="hljs-keyword">null</span> &amp;&amp; last.item != <span class="hljs-keyword">null</span>)<br></code></pre></div></td></tr></table></figure><h4 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h4><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/1628515716530-screenshot.png"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;<br>    E item;<br>    Node&lt;E&gt; next;<br>    Node&lt;E&gt; prev;<br><br>    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;<br>        <span class="hljs-keyword">this</span>.item = element;<br>        <span class="hljs-keyword">this</span>.next = next;<br>        <span class="hljs-keyword">this</span>.prev = prev;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ç”±æ­¤å¯çœ‹å‡ºåº•å±‚æ•°æ®ç»“æ„æ˜¯ <strong>åŒå‘é“¾è¡¨</strong></li></ul><h3 id="â…¡ã€Constructor-2"><a href="#â…¡ã€Constructor-2" class="headerlink" title="â…¡ã€Constructor"></a>â…¡ã€Constructor</h3><h4 id="æ— å‚æ„é€ -2"><a href="#æ— å‚æ„é€ -2" class="headerlink" title="æ— å‚æ„é€ "></a>æ— å‚æ„é€ </h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Constructs an empty list.</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LinkedList</span><span class="hljs-params">()</span> </span>&#123;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æœ‰å‚æ„é€ -2"><a href="#æœ‰å‚æ„é€ -2" class="headerlink" title="æœ‰å‚æ„é€ "></a>æœ‰å‚æ„é€ </h4><ul><li>å°†å…¥å‚é›†åˆå…ƒç´ æ·»åŠ è¿›æ–°çš„ <code>LinkedList</code> é›†åˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LinkedList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>();<br>    addAll(c);<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="â…¢ã€Method-2"><a href="#â…¢ã€Method-2" class="headerlink" title="â…¢ã€Method"></a>â…¢ã€Method</h3><h4 id="æ·»åŠ -add-E-e"><a href="#æ·»åŠ -add-E-e" class="headerlink" title="æ·»åŠ  add(E e)"></a>æ·»åŠ  add(E e)</h4><ul><li>æ·»åŠ å…ƒç´ ï¼Œä½¿ç”¨[å°¾æ’æ³•](#å°¾æ’æ³•æ·»åŠ å…ƒç´  linkLast(E e))</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    linkLast(e);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ·»åŠ -add-int-index-E-element"><a href="#æ·»åŠ -add-int-index-E-element" class="headerlink" title="æ·»åŠ  add(int index, E element)"></a>æ·»åŠ  add(int index, E element)</h4><ul><li>æ·»åŠ å…ƒç´ åˆ°æŒ‡å®šä¸‹æ ‡ä½ç½®<ul><li>æ£€æŸ¥ä¸‹æ ‡åˆæ³•æ€§</li><li>åˆ¤æ–­æ’å…¥ä½ç½®æ˜¯åœ¨æœ«å°¾ã€Œ[å°¾æ’](#å°¾æ’æ³•æ·»åŠ å…ƒç´  linkLast(E e))ã€è¿˜æ˜¯åœ¨ã€Œ[æ’å…¥éç©ºèŠ‚ç‚¹ä¹‹å‰](#æ’å…¥å…ƒç´ åˆ°éç©ºèŠ‚ç‚¹ä¹‹å‰ linkBefore(E e, Node<E> succ))ã€</li><li>ã€Œæ’å…¥éç©ºèŠ‚ç‚¹ä¹‹å‰ã€ç”¨åˆ° [node(int index)](#æ£€ç´¢èŠ‚ç‚¹åœ¨é“¾è¡¨çš„ä¸‹æ ‡ä½ç½® node(int index)) è®¡ç®—è¿”å›ä¸‹æ ‡ä½ç½®èŠ‚ç‚¹</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;<br>    checkPositionIndex(index);<br><br>    <span class="hljs-keyword">if</span> (index == size)<br>        linkLast(element);<br>    <span class="hljs-keyword">else</span><br>        linkBefore(element, node(index));<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkPositionIndex</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!isPositionIndex(index))<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));<br>&#125;<br><span class="hljs-comment">// æ£€æŸ¥ä¸‹æ ‡åˆæ³•æ€§ index âˆˆ [0, size]</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isPositionIndex</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt;= size;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ·»åŠ -addFirst-E-e"><a href="#æ·»åŠ -addFirst-E-e" class="headerlink" title="æ·»åŠ  addFirst(E e)"></a>æ·»åŠ  addFirst(E e)</h4><ul><li>[æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´](#æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´ linkFirst(E e))</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addFirst</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    linkFirst(e);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ·»åŠ -addLast-E-e"><a href="#æ·»åŠ -addLast-E-e" class="headerlink" title="æ·»åŠ  addLast(E e)"></a>æ·»åŠ  addLast(E e)</h4><ul><li>[æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å°¾](#å°¾æ’æ³•æ·»åŠ å…ƒç´  linkLast(E e))</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addLast</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    linkLast(e);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="åˆ é™¤-remove-Object-o-1"><a href="#åˆ é™¤-remove-Object-o-1" class="headerlink" title="åˆ é™¤ remove(Object o)"></a>åˆ é™¤ remove(Object o)</h4><ul><li><p>åˆ é™¤æŒ‡å®šå…ƒç´ çš„<strong>ç¬¬ä¸€ä¸ª</strong>åŒ¹é…é¡¹</p><ul><li><strong>if</strong> å¾…åˆ é™¤å…ƒç´ ä¸º <code>null</code><ul><li>ä»å¤´æŸ¥æ‰¾ç¬¬ä¸€ä¸ª <code>null</code>ï¼Œä»é“¾è¡¨[æ–­å¼€èŠ‚ç‚¹](#åˆ é™¤èŠ‚ç‚¹ unlink(Node<E> x))</li></ul></li><li><strong>else</strong> å¾…åˆ é™¤å…ƒç´ ä¸ç©º<ul><li>ä»å¤´æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç¬¦åˆçš„å…ƒç´ ï¼Œä»é“¾è¡¨[æ–­å¼€èŠ‚ç‚¹](#åˆ é™¤èŠ‚ç‚¹ unlink(Node<E> x))</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="hljs-keyword">null</span>; x = x.next) &#123;<br>            <span class="hljs-keyword">if</span> (x.item == <span class="hljs-keyword">null</span>) &#123;<br>                unlink(x);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="hljs-keyword">null</span>; x = x.next) &#123;<br>            <span class="hljs-keyword">if</span> (o.equals(x.item)) &#123;<br>                unlink(x);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="å°¾æ’æ³•æ·»åŠ å…ƒç´ -linkLast-E-e"><a href="#å°¾æ’æ³•æ·»åŠ å…ƒç´ -linkLast-E-e" class="headerlink" title="å°¾æ’æ³•æ·»åŠ å…ƒç´  linkLast(E e)"></a>å°¾æ’æ³•æ·»åŠ å…ƒç´  linkLast(E e)</h4><ul><li><code>l</code> æŒ‡é’ˆæŒ‡å‘é“¾è¡¨å°¾éƒ¨ï¼Œç”¨äºæ ‡è®°<strong>åŸé“¾è¡¨å°¾</strong></li><li>æ ¹æ® <code>Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next)</code> åˆ›å»ºå€¼ä¸º <code>e</code>ï¼Œå‰é©±ä¸º <code>l</code> å³ <code>last</code>ï¼Œåç»§ä¸º <code>null</code> çš„èŠ‚ç‚¹ï¼Œè¿™ä¹ˆæ„é€ ç¬¦åˆ<strong>å°¾èŠ‚ç‚¹</strong>ç‰¹ç‚¹</li><li>é“¾è¡¨å°¾æŒ‡é’ˆç§»åŠ¨åˆ°æ–°é“¾è¡¨å°¾</li><li><strong>if</strong> åŸé“¾è¡¨å°¾æ˜¯ <code>null</code> <ul><li>è¯´æ˜ã€Œé“¾è¡¨ä¸ºç©ºã€ï¼Œæ­¤æ—¶æ’å…¥çš„ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤å¤´æŒ‡é’ˆä¹ŸæŒ‡å‘æ–°èŠ‚ç‚¹</li></ul></li><li><strong>else</strong> åŸé“¾è¡¨ä¸ä¸º <code>null</code><ul><li>è¯´æ˜ã€Œé“¾è¡¨ä¸ç©ºã€ï¼Œå°¾æ’åˆ°é“¾è¡¨ä¸Š</li></ul></li><li><code>size</code> &amp; <code>modCount</code> è‡ªå¢</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">linkLast</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; l = last;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> Node&lt;&gt;(l, e, <span class="hljs-keyword">null</span>);<br>    last = newNode;<br>    <span class="hljs-keyword">if</span> (l == <span class="hljs-keyword">null</span>)<br>        first = newNode;<br>    <span class="hljs-keyword">else</span><br>        l.next = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ’å…¥å…ƒç´ åˆ°éç©ºèŠ‚ç‚¹ä¹‹å‰-linkBefore-E-e-Node-succ"><a href="#æ’å…¥å…ƒç´ åˆ°éç©ºèŠ‚ç‚¹ä¹‹å‰-linkBefore-E-e-Node-succ" class="headerlink" title="æ’å…¥å…ƒç´ åˆ°éç©ºèŠ‚ç‚¹ä¹‹å‰ linkBefore(E e, Node succ)"></a>æ’å…¥å…ƒç´ åˆ°éç©ºèŠ‚ç‚¹ä¹‹å‰ linkBefore(E e, Node<E> succ)</h4><ul><li>æ–­è¨€ <code>index</code>èŠ‚ç‚¹éç©º</li><li>è·å¾— <code>index</code> èŠ‚ç‚¹å‰é©± <code>pred</code> </li><li>åˆ›å»ºèŠ‚ç‚¹ï¼Œå€¼ä¸º <code>e</code>ï¼Œå‰é©±ä¸º <code>pred</code>ï¼Œåç»§ä¸º <code>succ</code></li><li>åç»§è¿æ¥ä¸Šæ–°èŠ‚ç‚¹</li><li><strong>if</strong> å‰é©±ä¸ºç©º<ul><li>è¯´æ˜ã€Œæ’å…¥ä½ç½®åœ¨é“¾è¡¨å¤´ã€ï¼Œå¤´æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹</li></ul></li><li><strong>else</strong> åç»§ä¸ºç©º<ul><li>è¯´æ˜ã€Œæ’å…¥ä½ç½®åœ¨ä¸­é—´ã€ï¼Œå‰é©±æŒ‡å‘æ–°èŠ‚ç‚¹</li></ul></li><li><code>size</code> &amp; <code>modCount</code> è‡ªå¢</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">linkBefore</span><span class="hljs-params">(E e, Node&lt;E&gt; succ)</span> </span>&#123;<br>    <span class="hljs-comment">// assert succ != null;</span><br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; pred = succ.prev;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> Node&lt;&gt;(pred, e, succ);<br>    succ.prev = newNode;<br>    <span class="hljs-keyword">if</span> (pred == <span class="hljs-keyword">null</span>)<br>        first = newNode;<br>    <span class="hljs-keyword">else</span><br>        pred.next = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´-linkFirst-E-e"><a href="#æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´-linkFirst-E-e" class="headerlink" title="æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´ linkFirst(E e)"></a>æ’å…¥å…ƒç´ åˆ°é“¾è¡¨å¤´ linkFirst(E e)</h4><ul><li>è·å¾—å¤´èŠ‚ç‚¹</li><li>åˆ›å»ºèŠ‚ç‚¹ï¼Œå€¼ä¸º <code>e</code>ï¼Œå‰é©±ä¸º <code>null</code>ï¼Œåç»§ä¸º <code>f</code>ï¼Œå³æ—§å¤´ç»“ç‚¹</li><li>å¤´æŒ‡é’ˆç§»åˆ°æ–°èŠ‚ç‚¹</li><li><strong>if</strong> æ—§å¤´èŠ‚ç‚¹ä¸ºç©º<ul><li>è¯´æ˜ã€Œé“¾è¡¨ä¸ºç©ºã€ï¼Œå°¾æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹</li></ul></li><li><strong>else</strong> æ—§å¤´èŠ‚ç‚¹ä¸ç©º<ul><li>è¯´æ˜ã€Œé“¾è¡¨ä¸ç©ºã€ï¼Œè¿æ¥ æ–°èŠ‚ç‚¹&amp;æ—§å¤´ç»“ç‚¹</li></ul></li><li><code>size</code> &amp; <code>modCount</code> è‡ªå¢</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">linkFirst</span><span class="hljs-params">(E e)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> Node&lt;&gt;(<span class="hljs-keyword">null</span>, e, f);<br>    first = newNode;<br>    <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span>)<br>        last = newNode;<br>    <span class="hljs-keyword">else</span><br>        f.prev = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="åˆ é™¤èŠ‚ç‚¹-unlink-Node-x"><a href="#åˆ é™¤èŠ‚ç‚¹-unlink-Node-x" class="headerlink" title="åˆ é™¤èŠ‚ç‚¹ unlink(Node x)"></a>åˆ é™¤èŠ‚ç‚¹ unlink(Node<E> x)</h4><ul><li>æ–­è¨€ èŠ‚ç‚¹ä¸ç©º</li><li>è·å– è¯¥èŠ‚ç‚¹ <code>element</code>ã€å‰é©± <code>prev</code> å’Œåç»§ <code>next</code></li><li><strong>if</strong> å‰é©±ä¸ºç©º<ul><li>è¯´æ˜ã€Œè¯¥èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ã€ï¼Œå¤´æŒ‡é’ˆç›´æ¥æŒ‡å‘åç»§</li></ul></li><li><strong>else</strong> å‰é©±ä¸ç©º<ul><li>è¯´æ˜ã€Œè¯¥èŠ‚ç‚¹éå¤´èŠ‚ç‚¹ã€ï¼Œå‰é©±æŒ‡å‘åç»§ï¼Œå†æ–­ã€Œx æŒ‡å‘å‰é©±ã€</li></ul></li><li>åŒå‘é“¾è¡¨ï¼Œåé¢çš„æ–¹å‘é“ç†åŒä¸Š</li><li><code>size</code> è‡ªå‡ï¼Œ <code>modCount</code> è‡ªå¢ï¼Œå…ƒç´ ç½®ç©ºï¼Œè¿”å›åˆ é™¤çš„èŠ‚ç‚¹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">E <span class="hljs-title">unlink</span><span class="hljs-params">(Node&lt;E&gt; x)</span> </span>&#123;<br>    <span class="hljs-comment">// assert x != null;</span><br>    <span class="hljs-keyword">final</span> E element = x.item;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; next = x.next;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; prev = x.prev;<br><br>    <span class="hljs-keyword">if</span> (prev == <span class="hljs-keyword">null</span>) &#123;<br>        first = next;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        prev.next = next;<br>        x.prev = <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (next == <span class="hljs-keyword">null</span>) &#123;<br>        last = prev;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        next.prev = prev;<br>        x.next = <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    x.item = <span class="hljs-keyword">null</span>;<br>    size--;<br>    modCount++;<br>    <span class="hljs-keyword">return</span> element;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ£€ç´¢èŠ‚ç‚¹åœ¨é“¾è¡¨çš„ä¸‹æ ‡ä½ç½®-node-int-index"><a href="#æ£€ç´¢èŠ‚ç‚¹åœ¨é“¾è¡¨çš„ä¸‹æ ‡ä½ç½®-node-int-index" class="headerlink" title="æ£€ç´¢èŠ‚ç‚¹åœ¨é“¾è¡¨çš„ä¸‹æ ‡ä½ç½® node(int index)"></a>æ£€ç´¢èŠ‚ç‚¹åœ¨é“¾è¡¨çš„ä¸‹æ ‡ä½ç½® node(int index)</h4><ul><li>æ–­è¨€ <code>indexâˆˆ[0, size)</code></li><li><strong>if</strong> ä¸‹æ ‡åœ¨å·¦åŠè¾¹<ul><li>ä»å¤´å‘ä¸­é—´æ£€ç´¢</li></ul></li><li><strong>else</strong> ä¸‹æ ‡åœ¨å³åŠè¾¹<ul><li>ä»åå‘ä¸­é—´æ£€ç´¢</li></ul></li></ul><p>ğŸ“ŒäºŒåˆ†æ€æƒ³ï¼Œåˆ©ç”¨å¥½åŒå‘é“¾è¡¨ï¼ŒåŒæ—¶å¤´å°¾èŠ‚ç‚¹éƒ½æ˜¯å›ºå®šçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">Node&lt;E&gt; <span class="hljs-title">node</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-comment">// assert isElementIndex(index);</span><br>    <span class="hljs-keyword">if</span> (index &lt; (size &gt;&gt; <span class="hljs-number">1</span>)) &#123;<br>        Node&lt;E&gt; x = first;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; index; i++)<br>            x = x.next;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Node&lt;E&gt; x = last;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = size - <span class="hljs-number">1</span>; i &gt; index; i--)<br>            x = x.prev;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="è·å–å…ƒç´ å››ç§æ–¹æ³•çš„åŒºåˆ«"><a href="#è·å–å…ƒç´ å››ç§æ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="è·å–å…ƒç´ å››ç§æ–¹æ³•çš„åŒºåˆ«"></a>è·å–å…ƒç´ å››ç§æ–¹æ³•çš„åŒºåˆ«</h4><p><code>getFirst()</code> &amp; <code>getLast()</code> &amp; <code>peekFirst()</code> &amp; <code>peekLast()</code> </p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peekFirst</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">return</span> (f == <span class="hljs-keyword">null</span>) ? <span class="hljs-keyword">null</span> : f.item;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">getFirst</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();<br>    <span class="hljs-keyword">return</span> f.item;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å¾ˆæ˜æ˜¾ï¼Œ<code>peek</code> ç±»å‹çš„æ–¹æ³•åœ¨ç©ºé“¾è¡¨æ—¶ä¼šè¿”å› <code>null</code>ï¼Œ<code>get</code> ç±»å‹åˆ™<strong>æŠ›å‡ºå¼‚å¸¸</strong> <code>NoSuchElementException</code> </li></ul><h4 id="LinkedList-ä½œåŒç«¯é˜Ÿåˆ—å’Œæ ˆçš„ç»†èŠ‚"><a href="#LinkedList-ä½œåŒç«¯é˜Ÿåˆ—å’Œæ ˆçš„ç»†èŠ‚" class="headerlink" title="LinkedList ä½œåŒç«¯é˜Ÿåˆ—å’Œæ ˆçš„ç»†èŠ‚"></a>LinkedList ä½œåŒç«¯é˜Ÿåˆ—å’Œæ ˆçš„ç»†èŠ‚</h4><p>å› ä¸º <code>LinkedList </code> åŒæ—¶ä¹Ÿå®ç°äº† <code>Deque</code> æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸º<strong>åŒç«¯é˜Ÿåˆ—</strong>ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥å½“åš<strong>æ ˆ</strong>ã€Œä¸€å¼€ä¸€é—­ã€ã€‚</p><ul><li>æ ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Deque&lt;Integer&gt; stack = <span class="hljs-keyword">new</span> ArrayDeque&lt;Integer&gt;();<br>        stack.push(<span class="hljs-number">1</span>);<br>        stack.push(<span class="hljs-number">2</span>);<br>        stack.push(<span class="hljs-number">3</span>);<br>        System.out.println(stack);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>[3, 2, 1]</p></blockquote><ul><li>é˜Ÿåˆ—</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Deque&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> ArrayDeque&lt;Integer&gt;();<br>        queue.offer(<span class="hljs-number">1</span>);<br>        queue.offer(<span class="hljs-number">2</span>);<br>        queue.offer(<span class="hljs-number">3</span>);<br>        System.out.println(queue);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>[1, 2, 3]</p></blockquote><p>æ—¢ç„¶å¯ä»¥åŒæ—¶ä½œé˜Ÿåˆ—å’Œæ ˆï¼Œå¼•å‘æ€è€ƒï¼ŒåŒä¸º <code>peek()</code> è·å¾—ã€Œæ ˆé¡¶ã€| ã€Œé˜Ÿå¤´ã€å…ƒç´ ï¼Œé‚£ä¹ˆçŒœæµ‹<strong>é˜Ÿåˆ—é¦–éƒ¨</strong>å’Œ<strong>æ ˆé¡¶å¼€å£</strong>æ˜¯<strong>åŒä¸ªæ–¹å‘</strong>çš„ã€‚</p><ul><li>æŸ¥çœ‹ <code>Deque</code> çš„ <code>peek()</code> å®˜æ–¹æ³¨é‡Š</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Retrieves, but does not remove, the head of the queue represented by</span><br><span class="hljs-comment"> * this deque (in other words, the first element of this deque), or</span><br><span class="hljs-comment"> * returns &#123;<span class="hljs-doctag">@code</span> null&#125; if this deque is empty.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;This method is equivalent to &#123;<span class="hljs-doctag">@link</span> #peekFirst()&#125;.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the head of the queue represented by this deque, or</span><br><span class="hljs-comment"> *         &#123;<span class="hljs-doctag">@code</span> null&#125; if this deque is empty</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">E <span class="hljs-title">peek</span><span class="hljs-params">()</span></span>;<br></code></pre></div></td></tr></table></figure><p><code>peek()</code> è¿”å› deque é˜Ÿåˆ—å¤´ï¼Œ å¦‚æœåŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› <code>null</code></p><ul><li>æŸ¥çœ‹ <code>LinkedList</code> å®ç°çš„ <code>peek()</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peek</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">return</span> (f == <span class="hljs-keyword">null</span>) ? <span class="hljs-keyword">null</span> : f.item;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>è·å–å·¦ä¾§é“¾è¡¨é¦–éƒ¨</p><ul><li>æŸ¥çœ‹ <code>ArrayDeque</code> å®ç°çš„ <code>peek()</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peek</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> peekFirst();<br>&#125;<br></code></pre></div></td></tr></table></figure><p>è·å–é˜Ÿåˆ—é¦–éƒ¨</p><p>ğŸ“Œç»“è®ºï¼šå®˜æ–¹å®šä¹‰çš„å·¦è¾¹ï¼ˆFirstï¼‰æ˜¯<code>æ ˆé¦–</code>ï¼Œ<code>é˜Ÿåˆ—å¤´</code>ã€‚ç”±æ­¤æ‰èƒ½å®ç°ä¸€ä¸ªæ–¹æ³•è¾¾åˆ°ç›¸åŒçš„<strong>peek</strong> æ•ˆæœã€‚</p><h2 id="ğŸ”—Referenceï¼š"><a href="#ğŸ”—Referenceï¼š" class="headerlink" title="ğŸ”—Referenceï¼š"></a>ğŸ”—<strong>Referenceï¼š</strong></h2><blockquote></blockquote><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://stackoverflow.com/questions/35756277/why-the-maximum-array-size-of-arraylist-is-integer-max-value-8">Why the maximum array size of ArrayList is Integer.MAX_VALUE - 8?</a><blockquote></blockquote><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://developer.ibm.com/articles/j-codetoheap/#:~:text=those%20128%20bits.-,Anatomy%20of%20a%20Java%20array%20object,-The%20shape%20and">Anatomy of a Java array object</a><blockquote></blockquote><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://developer.ibm.com/articles/j-codetoheap/#:~:text=the%20native%20heap.-,Anatomy%20of%20a%20Java%20object,-When%20your%20Java">Anatomy of a Java object</a><blockquote></blockquote><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://stackoverflow.com/questions/33147339/difference-between-if-a-b-0-and-if-a-b">[Difference between if (a - b &lt; 0) and if (a &lt; b)]</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>JVMã€ŒHotSpot VMã€</title>
    <link href="/2021/06/02/JVM/JVM%E3%80%8CHotSpot%20VM%E3%80%8D/"/>
    <url>/2021/06/02/JVM/JVM%E3%80%8CHotSpot%20VM%E3%80%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="ğŸ“Œ-JVMã€ŒHotSpot-VMã€"><a href="#ğŸ“Œ-JVMã€ŒHotSpot-VMã€" class="headerlink" title="ğŸ“Œ JVMã€ŒHotSpot VMã€"></a>ğŸ“Œ JVMã€ŒHotSpot VMã€</h3><ul><li><p>ğŸ“‚ Code Repository: <a href="https://github.com/hypocrite30/JVM-demonstrate">https://github.com/hypocrite30/JVM-demonstrate</a></p><ul><li>In directory ã€Œ<code>src</code>ã€</li></ul></li><li><p>ğŸ“š Reference :  </p><ul><li>ã€Œ<a href="https://book.douban.com/subject/34907497/">æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰</a>ã€<ul><li>In directory ã€Œ<code>doc</code>ã€</li></ul></li><li>ã€Œ<a href="https://www.bilibili.com/video/BV1PJ411n7xZ">å°šç¡…è°·JVMæ•™ç¨‹</a>ã€</li></ul></li><li><p>ğŸ¬Thanksï¼š</p><ul><li><a href="https://gitee.com/vectorx/NOTE_JVM">https://gitee.com/vectorx/NOTE_JVM</a><ul><li>In directory ã€Œ<code>doc</code>ã€</li></ul></li><li><a href="https://github.com/TangBean/understanding-the-jvm">https://github.com/TangBean/understanding-the-jvm</a><ul><li>In directory ã€Œ<code>doc</code>ã€</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸è§ç»†èŠ‚</title>
    <link href="/2021/05/15/JavaSE/Java%E5%B8%B8%E8%A7%81%E7%BB%86%E8%8A%82/"/>
    <url>/2021/05/15/JavaSE/Java%E5%B8%B8%E8%A7%81%E7%BB%86%E8%8A%82/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaå¸¸è§ç»†èŠ‚"><a href="#Javaå¸¸è§ç»†èŠ‚" class="headerlink" title="Javaå¸¸è§ç»†èŠ‚"></a>Javaå¸¸è§ç»†èŠ‚</h1><h2 id="1-ã€Œreplaceä¼šæ›¿æ¢æ‰€æœ‰å­—ç¬¦ï¼Ÿã€"><a href="#1-ã€Œreplaceä¼šæ›¿æ¢æ‰€æœ‰å­—ç¬¦ï¼Ÿã€" class="headerlink" title="1. ã€Œreplaceä¼šæ›¿æ¢æ‰€æœ‰å­—ç¬¦ï¼Ÿã€"></a>1. ã€Œreplaceä¼šæ›¿æ¢æ‰€æœ‰å­—ç¬¦ï¼Ÿã€</h2><p>å¦‚æœå°†å­—ç¬¦ä¸²ä¸­ <code>A</code> æ›¿æ¢ä¸º <code>B</code> ï¼Œåˆ™ä½¿ç”¨ <code>replaceAll</code> æ–¹æ³•ã€‚</p><p><code>replace</code> ä¼šæ›¿æ¢æ‰€æœ‰åŒ¹é…å­—ç¬¦å—ï¼Ÿ</p><blockquote><p>Replaces each substring of this string that matches the literal target sequence with the specified literal replacement sequence. The replacement proceeds from the beginning of the string to the end, for example, replacing â€œaaâ€ with â€œbâ€ in the string â€œaaaâ€ will result in â€œbaâ€ rather than â€œabâ€.</p></blockquote><ul><li>æ›¿æ¢ä»å­—ç¬¦ä¸²çš„å¼€å¤´ä¸€ç›´è¿›è¡Œåˆ°ç»“å°¾ï¼ŒåŒ¹é…æˆåŠŸå°±æ›¿æ¢ï¼Œç„¶åæ¥ä¸‹å»ã€‚</li><li>ä¾‹å¦‚ï¼šåŸå­—ç¬¦ä¸²ï¼š<code>aaa</code> ï¼Œå°† <code>aa</code> æ›¿æ¢ä¸º <code>b</code> ï¼Œåˆ™ç»“æœæ˜¯ <code>ba</code> è€Œä¸æ˜¯ <code>ab</code> ï¼Œå› ä¸ºæ˜¯ä»å‰å¾€åã€‚</li></ul><ol><li><code>replace</code>  ä¸¤ä¸ªé‡è½½æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">replace</span><span class="hljs-params">(<span class="hljs-keyword">char</span> oldChar, <span class="hljs-keyword">char</span> newChar)</span> <span class="hljs-comment">/* æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ */</span></span><br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">replace</span><span class="hljs-params">(CharSequence target, CharSequence replacement)</span> <span class="hljs-comment">/* æ›¿æ¢ä¸€ä¸ªä¸² */</span></span><br></code></pre></div></td></tr></table></figure><ol start="2"><li><code>replaceAll</code> </li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">replaceAll</span><span class="hljs-params">(String regex, String replacement)</span> <span class="hljs-comment">/* å‰é¢æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…æˆåŠŸæ›¿æ¢ä¸ºåé¢å­—ç¬¦ä¸² */</span></span><br></code></pre></div></td></tr></table></figure><p>ä¸¾ä¾‹ğŸŒ°ï¼šåŸä¸² s é‡Œçš„ <code>*</code> æ›¿æ¢ä¸º <code>A</code> ä¸¤ç§å†™æ³•ï¼š</p><ul><li><code>s.replaceAll(&quot;\\*&quot;, &quot;A&quot;)</code> åªèƒ½æ¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‡ºæ¥æ›¿æ¢ã€‚</li><li><code>s.replace(&quot;*&quot;, &quot;A&quot;)</code> </li></ul><ol start="3"><li><code>replaceFirst</code> åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…å­—ç¬¦ä¸²</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">replaceFirst</span><span class="hljs-params">(String regex, String replacement)</span></span><br></code></pre></div></td></tr></table></figure><h2 id="2-ã€ŒIntegerä¸èƒ½ç”¨-åˆ¤æ–­ï¼Ÿã€"><a href="#2-ã€ŒIntegerä¸èƒ½ç”¨-åˆ¤æ–­ï¼Ÿã€" class="headerlink" title="2. ã€ŒIntegerä¸èƒ½ç”¨ == åˆ¤æ–­ï¼Ÿã€"></a>2. ã€ŒIntegerä¸èƒ½ç”¨ == åˆ¤æ–­ï¼Ÿã€</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Integer orderStatus1 = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">1</span>);<br>Integer orderStatus2 = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">1</span>);<br>System.out.println(orderStatus1 == orderStatus2);<br></code></pre></div></td></tr></table></figure><ul><li>ç»“æœä¼šè¿”å› <code>false</code> </li><li>ä¸æ˜¯è¯´ Integer æœ‰ç¼“å­˜å—ï¼ŒèŒƒå›´æ˜¯ -128 ~ 127</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Integer</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.value = value;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æœ‰å‚æ„é€ å¹¶<strong>æ²¡æœ‰</strong>ç”¨åˆ°ç¼“å­˜</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title">valueOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)<br>        <span class="hljs-keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(i);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è¦ç”¨åˆ°ç¼“å­˜ï¼Œå°±åº”è¯¥ä½¿ç”¨ <code>valueOf</code> æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">String orderStatus1 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;1&quot;</span>);<br>String orderStatus2 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;1&quot;</span>);<br>System.out.println(Integer.valueOf(orderStatus1) == Integer.valueOf(orderStatus2));<br></code></pre></div></td></tr></table></figure><ul><li>è¿™æ ·å°±ä¼šè¿”å› true</li><li>åªæœ‰è¿™ç§ç‰¹æ®Šæƒ…å†µæ‰ä¼šä½¿åˆ¤æ–­ç»“æœç›¸åŒï¼Œå…»æˆå¥½å–œæ¬¢ï¼Œç»Ÿä¸€ä½¿ç”¨ <code>equals</code> æ¥åˆ¤æ–­ç›¸ç­‰ã€‚</li></ul><h2 id="3-ã€Œä½¿ç”¨BigDecimalä¸ä¸¢å¤±ç²¾åº¦ï¼Ÿã€"><a href="#3-ã€Œä½¿ç”¨BigDecimalä¸ä¸¢å¤±ç²¾åº¦ï¼Ÿã€" class="headerlink" title="3. ã€Œä½¿ç”¨BigDecimalä¸ä¸¢å¤±ç²¾åº¦ï¼Ÿã€"></a>3. ã€Œä½¿ç”¨BigDecimalä¸ä¸¢å¤±ç²¾åº¦ï¼Ÿã€</h2><p>æ¶‰åŠé‡‘èä¸šåŠ¡ï¼Œä¸å¯é¿å…æ¥è§¦åˆ°å°æ•°ã€‚</p><p>ä½¿ç”¨Doubleæ—¶å‡ºç°çš„åœºæ™¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">double</span> amount1 = <span class="hljs-number">0.02</span>;<br><span class="hljs-keyword">double</span> amount2 = <span class="hljs-number">0.03</span>;<br>System.out.println(amount2 - amount1); <span class="hljs-comment">// 0.009999999999999998</span><br></code></pre></div></td></tr></table></figure><p>ç»“æœå°äºé¢„è®¡ç»“æœã€‚</p><ul><li>Doubleç±»å‹ä¸¤ä¸ªå‚æ•°ç›¸å‡ä¼šè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œè€ŒDoubleæœ‰æ•ˆä½æ˜¯16ä½ï¼Œå‡ºç°å­˜å‚¨å°æ•°ä½ä¸å¤Ÿã€‚</li><li>ä½¿ç”¨ <code>BigDecimal</code> å°±å¯ä»¥é¿å…ä¸¢å¤±ç²¾åº¦å—ï¼Ÿè¿˜æ˜¯è¦çœ‹ä½ æ€ä¹ˆç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">BigDecimal amount1 = <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">0.02</span>);<br>BigDecimal amount2 = <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">0.03</span>);<br>System.out.println(amount2.subtract(amount1));<br></code></pre></div></td></tr></table></figure><blockquote><p>0.0099999999999999984734433411404097569175064563751220703125</p></blockquote><p>å¯ä»¥çœ‹åˆ°ä»ç„¶ä¸¢å¤±ç²¾åº¦ã€‚</p><p>çœ‹ <code>BigDecimal</code> å¸¦ double å‚æ•°çš„æ„é€ æ–¹æ³•ä¸Šçš„æ³¨é‡Š</p><blockquote><p>Notes:</p><ol><li><p>The results of this constructor can be somewhat unpredictable. One might assume that writing new BigDecimal(0.1) in Java creates a BigDecimal which is exactly equal to 0.1 (an unscaled value of 1, with a scale of 1), but it is actually equal to 0.1000000000000000055511151231257827021181583404541015625. This is because 0.1 cannot be represented exactly as a double (or, for that matter, as a binary fraction of any finite length). Thus, the value that is being passed in to the constructor is not exactly equal to 0.1, appearances notwithstanding.</p></li><li><p>The String constructor, on the other hand, is perfectly predictable: writing new BigDecimal(â€œ0.1â€) creates a BigDecimal which is exactly equal to 0.1, as one would expect. Therefore, it is generally recommended that the String constructor be used in preference to this one.</p></li><li><p>When a double must be used as a source for a BigDecimal, note that this constructor provides an exact conversion; it does not give the same result as converting the double to a String using the Double.toString(double) method and then using the BigDecimal(String) constructor. To get that result, use the static valueOf(double) method.</p></li></ol></blockquote><ul><li><p><code>public BigDecimal(double val)</code> è¿™ç§æ„é€ æ–¹æ³•ç”Ÿæˆçš„ç»“æœä¸å¯é¢„æµ‹(unpredictable)</p></li><li><p>æ³¨é‡Šä¸¾ä¾‹çš„ 0.1 æ— æ³•å‡†ç¡®æ›¿æ¢ä¸ºdoubleï¼Œå³æ— æ³•æ›¿æ¢ä¸ºä»»ä½•æœ‰é™é•¿åº¦çš„äºŒè¿›åˆ¶åˆ†æ•°</p></li><li><p>å®˜æ–¹æ¨èå…¥å‚é€‰ç”¨ <code>String</code> å­—ç¬¦ä¸²ï¼Œè¿™æ ·ä¼ å…¥å¤šå°‘ï¼Œç”Ÿæˆå¤šå°‘ã€‚</p></li><li><p>å¦‚æœéå¾—ç”¨ <code>double</code> å…¥å‚ï¼Œåˆ™å…ˆ <code>Double.toString(double)</code> è½¬æˆStringå†æ„é€ ã€‚</p></li><li><p>æˆ–è€…ä½¿ç”¨ <code>public static BigDecimal valueOf(double val)</code> é™æ€æ–¹æ³•ç”Ÿæˆï¼Œä¹Ÿæ˜¯é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œæ¨èçš„æ„é€ å½¢å¼ã€‚</p></li></ul><h2 id="4-ã€Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸èƒ½ç”¨Stringï¼Ÿã€"><a href="#4-ã€Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸èƒ½ç”¨Stringï¼Ÿã€" class="headerlink" title="4.  ã€Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸èƒ½ç”¨Stringï¼Ÿã€"></a>4.  ã€Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸èƒ½ç”¨Stringï¼Ÿã€</h2><p><code>String</code>ç±»å‹çš„å­—ç¬¦ä¸²è¢«ç§°ä¸ºä¸å¯å˜åºåˆ—ï¼Œåœ¨å¤§é‡å­—ç¬¦ä¸²æ‹¼æ¥çš„åœºæ™¯ä¸­ï¼Œå¦‚æœå¯¹è±¡å®šä¹‰ä¸º String ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šæ— ç”¨çš„ä¸­é—´å¯¹è±¡ï¼Œæµªè´¹å†…å­˜ç©ºé—´ï¼Œæ•ˆç‡ä½ã€‚</p><p>æ¨èä½¿ç”¨æ›´é«˜æ•ˆçš„å¯å˜å­—ç¬¦åºåˆ—ï¼š<code>StringBuilder</code> å’Œ <code>StringBuffer</code> </p><p><code>StringBuilder</code> è™½ç„¶çº¿ç¨‹ä¸å®‰å…¨ï¼Œä½†æ˜¯å¤šçº¿ç¨‹æ‹¼æ¥å­—ç¬¦ä¸²æƒ…å†µå¾ˆå°‘ï¼Œæ‰€ä»¥å°±ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ã€‚<code>append</code> æ–¹æ³•è¿½åŠ å­—ç¬¦ä¸²å³å¯ã€‚</p><p><strong>ã€Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶ä½¿ç”¨Stringç±»å‹çš„å¯¹è±¡ï¼Œæ•ˆç‡ä¸€å®šæ¯”StringBuilderç±»å‹çš„å¯¹è±¡ä½ï¼Ÿã€</strong></p><p>å¦ã€‚</p><p>é€šè¿‡ <code>javap -c</code> åç¼–è¯‘å¯çŸ¥ï¼Œæ€»JDK5å¼€å§‹ï¼Œjavaå¯¹Stringæ‹¼æ¥å­—ç¬¦ä¸²è¿›è¡Œä¼˜åŒ–ï¼Œç¼–è¯‘æˆå­—èŠ‚ç éƒ½ä¼šå˜æˆStringBuilderçš„appendæ“ä½œã€‚</p><h2 id="5-ã€ŒMapåˆå§‹åŒ–æ³¨æ„äº‹é¡¹ã€"><a href="#5-ã€ŒMapåˆå§‹åŒ–æ³¨æ„äº‹é¡¹ã€" class="headerlink" title="5. ã€ŒMapåˆå§‹åŒ–æ³¨æ„äº‹é¡¹ã€"></a>5. ã€ŒMapåˆå§‹åŒ–æ³¨æ„äº‹é¡¹ã€</h2><ul><li>Mapåˆå§‹åŒ–åŒæ—¶å¯¼å…¥æ•°æ®æœ‰ä»¥ä¸‹ä¸‰ç§å¸¸è§æ–¹æ³•</li></ul><ol><li>staticå—åˆå§‹åŒ–</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; myMap;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        myMap = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;();<br>        myMap.put(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br>        myMap.put(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>Guavaç±»åº“</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªHashMap</span><br>Map&lt;String, Object&gt; hashMap  = Maps.newHashMap();<br><span class="hljs-comment">// åˆ›å»ºä¸å¯å˜Map</span><br>Map&lt;String, Integer&gt; left = ImmutableMap.of(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>);<br><span class="hljs-comment">// æˆ–è€…</span><br>Map&lt;String, String&gt; test = ImmutableMap.&lt;String, String&gt;builder()<br>.put(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;v1&quot;</span>)<br>.put(<span class="hljs-string">&quot;k2&quot;</span>, <span class="hljs-string">&quot;v2&quot;</span>)<br>.build();<br></code></pre></div></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>        put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;&#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ğŸ“Œå¤–å±‚çš„æ‹¬å·æ˜¯åˆ›å»º <strong>åŒ¿åå†…éƒ¨ç±»</strong> ã€ŒAnonymous Inner Classã€ ï¼Œ<strong>è¿™é‡Œä¼šé€ æˆéšæ‚£</strong>ã€‚</li><li>å†…å±‚æ˜¯æ‹¬å·æ˜¯åˆ›å»º <strong>å®ä¾‹åˆå§‹åŒ–å—</strong> </li></ul><h3 id="â‘ éªŒè¯åŒ¿åå†…éƒ¨ç±»"><a href="#â‘ éªŒè¯åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="â‘ éªŒè¯åŒ¿åå†…éƒ¨ç±»"></a>â‘ éªŒè¯åŒ¿åå†…éƒ¨ç±»</h3><ul><li>é¦–å…ˆ <code>javac</code> ç¼–è¯‘ .java æ–‡ä»¶</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>        put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;&#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/image-20210515165844089.png" style="zoom:150%;" /><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/image-20210515170722679.png"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>$1 <span class="hljs-keyword">extends</span> <span class="hljs-title">HashMap</span> </span>&#123;<br>    Solution$<span class="hljs-number">1</span>(Solution var1) &#123;<br>        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">this</span>$<span class="hljs-number">0</span> = var1;<br>        <span class="hljs-keyword">this</span>.put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        <span class="hljs-keyword">this</span>.put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        <span class="hljs-keyword">this</span>.put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è¯´æ˜çš„ç¡®æ˜¯åˆ›å»ºäº†ä¸€ä¸ª<strong>åŒ¿åå†…éƒ¨ç±»</strong></li></ul><h3 id="â‘¡éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨"><a href="#â‘¡éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨" class="headerlink" title="â‘¡éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨"></a>â‘¡éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</h3><ul><li>Java ä¸­<strong>éé™æ€å†…éƒ¨ç±»</strong>ä¼š<strong>æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨</strong>ï¼Œä»è€Œå¯¼è‡´ GC æ— æ³•å›æ”¶è¿™éƒ¨åˆ†ä»£ç çš„å¼•ç”¨ï¼Œä»¥è‡³äºé€ æˆ<strong>å†…å­˜æº¢å‡º</strong>ã€‚</li></ul><ol><li>ğŸ¬ä¸ºä»€ä¹ˆè¦<strong>æŒæœ‰å¤–éƒ¨ç±»</strong>ï¼Ÿ</li></ol><p>éé™æ€åŒ¿åå†…éƒ¨ç±»çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªã€‚</p><ul><li><p>å½“åŒ¿åå†…éƒ¨ç±»åªåœ¨å¤–éƒ¨ç±»ï¼ˆä¸»ç±»ï¼‰ä¸­ä½¿ç”¨æ—¶ï¼ŒåŒ¿åå†…éƒ¨ç±»å¯ä»¥è®©å¤–éƒ¨ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œä»è€Œå‡å°‘äº†ä»£ç çš„ç»´æŠ¤å·¥ä½œã€‚</p></li><li><p>å½“åŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»æ—¶ï¼Œå®ƒå°±å¯ä»¥ç›´æ¥<strong>ä½¿ç”¨å¤–éƒ¨ç±»ä¸­çš„å˜é‡</strong>äº†ï¼Œè¿™æ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®Œæˆè°ƒç”¨ï¼š</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String userName = <span class="hljs-string">&quot;hypocrite30&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException </span>&#123;<br>        Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>            put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>            put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>            put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>            put(userName, userName);<br>        &#125;&#125;;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å†…éƒ¨ç±» <code>HashMap</code>  å¯ä»¥ç›´æ¥è°ƒç”¨å¤–éƒ¨ç±» <code>Solution</code> ä¸­çš„æˆå‘˜å˜é‡ <code>userName</code>.</li></ul><ol start="2"><li>ğŸ¬å®ƒæ˜¯æ€ä¹ˆæŒæœ‰å¤–éƒ¨ç±»çš„ï¼Ÿ</li></ol><ul><li><code>javap -c &#39;.\Solution$1.class&#39;</code> åç¼–è¯‘å†…éƒ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>$1 <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">util</span>.<span class="hljs-title">HashMap</span> </span>&#123;<br>  <span class="hljs-keyword">final</span> Solution <span class="hljs-keyword">this</span>$<span class="hljs-number">0</span>;<br><br>  Solution$<span class="hljs-number">1</span>(Solution);<br>    Code:<br>       <span class="hljs-number">0</span>: aload_0<br>       <span class="hljs-number">1</span>: aload_1<br>       2: putfield      #1                  // Field this$0:LSolution;<br>       <span class="hljs-number">5</span>: aload_0<br>       6: invokespecial #2                  // Method java/util/HashMap.&quot;&lt;init&gt;&quot;:()V<br>       <span class="hljs-number">9</span>: aload_0<br>      10: ldc           #3                  // String map1<br>      12: ldc           #4                  // String value1<br>      14: invokevirtual #5                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">17</span>: pop<br>      <span class="hljs-number">18</span>: aload_0<br>      19: ldc           #6                  // String map2<br>      21: ldc           #7                  // String value2<br>      23: invokevirtual #5                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">26</span>: pop<br>      <span class="hljs-number">27</span>: aload_0<br>      28: ldc           #8                  // String map3<br>      30: ldc           #9                  // String value3<br>      32: invokevirtual #5                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">35</span>: pop<br>      <span class="hljs-number">36</span>: <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>Code2:<code>putfield</code> ï¼šä¸€å¯¹ <code>Solution</code> çš„å¼•ç”¨è¢«å­˜å…¥ <code>this$0</code> ä¸­ï¼Œæ­¤æ—¶è¯¥åŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨</p></li><li><p>å¦ä¸€ç§ç›´è§‚æµ‹è¯•</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException </span>&#123;<br>        Map map = <span class="hljs-keyword">new</span> Solution().createMap();<br>        Field field = map.getClass().getDeclaredField(<span class="hljs-string">&quot;this$0&quot;</span>);<br>        field.setAccessible(<span class="hljs-keyword">true</span>);<br>        System.out.println(field.get(map).getClass());<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">createMap</span><span class="hljs-params">()</span> </span>&#123;<br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;() &#123;&#123;<br>            put(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;v1&quot;</span>);<br>            put(<span class="hljs-string">&quot;k2&quot;</span>, <span class="hljs-string">&quot;v2&quot;</span>);<br>        &#125;&#125;;<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/JavaCommons/image-20210515200626985.png"></p><blockquote><p> æ‰§è¡Œç»“æœï¼šSolution</p></blockquote><p>ç»“è®ºï¼šåŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>$0</code> å¯ä»¥æ­£å¸¸è·å–å¤–éƒ¨ç±»ï¼Œè¾“å…¥ç›¸å…³ä¿¡æ¯ã€‚</p><h3 id="â‘¢åŒ¿åå†…éƒ¨ç±»éšæ‚£"><a href="#â‘¢åŒ¿åå†…éƒ¨ç±»éšæ‚£" class="headerlink" title="â‘¢åŒ¿åå†…éƒ¨ç±»éšæ‚£"></a>â‘¢åŒ¿åå†…éƒ¨ç±»éšæ‚£</h3><ul><li>æ­£å¸¸ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">()</span> </span>&#123;<br>    Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>        put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;&#125;;<br>    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è½¬æ¢æˆè¿™æ ·å°±<strong>æœ‰å¯èƒ½</strong>é€ æˆ<strong>å†…å­˜æ³„æ¼</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">createMap</span><span class="hljs-params">()</span> </span>&#123;<br>    Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>        put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;&#125;;<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å› ä¸ºå½“æ­¤ <code>map</code> è¢«<strong>èµ‹å€¼ä¸ºå…¶ä»–ç±»å±æ€§</strong>æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ GC æ”¶é›†æ—¶ä¸æ¸…ç†æ­¤å¯¹è±¡ï¼Œè¿™æ—¶å€™æ‰ä¼šå¯¼è‡´<strong>å†…å­˜æ³„æ¼</strong>ã€‚</p><p>éé™æ€åŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼Œå› æ­¤ä¸²è¡ŒåŒ–è¿™ä¸ªé›†åˆæ—¶å¤–éƒ¨ç±»ä¹Ÿä¼šè¢«ä¸²è¡ŒåŒ–ï¼Œå½“å¤–éƒ¨ç±»æ²¡æœ‰å®ç°<code>serialize</code>æ¥å£æ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p><ul><li>æŠŠ <code>map</code> å¯¹è±¡å£°æ˜ä¸º <code>static</code> é™æ€ç±»å‹å°±ä¸ä¼šæ³„æ¼å†…å­˜</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title">createMap</span><span class="hljs-params">()</span> </span>&#123;<br>    Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>        put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        put(<span class="hljs-string">&quot;map3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br>    &#125;&#125;;<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åç¼–è¯‘æŸ¥çœ‹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>$1 <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">util</span>.<span class="hljs-title">HashMap</span> </span>&#123;<br>  Solution$<span class="hljs-number">1</span>();<br>    Code:<br>       <span class="hljs-number">0</span>: aload_0<br>       1: invokespecial #1                  // Method java/util/HashMap.&quot;&lt;init&gt;&quot;:()V<br>       <span class="hljs-number">4</span>: aload_0<br>       5: ldc           #2                  // String map1<br>       7: ldc           #3                  // String value1<br>       9: invokevirtual #4                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">12</span>: pop<br>      <span class="hljs-number">13</span>: aload_0<br>      14: ldc           #5                  // String map2<br>      16: ldc           #6                  // String value2<br>      18: invokevirtual #4                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">21</span>: pop<br>      <span class="hljs-number">22</span>: aload_0<br>      23: ldc           #7                  // String map3<br>      25: ldc           #8                  // String value3<br>      27: invokevirtual #4                  // Method put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br>      <span class="hljs-number">30</span>: pop<br>      <span class="hljs-number">31</span>: <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ²¡æœ‰ <code>putfield</code> å…³é”®å­—ï¼Œ<strong>é™æ€åŒ¿åç±»ä¸ä¼šæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨</strong> </li><li>å› ä¸ºåŒ¿åå†…éƒ¨ç±»æ˜¯é™æ€çš„ä¹‹åï¼Œå®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡æˆ–å±æ€§ä¹Ÿå¿…é¡»æ˜¯é™æ€çš„äº†ï¼Œå› æ­¤å°±å¯ä»¥ç›´æ¥ä» JVM çš„ Method Areaï¼ˆæ–¹æ³•åŒºï¼‰è·å–åˆ°å¼•ç”¨è€Œæ— éœ€æŒä¹…å¤–éƒ¨å¯¹è±¡äº†</li><li>å°½ç®¡å¦‚æ­¤è¿˜æ˜¯ä¸å»ºè®®ä½¿ç”¨åŒæ‹¬å·æ–¹å¼åˆå§‹map</li></ul><h3 id="â‘£æ›¿ä»£æ–¹æ¡ˆ"><a href="#â‘£æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="â‘£æ›¿ä»£æ–¹æ¡ˆ"></a>â‘£æ›¿ä»£æ–¹æ¡ˆ</h3><ol><li>Stream</li></ol><ul><li>Java8 çš„ Stream API</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">List list = <span class="hljs-keyword">new</span> ArrayList() &#123;&#123;<br>    add(<span class="hljs-string">&quot;Java&quot;</span>);<br>    add(<span class="hljs-string">&quot;Redis&quot;</span>);<br>&#125;&#125;;<br><span class="hljs-comment">// æ›¿æ¢ä¸ºâ†“</span><br>List list = Stream.of(<span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;Redis&quot;</span>).collect(Collectors.toList());<br></code></pre></div></td></tr></table></figure><ol start="2"><li>Java9é›†åˆå·¥å‚</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Map map = <span class="hljs-keyword">new</span> HashMap() &#123;&#123;<br>    put(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>    put(<span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>&#125;&#125;;<br><span class="hljs-comment">// æ›¿æ¢ä¸ºâ†“</span><br>Map map = Map.of(<span class="hljs-string">&quot;map1&quot;</span>, <span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;map2&quot;</span>, <span class="hljs-string">&quot;Redis&quot;</span>);<br></code></pre></div></td></tr></table></figure><blockquote><p>é¸£è°¢ï¼š<a href="https://www.cnblogs.com/vipstone/p/12937582.html">https://www.cnblogs.com/vipstone/p/12937582.html</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Redis</title>
    <link href="/2021/04/22/Redis/Redis/"/>
    <url>/2021/04/22/Redis/Redis/</url>
    
    <content type="html"><![CDATA[<h3 id="ğŸ“Œ-Redis"><a href="#ğŸ“Œ-Redis" class="headerlink" title="ğŸ“Œ Redis"></a>ğŸ“Œ Redis</h3><ul><li><p>ğŸ“• Note Book: <a href="https://www.yuque.com/hypocrite30/oz1eni">https://www.yuque.com/hypocrite30/oz1eni</a></p></li><li><p>ğŸ“‚ Code Repository: <a href="https://github.com/hypocrite30/Redis">https://github.com/hypocrite30/Redis</a></p><ul><li>In directory ã€Œ<code>src</code>ã€</li></ul></li><li><p>ğŸ“š Reference books:  ã€Œ<strong>Rediså¼€å‘ä¸è¿ç»´</strong>ã€ã€Œ<strong>Redisè®¾è®¡ä¸å®ç°</strong>ã€ã€Œ<strong>Redisæ·±åº¦å†é™©</strong>ã€</p><ul><li>In directory ã€Œ<code>doc</code>ã€</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DesignPatterns</title>
    <link href="/2021/04/15/DesignPatterns/DesignPatterns/"/>
    <url>/2021/04/15/DesignPatterns/DesignPatterns/</url>
    
    <content type="html"><![CDATA[<h3 id="ğŸ“Œ-Design-Pattern-By-Java"><a href="#ğŸ“Œ-Design-Pattern-By-Java" class="headerlink" title="ğŸ“Œ Design Pattern By Java"></a>ğŸ“Œ Design Pattern By Java</h3><ul><li><p>ğŸ“• Note Book: <a href="https://www.yuque.com/hypocrite30/vf5tcx">https://www.yuque.com/hypocrite30/vf5tcx</a></p></li><li><p>ğŸ“‚ Code Repository: <a href="https://github.com/hypocrite30/DesignPatterns">https://github.com/hypocrite30/DesignPatterns</a></p><ul><li>In directory ã€Œ<code>src</code>ã€</li></ul></li><li><p>ğŸ“š Reference books:  ã€Œ<code>è®¾è®¡æ¨¡å¼ä¹‹ç¦…</code> ç¬¬äºŒç‰ˆ ã€ã€Œé‡å­¦Javaè®¾è®¡æ¨¡å¼ ã€</p><ul><li>In directory ã€Œ<code>doc</code>ã€</li></ul></li></ul><p>ğŸ§°ã€Œåˆ›å»ºè€…æ¨¡å¼ã€5ç§</p><ul><li><input checked="" disabled="" type="checkbox"> 1 ã€å·¥å‚æ–¹æ³•æ¨¡å¼ã€</li><li><input checked="" disabled="" type="checkbox"> 2 ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€</li><li><input checked="" disabled="" type="checkbox"> 3 ã€å»ºé€ è€…æ¨¡å¼ã€</li><li><input checked="" disabled="" type="checkbox"> 4ã€åŸå‹æ¨¡å¼ã€</li><li><input checked="" disabled="" type="checkbox"> 5 ã€å•ä¾‹æ¨¡å¼ã€</li></ul><p>ğŸ¹ã€Œç»“æ„å‹æ¨¡å¼ã€7ç§</p><ul><li><input checked="" disabled="" type="checkbox"> 6 ã€é€‚é…å™¨æ¨¡å¼ã€</li><li><input checked="" disabled="" type="checkbox"> 7 ã€æ¡¥æ¢æ¨¡å¼ã€</li><li><input disabled="" type="checkbox"> 8 ã€ç»„åˆæ¨¡å¼ã€</li><li><input disabled="" type="checkbox"> 9 ã€è£…é¥°æ¨¡å¼ã€</li><li><input disabled="" type="checkbox"> 10 ã€å¤–è§‚æ¨¡å¼ã€</li><li><input disabled="" type="checkbox"> 11 ã€äº«å…ƒæ¨¡å¼ã€</li><li><input disabled="" type="checkbox"> 12 ã€ä»£ç†æ¨¡å¼ã€</li></ul><p>ğŸ§²ã€Œè¡Œä¸ºæ¨¡å¼ã€10ç§</p><ul><li><p><input disabled="" type="checkbox">  13 ã€è´£ä»»é“¾æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  14 ã€å‘½ä»¤æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  15 ã€è¿­ä»£å™¨æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  16 ã€ä¸­ä»‹è€…æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  17 ã€å¤‡å¿˜å½•æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  18 ã€è§‚å¯Ÿè€…æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  19 ã€çŠ¶æ€æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  20 ã€ç­–ç•¥æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  21 ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  22 ã€è®¿é—®è€…æ¨¡å¼ã€</p></li><li><p><input disabled="" type="checkbox">  23 ã€è§£é‡Šå™¨æ¨¡å¼ã€</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>DesignPatterns</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Spring Security 5.1.4</title>
    <link href="/2021/04/14/Security/Spring%20Security/"/>
    <url>/2021/04/14/Security/Spring%20Security/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h1><hr><blockquote><p>åŸºäº Spring Security 5.1.4.RELEASE</p></blockquote><h2 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. åŸºæœ¬æ¦‚å¿µ</h2><h3 id="1-1-è®¤è¯"><a href="#1-1-è®¤è¯" class="headerlink" title="1.1 è®¤è¯"></a>1.1 è®¤è¯</h3><ul><li>åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½<strong>æ˜¯å¦åˆæ³•</strong>çš„è¿‡ç¨‹ï¼Œç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ï¼Œä¸åˆæ³•åˆ™æ‹’ç»è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼ŒäºŒç»´ç ç™»å½•ï¼Œæ‰‹æœºçŸ­ä¿¡ç™»å½•ï¼ŒæŒ‡çº¹è®¤è¯ç­‰æ–¹å¼ã€‚</li></ul><h3 id="1-2-ä¼šè¯"><a href="#1-2-ä¼šè¯" class="headerlink" title="1.2 ä¼šè¯"></a>1.2 ä¼šè¯</h3><p>è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿è¯åœ¨ä¼šè¯ä¸­ã€‚ä¼šè¯å°±æ˜¯ç³»ç»Ÿä¸ºäº†<strong>ä¿æŒå½“å‰</strong><br><strong>ç”¨æˆ·çš„ç™»å½•çŠ¶æ€</strong>æ‰€æä¾›çš„æœºåˆ¶ã€‚</p><ul><li><code>session</code>æ–¹å¼</li></ul><p>è®¤è¯æˆåŠŸåï¼ŒæœåŠ¡å™¨ç”Ÿæˆç”¨æˆ·ç›¸å…³æ•°æ®ä¿å­˜åœ¨session(å½“å‰ä¼šè¯)ä¸­ï¼Œå‘ç»™å®¢æˆ·ç«¯ <code>session_id</code>ï¼Œå®¢æˆ·æœºå­˜åœ¨ <code>cookie</code> ä¸­ï¼Œä¸‹æ¬¡å®¢æˆ·ç«¯è¯·æ±‚ä¼šå¸¦ä¸Š session_id ï¼ŒæœåŠ¡å™¨å¯ä»¥éªŒè¯ session æ•°æ®ï¼Œæ£€éªŒåˆæ³•æ€§ï¼Œå½“ç”¨æˆ·é€€å‡ºç³»ç»Ÿæˆ– session è¿‡æœŸï¼Œsession_id å°±æ— æ•ˆã€‚</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210408205018967.png"></p><ul><li><code>token</code>æ–¹å¼</li></ul><p>ç”¨æˆ·è®¤è¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ª<code>token</code>å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¾åˆ° cookie æˆ– localStorage<br>ç­‰å­˜å‚¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Š tokenï¼ŒæœåŠ¡ç«¯æ”¶åˆ°tokené€šè¿‡éªŒè¯åå³å¯ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210408205204737.png"></p><h4 id="åŒºåˆ«ï¼š"><a href="#åŒºåˆ«ï¼š" class="headerlink" title="åŒºåˆ«ï¼š"></a>åŒºåˆ«ï¼š</h4><ul><li><p>åŸºäºsessionçš„è®¤è¯æ–¹å¼ç”±Servletè§„èŒƒå®šåˆ¶ï¼ŒæœåŠ¡ç«¯è¦å­˜å‚¨sessionä¿¡æ¯éœ€è¦<strong>å ç”¨å†…å­˜èµ„æº</strong>ï¼Œå®¢æˆ·ç«¯<strong>éœ€è¦æ”¯æŒ</strong><br><strong>cookie</strong>ï¼›</p></li><li><p>åŸºäºtokençš„æ–¹å¼åˆ™ä¸€èˆ¬ä¸éœ€è¦æœåŠ¡ç«¯å­˜å‚¨tokenï¼Œå¹¶ä¸”ä¸é™åˆ¶å®¢æˆ·ç«¯çš„å­˜å‚¨æ–¹å¼ã€‚å¦‚ä»Šç§»åŠ¨äº’è”ç½‘æ—¶ä»£<br>æ›´å¤šç±»å‹çš„å®¢æˆ·ç«¯éœ€è¦æ¥å…¥ç³»ç»Ÿï¼Œç³»ç»Ÿå¤šæ˜¯é‡‡ç”¨<strong>å‰åç«¯åˆ†ç¦»</strong>çš„æ¶æ„è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥åŸºäºtokençš„æ–¹å¼æ›´é€‚åˆã€‚</p></li></ul><h3 id="1-3-æˆæƒ"><a href="#1-3-æˆæƒ" class="headerlink" title="1.3 æˆæƒ"></a>1.3 æˆæƒ</h3><p>ç”¨æˆ·è®¤è¯é€šè¿‡æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ§åˆ¶ç”¨æˆ·è®¿é—®èµ„æºçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰èµ„æºçš„è®¿é—®æƒé™åˆ™æ­£å¸¸è®¿é—®ï¼Œæ²¡æœ‰æƒé™åˆ™æ‹’ç»è®¿é—®ã€‚</p><h4 id="åŒºåˆ«äºè®¤è¯"><a href="#åŒºåˆ«äºè®¤è¯" class="headerlink" title="åŒºåˆ«äºè®¤è¯"></a>åŒºåˆ«äºè®¤è¯</h4><ul><li><p>è®¤è¯æ˜¯ä¸ºäº†ä¿è¯<strong>ç”¨æˆ·èº«ä»½çš„åˆæ³•æ€§</strong></p></li><li><p>æˆæƒåˆ™æ˜¯ä¸ºäº†æ›´ç»†ç²’åº¦çš„å¯¹<strong>éšç§æ•°æ®</strong>è¿›è¡Œåˆ’åˆ†ï¼Œæˆæƒæ˜¯åœ¨<strong>è®¤è¯é€šè¿‡å</strong>å‘ç”Ÿçš„ï¼Œæ§åˆ¶ä¸åŒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä¸åŒçš„èµ„æºã€‚</p></li></ul><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p>æˆæƒå¯ç®€å•ç†è§£ä¸ºï¼š<strong>ä¸»ä½“</strong> å¯¹ <strong>èµ„æº</strong> è¿›è¡Œ æ€æ ·çš„<strong>æ“ä½œ</strong>ã€Œæƒé™/è®¸å¯ã€ï¼Œæƒé™æ˜¯éœ€è¦ä¸èµ„æºè¿›è¡Œå…³è”çš„ï¼Œå¦åˆ™æƒé™æ²¡æœ‰æ„ä¹‰ã€‚</p><p>ä¸‰è€…çš„å…³ç³»å›¾ï¼š</p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409161516911.png" style="zoom:125%;" /><ul><li>ä¸åŒçš„æƒé™å¯ä»¥ç®¡ç†ä¸åŒçš„èµ„æºï¼Œç”¨æˆ·éœ€è¦æœ‰å¯¹åº”æƒé™æ‰èƒ½è®¿é—®èµ„æºã€‚</li><li>å¼•å…¥ä¸€ä¸ª ã€Œè§’è‰²ã€æ¦‚å¿µï¼Œç”¨æˆ·å½’ç±»äº<strong>è§’è‰²</strong>ï¼Œè§’è‰²æ‹¥æœ‰ç›¸åº”<strong>æƒé™</strong>ï¼Œæœ€åæ ¹æ®æƒé™è®¿é—®<strong>èµ„æº</strong></li></ul><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409161944605.png" style="zoom:125%;" /><ul><li>ç”¨æˆ·ã€ç”¨æˆ·idï¼Œè´¦å·ï¼Œå¯†ç ï¼Œâ€¦ã€‘</li><li>è§’è‰²ã€è§’è‰²idï¼Œè§’è‰²åç§°ï¼Œâ€¦ã€‘</li><li>æƒé™ã€æƒé™idï¼Œæƒé™æ ‡è¯†ï¼Œæƒé™åç§°ï¼Œèµ„æºidï¼Œâ€¦ã€‘</li><li>èµ„æºã€èµ„æºidï¼Œèµ„æºåç§°ï¼Œè®¿é—®åœ°å€ï¼Œâ€¦ã€‘<ul><li>ç”¨æˆ· - è§’è‰² ã€ç”¨æˆ·idï¼Œè§’è‰²idï¼Œâ€¦ã€‘</li><li>è§’è‰² - æƒé™ ã€è§’è‰²idï¼Œæƒé™idï¼Œâ€¦.ã€‘</li></ul></li></ul><hr><p>ä¼ä¸šå¼€å‘å°† èµ„æºå’Œæƒé™åˆä¸ºä¸€å¼ æƒé™è¡¨ï¼š</p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409162541875.png" style="zoom:130%;" /><ul><li>èµ„æºã€èµ„æºidã€èµ„æºåç§°ã€è®¿é—®åœ°å€ã€â€¦ã€‘</li><li>æƒé™ã€æƒé™idã€æƒé™æ ‡è¯†ã€æƒé™åç§°ã€èµ„æºidã€â€¦ã€‘<ul><li><strong>åˆå¹¶</strong>ä¸ºï¼šæƒé™ã€æƒé™idã€æƒé™æ ‡è¯†ã€æƒé™åç§°ã€èµ„æºåç§°ã€èµ„æºè®¿é—®åœ°å€ã€â€¦ã€‘</li></ul></li></ul><h3 id="1-4-RBAC"><a href="#1-4-RBAC" class="headerlink" title="1.4 RBAC"></a>1.4 RBAC</h3><h4 id="1-4-1-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><a href="#1-4-1-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶" class="headerlink" title="1.4.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"></a>1.4.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h4><p><code>Role-Based Access Control</code> æŒ‰ç…§è§’è‰²è¿›è¡Œæˆæƒã€‚</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409163724890.png"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(ä¸»ä½“.hasRole(<span class="hljs-string">&quot;æ€»ç»ç†è§’è‰²id&quot;</span>)) &#123;<br>    æŸ¥è¯¢å·¥èµ„<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å¦‚æœä¸Šå›¾æ‰€éœ€è§’è‰²æ·»åŠ ä¸ºè€æ¿å’Œæ€»ç»ç†ï¼Œæ­¤æ—¶å°±è¦æ”¹ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(ä¸»ä½“.hasRole(<span class="hljs-string">&quot;æ€»ç»ç†è§’è‰²id&quot;</span>)Â ||Â Â ä¸»ä½“.hasRole(<span class="hljs-string">&quot;è€æ¿è§’è‰²id&quot;</span>)) &#123;<br>Â Â Â Â æŸ¥è¯¢å·¥èµ„<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="1-4-2-åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶"><a href="#1-4-2-åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶" class="headerlink" title="1.4.2 åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶"></a>1.4.2 åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶</h4><p><code>Resource-Based Access Control</code> æŒ‰ç…§èµ„æºï¼ˆæƒé™ï¼‰è¿›è¡Œæˆæƒã€‚</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409164139236.png"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(ä¸»ä½“.hasPermission(<span class="hljs-string">&quot;æŸ¥è¯¢å·¥èµ„æƒé™æ ‡è¯†&quot;</span>)) &#123;<br>Â Â Â Â æŸ¥è¯¢å·¥èµ„<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä»£ç ç»Ÿä¸€ï¼Œå¢åŠ <strong>å¯æ‹“å±•æ€§</strong>ã€‚</li></ul><h2 id="2-åŸºäºSessionçš„è®¤è¯æ–¹å¼ã€Œæ‰‹åŠ¨å®ç°securityã€"><a href="#2-åŸºäºSessionçš„è®¤è¯æ–¹å¼ã€Œæ‰‹åŠ¨å®ç°securityã€" class="headerlink" title="2. åŸºäºSessionçš„è®¤è¯æ–¹å¼ã€Œæ‰‹åŠ¨å®ç°securityã€"></a>2. åŸºäºSessionçš„è®¤è¯æ–¹å¼ã€Œæ‰‹åŠ¨å®ç°securityã€</h2><h3 id="2-1-ç¯å¢ƒæ­å»º"><a href="#2-1-ç¯å¢ƒæ­å»º" class="headerlink" title="2.1 ç¯å¢ƒæ­å»º"></a>2.1 ç¯å¢ƒæ­å»º</h3><blockquote><p>åŸºäº SpringMVC 5.1.5.RELEASE, Servlet3.0å®ç°</p></blockquote><h4 id="2-1-1-åˆ›å»ºMavenå·¥ç¨‹"><a href="#2-1-1-åˆ›å»ºMavenå·¥ç¨‹" class="headerlink" title="2.1.1 åˆ›å»ºMavenå·¥ç¨‹"></a>2.1.1 åˆ›å»ºMavenå·¥ç¨‹</h4><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xxx.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>security-springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¸æ·»åŠ è¯¥ä¾èµ–tomcat7:runæ— æ³•è¿è¡Œé¡¹ç›® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>security-springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">uriEncoding</span>&gt;</span>utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">uriEncoding</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">useDefaultDelimiters</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">useDefaultDelimiters</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>Webé¡¹ç›®ï¼Œpackagingæ‰“åŒ…æ–¹å¼ä¸º war</li><li>ä½¿ç”¨<code>tomcat7-maven-plugin</code>æ’ä»¶æ¥è¿è¡Œå·¥ç¨‹</li></ul><h4 id="2-1-2-Springå®¹å™¨é…ç½®"><a href="#2-1-2-Springå®¹å™¨é…ç½®" class="headerlink" title="2.1.2 Springå®¹å™¨é…ç½®"></a>2.1.2 Springå®¹å™¨é…ç½®</h4><ul><li>configåŒ…ä¸‹å®šä¹‰<code>ApplicationConfig</code>ï¼Œå®ƒå¯¹åº”web.xmlä¸­<code>ContextLoaderListener</code>çš„é…ç½®ã€ŒServlet3.0ä¸ç”¨xmlé…ç½®ã€</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span> <span class="hljs-comment">//ç›¸å½“äºapplicationContext.xml</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.xxx.security.springmvc&quot;</span><br><span class="hljs-meta">            ,excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfig</span> </span>&#123;<br>    <span class="hljs-comment">//åœ¨æ­¤é…ç½®é™¤äº†Controllerçš„å…¶å®ƒbeanï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“é“¾æ¥æ± ã€äº‹åŠ¡ç®¡ç†å™¨ã€ä¸šåŠ¡beanç­‰ã€‚</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2-1-3-servletContexté…ç½®"><a href="#2-1-3-servletContexté…ç½®" class="headerlink" title="2.1.3 servletContexté…ç½®"></a>2.1.3 servletContexté…ç½®</h4><ul><li>configåŒ…ä¸‹å®šä¹‰ <code>WebConfig</code> ï¼Œå¯¹åº”<code>DispatcherServlet</code>é…ç½®ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-comment">//å°±ç›¸å½“äºspringmvc.xmlæ–‡ä»¶</span><br><span class="hljs-meta">@EnableWebMvc</span> <span class="hljs-comment">// æ¥ç®¡ MVC</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.xxx.security.springmvc&quot;</span><br><span class="hljs-meta">        ,includeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br>    <span class="hljs-comment">//è§†å›¾è§£æå™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> InternalResourceViewResolver <span class="hljs-title">viewResolver</span><span class="hljs-params">()</span> </span>&#123;<br>        InternalResourceViewResolver viewResolver = <span class="hljs-keyword">new</span> InternalResourceViewResolver();<br>        viewResolver.setPrefix(<span class="hljs-string">&quot;/WEB-INF/view/&quot;</span>);<br>        viewResolver.setSuffix(<span class="hljs-string">&quot;.jsp&quot;</span>); <span class="hljs-comment">// ç”¨jspæ¥æ¼”ç¤ºä»£ç </span><br>        <span class="hljs-keyword">return</span> viewResolver;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2-1-4-åŠ è½½-Springå®¹å™¨"><a href="#2-1-4-åŠ è½½-Springå®¹å™¨" class="headerlink" title="2.1.4 åŠ è½½ Springå®¹å™¨"></a>2.1.4 åŠ è½½ Springå®¹å™¨</h4><ul><li>åœ¨initåŒ…ä¸‹å®šä¹‰Springå®¹å™¨åˆå§‹åŒ–ç±»<code>SpringApplicationInitializer</code>ï¼Œæ­¤ç±»å®ç°WebApplicationInitializeræ¥å£ï¼ŒSpringå®¹å™¨å¯åŠ¨æ—¶åŠ è½½WebApplicationInitializeræ¥å£çš„æ‰€æœ‰å®ç°ç±»ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringApplicationInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-comment">//springå®¹å™¨ï¼Œç›¸å½“äºåŠ è½½ applicationContext.xml</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Class[]&#123;ApplicationConfig.class&#125;;<br>    &#125;<br><br>    <span class="hljs-comment">//servletContextï¼Œç›¸å½“äºåŠ è½½springmvc.xml</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Class[]&#123;WebConfig.class&#125;;<br>    &#125;<br><br>    <span class="hljs-comment">//url-mapping</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String[] getServletMappings() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;/&quot;</span>&#125;;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409165409689.png"></p><p>SpringApplicationInitializerç›¸å½“äºweb.xmlï¼ŒApplicationConfig.javaå¯¹åº”ä»¥ä¸‹é…ç½®çš„application-context.xmlï¼ŒWebConfig.javaå¯¹åº”ä»¥ä¸‹é…ç½®çš„<strong>spring-mvc.xml</strong>ï¼Œ<strong>web.xml</strong>çš„å†…å®¹å‚è€ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;webâ€app&gt;<br>Â Â Â Â &lt;listener&gt;<br>Â Â Â Â Â Â Â Â &lt;listenerâ€<span class="hljs-class"><span class="hljs-keyword">class</span>&gt;<span class="hljs-title">org</span>.<span class="hljs-title">springframework</span>.<span class="hljs-title">web</span>.<span class="hljs-title">context</span>.<span class="hljs-title">ContextLoaderListener</span>&lt;/<span class="hljs-title">listener</span>â€<span class="hljs-title">class</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;/<span class="hljs-title">listener</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;<span class="hljs-title">context</span>â€<span class="hljs-title">param</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">param</span>â€<span class="hljs-title">name</span>&gt;<span class="hljs-title">contextConfigLocation</span>&lt;/<span class="hljs-title">param</span>â€<span class="hljs-title">name</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">param</span>â€<span class="hljs-title">value</span>&gt;/<span class="hljs-title">WEB</span>â€<span class="hljs-title">INF</span>/<span class="hljs-title">application</span>â€<span class="hljs-title">context</span>.<span class="hljs-title">xml</span>&lt;/<span class="hljs-title">param</span>â€<span class="hljs-title">value</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;/<span class="hljs-title">context</span>â€<span class="hljs-title">param</span>&gt;Â </span><br><span class="hljs-class">Â Â Â Â &lt;<span class="hljs-title">servlet</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">servlet</span>â€<span class="hljs-title">name</span>&gt;<span class="hljs-title">springmvc</span>&lt;/<span class="hljs-title">servlet</span>â€<span class="hljs-title">name</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">servlet</span>â€<span class="hljs-title">class</span>&gt;<span class="hljs-title">org</span>.<span class="hljs-title">springframework</span>.<span class="hljs-title">web</span>.<span class="hljs-title">servlet</span>.<span class="hljs-title">DispatcherServlet</span>&lt;/<span class="hljs-title">servlet</span>â€<span class="hljs-title">class</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">init</span>â€<span class="hljs-title">param</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">param</span>â€<span class="hljs-title">name</span>&gt;<span class="hljs-title">contextConfigLocation</span>&lt;/<span class="hljs-title">param</span>â€<span class="hljs-title">name</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">param</span>â€<span class="hljs-title">value</span>&gt;/<span class="hljs-title">WEB</span>â€<span class="hljs-title">INF</span>/<span class="hljs-title">spring</span>â€<span class="hljs-title">mvc</span>.<span class="hljs-title">xml</span>&lt;/<span class="hljs-title">param</span>â€<span class="hljs-title">value</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;/<span class="hljs-title">init</span>â€<span class="hljs-title">param</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">load</span>â€<span class="hljs-title">on</span>â€<span class="hljs-title">startup</span>&gt;1&lt;/<span class="hljs-title">load</span>â€<span class="hljs-title">on</span>â€<span class="hljs-title">startup</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;/<span class="hljs-title">servlet</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;<span class="hljs-title">servlet</span>â€<span class="hljs-title">mapping</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">servlet</span>â€<span class="hljs-title">name</span>&gt;<span class="hljs-title">springmvc</span>&lt;/<span class="hljs-title">servlet</span>â€<span class="hljs-title">name</span>&gt;</span><br><span class="hljs-class">Â Â Â Â Â Â Â Â &lt;<span class="hljs-title">url</span>â€<span class="hljs-title">pattern</span>&gt;/&lt;/<span class="hljs-title">url</span>â€<span class="hljs-title">pattern</span>&gt;</span><br><span class="hljs-class">Â Â Â Â &lt;/<span class="hljs-title">servlet</span>â€<span class="hljs-title">mapping</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">web</span>â€<span class="hljs-title">app</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="2-2-å®ç°è®¤è¯åŠŸèƒ½"><a href="#2-2-å®ç°è®¤è¯åŠŸèƒ½" class="headerlink" title="2.2 å®ç°è®¤è¯åŠŸèƒ½"></a>2.2 å®ç°è®¤è¯åŠŸèƒ½</h3><h4 id="2-2-1-è®¤è¯é¡µé¢"><a href="#2-2-1-è®¤è¯é¡µé¢" class="headerlink" title="2.2.1  è®¤è¯é¡µé¢"></a>2.2.1  è®¤è¯é¡µé¢</h4><ul><li>åœ¨<code>webapp/WEB-INF/views</code>ä¸‹å®šä¹‰è®¤è¯é¡µé¢<code>login.jsp</code>ï¼Œä½œä¸ºæµ‹è¯•è®¤è¯æµç¨‹ï¼Œé¡µé¢ä¸ºformè¡¨å•ï¼ŒåŒ…æ‹¬ç”¨æˆ·åï¼Œå¯†ç ï¼Œè§¦å‘ç™»å½•å°†æäº¤è¡¨å•ä¿¡æ¯è‡³<code>/login</code> ã€Œcontrollerã€ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;%@Â pageÂ contentType=<span class="hljs-string">&quot;text/html;charset=UTFâ€8&quot;</span>Â pageEncoding=<span class="hljs-string">&quot;utfâ€8&quot;</span>Â %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>Â Â Â Â &lt;title&gt;ç”¨æˆ·ç™»å½•&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;formÂ action=<span class="hljs-string">&quot;login&quot;</span>Â method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>Â Â Â Â ç”¨æˆ·åï¼š&lt;inputÂ type=<span class="hljs-string">&quot;text&quot;</span>Â name=<span class="hljs-string">&quot;username&quot;</span>&gt;&lt;br&gt;<br>Â Â Â Â å¯†&amp;nbsp;&amp;nbsp;&amp;nbsp;ç :<br>Â Â Â Â &lt;inputÂ type=<span class="hljs-string">&quot;password&quot;</span>Â name=<span class="hljs-string">&quot;password&quot;</span>&gt;&lt;br&gt;<br>Â Â Â Â &lt;inputÂ type=<span class="hljs-string">&quot;submit&quot;</span>Â value=<span class="hljs-string">&quot;ç™»å½•&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨WebConfigä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼Œå°†/ç›´æ¥å¯¼å‘login.jspé¡µé¢</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistryÂ registry)</span>Â </span>&#123;<br>Â Â Â Â registry.addViewController(<span class="hljs-string">&quot;/&quot;</span>).setViewName(<span class="hljs-string">&quot;login&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä½¿ç”¨tomcat7æ’ä»¶è¿è¡Œæµ‹è¯•ï¼Œé…ç½®å¦‚ä¸‹</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409170358793.png"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409170436346.png"></p><hr><h4 id="2-2-2-è®¤è¯æ¥å£"><a href="#2-2-2-è®¤è¯æ¥å£" class="headerlink" title="2.2.2 è®¤è¯æ¥å£"></a>2.2.2 è®¤è¯æ¥å£</h4><ol><li>å®šä¹‰è®¤è¯æ¥å£ï¼Œæ­¤æ¥å£å¯¹ä¼ æ¥çš„ç”¨æˆ·åå¯†ç æ ¡éªŒï¼Œè‹¥æˆåŠŸåˆ™è¿”å›è¯¥ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯å¼‚å¸¸</li></ol><ul><li>åœ¨serviceåŒ…ä¸‹åˆ›å»º<code>AuthenticationService</code>æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AuthenticationService</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·è®¤è¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> authenticationRequest ç”¨æˆ·è®¤è¯è¯·æ±‚ï¼Œè´¦å·å’Œå¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è®¤è¯æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">UserDto <span class="hljs-title">authentication</span><span class="hljs-params">(AuthenticationRequest authenticationRequest)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>modelåŒ…ä¸‹ï¼Œè®¤è¯è¯·æ±‚ç»“æ„</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span> <span class="hljs-comment">// import lombok.Data;</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationRequest</span> </span>&#123;<br>    <span class="hljs-comment">//è®¤è¯è¯·æ±‚å‚æ•°ï¼Œè´¦å·ã€å¯†ç </span><br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>modelåŒ…ä¸‹ï¼Œåˆ›å»ºUerDtoï¼Œä½œä¸ºç™»å½•æˆåŠŸåè·å¾—çš„ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDto</span> </span>&#123;<br>    <span class="hljs-comment">//ç”¨æˆ·èº«ä»½ä¿¡æ¯</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String fullname;<br>    <span class="hljs-keyword">private</span> String mobile;<br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; authorities; <span class="hljs-comment">// ç”¨æˆ·æƒé™ç”¨Seté›†åˆå­˜å‚¨</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è®¤è¯å®ç°ç±»ï¼Œæ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶æ ¡éªŒå¯†ç ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuthenticationService</span> </span>&#123;<br>    <span class="hljs-comment">//åŒ¿åä»£ç å—ï¼Œåˆå§‹åŒ–æ•°æ®ï¼Œæ¨¡æ‹Ÿæ•°æ®åº“</span><br>    &#123;<br>        Set&lt;String&gt; authorities1 = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>        authorities1.add(<span class="hljs-string">&quot;p1&quot;</span>);<span class="hljs-comment">// p1å’Œ/r/r1å¯¹åº”,åé¢controllerä¼šç”¨åˆ°</span><br>        Set&lt;String&gt; authorities2 = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>        authorities2.add(<span class="hljs-string">&quot;p2&quot;</span>);<span class="hljs-comment">// p2å’Œ/r/r2å¯¹åº”,åé¢controllerä¼šç”¨åˆ°</span><br>        userMap.put(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-keyword">new</span> UserDto(<span class="hljs-string">&quot;1010&quot;</span>, <span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-string">&quot;133443&quot;</span>, authorities1));<br>        userMap.put(<span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-keyword">new</span> UserDto(<span class="hljs-string">&quot;1011&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;456&quot;</span>, <span class="hljs-string">&quot;æå››&quot;</span>, <span class="hljs-string">&quot;144553&quot;</span>, authorities2));<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·è®¤è¯ï¼Œæ ¡éªŒç”¨æˆ·èº«ä»½ä¿¡æ¯æ˜¯å¦åˆæ³•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> authenticationRequest ç”¨æˆ·è®¤è¯è¯·æ±‚ï¼Œè´¦å·å’Œå¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è®¤è¯æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDto <span class="hljs-title">authentication</span><span class="hljs-params">(AuthenticationRequest authenticationRequest)</span> </span>&#123;<br>        <span class="hljs-comment">//æ ¡éªŒå‚æ•°æ˜¯å¦ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (authenticationRequest == <span class="hljs-keyword">null</span><br>                || StringUtils.isEmpty(authenticationRequest.getUsername())<br>                || StringUtils.isEmpty(authenticationRequest.getPassword())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;è´¦å·å’Œå¯†ç ä¸ºç©º&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//æ ¹æ®è´¦å·å»æŸ¥è¯¢æ•°æ®åº“,è¿™é‡Œæµ‹è¯•ç¨‹åºé‡‡ç”¨æ¨¡æ‹Ÿæ–¹æ³•</span><br>        UserDto user = getUserDto(authenticationRequest.getUsername());<br>        <span class="hljs-comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;æŸ¥è¯¢ä¸åˆ°è¯¥ç”¨æˆ·&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//æ ¡éªŒå¯†ç </span><br>        <span class="hljs-keyword">if</span> (!authenticationRequest.getPassword().equals(user.getPassword())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//è®¤è¯é€šè¿‡ï¼Œè¿”å›ç”¨æˆ·èº«ä»½ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-comment">//æ ¹æ®è´¦å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> UserDto <span class="hljs-title">getUserDto</span><span class="hljs-params">(String userName)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> userMap.get(userName);<br>    &#125;<br><br>    <span class="hljs-comment">//ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, UserDto&gt; userMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>ç™»å½•Controllerï¼Œå¯¹/loginè¯·æ±‚å¤„ç†ï¼Œå®ƒè°ƒç”¨AuthenticationServiceå®Œæˆè®¤è¯å¹¶è¿”å›ç™»å½•ç»“æœæç¤ºä¿¡æ¯ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    AuthenticationService authenticationService;<br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/login&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(AuthenticationRequest authenticationRequest, HttpSession session)</span> </span>&#123;<br>        UserDto userDto = authenticationService.authentication(authenticationRequest);<br>        <span class="hljs-keyword">return</span> userDto.getUsername() + <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>Testï¼Œè®¿é—®è·¯å¾„ä¸º /</li></ol><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409173720669.png"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409173731950.png"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210409173748505.png"></p><ul><li>è‡³æ­¤ï¼Œå®Œæˆæœ€ç®€å•çš„èº«ä»½å‡­è¯æ ¡éªŒï¼Œåé¢å¯¹äºèµ„æºçš„è¯·æ±‚è¿˜è¦å•ç‹¬æˆæƒã€‚</li></ul><h4 id="2-2-3-å®ç°ä¼šè¯åŠŸèƒ½"><a href="#2-2-3-å®ç°ä¼šè¯åŠŸèƒ½" class="headerlink" title="2.2.3 å®ç°ä¼šè¯åŠŸèƒ½"></a>2.2.3 å®ç°ä¼šè¯åŠŸèƒ½</h4><ol><li>å¢åŠ ä¼šè¯æ§åˆ¶</li></ol><ul><li>åœ¨UserDtoä¸­å®šä¹‰ä¸€ä¸ªSESSION_USER_KEYï¼Œä½œä¸ºSessionä¸­å­˜æ”¾ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„key</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">static</span>Â <span class="hljs-keyword">final</span>Â StringÂ SESSION_USER_KEYÂ =Â <span class="hljs-string">&quot;_user&quot;</span>;<br></code></pre></div></td></tr></table></figure><ul><li>ä¿®æ”¹LoginControllerï¼Œè®¤è¯æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯æ”¾å…¥å½“å‰ä¼šè¯ã€‚å¹¶å¢åŠ ç”¨æˆ·ç™»å‡ºæ–¹æ³•ï¼Œç™»å‡ºæ—¶å°†sessionç½®ä¸º<br>å¤±æ•ˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/login&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(AuthenticationRequest authenticationRequest, HttpSession session)</span> </span>&#123;<br>    UserDto userDto = authenticationService.authentication(authenticationRequest);<br>    <span class="hljs-comment">//å­˜å…¥session</span><br>    session.setAttribute(UserDto.SESSION_USER_KEY, userDto);<br>    <span class="hljs-keyword">return</span> userDto.getUsername() + <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@GetMapping(value = &quot;/logout&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">(HttpSession session)</span> </span>&#123;<br>    session.invalidate(); <span class="hljs-comment">// å°†sessionéæ³•åŒ–å°±è¾¾åˆ°é€€å‡ºæ•ˆæœ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;é€€å‡ºæˆåŠŸ&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>å¢åŠ æµ‹è¯•èµ„æº</li></ol><ul><li>ä¿®æ”¹LoginControllerï¼Œå¢åŠ æµ‹è¯•r1ï¼Œå®ƒä»å½“å‰ä¼šè¯sessionä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·ï¼Œå¹¶è¿”å›æç¤ºä¿¡æ¯ç»™å‰å°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/r/r1&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">r1</span><span class="hljs-params">(HttpSession session)</span> </span>&#123;<br>    String fullname = <span class="hljs-keyword">null</span>;<br>    Object object = session.getAttribute(UserDto.SESSION_USER_KEY);<br>    <span class="hljs-keyword">if</span> (object == <span class="hljs-keyword">null</span>) &#123;<br>        fullname = <span class="hljs-string">&quot;åŒ¿å&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        UserDto userDto = (UserDto) object;<br>        fullname = userDto.getFullname();<br>    &#125;<br>    <span class="hljs-keyword">return</span> fullname + <span class="hljs-string">&quot;è®¿é—®èµ„æºr1&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>Test</li></ol><ul><li>æœªç™»å½•æƒ…å†µä¸‹ç›´æ¥è®¿é—®æµ‹è¯•èµ„æº/r/r1</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410114837028.png"></p><ul><li>æˆåŠŸç™»å½•çš„æƒ…å†µä¸‹è®¿é—®æµ‹è¯•èµ„æº/r/r1</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410114851102.png"></p><p>åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ï¼Œè¯¥ç”¨æˆ·ä¿¡æ¯å·²è¢«æˆåŠŸæ”¾å…¥sessionï¼Œå¹¶ä¸”åç»­è¯·æ±‚å¯ä»¥æ­£å¸¸ä»sessionä¸­è·å–å½“<br>å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç¬¦åˆé¢„æœŸç»“æœã€‚</p><hr><h4 id="2-2-4-å®ç°æˆæƒåŠŸèƒ½"><a href="#2-2-4-å®ç°æˆæƒåŠŸèƒ½" class="headerlink" title="2.2.4 å®ç°æˆæƒåŠŸèƒ½"></a>2.2.4 å®ç°æˆæƒåŠŸèƒ½</h4><ul><li>åŒ¿åç”¨æˆ·ï¼ˆæœªç™»å½•ç”¨æˆ·ï¼‰è®¿é—®æ‹¦æˆªï¼šç¦æ­¢åŒ¿åç”¨æˆ·è®¿é—®æŸäº›èµ„æºã€‚</li><li>ç™»å½•ç”¨æˆ·è®¿é—®æ‹¦æˆªï¼šæ ¹æ®ç”¨æˆ·çš„<strong>æƒé™</strong>å†³å®šæ˜¯å¦èƒ½è®¿é—®æŸäº›èµ„æºã€‚</li></ul><ol><li>å¢åŠ æƒé™æ•°æ®</li></ol><ul><li>UserDtoæ·»åŠ ç”¨æˆ·æƒé™ï¼Œç”¨Seté›†åˆå­˜å‚¨</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span>Â Set&lt;String&gt;Â authorities;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨AuthenticationServiceImplä¸­ä¸ºæ¨¡æ‹Ÿç”¨æˆ·åˆå§‹åŒ–æƒé™ï¼Œå…¶ä¸­å¼ ä¸‰ç»™äº†p1æƒé™ï¼Œæå››ç»™äº†p2æƒé™ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Â <span class="hljs-comment">//ç”¨æˆ·ä¿¡æ¯</span><br>Â Â Â Â <span class="hljs-keyword">private</span>Â Map&lt;String,UserDto&gt;Â userMapÂ =Â <span class="hljs-keyword">new</span>Â HashMap&lt;&gt;();<br>Â Â Â Â &#123;<br>Â Â Â Â Â Â Â Â Set&lt;String&gt;Â authorities1Â =Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;();<br>Â Â Â Â Â Â Â Â authorities1.add(<span class="hljs-string">&quot;p1&quot;</span>);<br>Â Â Â Â Â Â Â Â Set&lt;String&gt;Â authorities2Â =Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;();<br>Â Â Â Â Â Â Â Â authorities2.add(<span class="hljs-string">&quot;p2&quot;</span>);<br>Â Â Â Â Â Â Â Â userMap.put(<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-keyword">new</span>Â UserDto(<span class="hljs-string">&quot;1010&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-string">&quot;å¼ </span><br><span class="hljs-string">ä¸‰&quot;</span>,<span class="hljs-string">&quot;133443&quot;</span>,authorities1));<br>Â Â Â Â Â Â Â Â userMap.put(<span class="hljs-string">&quot;lisi&quot;</span>,<span class="hljs-keyword">new</span>Â UserDto(<span class="hljs-string">&quot;1011&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>,<span class="hljs-string">&quot;456&quot;</span>,<span class="hljs-string">&quot;æå››&quot;</span>,<span class="hljs-string">&quot;144553&quot;</span>,authorities2));<br>Â Â Â Â &#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>å¢åŠ æµ‹è¯•èµ„æºï¼ŒåŒ/r/r1ï¼Œè¿™æ˜¯èµ„æºr2</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/r/r2&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">r2</span><span class="hljs-params">(HttpSession session)</span> </span>&#123;<br>    String fullname = <span class="hljs-keyword">null</span>;<br>    Object userObj = session.getAttribute(UserDto.SESSION_USER_KEY);<br>    <span class="hljs-keyword">if</span> (userObj != <span class="hljs-keyword">null</span>) &#123;<br>        fullname = ((UserDto) userObj).getFullname();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fullname = <span class="hljs-string">&quot;åŒ¿å&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> fullname + <span class="hljs-string">&quot; è®¿é—®èµ„æºr2&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>å®ç°æˆæƒæ‹¦æˆªå™¨</li></ol><ul><li>åœ¨<code>interceptor</code>åŒ…ä¸‹å®šä¹‰<code>SimpleAuthenticationInterceptor</code>æ‹¦æˆªå™¨</li><li>å®ç° 1ã€æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½• 2ã€æ ¡éªŒç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æ“ä½œæƒé™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleAuthenticationInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">//åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ ¡éªŒç”¨æˆ·è¯·æ±‚çš„urlæ˜¯å¦åœ¨ç”¨æˆ·çš„æƒé™èŒƒå›´å†…</span><br>        <span class="hljs-comment">//å–å‡ºç”¨æˆ·èº«ä»½ä¿¡æ¯</span><br>        Object object = request.getSession().getAttribute(UserDto.SESSION_USER_KEY);<br>        <span class="hljs-keyword">if</span> (object == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">//æ²¡æœ‰è®¤è¯ï¼Œæç¤ºç™»å½•</span><br>            writeContent(response, <span class="hljs-string">&quot;è¯·ç™»å½•&quot;</span>);<br>        &#125;<br>        UserDto userDto = (UserDto) object;<br>        <span class="hljs-comment">//è¯·æ±‚çš„url</span><br>        String requestURI = request.getRequestURI();<br>        <span class="hljs-keyword">if</span> (userDto.getAuthorities().contains(<span class="hljs-string">&quot;p1&quot;</span>) &amp;&amp; requestURI.contains(<span class="hljs-string">&quot;/r/r1&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (userDto.getAuthorities().contains(<span class="hljs-string">&quot;p2&quot;</span>) &amp;&amp; requestURI.contains(<span class="hljs-string">&quot;/r/r2&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>        writeContent(response, <span class="hljs-string">&quot;æ²¡æœ‰æƒé™ï¼Œæ‹’ç»è®¿é—®&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//å“åº”ä¿¡æ¯ç»™å®¢æˆ·ç«¯</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeContent</span><span class="hljs-params">(HttpServletResponse response, String msg)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        response.setContentType(<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>);<br>        PrintWriter writer = response.getWriter();<br>        writer.print(msg);<br>        writer.close();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨ WebConfigä¸­é…ç½®æ‹¦æˆªå™¨ï¼ŒåŒ¹é…<code>/r/**</code>çš„èµ„æºä¸ºå—ä¿æŠ¤çš„ç³»ç»Ÿèµ„æºï¼Œè®¿é—®è¯¥èµ„æºçš„è¯·æ±‚è¿›å…¥<br>SimpleAuthenticationInterceptoræ‹¦æˆªå™¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span>Â SimpleAuthenticationInterceptorÂ simpleAuthenticationInterceptor;<br>Â Â Â <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistryÂ registry)</span>Â </span>&#123;<br>Â Â Â Â registry.addInterceptor(simpleAuthenticationInterceptor).addPathPatterns(<span class="hljs-string">&quot;/r/**&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>Test</li></ol><ul><li>æœªç™»å½•</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410120022280.png"></p><ul><li>å¼ ä¸‰ç™»å½•</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410120052995.png"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410120104477.png"></p><ul><li>æå››åŒç†ï¼Œåªèƒ½è®¿é—®r2ã€‚r1æ²¡æœ‰æƒé™è®¿é—®ã€‚</li></ul><h2 id="3-Spring-Security-å¿«é€Ÿä¸Šæ‰‹ã€ŒåŸºäºMVCã€"><a href="#3-Spring-Security-å¿«é€Ÿä¸Šæ‰‹ã€ŒåŸºäºMVCã€" class="headerlink" title="3. Spring Security å¿«é€Ÿä¸Šæ‰‹ã€ŒåŸºäºMVCã€"></a>3. Spring Security å¿«é€Ÿä¸Šæ‰‹ã€ŒåŸºäºMVCã€</h2><ul><li>Spring Securityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚ç”±äºå®ƒæ˜¯Springç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå› æ­¤å®ƒä¼´éšç€æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿä¸æ–­ä¿®æ­£ã€å‡çº§ï¼Œåœ¨spring booté¡¹ç›®ä¸­åŠ å…¥Spring Securityæ›´æ˜¯ååˆ†ç®€å•ï¼Œä½¿ç”¨Spring Securityå‡å°‘äº†ä¸ºä¼ä¸šç³»ç»Ÿå®‰å…¨æ§åˆ¶ç¼–å†™å¤§é‡é‡å¤ä»£ç çš„å·¥ä½œã€‚</li></ul><h3 id="3-1-ç¯å¢ƒæ­å»º"><a href="#3-1-ç¯å¢ƒæ­å»º" class="headerlink" title="3.1 ç¯å¢ƒæ­å»º"></a>3.1 ç¯å¢ƒæ­å»º</h3><h4 id="3-1-1-åˆ›å»ºMavenå·¥ç¨‹"><a href="#3-1-1-åˆ›å»ºMavenå·¥ç¨‹" class="headerlink" title="3.1.1 åˆ›å»ºMavenå·¥ç¨‹"></a>3.1.1 åˆ›å»ºMavenå·¥ç¨‹</h4><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itheima.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>security-spring-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- spring-securityä¾èµ– --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ä¸æ·»åŠ è¯¥ä¾èµ–tomcat7:runæ— æ³•è¿è¡Œé¡¹ç›® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>security-springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">useDefaultDelimiters</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">useDefaultDelimiters</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="3-1-2-Springå®¹å™¨é…ç½®"><a href="#3-1-2-Springå®¹å™¨é…ç½®" class="headerlink" title="3.1.2 Springå®¹å™¨é…ç½®"></a>3.1.2 Springå®¹å™¨é…ç½®</h4><ul><li>åŒsecurity-springmvc</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackagesÂ =Â &quot;com.xxx.security.springmvc&quot;</span><br><span class="hljs-meta">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,excludeFiltersÂ =Â &#123;@ComponentScan.Filter(typeÂ =Â FilterType.ANNOTATION,valueÂ = Controller.class)&#125;)</span><br><span class="hljs-keyword">public</span>Â <span class="hljs-class"><span class="hljs-keyword">class</span>Â <span class="hljs-title">ApplicationConfig</span>Â </span>&#123;<br>Â Â Â Â <span class="hljs-comment">//åœ¨æ­¤é…ç½®é™¤äº†Controllerçš„å…¶å®ƒbeanï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“é“¾æ¥æ± ã€äº‹åŠ¡ç®¡ç†å™¨ã€ä¸šåŠ¡beanç­‰ã€‚</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-1-3-Servlet-Contexté…ç½®"><a href="#3-1-3-Servlet-Contexté…ç½®" class="headerlink" title="3.1.3 Servlet Contexté…ç½®"></a>3.1.3 Servlet Contexté…ç½®</h4><ul><li>åŒsecurity-springmvc</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebMvc</span><br><span class="hljs-meta">@ComponentScan(basePackagesÂ =Â &quot;com.xxx.security.springmvc&quot;</span><br><span class="hljs-meta">Â Â Â Â Â Â Â Â Â Â Â Â ,includeFiltersÂ =Â &#123;@ComponentScan.Filter(typeÂ =Â FilterType.ANNOTATION,valueÂ =</span><br><span class="hljs-meta">Controller.class)&#125;)</span><br><span class="hljs-keyword">public</span>Â <span class="hljs-class"><span class="hljs-keyword">class</span>Â <span class="hljs-title">WebConfig</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title">WebMvcConfigurer</span>Â </span>&#123;<br>Â Â Â Â <span class="hljs-comment">//è§†é¢‘è§£æå™¨</span><br>Â Â Â Â <span class="hljs-meta">@Bean</span><br>Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â InternalResourceViewResolverÂ <span class="hljs-title">viewResolver</span><span class="hljs-params">()</span></span>&#123;<br>Â Â Â Â Â Â Â Â InternalResourceViewResolverÂ viewResolverÂ =Â <span class="hljs-keyword">new</span>Â InternalResourceViewResolver();<br>Â Â Â Â Â Â Â Â viewResolver.setPrefix(<span class="hljs-string">&quot;/WEBâ€INF/views/&quot;</span>);<br>Â Â Â Â Â Â Â Â viewResolver.setSuffix(<span class="hljs-string">&quot;.jsp&quot;</span>);<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â viewResolver;<br>Â Â Â Â &#125;<br>Â &#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-1-4-åŠ è½½-Springå®¹å™¨"><a href="#3-1-4-åŠ è½½-Springå®¹å™¨" class="headerlink" title="3.1.4  åŠ è½½ Springå®¹å™¨"></a>3.1.4  åŠ è½½ Springå®¹å™¨</h4><ul><li>åœ¨<code>init</code>åŒ…ä¸‹å®šä¹‰Springå®¹å™¨åˆå§‹åŒ–ç±»<code>SpringApplicationInitializer</code>ï¼Œæ­¤ç±»å®ç°WebApplicationInitializeræ¥å£ï¼ŒSpringå®¹å™¨å¯åŠ¨æ—¶åŠ è½½WebApplicationInitializeræ¥å£çš„æ‰€æœ‰å®ç°ç±»ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span>Â <span class="hljs-class"><span class="hljs-keyword">class</span>Â <span class="hljs-title">SpringApplicationInitializer</span>Â <span class="hljs-keyword">extends</span></span><br><span class="hljs-class"><span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span>Â </span>&#123;<br>Â Â Â Â <span class="hljs-meta">@Override</span><br>Â Â Â Â <span class="hljs-keyword">protected</span>Â Class&lt;?&gt;[]Â getRootConfigClasses()Â &#123;<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â Class&lt;?&gt;[]Â &#123;Â ApplicationConfig.classÂ &#125;;<span class="hljs-comment">//æŒ‡å®šrootContextçš„é…ç½®ç±»</span><br>Â Â Â Â &#125;<br>Â Â Â Â <span class="hljs-meta">@Override</span><br>Â Â Â Â <span class="hljs-keyword">protected</span>Â Class&lt;?&gt;[]Â getServletConfigClasses()Â &#123;<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â Class&lt;?&gt;[]Â &#123;Â WebConfig.classÂ &#125;;Â <span class="hljs-comment">//æŒ‡å®šservletContextçš„é…ç½®ç±»</span><br>Â Â Â Â &#125;<br>Â Â Â Â <span class="hljs-meta">@Override</span><br>Â Â Â Â <span class="hljs-keyword">protected</span>Â String[]Â getServletMappings()Â &#123;<br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â StringÂ []Â &#123;<span class="hljs-string">&quot;/&quot;</span>&#125;;<br>Â Â Â Â &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><hr><h3 id="3-2-è®¤è¯"><a href="#3-2-è®¤è¯" class="headerlink" title="3.2 è®¤è¯"></a>3.2 è®¤è¯</h3><h4 id="3-2-1-è®¤è¯é¡µé¢"><a href="#3-2-1-è®¤è¯é¡µé¢" class="headerlink" title="3.2.1 è®¤è¯é¡µé¢"></a>3.2.1 è®¤è¯é¡µé¢</h4><ul><li>Spring Securityé»˜è®¤æä¾›è®¤è¯é¡µé¢ï¼Œä¸éœ€è¦é¢å¤–å¼€å‘ã€‚</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410162825759.png"></p><h4 id="3-2-2-å®‰å…¨é…ç½®"><a href="#3-2-2-å®‰å…¨é…ç½®" class="headerlink" title="3.2.2 å®‰å…¨é…ç½®"></a>3.2.2 å®‰å…¨é…ç½®</h4><ul><li>Spring Securityæä¾›äº†<strong>ç”¨æˆ·åå¯†ç ç™»å½•</strong>ã€<strong>é€€å‡º</strong>ã€<strong>ä¼šè¯ç®¡ç†</strong>ç­‰è®¤è¯åŠŸèƒ½ï¼Œåªéœ€è¦é…ç½®å³å¯ä½¿ç”¨ã€‚</li></ul><ol><li>åœ¨configåŒ…ä¸‹å®šä¹‰<code>WebSecurityConfig</code>ï¼Œä½œä¸ºSecurityæ¡†æ¶çš„é…ç½®ç±»ï¼Œå®‰å…¨é…ç½®çš„å†…å®¹åŒ…æ‹¬ï¼šç”¨æˆ·ä¿¡æ¯ã€å¯†ç ç¼–ç å™¨ã€å®‰å…¨æ‹¦æˆªæœºåˆ¶ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>    <span class="hljs-comment">//å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title">userDetailsService</span><span class="hljs-params">()</span> </span>&#123;<br>        InMemoryUserDetailsManager manager = <span class="hljs-keyword">new</span> InMemoryUserDetailsManager();<br>        manager.createUser(User.withUsername(<span class="hljs-string">&quot;zhangsan&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).authorities(<span class="hljs-string">&quot;p1&quot;</span>).build());<br>        manager.createUser(User.withUsername(<span class="hljs-string">&quot;lisi&quot;</span>).password(<span class="hljs-string">&quot;456&quot;</span>).authorities(<span class="hljs-string">&quot;p2&quot;</span>).build());<br>        <span class="hljs-keyword">return</span> manager;<br>    &#125;<br><br>    <span class="hljs-comment">//å¯†ç ç¼–ç å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();<br>    &#125;<br><br>    <span class="hljs-comment">//å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/r/r1&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p1&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/r/r2&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p2&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/r/**&quot;</span>).authenticated() <span class="hljs-comment">// æ‰€æœ‰/r/**çš„è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡</span><br>                .anyRequest().permitAll()   <span class="hljs-comment">// é™¤äº†/r/**ï¼Œå…¶å®ƒçš„è¯·æ±‚å¯ä»¥è®¿é—®</span><br>                .and()<br>                .formLogin() <span class="hljs-comment">// å…è®¸è¡¨å•ç™»å½•</span><br>                .successForwardUrl(<span class="hljs-string">&quot;/login-success&quot;</span>); <span class="hljs-comment">// è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼š</p><ul><li><code>@EnableWebSecurity</code>æ³¨è§£å·²ç»åŒ…å«äº† <code>@Configuration</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Import(&#123; WebSecurityConfiguration.class,</span><br><span class="hljs-meta">      SpringWebMvcImportSelector.class,</span><br><span class="hljs-meta">      OAuth2ImportSelector.class &#125;)</span><br><span class="hljs-meta">@EnableGlobalAuthentication</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableWebSecurity &#123;...&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨ <code>userDetailsService() </code>æ–¹æ³•ä¸­ï¼Œè¿”å›ä¸€ä¸ªUserDetailsService ç»™ Springå®¹Så™¨ï¼ŒSpring Securityä¼šä½¿ç”¨å®ƒæ¥<br>è·å–ç”¨æˆ·ä¿¡æ¯ã€‚æš‚æ—¶ä½¿ç”¨InMemoryUserDetailsManagerå®ç°ç±»ï¼Œå¹¶åœ¨å…¶ä¸­åˆ†åˆ«åˆ›å»ºäº†zhangsanã€lisiä¸¤ä¸ªç”¨<br>æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç å’Œæƒé™ã€‚<code>InMemoryUserDetailsManager</code>æ˜¯ <code>UserDetailsService </code>æ¥å£å®ç°ç±»ã€‚</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410163409717.png"></p><ul><li>åœ¨configure()ä¸­ï¼Œé€šè¿‡HttpSecurityè®¾ç½®äº†å®‰å…¨æ‹¦æˆªè§„åˆ™<ul><li>1ï¸âƒ£urlåŒ¹é…<code>/r/**</code>çš„èµ„æºï¼Œç»è¿‡è®¤è¯åæ‰èƒ½è®¿é—®</li><li>2ï¸âƒ£å…¶ä»–urlå®Œå…¨å¼€æ”¾</li><li>3ï¸âƒ£æ”¯æŒformè¡¨å•è®¤è¯ï¼Œè®¤è¯æˆåŠŸåè½¬å‘<code>/login-success</code></li></ul></li></ul><ol start="2"><li>åŠ è½½ WebSecurityConfig</li></ol><ul><li>ä¿®æ”¹<code>SpringApplicationInitializer</code>çš„<code>getRootConfigClasses()</code>æ–¹æ³•ï¼Œæ·»åŠ  <code>WebSecurityConfig.class</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span>Â Class&lt;?&gt;[]Â getRootConfigClasses()Â &#123;<br>Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â Class&lt;?&gt;[]Â &#123;Â ApplicationConfig.class,Â WebSecurityConfig.class&#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-2-3-Spring-Securityåˆå§‹åŒ–"><a href="#3-2-3-Spring-Securityåˆå§‹åŒ–" class="headerlink" title="3.2.3 Spring Securityåˆå§‹åŒ–"></a>3.2.3 Spring Securityåˆå§‹åŒ–</h4><ul><li><p>Spring Security åˆå§‹åŒ–ï¼Œæœ‰ä¸¤ç§æƒ…å†µ</p><ul><li>è‹¥å½“å‰ç¯å¢ƒæ²¡æœ‰ä½¿ç”¨ Spring æˆ– Spring MVCï¼Œåˆ™éœ€è¦å°† WebSecurityConfig(Spring Securityé…ç½®ç±») ä¼ å…¥è¶…<br>ç±»ï¼Œä»¥ç¡®ä¿è·å–é…ç½®ï¼Œå¹¶åˆ›å»ºspring contextã€‚</li><li>ç›¸åï¼Œè‹¥å½“å‰ç¯å¢ƒ<strong>å·²ç»ä½¿ç”¨ Spring</strong>ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç°æœ‰çš„SpringContextä¸­æ³¨å†ŒSpring Securityã€Œä¸Šä¸€æ­¥å·²ç»åšå°†WebSecurityConfigåŠ è½½è‡³rootcontextã€ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä»€ä¹ˆéƒ½ä¸åšã€‚</li></ul></li><li><p>åœ¨<code>init</code>åŒ…ä¸‹å®šä¹‰<code>SpringSecurityApplicationInitializer</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityApplicationInitializer</span></span><br><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSecurityWebApplicationInitializer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SpringSecurityApplicationInitializer</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//super(WebSecurityConfig.class);</span><br>        <span class="hljs-comment">//æ²¡æœ‰ä½¿ç”¨Springæˆ–Spring MVCï¼Œåˆ™éœ€è¦å°†WebSecurityConfig(Spring Securityé…ç½®ç±») ä¼ å…¥è¶…</span><br>        <span class="hljs-comment">//ç±»ï¼Œä»¥ç¡®ä¿è·å–é…ç½®ï¼Œå¹¶åˆ›å»ºspring contextã€‚</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-2-4-é»˜è®¤æ ¹è·¯å¾„è¯·æ±‚"><a href="#3-2-4-é»˜è®¤æ ¹è·¯å¾„è¯·æ±‚" class="headerlink" title="3.2.4 é»˜è®¤æ ¹è·¯å¾„è¯·æ±‚"></a>3.2.4 é»˜è®¤æ ¹è·¯å¾„è¯·æ±‚</h4><ul><li>åœ¨WebConfig.javaä¸­æ·»åŠ é»˜è®¤è¯·æ±‚æ ¹è·¯å¾„è·³è½¬åˆ°<code>/login</code>ï¼Œæ­¤urlä¸º<strong>Spring Security</strong>æä¾›ï¼š</li><li>è¿™é‡Œè¦ç”¨é‡å®šå‘åˆ°é»˜è®¤çš„ /login ç•Œé¢</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤Urlæ ¹è·¯å¾„è·³è½¬åˆ°/loginï¼Œæ­¤urlä¸ºspringÂ securityæä¾›</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistryÂ registry)</span>Â </span>&#123;<br>Â Â Â Â registry.addViewController(<span class="hljs-string">&quot;/&quot;</span>).setViewName(<span class="hljs-string">&quot;redirect:/login&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-2-5-è®¤è¯æˆåŠŸé¡µé¢"><a href="#3-2-5-è®¤è¯æˆåŠŸé¡µé¢" class="headerlink" title="3.2.5 è®¤è¯æˆåŠŸé¡µé¢"></a>3.2.5 è®¤è¯æˆåŠŸé¡µé¢</h4><ul><li>åœ¨å®‰å…¨é…ç½®ä¸­ï¼Œè®¤è¯æˆåŠŸå°†è·³è½¬åˆ°<code>/login-success</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    http.authorizeRequests()<br>        .antMatchers(<span class="hljs-string">&quot;/r/r1&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p1&quot;</span>)<br>        .antMatchers(<span class="hljs-string">&quot;/r/r2&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p2&quot;</span>)<br>        .antMatchers(<span class="hljs-string">&quot;/r/**&quot;</span>).authenticated() <span class="hljs-comment">// æ‰€æœ‰/r/**çš„è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡</span><br>        .anyRequest().permitAll()   <span class="hljs-comment">// é™¤äº†/r/**ï¼Œå…¶å®ƒçš„è¯·æ±‚å¯ä»¥è®¿é—®</span><br>        .and()<br>        .formLogin() <span class="hljs-comment">// å…è®¸è¡¨å•ç™»å½•</span><br>        .successForwardUrl(<span class="hljs-string">&quot;/login-success&quot;</span>); <span class="hljs-comment">// è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>Spring Securityæ”¯æŒformè¡¨å•è®¤è¯ï¼Œè®¤è¯æˆåŠŸåè½¬å‘<code>/login-success</code>ã€‚</li><li>åœ¨<code>LoginController</code>ä¸­å®šä¹‰<code>/login-success</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(valueÂ =Â &quot;/loginâ€success&quot;,producesÂ =Â &#123;&quot;text/plain;charset=UTFâ€8&quot;&#125;)</span> <br><span class="hljs-function"><span class="hljs-keyword">public</span>Â StringÂ <span class="hljs-title">loginSuccess</span><span class="hljs-params">()</span></span>&#123;<br>Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">&quot;Â ç™»å½•æˆåŠŸ&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-2-6-Test"><a href="#3-2-6-Test" class="headerlink" title="3.2.6 Test"></a>3.2.6 Test</h4><ol><li>å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®<a href="http://localhost:8080/security-spring-security/%E8%B7%AF%E5%BE%84%E5%9C%B0%E5%9D%80">http://localhost:8080/security-spring-security/è·¯å¾„åœ°å€</a></li></ol><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410165535635.png"></p><ul><li>é¡µé¢ä¼šæ ¹æ®WebConfigä¸­addViewControllersé…ç½®è§„åˆ™ï¼Œé‡å®šå‘è·³è½¬è‡³/loginï¼Œ/loginæ˜¯pring Securityæä¾›çš„ç™»å½•é¡µé¢ã€‚</li></ul><ol start="2"><li>ç™»å½•</li></ol><ul><li>è´¦æˆ·åã€å¯†ç é”™è¯¯</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410165724178.png"></p><ul><li>è´¦æˆ·åï¼šzhangsanï¼›å¯†ç ï¼š123</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410165809551.png"></p><ol start="3"><li>è¾“å…¥<a href="http://localhost:8080/security-spring-security/logout%E9%80%80%E5%87%BA%EF%BC%8CLog">http://localhost:8080/security-spring-security/logouté€€å‡ºï¼ŒLog</a> Outè‡ªåŠ¨è·³è½¬å›ç™»å½•ç•Œé¢</li></ol><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410165846215.png"></p><hr><h3 id="3-3-æˆæƒ"><a href="#3-3-æˆæƒ" class="headerlink" title="3.3 æˆæƒ"></a>3.3 æˆæƒ</h3><ul><li><p>å®ç°æˆæƒéœ€è¦å¯¹ç”¨æˆ·çš„è®¿é—®è¿›è¡Œæ‹¦æˆªæ ¡éªŒï¼Œæ ¡éªŒç”¨æˆ·çš„æƒé™æ˜¯å¦å¯ä»¥æ“ä½œæŒ‡å®šçš„èµ„æºï¼ŒSpring Securityé»˜è®¤æä¾›æˆæƒå®ç°æ–¹æ³•ã€‚</p></li><li><p>åœ¨<code>LoginController</code>æ·»åŠ <code>/r/r1</code>æˆ–<code>/r/r2</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// æµ‹è¯•èµ„æº1</span><br><span class="hljs-meta">@GetMapping(value = &quot;/r/r1&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">r1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; è®¿é—®èµ„æº1&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// æµ‹è¯•èµ„æº2</span><br><span class="hljs-meta">@GetMapping(value = &quot;/r/r2&quot;, produces = &#123;&quot;text/plain;charset=UTF-8&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">r2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; è®¿é—®èµ„æº2&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä¹‹å‰ç»™ä¸¤ä¸ªæµ‹è¯•ç”¨æˆ·ç»‘å®šäº†ç›¸åº”çš„æƒé™ï¼Œè¡¨ç¤ºè®¿é—®â€/xxxâ€èµ„æºçš„urléœ€è¦æœ‰â€pxâ€çš„æƒé™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">manager.createUser(User.withUsername(<span class="hljs-string">&quot;zhangsan&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).authorities(<span class="hljs-string">&quot;p1&quot;</span>).build());<br>manager.createUser(User.withUsername(<span class="hljs-string">&quot;lisi&quot;</span>).password(<span class="hljs-string">&quot;456&quot;</span>).authorities(<span class="hljs-string">&quot;p2&quot;</span>).build());Â <br><span class="hljs-comment">// protected void configure(HttpSecurity http) â†“â†“â†“â†“</span><br>.antMatchers(<span class="hljs-string">&quot;/r/r1&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p1&quot;</span>)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <br>.antMatchers(<span class="hljs-string">&quot;/r/r2&quot;</span>).hasAuthority(<span class="hljs-string">&quot;p2&quot;</span>)<br></code></pre></div></td></tr></table></figure><ul><li>Test</li></ul><ol><li><p>å¼ ä¸‰ç™»å½•ï¼Œè®¿é—®r1èµ„æº</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410170553915.png"></p></li><li><p>å¼ ä¸‰è®¿é—®r2èµ„æºï¼Œ403æ— æƒé™</p></li></ol><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210410170804126.png"></p><h2 id="4-Spring-Security-åŸºæœ¬åŸç†"><a href="#4-Spring-Security-åŸºæœ¬åŸç†" class="headerlink" title="4 Spring Security  åŸºæœ¬åŸç†"></a>4 Spring Security  åŸºæœ¬åŸç†</h2><h3 id="4-1-Spring-Securityæœ¬è´¨"><a href="#4-1-Spring-Securityæœ¬è´¨" class="headerlink" title="4.1 Spring Securityæœ¬è´¨"></a>4.1 Spring Securityæœ¬è´¨</h3><ul><li>SpringSecurity æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>è¿‡æ»¤å™¨é“¾</strong>ï¼Œä»å¯åŠ¨å¯ä»¥è·å–åˆ°è¿‡æ»¤å™¨é“¾ï¼š<ul><li>org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFil<br>ter</li><li>org.springframework.security.web.context.SecurityContextPersistenceFilter</li><li>org.springframework.security.web.header.HeaderWriterFilter</li><li>org.springframework.security.web.csrf.CsrfFilter</li><li>org.springframework.security.web.authentication.logout.LogoutFilter</li><li>org.springframework.security.web.authentication.<code>UsernamePasswordAuthenticationFilter</code></li><li>org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter</li><li>org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter</li><li>org.springframework.security.web.savedrequest.RequestCacheAwareFilter</li><li>org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter</li><li>org.springframework.security.web.authentication.AnonymousAuthenticationFilter</li><li>org.springframework.security.web.session.SessionManagementFilter</li><li>org.springframework.security.web.access.<code>ExceptionTranslationFilter</code></li><li>org.springframework.security.web.access.intercept.<code>FilterSecurityInterceptor</code></li></ul></li></ul><p>é‡ç‚¹çœ‹ä¸‰ä¸ªè¿‡æ»¤å™¨ï¼š</p><ol><li><code>FilterSecurityInterceptor</code></li></ol><p>ä¸€ä¸ª<strong>æ–¹æ³•çº§</strong>çš„æƒé™è¿‡æ»¤å™¨, åŸºæœ¬ä½äºè¿‡æ»¤é“¾çš„æœ€åº•éƒ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilterSecurityInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSecurityInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invoke</span><span class="hljs-params">(FilterInvocation fi)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>        <span class="hljs-keyword">if</span> (fi.getRequest() != <span class="hljs-keyword">null</span> &amp;&amp; fi.getRequest().getAttribute(<span class="hljs-string">&quot;__spring_security_filterSecurityInterceptor_filterApplied&quot;</span>) != <span class="hljs-keyword">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.observeOncePerRequest) &#123;<br>            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (fi.getRequest() != <span class="hljs-keyword">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.observeOncePerRequest) &#123;<br>                fi.getRequest().setAttribute(<span class="hljs-string">&quot;__spring_security_filterSecurityInterceptor_filterApplied&quot;</span>, Boolean.TRUE);<br>            &#125;<br>            InterceptorStatusToken token = <span class="hljs-keyword">super</span>.beforeInvocation(fi);<br>            <span class="hljs-keyword">try</span> &#123;<br>                fi.getChain().doFilter(fi.getRequest(), fi.getResponse());<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-keyword">super</span>.finallyInvocation(token);<br>            &#125;<br>            <span class="hljs-keyword">super</span>.afterInvocation(token, (Object)<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;   <br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>super.beforeInvocation(fi)</code> æŸ¥çœ‹ä¹‹å‰çš„ filter æ˜¯å¦é€šè¿‡</li><li><code>fi.getChain().doFilter(fi.getRequest(), fi.getResponse())</code> çœŸæ­£çš„è°ƒç”¨åå°çš„æœåŠ¡</li></ul><ol start="2"><li><code>ExceptionTranslationFilter</code></li></ol><ul><li>å¼‚å¸¸è¿‡æ»¤å™¨ï¼Œç”¨æ¥å¤„ç†åœ¨è®¤è¯æˆæƒè¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionTranslationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>        HttpServletRequest request = (HttpServletRequest)req;<br>        HttpServletResponse response = (HttpServletResponse)res;<br>        <span class="hljs-keyword">try</span> &#123;<br>            chain.doFilter(request, response);<br>            <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Chain processed normally&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var9) &#123;<br>            <span class="hljs-keyword">throw</span> var9;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var10) &#123;<br>            Throwable[] causeChain = <span class="hljs-keyword">this</span>.throwableAnalyzer.determineCauseChain(var10);<br>            RuntimeException ase = (AuthenticationException)<span class="hljs-keyword">this</span>.throwableAnalyzer.getFirstThrowableOfType(AuthenticationException.class, causeChain);<br>            <span class="hljs-keyword">if</span> (ase == <span class="hljs-keyword">null</span>) &#123;<br>                ase = (AccessDeniedException)<span class="hljs-keyword">this</span>.throwableAnalyzer.getFirstThrowableOfType(AccessDeniedException.class, causeChain);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (ase == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (var10 <span class="hljs-keyword">instanceof</span> ServletException) &#123;<br>                    <span class="hljs-keyword">throw</span> (ServletException)var10;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (var10 <span class="hljs-keyword">instanceof</span> RuntimeException) &#123;<br>                    <span class="hljs-keyword">throw</span> (RuntimeException)var10;<br>                &#125;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(var10);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (response.isCommitted()) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ServletException(<span class="hljs-string">&quot;Unable to handle the Spring Security Exception because the response is already committed.&quot;</span>, var10);<br>            &#125;<br>            <span class="hljs-keyword">this</span>.handleSpringSecurityException(request, response, chain, (RuntimeException)ase);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li><code>UsernamePasswordAuthenticationFilter</code></li></ol><ul><li>å¯¹/login çš„ POST è¯·æ±‚åšæ‹¦æˆªï¼Œæ ¡éªŒè¡¨å•ä¸­ç”¨æˆ·åï¼Œå¯†ç </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAuthenticationProcessingFilter</span> </span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.postOnly &amp;&amp; !request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            String username = <span class="hljs-keyword">this</span>.obtainUsername(request);<br>            String password = <span class="hljs-keyword">this</span>.obtainPassword(request);<br>            <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;<br>                username = <span class="hljs-string">&quot;&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;<br>                password = <span class="hljs-string">&quot;&quot;</span>;<br>            &#125;<br>            username = username.trim();<br>            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(username, password);<br>            <span class="hljs-keyword">this</span>.setDetails(request, authRequest);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><hr><h3 id="4-2-è¿‡æ»¤å™¨åŠ è½½"><a href="#4-2-è¿‡æ»¤å™¨åŠ è½½" class="headerlink" title="4.2 è¿‡æ»¤å™¨åŠ è½½"></a>4.2 è¿‡æ»¤å™¨åŠ è½½</h3><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210412213111265.png"></p><ul><li>è¿‡æ»¤å™¨åŠ è½½é€šè¿‡ <code>DelegatingFilterProxy</code> æ¥é…ç½®åŠ è½½</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelegatingFilterProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        Filter delegateToUse = <span class="hljs-keyword">this</span>.delegate;<br>        <span class="hljs-keyword">if</span> (delegateToUse == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span>(<span class="hljs-keyword">this</span>.delegateMonitor) &#123;<br>                delegateToUse = <span class="hljs-keyword">this</span>.delegate;<br>                <span class="hljs-keyword">if</span> (delegateToUse == <span class="hljs-keyword">null</span>) &#123;<br>                    WebApplicationContext wac = <span class="hljs-keyword">this</span>.findWebApplicationContext();<br>                    <span class="hljs-keyword">if</span> (wac == <span class="hljs-keyword">null</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;No WebApplicationContext found: no ContextLoaderListener or DispatcherServlet registered?&quot;</span>);<br>                    &#125;<br>                    delegateToUse = <span class="hljs-keyword">this</span>.initDelegate(wac);<br>                &#125;<br>                <span class="hljs-keyword">this</span>.delegate = delegateToUse;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">this</span>.invokeDelegate(delegateToUse, request, response, filterChain);<br>    &#125;   <br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>this.delegate = this.initDelegate(wac)</code>  åˆå§‹åŒ–ä»£ç†</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> Filter <span class="hljs-title">initDelegate</span><span class="hljs-params">(WebApplicationContext wac)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>    String targetBeanName = <span class="hljs-keyword">this</span>.getTargetBeanName();<br>    Assert.state(targetBeanName != <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;No target bean name set&quot;</span>);<br>    Filter delegate = (Filter)wac.getBean(targetBeanName, Filter.class);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isTargetFilterLifecycle()) &#123;<br>        delegate.init(<span class="hljs-keyword">this</span>.getFilterConfig());<br>    &#125;<br>    <span class="hljs-keyword">return</span> delegate;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä¼šå†…ç½® <code>FilterChainProxy</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilterChainProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilterInternal</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> </span>&#123;<br>        List&lt;Filter&gt; filters = <span class="hljs-keyword">this</span>.getFilters((HttpServletRequest)fwRequest);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>private List&lt;Filter&gt; getFilters(HttpServletRequest request)</code> è·å–æ‰€æœ‰è¿‡æ»¤å™¨é“¾</li></ul><hr><h3 id="4-3-ä¸¤ä¸ªé‡è¦æ¥å£"><a href="#4-3-ä¸¤ä¸ªé‡è¦æ¥å£" class="headerlink" title="4.3 ä¸¤ä¸ªé‡è¦æ¥å£"></a>4.3 ä¸¤ä¸ªé‡è¦æ¥å£</h3><ol><li><code>UserDetailsService</code></li></ol><ul><li>å½“ä»€ä¹ˆä¹Ÿæ²¡æœ‰é…ç½®çš„æ—¶å€™ï¼Œè´¦å·å’Œå¯†ç æ˜¯ç”± Spring Security å®šä¹‰ç”Ÿæˆçš„ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰é€»è¾‘æ—¶ï¼Œåªéœ€è¦å®ç° UserDetailsService æ¥å£ã€‚</li><li><strong>æŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç è¿‡ç¨‹å†™åœ¨è¿™ä¸ªæ¥å£ä¸­</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;<br>    <span class="hljs-function">UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ä¼šè¿”å› <code>UserDetails</code> ç±»ï¼Œé»˜è®¤ä¸º ç”¨æˆ· â€œä¸»ä½“â€</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDetails</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); <span class="hljs-comment">// è·å–ç™»å½•ç”¨æˆ·æ‰€æœ‰æƒé™</span><br>    <span class="hljs-function">String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// è·å–å¯†ç </span><br>    <span class="hljs-function">String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">// è·å–ç”¨æˆ·å</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">// åˆ¤æ–­è´¦æˆ·æ˜¯å¦è¿‡æœŸ</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">// åˆ¤æ–­è´¦æˆ·æ˜¯å¦è¢«é”å®š</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">// å‡­è¯&#123;å¯†ç &#125;æ˜¯å¦è¿‡æœŸ</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">// å½“å‰ç”¨æˆ·æ˜¯å¦å¯ç”¨</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210412215511215.png"></p><ul><li>å®ç°ç±»ä¸º <code>User</code>ï¼Œåé¢åªç”¨å®ç°Userè¿™ä¸ªå®ä½“ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span>, <span class="hljs-title">CredentialsContainer</span> </span>&#123;<br>    <span class="hljs-comment">//@Param username: æ­¤å€¼æ˜¯å®¢æˆ·ç«¯è¡¨å•ä¼ é€’è¿‡æ¥çš„æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹å¿…é¡»å« usernameï¼Œå¦åˆ™æ— </span><br>    <span class="hljs-comment">//æ³•æ¥æ”¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>(username, password, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, authorities);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>éœ€è¦åšçš„æ˜¯ï¼š</p><ul><li><p>åˆ›å»ºç±»ç»§æ‰¿ <code>UsernamePasswordAuthenticationFilter</code> ï¼Œé‡å†™ä¸‰ä¸ªæ–¹æ³•</p><ul><li><code>attemptAuthentication</code> å°è¯•è®¤è¯</li><li>çˆ¶ç±»ä¸­çš„ <code>successfulAuthentication</code> <code>unsuccessfulAuthentication</code> æˆåŠŸå’Œå¤±è´¥è®¤è¯</li></ul></li><li><p>åˆ›å»ºç±»å®ç° <code>UserDetailsService</code> ï¼Œç¼–å†™æŸ¥è¯¢æ•°æ®è¿‡ç¨‹ï¼Œè¿”å› User å¯¹è±¡ï¼Œè¯¥Useræ˜¯å®‰å…¨æ¡†æ¶æä¾›çš„ã€‚</p></li></ul></li></ul><hr><ol start="2"><li><code>PasswordEncoder</code></li></ol><ul><li><strong>æ•°æ®åŠ å¯†æ¥å£ï¼Œç”¨äºè¿”å›Userå¯¹è±¡é‡Œé¢å¯†ç åŠ å¯†</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PasswordEncoder</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¡¨ç¤ºæŠŠå‚æ•°æŒ‰ç…§ç‰¹å®šçš„è§£æè§„åˆ™è¿›è¡Œè§£æ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">String <span class="hljs-title">encode</span><span class="hljs-params">(CharSequence var1)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éªŒè¯ä»å­˜å‚¨ä¸­è·å–çš„ç¼–ç å¯†ç ä¸ç¼–ç åæäº¤çš„åŸå§‹å¯†ç æ˜¯å¦åŒ¹é…</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> var1 éœ€è¦è¢«è§£æçš„å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> var2 å­˜å‚¨çš„å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¯†ç åŒ¹é… true, ä¸åŒ¹é… false</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">matches</span><span class="hljs-params">(CharSequence var1, String var2)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‡çº§å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> encodedPassword ç¼–è¯‘åçš„å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è§£æçš„å¯†ç èƒ½å¤Ÿå†æ¬¡è¿›è¡Œè§£æä¸”è¾¾åˆ°æ›´å®‰å…¨çš„ç»“æœ true, å¦åˆ™è¿”å›</span><br><span class="hljs-comment">     *         falseã€‚é»˜è®¤è¿”å› false</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">upgradeEncoding</span><span class="hljs-params">(String encodedPassword)</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210412220820356.png"></p><ul><li><code>BCryptPasswordEncoder</code> æ˜¯ Spring Security å®˜æ–¹æ¨èçš„å¯†ç è§£æå™¨ï¼Œå¹³æ—¶å¤šä½¿ç”¨è¿™ä¸ªè§£æå™¨ï¼Œå¯¹ bcrypt å¼ºæ•£åˆ—æ–¹æ³•çš„å…·ä½“å®ç°ã€‚æ˜¯åŸºäº Hash ç®—æ³•å®ç°çš„å•å‘åŠ å¯†ã€‚å¯ä»¥é€šè¿‡ strength æ§åˆ¶åŠ å¯†å¼ºåº¦ï¼Œé»˜è®¤ 10ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// åˆ›å»ºå¯†ç è§£æå™¨</span><br>    BCryptPasswordEncoder bCryptPasswordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>    <span class="hljs-comment">// å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</span><br>    String testStr = bCryptPasswordEncoder.encode(<span class="hljs-string">&quot;test&quot;</span>);<br>    <span class="hljs-comment">// æ‰“å°åŠ å¯†ä¹‹åçš„æ•°æ®</span><br>    System.out.println(<span class="hljs-string">&quot; åŠ å¯†ä¹‹åæ•°æ®ï¼š\t&quot;</span> + testStr);<br>    <span class="hljs-comment">// åˆ¤æ–­åŸå­—ç¬¦åŠ å¯†åå’ŒåŠ å¯†ä¹‹å‰æ˜¯å¦åŒ¹é…</span><br>    <span class="hljs-keyword">boolean</span> result = bCryptPasswordEncoder.matches(<span class="hljs-string">&quot;test&quot;</span>, testStr);<br>    <span class="hljs-comment">// æ‰“å°æ¯”è¾ƒç»“æœ</span><br>    System.out.println(<span class="hljs-string">&quot; æ¯”è¾ƒç»“æœï¼š\t&quot;</span> + result);<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="5-SpringSecurity-Web-æƒé™æ–¹æ¡ˆ"><a href="#5-SpringSecurity-Web-æƒé™æ–¹æ¡ˆ" class="headerlink" title="5 SpringSecurity Web æƒé™æ–¹æ¡ˆ"></a>5 SpringSecurity Web æƒé™æ–¹æ¡ˆ</h2><blockquote><p>spring-boot-starter-parent 2.2.1.RELEASE;  spring-security-web  5.2.1.RELEASE</p></blockquote><h3 id="5-1-è®¾ç½®ç™»å½•ç³»ç»Ÿçš„è´¦å·ã€å¯†ç "><a href="#5-1-è®¾ç½®ç™»å½•ç³»ç»Ÿçš„è´¦å·ã€å¯†ç " class="headerlink" title="5.1 è®¾ç½®ç™»å½•ç³»ç»Ÿçš„è´¦å·ã€å¯†ç "></a>5.1 è®¾ç½®ç™»å½•ç³»ç»Ÿçš„è´¦å·ã€å¯†ç </h3><h4 id="æ–¹å¼ä¸€ï¼šapplication-properties"><a href="#æ–¹å¼ä¸€ï¼šapplication-properties" class="headerlink" title="æ–¹å¼ä¸€ï¼šapplication.properties"></a>æ–¹å¼ä¸€ï¼šapplication.properties</h4><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.security.user.name</span>=<span class="hljs-string">hypocrite30</span><br><span class="hljs-meta">spring.security.user.password</span>=<span class="hljs-string">hypocrite30</span><br></code></pre></div></td></tr></table></figure><h4 id="æ–¹å¼äºŒï¼šç¼–å†™ç±»å®ç°æ¥å£"><a href="#æ–¹å¼äºŒï¼šç¼–å†™ç±»å®ç°æ¥å£" class="headerlink" title="æ–¹å¼äºŒï¼šç¼–å†™ç±»å®ç°æ¥å£"></a>æ–¹å¼äºŒï¼šç¼–å†™ç±»å®ç°æ¥å£</h4><ul><li><code>config</code> åŒ…ä¸‹åˆ›å»º Security çš„<strong>é…ç½®ç±»</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        BCryptPasswordEncoder passwordEncoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>        String password = passwordEncoder.encode(<span class="hljs-string">&quot;123&quot;</span>); <span class="hljs-comment">// å¯¹å¯†ç è¿›è¡Œç¼–è¯‘</span><br>        auth.inMemoryAuthentication().withUser(<span class="hljs-string">&quot;hypocrite30&quot;</span>).password(password).roles(<span class="hljs-string">&quot;admin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// æ³¨å…¥å¯†ç ç¼–ç å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">password</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰å®ç°ç±»"><a href="#æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰å®ç°ç±»" class="headerlink" title="æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰å®ç°ç±»"></a>æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰å®ç°ç±»</h4><ul><li>åˆ›å»ºé…ç½®ç±»ï¼Œè®¾ç½®ä½¿ç”¨å“ªä¸ª<code>userDetailsService</code>å®ç°ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfigTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br><span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(password());<br>    &#125;<br>    <span class="hljs-comment">// æ³¨å…¥å¯†ç ç¼–ç å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">password</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>userDetailsService</code> é€‰æ‹©ä½¿ç”¨å“ªä¸ª Serviceè¿›è¡Œè®¤è¯</li><li>ç¼–å†™å®ç°ç±»ï¼Œè¿”å›Userå¯¹è±¡ï¼ŒUserå¯¹è±¡æœ‰ç”¨æˆ·åå¯†ç å’Œæƒé™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service(&quot;userDetailsService&quot;)</span> <span class="hljs-comment">// ä¸æ³¨å…¥çš„åç§°ä¸€ä¸€å¯¹åº”</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;<br><span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;<br>        List&lt;GrantedAuthority&gt; auths =<br>                AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;role&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;hypocrite30&quot;</span>,<br>                <span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;password&quot;</span>), auths);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>ä¸€èˆ¬éƒ½æ˜¯ç”¨<strong>ç¬¬ä¸‰ç§</strong>æ–¹æ³•ï¼Œè‡ªå®šä¹‰å®ç°ç±»ã€‚ä½†æ˜¯æ¶‰åŠåˆ°ç®¡ç†å‘˜æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€å’Œç¬¬äºŒç§æ–¹å¼è®¾ç½®adminã€‚</p></blockquote><h3 id="5-2-æ•´åˆæ•°æ®åº“å®Œæˆç”¨æˆ·è®¤è¯"><a href="#5-2-æ•´åˆæ•°æ®åº“å®Œæˆç”¨æˆ·è®¤è¯" class="headerlink" title="5.2 æ•´åˆæ•°æ®åº“å®Œæˆç”¨æˆ·è®¤è¯"></a>5.2 æ•´åˆæ•°æ®åº“å®Œæˆç”¨æˆ·è®¤è¯</h3><ul><li>æ•´åˆMybatis-plus</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mybatis-plus--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mysql--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>åˆ›è¡¨ users</li></ul><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> NAMES utf8mb4;<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Table structure for users</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `users`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `users`  (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> InnoDB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Records of users</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;lucy&#x27;</span>, <span class="hljs-string">&#x27;123&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;mary&#x27;</span>, <span class="hljs-string">&#x27;456&#x27;</span>);<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></div></td></tr></table></figure><ul><li>åˆ›å»ºå®ä½“ç±»ï¼Œ<code>entity</code>åŒ…ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ•´åˆMybatis-plusï¼Œåˆ›å»ºmapperï¼Œæ”¾åœ¨mapperåŒ…ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UsersMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">Users</span>&gt; </span>&#123;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æœ‰Mapperï¼Œå°±éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @MapperScanæ‰«æ</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan(&quot;com.xxx.security.mapper&quot;)</span> <span class="hljs-comment">// mapperå¯¹åº”çš„åŒ…è·¯å¾„</span><br></code></pre></div></td></tr></table></figure><ul><li>é…ç½®æ–‡ä»¶åŠ ä¸Šæ•°æ®åº“è¿æ¥ä¿¡æ¯</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/springsecurity?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true</span><br><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><br></code></pre></div></td></tr></table></figure><ul><li>åœ¨è‡ªå®šä¹‰å®ç°ç±»ä¸­è°ƒç”¨mapperæŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·åè®¤è¯</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service(&quot;userDetailsService&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UsersMapper usersMapper;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;<br>        <span class="hljs-comment">//è°ƒç”¨usersMapperæ–¹æ³•ï¼Œæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</span><br>        QueryWrapper&lt;Users&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper();<br>        <span class="hljs-comment">// where username=?</span><br>        wrapper.eq(<span class="hljs-string">&quot;username&quot;</span>, username);<br>        Users users = usersMapper.selectOne(wrapper);<br>        <span class="hljs-comment">//åˆ¤æ–­</span><br>        <span class="hljs-keyword">if</span> (users == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-comment">//æ•°æ®åº“æ²¡æœ‰ç”¨æˆ·åï¼Œè®¤è¯å¤±è´¥</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);<br>        &#125;<br>        List&lt;GrantedAuthority&gt; auths =<br>                AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;role&quot;</span>);<br>        <span class="hljs-comment">//ä»æŸ¥è¯¢æ•°æ®åº“è¿”å›userså¯¹è±¡ï¼Œå¾—åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿”å›</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(users.getUsername(),<br>                <span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(users.getPassword()), auths);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="5-3-è‡ªå®šä¹‰ç™»å½•ç•Œé¢-amp-æ§åˆ¶æ˜¯å¦è®¤è¯"><a href="#5-3-è‡ªå®šä¹‰ç™»å½•ç•Œé¢-amp-æ§åˆ¶æ˜¯å¦è®¤è¯" class="headerlink" title="5.3 è‡ªå®šä¹‰ç™»å½•ç•Œé¢ &amp; æ§åˆ¶æ˜¯å¦è®¤è¯"></a>5.3 è‡ªå®šä¹‰ç™»å½•ç•Œé¢ &amp; æ§åˆ¶æ˜¯å¦è®¤è¯</h3><ul><li>åœ¨Securityé…ç½®ç±»è¿›è¡Œé…ç½®ï¼Œæ³¨æ„é‡å†™çš„æ˜¯ å½¢å‚<code>HttpSecurity http</code> çš„ configure()</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// é…ç½®è®¤è¯</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    http.formLogin() <span class="hljs-comment">// è‡ªå®šä¹‰è‡ªå·±ç¼–å†™çš„ç™»å½•é¡µé¢</span><br>            .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>) <span class="hljs-comment">//  é…ç½®å“ªä¸ª url ä¸ºç™»å½•é¡µé¢</span><br>            .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>) <span class="hljs-comment">// ç™»å½•è®¿é—®è·¯å¾„ url</span><br>            .successForwardUrl(<span class="hljs-string">&quot;/success&quot;</span>) <span class="hljs-comment">//  ç™»å½•æˆåŠŸä¹‹åï¼Œè·³è½¬è·¯å¾„ url</span><br>            .failureForwardUrl(<span class="hljs-string">&quot;/fail&quot;</span>);<span class="hljs-comment">//  ç™»å½•å¤±è´¥ä¹‹åè·³è½¬åˆ°å“ªä¸ª url</span><br>    http.authorizeRequests()<br>            .antMatchers(<span class="hljs-string">&quot;/test/hello&quot;</span>, <span class="hljs-string">&quot;/login&quot;</span>) <span class="hljs-comment">// è¡¨ç¤ºé…ç½®è¯·æ±‚è·¯å¾„</span><br>            .permitAll() <span class="hljs-comment">// æŒ‡å®š URL æ— éœ€è®¤è¯ã€‚</span><br>            .anyRequest() <span class="hljs-comment">// å…¶ä»–è¯·æ±‚</span><br>            .authenticated(); <span class="hljs-comment">// éœ€è¦è®¤è¯</span><br>    http.csrf().disable(); <span class="hljs-comment">// å…³é—­ csrf</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/success&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br><span class="hljs-meta">@PostMapping(&quot;/fail&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">fail</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;fail&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å‰ç«¯è¡¨å•</li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login&quot;</span><span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>ç”¨æˆ·å:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span> // usernameï¼Œpasswordåç§°ä¸èƒ½é”™<br>å¯†ç ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span><span class="hljs-attr">value</span>=<span class="hljs-string">&quot; æäº¤&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="5-4-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶"><a href="#5-4-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶" class="headerlink" title="5.4 åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶"></a>5.4 åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶</h3><h4 id="ã€ŒhasAuthorityã€"><a href="#ã€ŒhasAuthorityã€" class="headerlink" title="ã€ŒhasAuthorityã€"></a>ã€ŒhasAuthorityã€</h4><ul><li><p>å¦‚æœå½“å‰çš„ä¸»ä½“å…·æœ‰æŒ‡å®šæƒé™ï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p></li><li><p>é…ç½®ç±»åŠ ä¸Šè·¯å¾„å’Œèƒ½è®¿é—®çš„æƒé™</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">.antMatchers(<span class="hljs-string">&quot;/test/index&quot;</span>).hasAuthority(<span class="hljs-string">&quot;admins&quot;</span>)<br></code></pre></div></td></tr></table></figure><ul><li>è‡ªå®šä¹‰Serviceä¸Šä¸ºè¿”å›çš„Userå¯¹è±¡åŠ æƒé™</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">List&lt;GrantedAuthority&gt; auths =<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AuthorityUtils</span>.</span></span>comma<span class="hljs-constructor">SeparatedStringToAuthorityList(<span class="hljs-string">&quot;admins&quot;</span>)</span>;<br></code></pre></div></td></tr></table></figure><h4 id="ã€ŒhasAnyAuthorityã€"><a href="#ã€ŒhasAnyAuthorityã€" class="headerlink" title="ã€ŒhasAnyAuthorityã€"></a>ã€ŒhasAnyAuthorityã€</h4><ul><li>åŒºåˆ«äºä¸Šé¢çš„å•ä¸ªè§’è‰²ï¼Œæ­¤æ–¹æ³•æ·»åŠ å¤šä¸ªæƒé™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">.antMatchers(<span class="hljs-string">&quot;/test/index&quot;</span>).hasAnyAuthority(<span class="hljs-string">&quot;admins, manager&quot;</span>)<br></code></pre></div></td></tr></table></figure><h4 id="ã€ŒhasRoleã€"><a href="#ã€ŒhasRoleã€" class="headerlink" title="ã€ŒhasRoleã€"></a>ã€ŒhasRoleã€</h4><ul><li>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²å°±å…è®¸è®¿é—®ï¼Œå¦åˆ™403</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">.antMatchers(<span class="hljs-string">&quot;/test/index&quot;</span>).hasRole(<span class="hljs-string">&quot;sale&quot;</span>)<br></code></pre></div></td></tr></table></figure><ul><li>æ³¨ï¼šhasRole() å‚æ•°<strong>ä¸èƒ½</strong>åŠ  â€œ<code>ROLE_</code>â€œï¼Œä¼šæŠ›å‡ºå¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">hasRole</span><span class="hljs-params">(String role)</span> </span>&#123;<br>    Assert.notNull(role, <span class="hljs-string">&quot;role cannot be null&quot;</span>);<br>    <span class="hljs-keyword">if</span> (role.startsWith(<span class="hljs-string">&quot;ROLE_&quot;</span>)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;role should not start with &#x27;ROLE_&#x27; since it is automatically inserted. Got &#x27;&quot;</span> + role + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hasRole(&#x27;ROLE_&quot;</span> + role + <span class="hljs-string">&quot;&#x27;)&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">.antMatchers(<span class="hljs-string">&quot;/test/index&quot;</span>).access(<span class="hljs-string">&quot;hasRole(&#x27;sale&#x27;)&quot;</span>) <span class="hljs-comment">// è¿™ç§å†™æ³•åŒä¸Šï¼Œå¯åŠ ROLE_ï¼Œå¯ä¸åŠ </span><br></code></pre></div></td></tr></table></figure><ul><li>ç»™ç”¨æˆ·æ·»åŠ è§’è‰²ï¼Œéœ€è¦åŠ ä¸Šå‰ç¼€</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">List&lt;GrantedAuthority&gt; auths =<br>        AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;admin,ROLE_sale&quot;</span>);<br></code></pre></div></td></tr></table></figure><h4 id="ã€ŒhasAnyRoleã€"><a href="#ã€ŒhasAnyRoleã€" class="headerlink" title="ã€ŒhasAnyRoleã€"></a>ã€ŒhasAnyRoleã€</h4><ul><li>åŒä¸Šï¼Œå¯æ·»åŠ å¤šä¸ªï¼ŒåŒæ ·æ³¨æ„åŠ å‰ç¼€ã€‚</li></ul><h3 id="5-5-è‡ªå®šä¹‰403ç•Œé¢"><a href="#5-5-è‡ªå®šä¹‰403ç•Œé¢" class="headerlink" title="5.5 è‡ªå®šä¹‰403ç•Œé¢"></a>5.5 è‡ªå®šä¹‰403ç•Œé¢</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//é…ç½®æ²¡æœ‰æƒé™è®¿é—®è·³è½¬è‡ªå®šä¹‰é¡µé¢</span><br>http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth.html&quot;</span>); <span class="hljs-comment">// è·³è½¬åˆ°è‡ªå®šä¹‰403ç•Œé¢</span><br></code></pre></div></td></tr></table></figure><ul><li>è·³è½¬çš„è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯controllerè¿›è¡Œè·³è½¬</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth&quot;</span>);<br><br><span class="hljs-meta">@GetMapping(&quot;/unauth&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">accessDenyPage</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unauth&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="5-6-æ³¨è§£"><a href="#5-6-æ³¨è§£" class="headerlink" title="5.6 æ³¨è§£"></a>5.6 æ³¨è§£</h3><h4 id="ã€Œ-Securedã€"><a href="#ã€Œ-Securedã€" class="headerlink" title="ã€Œ@Securedã€"></a>ã€Œ@Securedã€</h4><ul><li><p>åˆ¤æ–­æ˜¯å¦å…·æœ‰<strong>è§’è‰²</strong>ï¼Œå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒåŒ¹é…çš„å­—ç¬¦ä¸²éœ€è¦æ·»åŠ å‰ç¼€ <code>ROLE_</code>ã€‚</p></li><li><p>å¼€å¯æ³¨è§£åŠŸèƒ½(ä¸‹é¢çš„æ³¨è§£éƒ½è¦æ‰“å¼€æ³¨è§£åŠŸèƒ½)</p></li></ul><p><code>@EnableGlobalMethodSecurity(securedEnabled=true)</code> å¯ä»¥åŠ åœ¨<strong>å¯åŠ¨ç±»</strong>æˆ–<strong>é…ç½®ç±»</strong>ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableGlobalMethodSecurity(securedEnabled=true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemosecurityApplication</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(DemosecurityApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;update&quot;)</span><br><span class="hljs-meta">@Secured(&#123;&quot;ROLE_sale&quot;,&quot;ROLE_manager&quot;&#125;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello update&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ã€Œ-PreAuthorizeã€"><a href="#ã€Œ-PreAuthorizeã€" class="headerlink" title="ã€Œ@PreAuthorizeã€"></a>ã€Œ@PreAuthorizeã€</h4><ul><li>æ³¨è§£é€‚åˆ<strong>è¿›å…¥æ–¹æ³•å‰</strong>çš„æƒé™éªŒè¯ï¼Œåˆ¤æ–­çš„æ˜¯æœ‰æ— <strong>æƒé™</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/preAuthorize&quot;)</span><br><span class="hljs-comment">//@PreAuthorize(&quot;hasRole(&#x27;admins&#x27;)&quot;)</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;admins&#x27;)&quot;)</span> <span class="hljs-comment">//ä¸Šé¢çš„å››ç§æ–¹æ³•éƒ½å¯ä»¥</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">preAuthorize</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;preAuthorize&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ã€Œ-PostAuthorizeã€"><a href="#ã€Œ-PostAuthorizeã€" class="headerlink" title="ã€Œ@PostAuthorizeã€"></a>ã€Œ@PostAuthorizeã€</h4><ul><li>æ³¨è§£ä½¿ç”¨å¹¶ä¸å¤šï¼Œåœ¨æ–¹æ³•æ‰§è¡Œåå†è¿›è¡Œæƒé™éªŒè¯ï¼Œé€‚åˆéªŒè¯å¸¦æœ‰è¿”å›å€¼çš„æƒé™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/testPostAuthorize&quot;)</span><br><span class="hljs-meta">@PostAuthorize(&quot;hasAnyAuthority(&#x27;admins&#x27;)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">preAuthorize</span><span class="hljs-params">()</span></span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;test--PostAuthorize&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;PostAuthorize&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ— æƒé™ç™»å½•å®Œåè™½ç„¶ä¼šè™½ç„¶ä¼šè¿›å…¥403ï¼Œä½†æ˜¯æ–¹æ³•é‡Œçš„soutä¾ç„¶ä¼šæ‰§è¡Œ</li></ul><h4 id="ã€Œ-PreFilterã€"><a href="#ã€Œ-PreFilterã€" class="headerlink" title="ã€Œ@PreFilterã€"></a>ã€Œ@PreFilterã€</h4><ul><li>ä¸å¸¸ç”¨ï¼Œè¿›å…¥æ§åˆ¶å™¨ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä¸€èˆ¬å°±æ˜¯å¯¹ç‰¹å®šçš„æ•°æ®æ‹¦æˆª</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;getTestPreFilter&quot;)</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasRole(&#x27;admins&#x27;)&quot;)</span><br><span class="hljs-meta">@PreFilter(&quot;filterObject.id%2 == 0&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title">getTestPreFilter</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;Users&gt; list)</span> </span>&#123;<br>    list.forEach(t -&gt; &#123;<br>        System.out.println(t.getId() + <span class="hljs-string">&quot;\t&quot;</span> + t.getUsername());<br>    &#125;);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ã€Œ-PostFilterã€"><a href="#ã€Œ-PostFilterã€" class="headerlink" title="ã€Œ@PostFilterã€"></a>ã€Œ@PostFilterã€</h4><ul><li>ä¸å¸¸ç”¨ï¼Œæƒé™éªŒè¯<strong>ä¹‹å</strong>å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œç•™ä¸‹ç”¨æˆ·åæ˜¯ admin1 çš„æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;getAll&quot;)</span><br><span class="hljs-meta">@PostAuthorize(&quot;hasAnyAuthority(&#x27;admin&#x27;)&quot;)</span><br><span class="hljs-meta">@PostFilter(&quot;filterObject.username == &#x27;admin1&#x27;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span> </span>&#123;<br>    ArrayList&lt;Users&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    list.add(<span class="hljs-keyword">new</span> Users(<span class="hljs-number">11</span>, <span class="hljs-string">&quot;admin1&quot;</span>, <span class="hljs-string">&quot;6666&quot;</span>));<br>    list.add(<span class="hljs-keyword">new</span> Users(<span class="hljs-number">21</span>, <span class="hljs-string">&quot;admin2&quot;</span>, <span class="hljs-string">&quot;888&quot;</span>));<br>    System.out.println(list);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="5-7-æ³¨é”€"><a href="#5-7-æ³¨é”€" class="headerlink" title="5.7 æ³¨é”€"></a>5.7 æ³¨é”€</h3><ul><li>é…ç½®ç±»çš„<code>configure</code> æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//é€€å‡º</span><br>http.logout().logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>).<br>        logoutSuccessUrl(<span class="hljs-string">&quot;/test/hello&quot;</span>).permitAll();<br></code></pre></div></td></tr></table></figure><ul><li>æµ‹è¯•å¯ä»¥å…ˆæˆåŠŸç™»å½•ï¼Œå†è®¿é—®èµ„æºï¼Œé€€å‡ºåå†è®¿é—®ç›¸åŒèµ„æºéœ€è¦ç™»å½•ã€‚</li></ul><h3 id="5-8-RememberMeåŠŸèƒ½"><a href="#5-8-RememberMeåŠŸèƒ½" class="headerlink" title="5.8 RememberMeåŠŸèƒ½"></a>5.8 RememberMeåŠŸèƒ½</h3><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210414195940770.png"></p><ul><li>æ•°æ®åº“åˆ›è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `persistent_logins`  (<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `series` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `token` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `last_used` <span class="hljs-type">timestamp</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`series`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> InnoDB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<br></code></pre></div></td></tr></table></figure><ul><li>é…ç½®ç±»æ³¨å…¥æ•°æ®æºï¼Œé…ç½®æ“ä½œæ•°æ®åº“å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ³¨å…¥æ•°æ®æº</span><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> DataSource dataSource;<br><span class="hljs-comment">//é…ç½®å¯¹è±¡</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> PersistentTokenRepository <span class="hljs-title">persistentTokenRepository</span><span class="hljs-params">()</span> </span>&#123;<br>    JdbcTokenRepositoryImpl jdbcTokenRepository = <span class="hljs-keyword">new</span> JdbcTokenRepositoryImpl();<br>    jdbcTokenRepository.setDataSource(dataSource);<br>    <span class="hljs-comment">//jdbcTokenRepository.setCreateTableOnStartup(true); è‡ªåŠ¨æŠŠè¡¨åˆ›å»º</span><br>    <span class="hljs-keyword">return</span> jdbcTokenRepository;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>é…ç½®ç±»é…ç½®è‡ªåŠ¨ç™»å½•</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">.and()<br>.rememberMe().tokenRepository(persistentTokenRepository()) <span class="hljs-comment">// è®¾ç½®ä½¿ç”¨çš„repository</span><br>.tokenValiditySeconds(<span class="hljs-number">60</span>)   <span class="hljs-comment">//è®¾ç½®æœ‰æ•ˆæ—¶é•¿ï¼Œå•ä½ç§’</span><br>.userDetailsService(userDetailsService);<br></code></pre></div></td></tr></table></figure><ul><li>å‰ç«¯çš„è‡ªåŠ¨ç™»å½•çš„checkboxçš„nameå¿…é¡»æ˜¯ <code>remember-me</code></li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remember-me&quot;</span>/&gt;</span> è‡ªåŠ¨ç™»å½•<br></code></pre></div></td></tr></table></figure><h4 id="ã€ŒRememberMeåŸç†ã€"><a href="#ã€ŒRememberMeåŸç†ã€" class="headerlink" title="ã€ŒRememberMeåŸç†ã€"></a>ã€ŒRememberMeåŸç†ã€</h4><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210413220252425.png"></p><ul><li><p>ç¬¬ä¸€æ¬¡è®¤è¯çš„æµç¨‹èµ°ä¸Šé¢çš„è·¯çº¿ï¼ˆ1-4ï¼‰ï¼Œç¬¬äºŒæ¬¡ï¼ˆ11-14ï¼‰</p></li><li><p>çœ‹åˆ° <code>UsernamePasswordAuthenticationFilter</code> çš„çˆ¶ç±» <code>AbstractAuthenticationProcessingFilter</code>çš„ <code>doFilter</code> æ–¹æ³•åœ¨æˆåŠŸè®¤è¯åï¼Œè°ƒç”¨ <code>successfulAuthentication</code> æ–¹æ³•</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">successfulAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.logger.isDebugEnabled()) &#123;<br>        <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Authentication success. Updating SecurityContextHolder to contain: &quot;</span> + authResult);<br>    &#125;<br><br>    SecurityContextHolder.getContext().setAuthentication(authResult);<br>    <span class="hljs-keyword">this</span>.rememberMeServices.loginSuccess(request, response, authResult);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.eventPublisher != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">this</span>.eventPublisher.publishEvent(<span class="hljs-keyword">new</span> InteractiveAuthenticationSuccessEvent(authResult, <span class="hljs-keyword">this</span>.getClass()));<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>.successHandler.onAuthenticationSuccess(request, response, authResult);<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>this.rememberMeServices.loginSuccess(request, response, authResult);</code>ç»§ç»­è·Ÿè¿›</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RememberMeServices</span> </span>&#123;<br>    <span class="hljs-function">Authentication <span class="hljs-title">autoLogin</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loginFail</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loginSuccess</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2, Authentication var3)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨å…¶å®ç°ç±» <code>AbstractRememberMeServices</code>ä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loginSuccess</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Authentication successfulAuthentication)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.rememberMeRequested(request, <span class="hljs-keyword">this</span>.parameter)) &#123;<br>        <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Remember-me login not requested.&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">this</span>.onLoginSuccess(request, response, successfulAuthentication);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLoginSuccess</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2, Authentication var3)</span></span>;<br></code></pre></div></td></tr></table></figure><ul><li><code>onLoginSuccess</code> ç”±å®ç°ç±» <code>PersistentTokenBasedRememberMeServices</code> å®ç°</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLoginSuccess</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Authentication successfulAuthentication)</span> </span>&#123;<br>    String username = successfulAuthentication.getName();<br>    <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Creating new persistent login for user &quot;</span> + username);<br>    PersistentRememberMeToken persistentToken = <span class="hljs-keyword">new</span> PersistentRememberMeToken(username, <span class="hljs-keyword">this</span>.generateSeriesData(), <span class="hljs-keyword">this</span>.generateTokenData(), <span class="hljs-keyword">new</span> Date());<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">this</span>.tokenRepository.createNewToken(persistentToken);<br>        <span class="hljs-keyword">this</span>.addCookie(persistentToken, request, response);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception var7) &#123;<br>        <span class="hljs-keyword">this</span>.logger.error(<span class="hljs-string">&quot;Failed to save persistent token &quot;</span>, var7);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>this.tokenRepository.createNewToken(persistentToken)</code> é€šè¿‡<code>tokenRepository</code>ï¼Œåˆ›å»ºæ–°Tokenï¼Œç„¶åé€šè¿‡cookieä¼ å›ç»™æµè§ˆå™¨ï¼Œå¦ä¸€è¾¹å†™å…¥æ•°æ®åº“åšå¤‡ä»½ã€‚</li><li>åœ¨ <code>public class JdbcTokenRepositoryImpl</code> ä¸­ä¼šå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œè®©Tokenå­˜å…¥æ•°æ®åº“ä¸­ã€‚</li></ul><hr><ul><li>ã€Œè®°ä½æˆ‘ã€ä¹‹åï¼Œä¸‹æ¬¡çš„è¯·æ±‚è¿‡ç¨‹æ˜¯</li><li>å…ˆè¢« <code>RememberMeAuthenticationFilter</code> è¿‡æ»¤å™¨è¿‡æ»¤ï¼Œå…¶ä¸­çš„ <code>doFilter </code> æ–¹æ³•ä¼šå®Œæˆè‡ªåŠ¨ç™»å½•</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>    HttpServletRequest request = (HttpServletRequest)req;<br>    HttpServletResponse response = (HttpServletResponse)res;<br>    <span class="hljs-keyword">if</span> (SecurityContextHolder.getContext().getAuthentication() == <span class="hljs-keyword">null</span>) &#123;<br>        Authentication rememberMeAuth = <span class="hljs-keyword">this</span>.rememberMeServices.autoLogin(request, response);<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RememberMeServices</span> </span>&#123;<br>    <span class="hljs-function">Authentication <span class="hljs-title">autoLogin</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2)</span></span>;<br></code></pre></div></td></tr></table></figure><ul><li>å®ç°ç±» <code>AbstractRememberMeServices</code> </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Authentication <span class="hljs-title">autoLogin</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<br>    String rememberMeCookie = <span class="hljs-keyword">this</span>.extractRememberMeCookie(request);<br>    <span class="hljs-keyword">if</span> (rememberMeCookie == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Remember-me cookie detected&quot;</span>);<br>        <span class="hljs-keyword">if</span> (rememberMeCookie.length() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Cookie was empty&quot;</span>);<br>            <span class="hljs-keyword">this</span>.cancelCookie(request, response);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            UserDetails user = <span class="hljs-keyword">null</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                String[] cookieTokens = <span class="hljs-keyword">this</span>.decodeCookie(rememberMeCookie);<br>                user = <span class="hljs-keyword">this</span>.processAutoLoginCookie(cookieTokens, request, response);<br>                <span class="hljs-keyword">this</span>.userDetailsChecker.check(user);<br>                <span class="hljs-keyword">this</span>.logger.debug(<span class="hljs-string">&quot;Remember-me cookie accepted&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.createSuccessfulAuthentication(request, user);<br></code></pre></div></td></tr></table></figure><ul><li>å‰é¢åˆ¤ç©ºã€‚ç„¶å try é‡Œå¤´å¯¹cookieè§£ç ï¼Œå†è°ƒç”¨ <code>processAutoLoginCookie</code> </li><li>åœ¨å®ç°ç±»ä¸­ <code>PersistentTokenBasedRememberMeServices</code> </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> UserDetails <span class="hljs-title">processAutoLoginCookie</span><span class="hljs-params">(String[] cookieTokens, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<br>    ....<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getUserDetailsService().loadUserByUsername(token.getUsername());<br></code></pre></div></td></tr></table></figure><ul><li>è°ƒç”¨ <code>loadUserByUsername</code> ï¼Œå³æ¥å£ <code>UserDetailsService</code> é‡Œçš„å®ç°ç±»è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œæ•°æ®åº“çš„æŸ¥è¯¢ï¼Œè¿”å›ä¹‹å‰åœ¨æ•°æ®åº“ä¸­å­˜çš„cookieï¼Œç„¶åè¿›è¡Œ <code>check</code> æ¯”å¯¹ï¼ŒæˆåŠŸåˆ™ç›´æ¥returnï¼Œ<code>createSuccessfulAuthentication</code>æˆåŠŸè®¤è¯ã€‚</li></ul><h3 id="5-9-CSRF"><a href="#5-9-CSRF" class="headerlink" title="5.9 CSRF"></a>5.9 CSRF</h3><ul><li><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºç½‘ç«™è¯»å–å·²ç»å­˜åœ¨çš„cookieç”¨æ¥åšæ¶æ„è®¤è¯ã€‚</p></li><li><p>ä» Spring Security 4.0 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¯ç”¨ CSRF ä¿æŠ¤ï¼Œä»¥é˜²æ­¢ CSRF æ”»å‡»åº”ç”¨ç¨‹åºï¼ŒSpring Security CSRF ä¼šé’ˆå¯¹ <code>PATCH</code>ï¼Œ<code>POST</code>ï¼Œ<code>PUT</code> å’Œ DELETE æ–¹æ³•è¿›è¡Œé˜²æŠ¤ã€‚ä¸»è¦æ˜¯é’ˆå¯¹æ•°æ®åº“æ“ä½œçš„è¯·æ±‚é˜²æŠ¤ã€‚</p></li></ul><ul><li>å¯¼å…¥thymeleaf-security</li></ul><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;!--å¯¹Thymeleafæ·»åŠ Spring Securityæ ‡ç­¾æ”¯æŒ--&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;<br>    &lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨ç™»å½•é¡µé¢æ·»åŠ ä¸€ä¸ª<strong>éšè—åŸŸ</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;input<br>type=&quot;hidden&quot; th:if=&quot;$&#123;_csrf&#125;!=null&quot; th:value=&quot;$&#123;_csrf.token&#125;&quot; name=&quot;_csrf&quot;/&gt;<br></code></pre></div></td></tr></table></figure><ul><li>å…³é—­å®‰å…¨é…ç½®çš„ç±»ä¸­çš„ csrf</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// http.csrf().disable();</span><br></code></pre></div></td></tr></table></figure><hr><h4 id="ã€ŒåŸç†ã€"><a href="#ã€ŒåŸç†ã€" class="headerlink" title="ã€ŒåŸç†ã€"></a>ã€ŒåŸç†ã€</h4><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210414211832498.png"></p><ol><li>ç”Ÿæˆ csrfToken ä¿å­˜åˆ° HttpSession æˆ–è€… Cookie ä¸­</li></ol><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210414220149644.png"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CsrfToken</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-function">String <span class="hljs-title">getHeaderName</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">getParameterName</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">getToken</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>SaveOnAccessCsrfToken</code> ç±»æœ‰ä¸ªæ¥å£ <code>CsrfTokenRepository</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaveOnAccessCsrfToken</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CsrfToken</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> CsrfTokenRepository tokenRepository;<br></code></pre></div></td></tr></table></figure><ul><li>å…¶å®ç°ç±» <code>HttpSessionCsrfTokenRepository</code>  <code>CookieCsrfTokenRepository</code></li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringSecurity/image-20210414220605226.png"></p><ul><li><code>CookieCsrfTokenRepository</code> æˆªå–éƒ¨åˆ†</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">public final <span class="hljs-keyword">class</span> CookieCsrfTokenRepository implements CsrfTokenRepository &#123;<br>    <span class="hljs-keyword">private</span> String parameterName = <span class="hljs-string">&quot;_csrf&quot;</span>;<br>    <br>    public CsrfToken generate<span class="hljs-constructor">Token(HttpServletRequest <span class="hljs-params">request</span>)</span> &#123;<br>        return <span class="hljs-keyword">new</span> <span class="hljs-constructor">DefaultCsrfToken(<span class="hljs-params">this</span>.<span class="hljs-params">headerName</span>, <span class="hljs-params">this</span>.<span class="hljs-params">parameterName</span>, <span class="hljs-params">this</span>.<span class="hljs-params">createNewToken</span>()</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> String create<span class="hljs-constructor">NewToken()</span> &#123;<br>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UUID</span>.</span></span>random<span class="hljs-constructor">UUID()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä»è¯·æ±‚ä¸­æå– csrfTokenï¼Œå’Œä¿å­˜çš„ csrfToken åšæ¯”è¾ƒï¼Œè¿›è€Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚ä¸»è¦é€šè¿‡ <code>CsrfFilter</code> è¿‡æ»¤å™¨æ¥å®Œæˆã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CsrfFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OncePerRequestFilter</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CsrfTokenRepository tokenRepository;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        request.setAttribute(HttpServletResponse.class.getName(), response);<br>        CsrfToken csrfToken = <span class="hljs-keyword">this</span>.tokenRepository.loadToken(request);<br>        <span class="hljs-keyword">boolean</span> missingToken = csrfToken == <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">if</span> (missingToken) &#123;<br>            csrfToken = <span class="hljs-keyword">this</span>.tokenRepository.generateToken(request);<br>            <span class="hljs-keyword">this</span>.tokenRepository.saveToken(csrfToken, request, response);<br>        &#125;<br><br>        request.setAttribute(CsrfToken.class.getName(), csrfToken);<br>        <span class="hljs-comment">// key: _csrf  value: token</span><br>        request.setAttribute(csrfToken.getParameterName(), csrfToken);<br>        <span class="hljs-comment">// éªŒè¯æ˜¯å¦åŒ¹é…æ­£ç¡®</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.requireCsrfProtectionMatcher.matches(request)) &#123; <br>            filterChain.doFilter(request, response);<br>        &#125;<br>        ...<br></code></pre></div></td></tr></table></figure><h3 id="åŸºäºå¾®æœåŠ¡å’Œjwtå¾…ç»­ã€‚ã€‚ã€‚"><a href="#åŸºäºå¾®æœåŠ¡å’Œjwtå¾…ç»­ã€‚ã€‚ã€‚" class="headerlink" title="åŸºäºå¾®æœåŠ¡å’Œjwtå¾…ç»­ã€‚ã€‚ã€‚"></a>åŸºäºå¾®æœåŠ¡å’Œjwtå¾…ç»­ã€‚ã€‚ã€‚</h3><blockquote><p>é¸£è°¢ï¼š</p><p><a href="https://docs.spring.io/spring-security/site/docs/5.3.4.RELEASE/reference/html5/#servlet-hello">https://docs.spring.io/spring-security/site/docs/5.3.4.RELEASE/reference/html5/#servlet-hello</a></p><p><a href="https://www.bilibili.com/video/BV1VE411h7aL">https://www.bilibili.com/video/BV1VE411h7aL</a></p><p><a href="https://www.bilibili.com/video/BV15a411A7kP?from=search&amp;seid=12610921816944973603">https://www.bilibili.com/video/BV15a411A7kP?from=search&amp;seid=12610921816944973603</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Security</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot 2.3.4</title>
    <link href="/2021/04/05/SpringBoot/SpringBoot/"/>
    <url>/2021/04/05/SpringBoot/SpringBoot/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot-Notes"><a href="#SpringBoot-Notes" class="headerlink" title="SpringBoot Notes"></a>SpringBoot Notes</h1><blockquote><p>æœ¬æ–‡åŸºäºSpringBoot 2.3.4.RELEASE</p></blockquote><h2 id="ä¸€ã€SpringBootç®€ä»‹"><a href="#ä¸€ã€SpringBootç®€ä»‹" class="headerlink" title="ä¸€ã€SpringBootç®€ä»‹"></a>ä¸€ã€SpringBootç®€ä»‹</h2><p><strong>å®˜ç½‘ä»‹ç»</strong>ï¼š</p><blockquote><ul><li>Create stand-alone Spring applications</li><li>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)</li><li>Provide opinionated â€˜starterâ€™ dependencies to simplify your build configuration</li><li>Automatically configure Spring and 3rd party libraries whenever possible</li><li>Provide production-ready features such as metrics, health checks, and externalized configuration</li><li>Absolutely no code generation and no requirement for XML configuration</li></ul></blockquote><ul><li>åˆ›å»ºç‹¬ç«‹çš„<code>spring</code>åº”ç”¨ã€‚</li><li>åµŒå…¥<code>Tomcat</code>, <code>Jetty</code> <code>Undertow</code> è€Œä¸”ä¸éœ€è¦éƒ¨ç½²ä»–ä»¬ã€‚</li><li>æä¾›çš„â€œstartersâ€ pomsæ¥ç®€åŒ–<code>Maven</code>é…ç½®</li><li>å°½å¯èƒ½è‡ªåŠ¨é…ç½®<code>spring</code>åº”ç”¨ã€‚</li><li>æä¾›ç”Ÿäº§æŒ‡æ ‡,å¥å£®æ£€æŸ¥å’Œå¤–éƒ¨åŒ–é…ç½®</li><li>ç»å¯¹æ²¡æœ‰ä»£ç ç”Ÿæˆå’Œ<code>XML</code>é…ç½®è¦æ±‚ã€‚</li></ul><p>ä¸€èˆ¬æŠŠSpring Bootç§°ä¸ºæ­å»ºç¨‹åºçš„ è„šæ‰‹æ¶ æˆ–è€…è¯´æ˜¯<strong>ä¾¿æ·æ­å»º åŸºäºSpringçš„å·¥ç¨‹ è„šæ‰‹æ¶</strong>ã€‚å…¶æœ€ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©å¼€<br>å‘äººå‘˜å¿«é€Ÿçš„æ„å»ºåºå¤§çš„springé¡¹ç›®ï¼Œå¹¶ä¸”å°½å¯èƒ½çš„å‡å°‘ä¸€åˆ‡xmlé…ç½®ï¼Œåšåˆ°å¼€ç®±å³ç”¨ï¼Œè¿…é€Ÿä¸Šæ‰‹ï¼Œè®©å¼€å‘äººå‘˜å…³æ³¨ä¸šåŠ¡è€Œéé…ç½®ã€‚</p><h3 id="æ—¶ä»£èƒŒæ™¯"><a href="#æ—¶ä»£èƒŒæ™¯" class="headerlink" title="æ—¶ä»£èƒŒæ™¯"></a>æ—¶ä»£èƒŒæ™¯</h3><p>SpringBootåŸºäº<strong>å¾®æœåŠ¡</strong>ä»¥åŠ<strong>åˆ†å¸ƒå¼</strong></p><h2 id="äºŒã€SpringBootåŸºç¡€"><a href="#äºŒã€SpringBootåŸºç¡€" class="headerlink" title="äºŒã€SpringBootåŸºç¡€"></a>äºŒã€SpringBootåŸºç¡€</h2><h3 id="2-1-SpringBoot-ç‰¹ç‚¹"><a href="#2-1-SpringBoot-ç‰¹ç‚¹" class="headerlink" title="2.1 SpringBoot ç‰¹ç‚¹"></a>2.1 SpringBoot ç‰¹ç‚¹</h3><h4 id="2-1-1-ä¾èµ–ç®¡ç†"><a href="#2-1-1-ä¾èµ–ç®¡ç†" class="headerlink" title="2.1.1 ä¾èµ–ç®¡ç†"></a>2.1.1 ä¾èµ–ç®¡ç†</h4><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>å…¶çˆ¶é¡¹ç›®, è‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>è‡ªå®šä¹‰ç‰ˆæœ¬å·</li><li>1ã€æŸ¥çœ‹spring-boot-dependenciesé‡Œé¢è§„å®šå½“å‰ä¾èµ–çš„ç‰ˆæœ¬ ç”¨çš„ keyã€‚</li><li>2ã€åœ¨å½“å‰é¡¹ç›®é‡Œé¢é‡å†™é…ç½®ï¼Œå¦‚ä¸‹è‡ªå®šä¹‰mysql çš„ç‰ˆæœ¬</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.43<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h5 id="åŸºç¡€ä¾èµ–"><a href="#åŸºç¡€ä¾èµ–" class="headerlink" title="åŸºç¡€ä¾èµ–"></a>åŸºç¡€ä¾èµ–</h5><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></div></td></tr></table></figure><ul><li>spring-boot-starterï¼šspring bootåœºæ™¯å¯åŠ¨å™¨</li><li>SpringæŠŠæ¯ä¸ªåœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆäº†ä¸€ä¸ªä¸ªstarts</li><li>å¦‚æˆ‘ä»¬éœ€è¦é‚£ä¸ªåœºæ™¯åªéœ€è¦æŠŠå¯¹åº”çš„å¯åŠ¨å™¨æ¥å¯¼å…¥è¿›æ¥å°±å¯ä»¥ï¼Œä¸ç”¨æ‹…å¿ƒç‰ˆæœ¬ã€‚</li><li>ç”¨ä»€ä¹ˆåŠŸèƒ½(Webã€ç¼“å­˜ã€kafkaç­‰ç­‰)å¯¼å…¥ç›¸å…³å¯åŠ¨å™¨å³å¯</li></ul><h5 id="æ³¨è§£åŒºåˆ«"><a href="#æ³¨è§£åŒºåˆ«" class="headerlink" title="æ³¨è§£åŒºåˆ«"></a>æ³¨è§£åŒºåˆ«</h5><ul><li><code>@Controller</code>å’Œ<code>@RestController</code>çš„åŒºåˆ«</li></ul><p><code>@RestController</code>æ³¨è§£ç›¸å½“äº<code>@ResponseBody</code> ï¼‹ <code>@Controller</code>åˆåœ¨ä¸€èµ·çš„ä½œç”¨ã€‚</p><ol><li>å¦‚æœåªæ˜¯ä½¿ç”¨@RestControlleræ³¨è§£Controllerï¼Œåˆ™Controllerä¸­çš„æ–¹æ³•æ— æ³•è¿”å›jspé¡µ<br>é¢ï¼Œæˆ–è€…htmlï¼Œé…ç½®çš„è§†å›¾è§£æå™¨ <code>InternalResourceViewResolver</code>ä¸èµ·ä½œç”¨ï¼Œè¿”å›<br>çš„å†…å®¹å°±æ˜¯ Return é‡Œçš„å†…å®¹ã€‚</li><li>å¦‚æœéœ€è¦è¿”å›åˆ°æŒ‡å®šé¡µé¢ï¼Œåˆ™éœ€è¦ç”¨ @Controller é…åˆ<strong>è§†å›¾è§£æå™¨</strong><br>InternalResourceViewResolveræ‰è¡Œã€‚ å¦‚æœéœ€è¦è¿”å›JSONï¼ŒXMLæˆ–è‡ªå®šä¹‰<br>mediaTypeå†…å®¹åˆ°é¡µé¢ï¼Œåˆ™éœ€è¦åœ¨å¯¹åº”çš„æ–¹æ³•ä¸ŠåŠ ä¸Š@ResponseBodyæ³¨è§£ã€‚</li></ol><p>å³ï¼š</p><ol><li>ä½¿ç”¨@Controller æ³¨è§£</li></ol><ul><li>åœ¨å¯¹åº”çš„æ–¹æ³•ä¸Šï¼Œè§†å›¾è§£æå™¨å¯ä»¥è§£æreturn çš„jsp,htmlé¡µé¢ï¼Œå¹¶ä¸”è·³è½¬åˆ°ç›¸åº”é¡µé¢</li><li>è‹¥è¿”å›jsonç­‰å†…å®¹åˆ°é¡µé¢ï¼Œåˆ™éœ€è¦åŠ @ResponseBodyæ³¨è§£</li></ul><ol start="2"><li>@RestControlleræ³¨è§£</li></ol><ul><li><p>ç›¸å½“äº@Controller+@ResponseBodyä¸¤ä¸ªæ³¨è§£çš„ç»“åˆã€‚</p></li><li><p>è¿”å›jsonæ•°æ®ä¸éœ€è¦åœ¨æ–¹æ³•å‰é¢åŠ @ResponseBodyæ³¨è§£äº†</p></li><li><p>ä½¿ç”¨@RestControllerè¿™ä¸ªæ³¨è§£ï¼Œå°±ä¸èƒ½è¿”å›jsp,htmlé¡µé¢ï¼Œè§†å›¾è§£æå™¨æ— æ³•è§£æ</p><p>jsp,htmlé¡µé¢</p></li></ul><h5 id="æ‰“åŒ…æ’ä»¶"><a href="#æ‰“åŒ…æ’ä»¶" class="headerlink" title="æ‰“åŒ…æ’ä»¶"></a>æ‰“åŒ…æ’ä»¶</h5><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡ŒJaråŒ…ï¼Œç›´æ¥ä½¿ç”¨java -jar xxxxçš„å‘½ä»¤æ¥æ‰§è¡Œ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="2-1-2-è‡ªåŠ¨é…ç½®"><a href="#2-1-2-è‡ªåŠ¨é…ç½®" class="headerlink" title="2.1.2 è‡ªåŠ¨é…ç½®"></a>2.1.2 è‡ªåŠ¨é…ç½®</h4><ul><li>ä»¥ <code>spring-boot-starter-web</code> ä¸ºä¾‹ï¼Œè¿›å…¥çˆ¶å·¥ç¨‹å¯å‘ç°</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>Tomcat<ul><li>é…ç½®äº†Tomcat</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li><strong>SpringMVC</strong><ul><li>è‡ªåŠ¨é…ç½®MVCå¸¸ç”¨ç»„ä»¶</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.9.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li><strong>Web</strong><ul><li>è‡ªåŠ¨é…ç½®å¥½Webå¸¸è§åœºæ™¯ï¼Œæ¯”å¦‚<strong>å­—ç¬¦ç¼–ç é—®é¢˜</strong>ã€‚</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.9.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li><p><strong>é»˜è®¤åŒ…ç»“æ„</strong></p><ul><li>ä¸»ç¨‹åºæ‰€åœ¨åŒ…ä¸‹æ‰€æœ‰è‡ªåŒ…çš„ç»„ä»¶éƒ½ä¼šé»˜è®¤æ‰«æï¼Œä¸éœ€è¦ä»¥å‰çš„åŒ…æ‰«æé…ç½®</li><li>æƒ³è¦æ”¹å˜æ‰«æè·¯åŠ²ï¼š<code>@SpringBootApplication(scanBasePackages=&quot;com.xxx&quot;)</code>æˆ– <code>@ComponentScan æŒ‡å®šæ‰«æè·¯å¾„</code></li></ul></li><li><p>å„ç§é…ç½®æ‹¥æœ‰é»˜è®¤å€¼</p></li><li><ul><li>é»˜è®¤é…ç½®æœ€ç»ˆéƒ½æ˜¯æ˜ å°„åˆ°æŸä¸ªç±»ä¸Šï¼Œå¦‚ï¼šMultipartProperties</li><li>é…ç½®æ–‡ä»¶çš„å€¼æœ€ç»ˆä¼šç»‘å®šæ¯ä¸ªç±»ä¸Šï¼Œè¿™ä¸ªç±»ä¼šåœ¨å®¹å™¨ä¸­åˆ›å»ºå¯¹è±¡</li></ul></li><li><p>æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹</p></li><li><ul><li>éå¸¸å¤šçš„starter</li><li>å¼•å…¥äº†å“ªäº›åœºæ™¯è¿™ä¸ªåœºæ™¯çš„è‡ªåŠ¨é…ç½®æ‰ä¼šå¼€å¯</li><li>SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨ <code>spring-boot-autoconfigure</code> åŒ…é‡Œé¢</li></ul></li></ul><h3 id="2-2-å®¹å™¨åŠŸèƒ½"><a href="#2-2-å®¹å™¨åŠŸèƒ½" class="headerlink" title="2.2 å®¹å™¨åŠŸèƒ½"></a>2.2 å®¹å™¨åŠŸèƒ½</h3><h5 id="2-2-1-ç»„ä»¶æ·»åŠ "><a href="#2-2-1-ç»„ä»¶æ·»åŠ " class="headerlink" title="2.2.1  ç»„ä»¶æ·»åŠ "></a>2.2.1  ç»„ä»¶æ·»åŠ </h5><ul><li><code>@Configuration</code></li></ul><ol><li><p>é…ç½®ç±»é‡Œé¢ä½¿ç”¨@Beanæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šç»™å®¹å™¨æ³¨å†Œç»„ä»¶ï¼Œé»˜è®¤ä¹Ÿæ˜¯å•å®ä¾‹çš„</p></li><li><p>é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ç»„ä»¶</p></li><li><p><strong>proxyBeanMethods</strong>ï¼šä»£ç†beançš„æ–¹æ³•ã€‚</p><ul><li><code>Full</code>(proxyBeanMethods = <strong>true</strong>) ã€Œä¿è¯æ¯ä¸ª<code>@Bean</code>æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯<strong>å•å®ä¾‹</strong>çš„ã€</li><li><code>Lite</code>(proxyBeanMethods = <strong>false</strong>)ã€Œæ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„ã€â€˜</li></ul><p>ç»„ä»¶ä¾èµ–å¿…é¡»ä½¿ç”¨Fullæ¨¡å¼é»˜è®¤ã€‚å…¶ä»–é»˜è®¤æ˜¯å¦Liteæ¨¡å¼ã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">#####################Configurationä½¿ç”¨ç¤ºä¾‹#####################<br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span> <span class="hljs-comment">//å‘Šè¯‰SpringBootè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» == é…ç½®æ–‡ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Full:å¤–éƒ¨æ— è®ºå¯¹é…ç½®ç±»ä¸­çš„è¿™ä¸ªç»„ä»¶æ³¨å†Œæ–¹æ³•è°ƒç”¨å¤šå°‘æ¬¡è·å–çš„éƒ½æ˜¯ä¹‹å‰æ³¨å†Œå®¹å™¨ä¸­çš„å•å®ä¾‹å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span> <span class="hljs-comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚ä»¥æ–¹æ³•åä½œä¸ºç»„ä»¶çš„idã€‚è¿”å›ç±»å‹å°±æ˜¯ç»„ä»¶ç±»å‹ã€‚è¿”å›çš„å€¼ï¼Œå°±æ˜¯ç»„ä»¶åœ¨å®¹å™¨ä¸­çš„å®ä¾‹</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">user01</span><span class="hljs-params">()</span></span>&#123;<br>        User zhangsan = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">18</span>);<br>        <span class="hljs-comment">//userç»„ä»¶ä¾èµ–äº†Petç»„ä»¶</span><br>        zhangsan.setPet(tomcatPet());<br>        <span class="hljs-keyword">return</span> zhangsan;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(&quot;tom&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Pet <span class="hljs-title">tomcatPet</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pet(<span class="hljs-string">&quot;tomcat&quot;</span>);<br>    &#125;<br>&#125;<br>#####################Configurationæµ‹è¯•ä»£ç å¦‚ä¸‹#####################<br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.atguigu.boot&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainApplication</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//1ã€è¿”å›æˆ‘ä»¬IOCå®¹å™¨</span><br>        ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);<br><br>        <span class="hljs-comment">//2ã€æŸ¥çœ‹å®¹å™¨é‡Œé¢çš„ç»„ä»¶</span><br>        String[] names = run.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br><br>        <span class="hljs-comment">//3ã€ä»å®¹å™¨ä¸­è·å–ç»„ä»¶</span><br>        Pet tom01 = run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br><br>        Pet tom02 = run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br><br>        System.out.println(<span class="hljs-string">&quot;ç»„ä»¶ï¼š&quot;</span>+(tom01 == tom02));<br><br>        <span class="hljs-comment">//4ã€com.atguigu.boot.config.MyConfig$$EnhancerBySpringCGLIB$$51f1e1ca@1654a892</span><br>        MyConfig bean = run.getBean(MyConfig.class);<br>        System.out.println(bean);<br><br>        <span class="hljs-comment">//å¦‚æœ@Configuration(proxyBeanMethods = true)ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ã€‚SpringBootæ€»ä¼šæ£€æŸ¥è¿™ä¸ªç»„ä»¶æ˜¯å¦åœ¨å®¹å™¨ä¸­æœ‰ã€‚</span><br>        <span class="hljs-comment">//ä¿æŒç»„ä»¶å•å®ä¾‹</span><br>        User user = bean.user01();<br>        User user1 = bean.user01();<br>        System.out.println(user == user1);<br><br>        User user01 = run.getBean(<span class="hljs-string">&quot;user01&quot;</span>, User.class);<br>        Pet tom = run.getBean(<span class="hljs-string">&quot;tom&quot;</span>, Pet.class);<br><br>        System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·çš„å® ç‰©ï¼š&quot;</span>+(user01.getPet() == tom));<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><hr><ul><li><code>@Bean</code>ã€<code>@Component</code>ã€<code>@Controller</code>ã€<code>@Service</code>ã€<code>@Repository</code></li></ul><p>ç…§å¸¸ä½¿ç”¨å³å¯ã€‚</p><hr><ul><li><code>@ComponentScan</code>ã€ <code>@Import</code><ul><li>å‰é¢è‡ªå®šä¹‰æ‰«æåŒ…ç”¨åˆ°äº†@ComponentScanï¼Œç”¨æ¥æ‰«ææ‰€æœ‰çš„ç»„ä»¶</li><li>@Import ç»™å®¹å™¨ä¸­è‡ªåŠ¨åˆ›å»ºå‡ºè¿™å¯¹åº”ç±»å‹çš„ç»„ä»¶ã€é»˜è®¤ç»„ä»¶çš„åå­—å°±æ˜¯å…¨ç±»å</li></ul></li></ul><hr><ul><li><code>@Conditional</code><ul><li>æ¡ä»¶è£…é…ï¼Œæ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶è¿›è¡Œæ³¨å…¥ã€‚</li><li>Ctrl + H (Intellij IDEA) æ‰“å¼€@Conditionalçš„å®ç°ç±»</li></ul></li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/@Conditional.png" alt="@Conditional"></p><ul><li>ConditionalOnMissingClass - ä¸å­˜åœ¨æŸä¸ªç±»æ—¶æ³¨å…¥</li><li>ConditionalOnBean - å­˜åœ¨æŸä¸ªBeanæ—¶æ³¨å…¥</li><li>å…¶ä½™çš„æ ¹æ®åå­—å¯ä»¥åˆ¤æ–­å«ä¹‰</li></ul><hr><h5 id="2-2-2-åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥"><a href="#2-2-2-åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥" class="headerlink" title="2.2.2 åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥"></a>2.2.2 åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥</h5><ul><li><code>@ImportResource</code><ul><li>@ImportResource(â€œclasspath:beans.xmlâ€)å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶</li><li>ç”¨äºå·²ç»æœ‰å¤§é‡Beanåœ¨xmlæ–‡ä»¶ä¸­æ³¨å…¥äº†ï¼Œå°±ä½¿ç”¨æ­¤æ–¹å¼å¯¼å…¥ã€‚å¯ç”¨äºè€é¡¹ç›®æ›´æ–°è¿­ä»£ã€‚</li></ul></li></ul><hr><h5 id="2-2-3-é…ç½®ç»‘å®š"><a href="#2-2-3-é…ç½®ç»‘å®š" class="headerlink" title="2.2.3 é…ç½®ç»‘å®š"></a>2.2.3 é…ç½®ç»‘å®š</h5><ul><li><p>1.<code>@ConfigurationProperties</code> <strong>+</strong> <code>@Component</code></p><ul><li><p>åœ¨å®ä½“ç±»ä¸ŠåŠ ä¸Šæ³¨è§£ @Component å’Œ @ConfigurationProperties</p></li><li><p>@Componentè®©å®ä½“ç±»æˆä¸ºå®¹å™¨ç»„ä»¶ï¼Œæ‰èƒ½è®©åº•å±‚è‡ªåŠ¨é…ç½®</p></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;&#125;<br></code></pre></div></td></tr></table></figure><ul><li>2.<code>@EnableConfigurationProperties</code> <strong>+</strong> <code>@ConfigurationProperties</code><ul><li>åœ¨é…ç½®ç±»ä¸ŠåŠ ä¸Š@EnableConfigurationPropertiesï¼Œå¼€å¯Carç±»çš„ç»‘å®šåŠŸèƒ½</li><li>@ConfigurationPropertiesåŠ è½½å®ä½“ç±»ä¸Šï¼Œprefix = â€œå‰ç¼€â€</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(Car.class)</span><br><span class="hljs-comment">//1ã€å¼€å¯Caré…ç½®ç»‘å®šåŠŸèƒ½</span><br><span class="hljs-comment">//2ã€æŠŠè¿™ä¸ªCarè¿™ä¸ªç»„ä»¶è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>&#123;&#125;<br></code></pre></div></td></tr></table></figure><h3 id="2-3-è‡ªåŠ¨é…ç½®åŸç†"><a href="#2-3-è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="2.3 è‡ªåŠ¨é…ç½®åŸç†"></a>2.3 è‡ªåŠ¨é…ç½®åŸç†</h3><h4 id="2-3-1-å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»"><a href="#2-3-1-å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="2.3.1 å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»"></a>2.3.1 å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»</h4><ul><li>åœ¨å¯åŠ¨ç±»MainApplicationå¤´éƒ¨åŠ ä¸Šæ³¨è§£ <code>@SpringBootApplication</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="hljs-meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication &#123;...&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>@SpringBootConfiguration</code><ul><li>æœ€é‡è¦çš„å°±æ˜¯ <code>@Configuration</code>ï¼Œè¡¨æ˜å¯åŠ¨ç±»MainApplicationå°±æ˜¯ä¸€ä¸ª<strong>é…ç½®ç±»</strong></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration &#123;...&#125;<br></code></pre></div></td></tr></table></figure><ul><li><code>@ComponentScan</code></li></ul><blockquote><p>Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <a href="context:component-scan">context:component-scan</a> element.<br>Either basePackageClasses or basePackages (or its alias value) may be specified to define specific packages to scan. If specific packages are not defined, scanning will occur from the package of the class that declares this annotation.</p></blockquote><ol><li>è¯¥æ³¨è§£ç›¸å½“äºXMLæ–‡ä»¶çš„<code>&lt;context:component-scan&gt;</code>é…ç½®</li><li>å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰æ‰«æçš„åŒ…ï¼Œé»˜è®¤æ‰«æ<strong>å£°æ˜è¯¥æ³¨è§£çš„ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…</strong>ã€‚æ‰€ä»¥å¯åŠ¨ç±»æ‰åº”è¯¥ä¸æ§åˆ¶å™¨åŒ…åŒçº§ã€‚</li></ol><ul><li><code>@EnableAutoConfiguration</code><ul><li>å¼€å¯è‡ªåŠ¨é…ç½®</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;...&#125;<br></code></pre></div></td></tr></table></figure><p>å…ˆçœ‹ç¬¬ä¸€ä¸ªæ³¨è§£ï¼šè¿›å…¥<code>@AutoConfigurationPackage</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Import(AutoConfigurationPackages.Registrar.class)</span><span class="hljs-comment">//ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage &#123;...&#125;<br><span class="hljs-comment">//åˆ©ç”¨Registrarç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ç³»åˆ—ç»„ä»¶</span><br><span class="hljs-comment">//å°†æŒ‡å®šçš„ä¸€ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶å¯¼å…¥è¿›æ¥ -&gt; MainApplication æ‰€åœ¨åŒ…ä¸‹ã€‚</span><br></code></pre></div></td></tr></table></figure><blockquote><p>Registers packages with AutoConfigurationPackages. When no base packages or base package classes are specified, the package of the annotated class is registered.</p></blockquote><ol><li>å‘AutoConfigurationPackagesæ³¨å†ŒåŒ…</li><li>å¦‚æœæœªæŒ‡å®šåŸºåŒ…æˆ–åŸºåŒ…ç±»ï¼Œåˆ™ä¼šæ³¨å†Œå¸¦æ³¨é‡Šç±»çš„åŒ…ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AutoConfigurationPackages</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>Class for storing auto-configuration packages for reference later (e.g. by JPA entity scanner).</p></blockquote><ol><li>ç”¨äºå­˜å‚¨è‡ªåŠ¨é…ç½®åŒ…ä»¥ä¾›ä»¥åå‚è€ƒçš„ç±»ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡JPAå®ä½“æ‰«æä»ªï¼‰</li></ol><p>å†çœ‹åˆ°<code>AutoConfigurationPackages.Registrar.class</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Registrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ImportBeanDefinitionRegistrar</span>, <span class="hljs-title">DeterminableImports</span> </span>&#123;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;<br>      register(registry, <span class="hljs-keyword">new</span> PackageImports(metadata).getPackageNames().toArray(<span class="hljs-keyword">new</span> String[<span class="hljs-number">0</span>]));<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">determineImports</span><span class="hljs-params">(AnnotationMetadata metadata)</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-keyword">new</span> PackageImports(metadata));<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç»™ <code>register</code>æ–¹æ³•æ‰“æ–­ç‚¹ï¼Œå¹¶å¯åŠ¨ç¨‹åºã€‚</p><p>è®¡ç®— <code>new PackageImports(metadata).getPackageNames()</code>çš„å€¼ï¼Œ(Alt + F8 Intellij IDEA)</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/register%E6%96%AD%E7%82%B9%E4%BF%A1%E6%81%AF.png" alt="registeræ–­ç‚¹ä¿¡æ¯"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/%E8%AE%A1%E7%AE%97%E5%8C%85%E5%90%8D.png" alt="è®¡ç®—åŒ…å"></p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/%E5%8C%85%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="åŒ…ç›®å½•ç»“æ„"></p><ol><li>metedataå…ƒæ•°æ®ï¼ŒintrospectedClassæ˜¯å¯åŠ¨ç±»ã€‚å› ä¸ºè¯¥æ³¨è§£æ˜¯åŠ åœ¨å¯åŠ¨ç±»ä¸Šçš„ã€‚</li><li>ç„¶åè·å¾—å¯åŠ¨ç±»æ‰€åœ¨çš„æ ¹ç›®å½•æŠ¥åï¼Œæœ€å<code>toArray(new String[0])</code>ï¼Œå°è£…æˆä¸€ä¸ªæ•°ç»„æ³¨å†Œã€‚</li></ol><hr><p>ç„¶åæ˜¯ç¬¬äºŒä¸ªæ³¨è§£ï¼š<code>@Import(AutoConfigurationImportSelector.class)</code></p><p>è¿›å…¥ <code>AutoConfigurationImportSelector</code>ï¼Œé‡å†™äº†å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;<br>   <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>      <span class="hljs-keyword">return</span> NO_IMPORTS;<br>   &#125;<br>   AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(annotationMetadata);<br>   <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(annotationMetadata);</code> ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> </span>&#123;<br>   <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>      <span class="hljs-keyword">return</span> EMPTY_ENTRY;<br>   &#125;<br>   AnnotationAttributes attributes = getAttributes(annotationMetadata);<br>   List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);<br>   configurations = removeDuplicates(configurations);<br>   Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);<br>   checkExcludedClasses(configurations, exclusions);<br>   configurations.removeAll(exclusions);<br>   configurations = getConfigurationClassFilter().filter(configurations);<br>   fireAutoConfigurationImportEvents(configurations, exclusions);<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AutoConfigurationEntry(configurations, exclusions);<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</code>è·å–æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±»ã€‚æ‰“æ–­ç‚¹è§‚å¯Ÿï¼š</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/%E8%8E%B7%E5%8F%96%E9%9C%80%E8%A6%81%E7%9A%84%E9%85%8D%E7%BD%AE%E7%B1%BB.png" alt="è·å–éœ€è¦çš„é…ç½®ç±»"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;<br>   List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),<br>         getBeanClassLoader());<br>   Assert.notEmpty(configurations, <span class="hljs-string">&quot;No auto configuration classes found in META-INF/spring.factories. If you &quot;</span><br>         + <span class="hljs-string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span>);<br>   <span class="hljs-keyword">return</span> configurations;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>é€šè¿‡ <code>SpringFactoriesLoader</code> å·¥å‚ç±»æ¥åŠ è½½è¿™äº›é…ç½®ç±»ã€‚</p></li><li><p><code>META-INF/spring.factories</code> è¿™ä¸ªç›®å½•ä¸‹æœ‰ç›¸åº”çš„é…ç½®å†…å®¹ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title">loadFactoryNames</span><span class="hljs-params">(Class&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;<br>    String factoryTypeName = factoryType.getName();<br>    <span class="hljs-keyword">return</span> (List)loadSpringFactories(classLoader).getOrDefault(factoryTypeName, Collections.emptyList());<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="hljs-meta">@Nullable</span> ClassLoader classLoader) &#123;<br></code></pre></div></td></tr></table></figure><ul><li>åˆ©ç”¨å·¥å‚åŠ è½½ Map&lt;String, List<String>&gt; loadSpringFactories(@Nullable ClassLoader classLoader)ï¼›å¾—åˆ°æ‰€æœ‰çš„ç»„ä»¶</li><li>é»˜è®¤æ‰«ææˆ‘ä»¬å½“å‰ç³»ç»Ÿé‡Œé¢æ‰€æœ‰<code>META-INF/spring.factories</code>ä½ç½®çš„æ–‡ä»¶</li><li>spring-boot-autoconfigure-2.3.4.RELEASE.jaråŒ…é‡Œé¢ä¹Ÿæœ‰META-INF/spring.factories</li></ul><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/springFactories.png" alt="springFactories"></p><h4 id="2-3-2-æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹"><a href="#2-3-2-æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹" class="headerlink" title="2.3.2 æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹"></a>2.3.2 æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹</h4><p>è™½ç„¶é»˜è®¤åŠ è½½äº†å¾ˆå¤šè‡ªåŠ¨é…ç½®ç±»ï¼Œä½†æ˜¯è¿™äº›è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šåŠ ä¸Šä¸€äº›æ¡ä»¶çš„æ³¨è§£ã€‚<code>@ConditionalOnClass</code>ç­‰ æ¥é™å®šå®ƒä»¬çš„å¼€å¯ã€‚</p><h4 id="2-3-3-ä¿®æ”¹é»˜è®¤é…ç½®"><a href="#2-3-3-ä¿®æ”¹é»˜è®¤é…ç½®" class="headerlink" title="2.3.3 ä¿®æ”¹é»˜è®¤é…ç½®"></a>2.3.3 ä¿®æ”¹é»˜è®¤é…ç½®</h4><ul><li><p>SpringBoot å…ˆåŠ è½½æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»  <code>xxxxxAutoConfiguration</code></p></li><li><p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»<strong>æŒ‰ç…§æ¡ä»¶</strong>è¿›è¡Œç”Ÿæ•ˆï¼Œé»˜è®¤éƒ½ä¼š<strong>ç»‘å®šé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼</strong>ã€‚xxxxPropertiesé‡Œé¢æ‹¿ã€‚xxxPropertieså’Œé…ç½®æ–‡ä»¶è¿›è¡Œäº†ç»‘å®š</p></li><li><p>ç”Ÿæ•ˆçš„é…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­è£…é…å¾ˆå¤šç»„ä»¶</p></li><li><p>åªè¦å®¹å™¨ä¸­æœ‰è¿™äº›ç»„ä»¶ï¼Œç›¸å½“äºè¿™äº›åŠŸèƒ½å°±æœ‰äº†</p></li><li><p>å®šåˆ¶åŒ–é…ç½®</p></li><li><ul><li>ç”¨æˆ·ç›´æ¥è‡ªå·±@Beanæ›¿æ¢åº•å±‚çš„ç»„ä»¶</li><li>ç”¨æˆ·å»çœ‹è¿™ä¸ªç»„ä»¶æ˜¯è·å–çš„é…ç½®æ–‡ä»¶ä»€ä¹ˆå€¼å°±å»ä¿®æ”¹ã€‚</li></ul></li></ul><h4 id="2-3-4-å®è·µ"><a href="#2-3-4-å®è·µ" class="headerlink" title="2.3.4 å®è·µ"></a>2.3.4 å®è·µ</h4><ul><li><p>å¼•å…¥åœºæ™¯ä¾èµ–</p></li><li><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></li></ul></li><li><p>æŸ¥çœ‹è‡ªåŠ¨é…ç½®äº†å“ªäº›ï¼ˆé€‰åšï¼‰</p></li><li><ul><li>è‡ªå·±åˆ†æï¼Œå¼•å…¥åœºæ™¯å¯¹åº”çš„è‡ªåŠ¨é…ç½®ä¸€èˆ¬éƒ½ç”Ÿæ•ˆäº†</li><li>é…ç½®æ–‡ä»¶ä¸­debug=trueå¼€å¯è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚Negativeï¼ˆä¸ç”Ÿæ•ˆï¼‰\Positiveï¼ˆç”Ÿæ•ˆï¼‰</li></ul></li><li><p>æ˜¯å¦éœ€è¦ä¿®æ”¹</p></li><li><ul><li>å‚ç…§æ–‡æ¡£ä¿®æ”¹é…ç½®é¡¹</li></ul></li><li><ul><li><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</a></li><li>è‡ªå·±åˆ†æã€‚xxxxPropertiesç»‘å®šäº†é…ç½®æ–‡ä»¶çš„å“ªäº›ã€‚</li></ul></li></ul></li><li><ul><li>è‡ªå®šä¹‰åŠ å…¥æˆ–è€…æ›¿æ¢ç»„ä»¶</li></ul></li><li><ul><li><ul><li>@Beanã€@Componentã€‚ã€‚ã€‚</li></ul></li></ul></li><li><ul><li>è‡ªå®šä¹‰å™¨  <strong>XXXXXCustomizer</strong>ï¼›</li></ul></li></ul><h3 id="2-4-Webå¼€å‘"><a href="#2-4-Webå¼€å‘" class="headerlink" title="2.4 Webå¼€å‘"></a>2.4 Webå¼€å‘</h3><h4 id="2-4-1-SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ"><a href="#2-4-1-SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ" class="headerlink" title="2.4.1 SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ"></a>2.4.1 SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ</h4><p>åœ¨å®˜ç½‘ä¸Šæœ‰ SpringBOOT æ•´åˆ <strong>SpringMVC</strong> ç›¸å…³çš„ä»‹ç»ã€‚</p><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-auto-configuration">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-auto-configuration</a></p><blockquote><p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(å¤§å¤šåœºæ™¯æˆ‘ä»¬éƒ½æ— éœ€è‡ªå®šä¹‰é…ç½®)</strong></p><p>The auto-configuration adds the following features on top of Springâ€™s defaults:</p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p></li><li><ul><li>å†…å®¹åå•†è§†å›¾è§£æå™¨å’ŒBeanNameè§†å›¾è§£æå™¨</li></ul></li><li><p>Support for serving static resources, including support for WebJars (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">later in this document</a>)).</p></li><li><ul><li>é™æ€èµ„æºï¼ˆåŒ…æ‹¬webjarsï¼‰</li></ul></li><li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p></li><li><ul><li>è‡ªåŠ¨æ³¨å†Œ <code>Converterï¼ŒGenericConverterï¼ŒFormatter </code></li></ul></li><li><p>Support for <code>HttpMessageConverters</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters">later in this document</a>).</p></li><li><ul><li>æ”¯æŒ <code>HttpMessageConverters</code> ï¼ˆåæ¥æˆ‘ä»¬é…åˆå†…å®¹åå•†ç†è§£åŸç†ï¼‰</li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes">later in this document</a>).</p></li><li><ul><li>è‡ªåŠ¨æ³¨å†Œ <code>MessageCodesResolver</code> ï¼ˆå›½é™…åŒ–ç”¨ï¼‰</li></ul></li><li><p>Static <code>index.html</code> support.</p></li><li><ul><li>é™æ€index.html é¡µæ”¯æŒ</li></ul></li><li><p>Custom <code>Favicon</code> support (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon">later in this document</a>).</p></li><li><ul><li>è‡ªå®šä¹‰ <code>Favicon</code>  </li></ul></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).</p></li><li><ul><li>è‡ªåŠ¨ä½¿ç”¨ <code>ConfigurableWebBindingInitializer</code> ï¼Œï¼ˆDataBinderè´Ÿè´£å°†è¯·æ±‚æ•°æ®ç»‘å®šåˆ°JavaBeanä¸Šï¼‰</li></ul></li></ul></blockquote><blockquote><p>If you want to keep those Spring Boot MVC customizations and make more <a href="https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p><p><strong>ä¸ç”¨<code>@EnableWebMvc</code>æ³¨è§£ã€‚ä½¿ç”¨</strong> <strong><code>@Configuration</code></strong> <strong>+</strong> <strong><code>WebMvcConfigurer</code></strong> <strong>è‡ªå®šä¹‰è§„åˆ™</strong></p></blockquote><ul><li>@EnableWebMvcæ³¨è§£åŸç†</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">...<br><span class="hljs-meta">@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableWebMvc &#123;...&#125;<br></code></pre></div></td></tr></table></figure><p><code>@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</code>ï¼Œæ‰€ä»¥åœ¨@EnableWebMvcé…ç½®åï¼Œä¼šè‡ªåŠ¨åŠ è½½<code>DelegatingWebMvcConfiguration.class</code>ã€‚è€Œåœ¨<code>public class WebMvcAutoConfiguration</code>é‡Œé¢</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">....<br><span class="hljs-meta">@ConditionalOnMissingBean(&#123;WebMvcConfigurationSupport.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><p><code>@ConditionalOnMissingBean(&#123;WebMvcConfigurationSupport.class&#125;)</code> è¿™é‡Œè¡¨ç¤ºå¦‚æœ<code>WebMvcConfigurationSupport</code>æ³¨å…¥æ—¶ï¼Œåˆ™<code>WebMvcAutoConfiguration</code>ä¸ä¼šè¢«å¼€å¯ã€‚</p><p><code>public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</code>æ³¨å…¥<code>DelegatingWebMvcConfiguration </code>åŒæ—¶ä¹Ÿä¼šæ³¨å…¥çˆ¶ç±»<code>WebMvcConfigurationSupport</code>ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“è®ºæ˜¯ï¼š</p><ul><li>æ³¨å…¥<code>@EnableWebMvc</code>ä¼šè®©WebMVCè‡ªå®šä¹‰é…ç½®å¤±æ•ˆ</li></ul><blockquote><p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.</p><p><strong>å£°æ˜</strong> <strong><code>WebMvcRegistrations</code></strong> <strong>æ”¹å˜é»˜è®¤åº•å±‚ç»„ä»¶</strong>ï¼Œ<strong>å¹¶ä¸”ä»ç„¶ä¿ç•™Spring Boot MVCè‡ªå®šä¹‰è®¾ç½®ã€‚</strong></p></blockquote><blockquote><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p><p><strong>ä½¿ç”¨</strong> <strong><code>@EnableWebMvc + @Configuration + DelegatingWebMvcConfiguration å…¨é¢æ¥ç®¡SpringMVC</code></strong></p></blockquote><h4 id="2-4-2-åŠŸèƒ½åˆ†æ"><a href="#2-4-2-åŠŸèƒ½åˆ†æ" class="headerlink" title="2.4.2 åŠŸèƒ½åˆ†æ"></a>2.4.2 åŠŸèƒ½åˆ†æ</h4><h5 id="2-4-2-1-é™æ€èµ„æºè®¿é—®"><a href="#2-4-2-1-é™æ€èµ„æºè®¿é—®" class="headerlink" title="2.4.2.1 é™æ€èµ„æºè®¿é—®"></a>2.4.2.1 é™æ€èµ„æºè®¿é—®</h5><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content</a></p><blockquote><p>By default, Spring Boot serves static content from a directory called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code>) in the classpath or from the root of the <code>ServletContext</code>. It uses the <code>ResourceHttpRequestHandler</code> from Spring MVC so that you can modify that behavior by adding your own <code>WebMvcConfigurer</code> and overriding the <code>addResourceHandlers</code> method.</p></blockquote><ul><li>é™æ€èµ„æºé»˜è®¤è®¿é—®è·¯å¾„<ul><li><code>/META-INF/resources/</code></li><li><code>/resources/</code></li><li><code>/static/</code></li><li><code>/public/</code></li><li>ä¼˜å…ˆçº§é¡ºåºä¸ºï¼š<strong>META-INF/resources &gt; resources &gt; static &gt; public</strong>, ä¸€èˆ¬æ¥è¯´ <code>public</code> ä¸‹æ”¾ä¸€äº›å…¬å…±çš„èµ„æºæ¯”å¦‚ ç”¨æˆ·éƒ½ä¼šè®¿é—®çš„ js æ–‡ä»¶ï¼Œ <code>static</code> æ”¾ä¸€äº›é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡ã€‚<code>resources</code> æ”¾ä¸€äº›ä¸Šä¼ uploadæ–‡ä»¶ã€‚</li></ul></li><li>å®ƒä½¿ç”¨Spring MVCä¸­çš„<code>ResourceHttpRequestHandler</code>ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„<code>WebMvcConfigurer</code>å¹¶é‡å†™<code>addResourceHandlers</code>æ–¹æ³•æ¥ä¿®æ”¹è¯¥è¡Œä¸ºã€‚</li></ul><blockquote><p>By default, resources are mapped on <code>/**</code>, but you can tune that with the <code>spring.mvc.static-path-pattern</code> property. For instance, relocating all resources to <code>/resources/**</code> can be achieved as follows:</p></blockquote><hr><ul><li>å¯ä»¥ä¿®æ”¹èµ„æºè®¿é—®çš„è·¯å¾„ï¼ˆé¡¹ç›®resourcesä¸‹é¢çš„æ–‡ä»¶ï¼‰</li></ul><blockquote><p>You can also customize the static resource locations by using the <code>spring.web.resources.static-locations</code> property (replacing the default values with a list of directory locations). The root Servlet context path, <code>&quot;/&quot;</code>, is automatically added as a location as well.</p></blockquote><ul><li>ç”¨äº† <code>spring.web.resources.static-locations</code> ä¿®æ”¹èµ„æºæ–‡ä»¶è®¿é—®è·¯å¾„ï¼Œåˆ™ä¸Šé¢çš„å››ä¸ªé»˜è®¤çš„è·¯å¾„å°±ä¼šå¤±æ•ˆã€‚</li></ul><hr><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºæ˜ å°„åˆ°/** ï¼Œä½†å¯ä»¥ä½¿ç”¨<code>spring.mvc.static-path-pattern</code>æ¥é‡æ–°å®šä½åˆ° /resources/**ã€‚å°±æ˜¯è®¿é—®èµ„æºè·¯å¾„å‰é¢åŠ ä¸€ä¸ªå‰ç¼€ã€‚ï¼ˆurlï¼‰</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.mvc.static-path-pattern</span>=<span class="hljs-string">/resources/**</span><br></code></pre></div></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">&quot;/resources/**&quot;</span><br></code></pre></div></td></tr></table></figure><p>è¯·æ±‚è¿›æ¥ï¼Œå…ˆå»æ‰¾Controllerçœ‹èƒ½ä¸èƒ½å¤„ç†ã€‚ä¸èƒ½å¤„ç†çš„æ‰€æœ‰è¯·æ±‚åˆéƒ½äº¤ç»™é™æ€èµ„æºå¤„ç†å™¨ã€‚é™æ€èµ„æºä¹Ÿæ‰¾ä¸åˆ°åˆ™å“åº”404é¡µé¢ã€‚</p><hr><ul><li>é™æ€èµ„æºå¦‚æœæ˜¯åœ¨WebJarsè¿™ä¸ªç½‘ç«™å¯¼å…¥çš„ï¼Œåˆ™ä¸‹è½½çš„ç›®å½•æ–‡ä»¶éƒ½æœ‰åŒä¸€çš„è·¯å¾„æ ¼å¼ï¼Œåˆ™ä»jaræ–‡ä»¶æä¾›è·¯å¾„ä¸º<code>/webjars/**</code>çš„ä»»ä½•èµ„æºã€‚</li></ul><p>In addition to the â€œstandardâ€ static resource locations mentioned earlier, a special case is made for <a href="https://www.webjars.org/">Webjars content</a>. Any resources with a path in <code>/webjars/**</code> are served from jar files if they are packaged in the Webjars format.</p><p>å¦‚å¯¼å…¥jquery</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">http://localhost:8080/webjars/<strong>jquery/3.5.1/jquery.js</strong></a>  åé¢åœ°å€è¦æŒ‰ç…§ä¾èµ–é‡Œé¢çš„åŒ…è·¯å¾„</p><h5 id="2-4-2-2-æ¬¢è¿é¡µ"><a href="#2-4-2-2-æ¬¢è¿é¡µ" class="headerlink" title="2.4.2.2 æ¬¢è¿é¡µ"></a>2.4.2.2 æ¬¢è¿é¡µ</h5><p>å¦‚ä¸‹ä¸¤ç§æƒ…å†µéƒ½ä¼šå½“ä½œé™æ€é¡µå¤„ç†ã€‚1 è®¿é—®é™æ€é¡µæ–‡ä»¶ 2 Controllerè¿›è¡Œèµ„æºè·³è½¬ã€‚</p><ol><li>é™æ€èµ„æºè·¯å¾„ä¸‹  index.html</li></ol><ul><li><p>å¯ä»¥é…ç½®é™æ€èµ„æºè·¯å¾„</p></li><li><p>ä½†æ˜¯ä¸å¯ä»¥é…ç½®<strong>é™æ€èµ„æºçš„è®¿é—®å‰ç¼€</strong>ã€‚å¦åˆ™å¯¼è‡´ index.html ä¸èƒ½è¢«é»˜è®¤è®¿é—®</p></li><li><p><code>spring.mvc.static-path-pattern</code> âŒâŒâŒ</p></li></ul><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">spring:<br>#  mvc:<br>#    <span class="hljs-keyword">static</span>-path-pattern: <span class="hljs-regexp">/res/</span>**   è¿™ä¸ªä¼šå¯¼è‡´welcome pageåŠŸèƒ½å¤±æ•ˆ<br><br>  resources:<br>    <span class="hljs-keyword">static</span>-locations: [<span class="hljs-keyword">classpath</span>:<span class="hljs-regexp">/haha/</span>]<br></code></pre></div></td></tr></table></figure><ol start="2"><li>controllerèƒ½å¤„ç†/index</li></ol><h5 id="2-4-2-3-è‡ªå®šä¹‰-Favicon"><a href="#2-4-2-3-è‡ªå®šä¹‰-Favicon" class="headerlink" title="2.4.2.3 è‡ªå®šä¹‰ Favicon"></a>2.4.2.3 è‡ªå®šä¹‰ Favicon</h5><p>favicon.ico æ”¾åœ¨<strong>é™æ€èµ„æºç›®å½•</strong>ä¸‹å³å¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**   è¿™ä¸ªä¼šå¯¼è‡´ Favicon åŠŸèƒ½å¤±æ•ˆ</span><br></code></pre></div></td></tr></table></figure><h5 id="2-4-2-4-é™æ€èµ„æºé…ç½®åŸç†"><a href="#2-4-2-4-é™æ€èµ„æºé…ç½®åŸç†" class="headerlink" title="2.4.2.4  é™æ€èµ„æºé…ç½®åŸç†"></a>2.4.2.4  é™æ€èµ„æºé…ç½®åŸç†</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><br><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><br><span class="hljs-meta">      ValidationAutoConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><ul><li>âœ” æ˜¯ä¸€ä¸ªSERVLETåº”ç”¨</li><li>âœ” åœ¨WebMVCè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥ä¹‹å‰å·²ç»å¯¼å…¥<code>Servlet </code> <code>DispatcherServlet</code>  <code>WebMvcConfigurer</code></li><li>âŒæ²¡å¯¼å…¥ <code>WebMvcConfigurationSupport</code></li><li>âœ” WebMvcAutoConfiguration <strong>æ‰§è¡Œ</strong></li></ul><hr><ul><li>ç„¶åçœ‹åˆ°é™æ€å†…éƒ¨ç±» <code>WebMvcAutoConfigurationAdapter</code> </li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">...<br><span class="hljs-meta">@Import(EnableWebMvcConfiguration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, ResourceProperties.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfigurationAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><p><code>WebMvcProperties.class</code>å’Œ <code>ResourceProperties.class</code>åˆ†åˆ«ç»‘å®šå‰ç¼€å±æ€§ï¼š<strong>spring.mvc</strong>, <strong>spring.resources</strong></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.mvc&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcProperties</span> </span>&#123;...&#125;<br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.resources&quot;, ignoreUnknownFields = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceProperties</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><ul><li>åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebMvcAutoConfigurationAdapter</span><span class="hljs-params">(ResourceProperties resourceProperties, WebMvcProperties mvcProperties,</span></span><br><span class="hljs-function"><span class="hljs-params">            ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="hljs-function"><span class="hljs-params">            ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="hljs-function"><span class="hljs-params">            ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="hljs-function"><span class="hljs-params">            ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.resourceProperties = resourceProperties;<br>        <span class="hljs-keyword">this</span>.mvcProperties = mvcProperties;<br>        <span class="hljs-keyword">this</span>.beanFactory = beanFactory;<br>        <span class="hljs-keyword">this</span>.messageConvertersProvider = messageConvertersProvider;<br>        <span class="hljs-keyword">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();<br>        <span class="hljs-keyword">this</span>.dispatcherServletPath = dispatcherServletPath;<br>        <span class="hljs-keyword">this</span>.servletRegistrations = servletRegistrations;<br>    &#125;<br></code></pre></div></td></tr></table></figure><ul><li>æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¼šä»<strong>å®¹å™¨</strong>ä¸­ç¡®å®š</li><li>ResourceProperties resourcePropertiesï¼›è·å–å’Œ<strong>spring.resources</strong>ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>WebMvcProperties mvcProperties è·å–å’Œ<strong>spring.mvc</strong>ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li><li>ListableBeanFactory beanFactory Springçš„ <strong>beanFactory</strong></li><li>HttpMessageConverters æ‰¾åˆ°æ‰€æœ‰çš„<strong>HttpMessageConverters</strong></li><li>ResourceHandlerRegistrationCustomizer æ‰¾åˆ° èµ„æºå¤„ç†å™¨çš„<strong>è‡ªå®šä¹‰å™¨</strong>ã€‚</li><li>DispatcherServletPath  </li><li>ServletRegistrationBean   ç»™åº”ç”¨æ³¨å†ŒServletã€Filterâ€¦.</li></ul><hr><ul><li><p>å†…éƒ¨æˆå‘˜æ–¹æ³•<code>addResourceHandlers</code>   â€”-&gt;  <strong>èµ„æºå¤„ç†é»˜è®¤è§„åˆ™</strong></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;<br>   <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;<br>      logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>   &#125;<br>   Duration cachePeriod = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getPeriod();<br>   CacheControl cacheControl = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();<br>   <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(<span class="hljs-string">&quot;/webjars/**&quot;</span>)) &#123;<br>      customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>)<br>            .addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)<br>            .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>   &#125;<br>   String staticPathPattern = <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern();<br>   <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;<br>      customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)<br>            .addResourceLocations(getResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations()))<br>            .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li><p>å…ˆåœ¨<code>if (!this.resourceProperties.isAddMappings())</code> æ‰“æ–­ç‚¹</p></li></ul><p>è¿›å…¥<code>isAddMappings</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAddMappings</span><span class="hljs-params">()</span> </span>&#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.addMappings;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Whether to enable default resource handling. æ˜¯å¦å¯ç”¨é»˜è®¤èµ„æºå¤„ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> addMappings = <span class="hljs-keyword">true</span>; <span class="hljs-comment">// é»˜è®¤ä¸ºtrue</span><br></code></pre></div></td></tr></table></figure><p>æ‰€ä»¥é…ç½®ä¸Šï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">false</span>   <span class="hljs-string">ç¦ç”¨æ‰€æœ‰é™æ€èµ„æºè§„åˆ™</span><br></code></pre></div></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥ç”¨è¿™ç§æ–¹å¼ç¦ç”¨é™æ€èµ„æºçš„è®¿é—®</p><ul><li>ä¸­é—´è·å–äº†é™æ€èµ„æºçš„ç¼“å­˜è§„åˆ™ï¼ŒåŒ…æ‹¬ç¼“å­˜æ—¶é—´ç­‰</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Duration cachePeriod = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getPeriod();<br>CacheControl cacheControl = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Duration <span class="hljs-title">getPeriod</span><span class="hljs-params">()</span> </span>&#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.period;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Cache period for the resources served by the resource handler. If a duration</span><br><span class="hljs-comment"> * suffix is not specified, seconds will be used. Can be overridden by the</span><br><span class="hljs-comment"> * &#x27;spring.resources.cache.cachecontrol&#x27; properties.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DurationUnit(ChronoUnit.SECONDS)</span><br><span class="hljs-keyword">private</span> Duration period;<br></code></pre></div></td></tr></table></figure><p>æ ¹æ®æ³¨é‡Šä¸Šçš„æç¤ºï¼Œå¯ä»¥ï¼Œperiodå•ä½æ˜¯ç§’ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è‡ªå®šä¹‰ç¼“å­˜æ—¶é—´</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">true</span> <span class="hljs-string">//</span> <span class="hljs-string">é»˜è®¤ä¸ºtrue</span><br>    <span class="hljs-attr">cache:</span><br>      <span class="hljs-attr">period:</span> <span class="hljs-number">11000</span> <span class="hljs-string">//</span> <span class="hljs-string">å•ä½s</span><br></code></pre></div></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªifï¼Œå¦‚æœå­˜åœ¨<code>/webjars/**</code>è·¯å¾„ï¼Œåˆ™å» <code>/META-INF/resources/webjars/</code>ä¸‹æ‰¾èµ„æºï¼Œå¹¶é…ç½®å¥½è®¾ç½®çš„ç¼“å­˜è§„åˆ™ã€‚è¿™ç§æ–¹å¼å°±æ˜¯åœ¨WebJarsæ–¹å¼å¯¼å…¥é™æ€èµ„æºã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(<span class="hljs-string">&quot;/webjars/**&quot;</span>)) &#123;<br>   customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>)<br>         .addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)<br>         .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å¦‚æœä¸æ˜¯webjarsæ–¹å¼å¯¼å…¥ï¼Œåˆ™ä»resourcesç›®å½•ä¸‹æ‰¾èµ„æº</li></ul><p>å…ˆè·å–èµ„æºè·¯å¾„ï¼Œé»˜è®¤è·¯å¾„å°±æ˜¯ <code>/**</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">String staticPathPattern = <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern();<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStaticPathPattern</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.staticPathPattern;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Path pattern used for static resources.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String staticPathPattern = <span class="hljs-string">&quot;/**&quot;</span>;<br></code></pre></div></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„ä»£ç ä¸ä¸Šé¢é€»è¾‘ç›¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;<br>   customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)<br>         .addResourceLocations(getResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations()))<br>         .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>&#125;<br></code></pre></div></td></tr></table></figure><p>è¿›å…¥<code>this.resourceProperties.getStaticLocations()</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String[] getStaticLocations() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.staticLocations;<br>&#125;<br><br><span class="hljs-keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>,<br><span class="hljs-string">&quot;classpath:/resources/&quot;</span>, <span class="hljs-string">&quot;classpath:/static/&quot;</span>, <span class="hljs-string">&quot;classpath:/public/&quot;</span> &#125;;<br></code></pre></div></td></tr></table></figure><p>å°±æ˜¯é»˜è®¤çš„å››ä¸ªé™æ€èµ„æºè®¿é—®è·¯å¾„ã€‚</p><hr><ul><li>è¿›å…¥é™æ€å†…éƒ¨ç±»<code>EnableWebMvcConfiguration</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ResourceLoaderAware</span> </span>&#123;...&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext,</span></span><br><span class="hljs-function"><span class="hljs-params">      FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;<br>   WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="hljs-keyword">new</span> WelcomePageHandlerMapping(<br>         <span class="hljs-keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),<br>         <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern());<br>   welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));<br>   welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());<br>   <span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>welcomePageHandlerMapping</code>è¿™ä¸ªæ–¹æ³•å°±æ˜¯æ§åˆ¶æ¬¢è¿é¡µã€‚</p><p>è¿›å…¥<code>WelcomePageHandlerMapping</code>æœ‰å‚æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,<br>      ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) &#123;<br>   <span class="hljs-keyword">if</span> (welcomePage.isPresent() &amp;&amp; <span class="hljs-string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;<br>      logger.info(<span class="hljs-string">&quot;Adding welcome page: &quot;</span> + welcomePage.get());<br>      setRootViewName(<span class="hljs-string">&quot;forward:index.html&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;<br>      logger.info(<span class="hljs-string">&quot;Adding welcome page template: index&quot;</span>);<br>      setRootViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>è¦ç”¨æ¬¢è¿é¡µåŠŸèƒ½ï¼Œè·¯å¾„å¿…é¡»æ˜¯/**ï¼Œæ¬¢è¿é¡µå­˜åœ¨ï¼Œèµ°if</p></li><li><p>ä¸èƒ½å­˜åœ¨ï¼Œèµ°else ifï¼šè°ƒç”¨Controller  /index</p></li></ul><hr><ul><li>Favicon</li></ul><p>æµè§ˆå™¨ä¼šè‡ªåŠ¨å‘é€ /favicon.ico è¯·æ±‚è·å–å›¾æ ‡ï¼Œæ•´ä¸ªsessionæœŸé—´ä¸å†è·å–</p><h4 id="2-4-3-è¯·æ±‚å‚æ•°å¤„ç†"><a href="#2-4-3-è¯·æ±‚å‚æ•°å¤„ç†" class="headerlink" title="2.4.3 è¯·æ±‚å‚æ•°å¤„ç†"></a>2.4.3 è¯·æ±‚å‚æ•°å¤„ç†</h4><h5 id="2-4-3-1-è¯·æ±‚æ˜ å°„"><a href="#2-4-3-1-è¯·æ±‚æ˜ å°„" class="headerlink" title="2.4.3.1 è¯·æ±‚æ˜ å°„"></a>2.4.3.1 è¯·æ±‚æ˜ å°„</h5><ul><li><p>@xxxMappingï¼›</p></li><li><p>Resté£æ ¼æ”¯æŒï¼ˆ<em>ä½¿ç”¨<strong>HTTP</strong>è¯·æ±‚æ–¹å¼åŠ¨è¯æ¥è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œ</em>ï¼‰</p></li><li><ul><li>ä»¥å‰ï¼š**/getUser  è·å–ç”¨æˆ·   /deleteUser åˆ é™¤ç”¨æˆ·   /editUser  ä¿®æ”¹ç”¨æˆ·    /saveUser ä¿å­˜ç”¨æˆ·</li><li>ç°åœ¨ï¼š /user   GET-<strong>è·å–</strong>ç”¨æˆ·   DELETE-<strong>åˆ é™¤</strong>ç”¨æˆ·   PUT-<strong>ä¿®æ”¹</strong>ç”¨æˆ·     POST-<strong>ä¿å­˜</strong>ç”¨æˆ·</li><li>æ ¸å¿ƒFilterï¼š<code>HiddenHttpMethodFilter</code></li></ul></li><li><ul><li><ul><li>ç”¨æ³•ï¼š <strong>è¡¨å•</strong>method=postï¼Œéšè—åŸŸ _method=put</li><li>SpringBootä¸­æ‰‹åŠ¨å¼€å¯</li></ul></li></ul></li></ul><p>å› ä¸º<form>è¡¨å•è¯·æ±‚æ–¹å¼methodåªæœ‰ GET å’Œ POSTï¼Œæ‰€ä»¥è¦è®©è¿‡æ»¤å™¨HiddenHttpMethodFilterå°†è¯·æ±‚å‚æ•°åæ›¿æ¢ã€‚</p><p>å››ç§æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUser</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;GET-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveUser</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;POST-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><br><span class="hljs-meta">@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">putUser</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;PUT-å¼ ä¸‰&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.DELETE)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deleteUser</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;DELETE-å¼ ä¸‰&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>hiddenHttpMethodFilter</code>æ¥æ§åˆ¶methodçš„è¯·æ±‚æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span><br><span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;, matchIfMissing = false)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> OrderedHiddenHttpMethodFilter <span class="hljs-title">hiddenHttpMethodFilter</span><span class="hljs-params">()</span> </span>&#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OrderedHiddenHttpMethodFilter();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderedHiddenHttpMethodFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HiddenHttpMethodFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderedFilter</span></span><br></code></pre></div></td></tr></table></figure><p>çˆ¶ç±»<code>HiddenHttpMethodFilter</code>é‡Œçš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        HttpServletRequest requestToUse = request;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(<span class="hljs-string">&quot;javax.servlet.error.exception&quot;</span>) == <span class="hljs-keyword">null</span>) &#123;<br>            String paramValue = request.getParameter(<span class="hljs-keyword">this</span>.methodParam);<br>            <span class="hljs-keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;<br>                String method = paramValue.toUpperCase(Locale.ENGLISH);<br>                <span class="hljs-keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;<br>                    requestToUse = <span class="hljs-keyword">new</span> HiddenHttpMethodFilter.HttpMethodRequestWrapper(request, method);<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        filterChain.doFilter((ServletRequest)requestToUse, response);<br>    &#125;<br></code></pre></div></td></tr></table></figure><p><code>HiddenHttpMethodFilter.HttpMethodRequestWrapper(request, method);</code>è¿™é‡Œå®ç°äº†methodçš„è½¬æ¢ï¼Œé‡å†™äº†getMethod().</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpMethodRequestWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServletRequestWrapper</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String method;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HttpMethodRequestWrapper</span><span class="hljs-params">(HttpServletRequest request, String method)</span> </span>&#123;<br>            <span class="hljs-keyword">super</span>(request);<br>            <span class="hljs-keyword">this</span>.method = method;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMethod</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.method;<br>        &#125;<br>    &#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>è¡¨å•æäº¤ä¼šå¸¦ä¸Š<strong>_method=PUT</strong></p></li><li><p><strong>è¯·æ±‚è¿‡æ¥è¢«</strong>HiddenHttpMethodFilteræ‹¦æˆª</p><ul><li><p>è¯·æ±‚æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä¸”æ˜¯POST</p><ul><li><p>è·å–åˆ°<strong>_method</strong>çš„å€¼ã€‚</p></li><li><p>å…¼å®¹ä»¥ä¸‹è¯·æ±‚ï¼›<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong></p></li><li><p><strong>åŸç”Ÿrequestï¼ˆpostï¼‰ï¼ŒåŒ…è£…æ¨¡å¼requesWrapperé‡å†™äº†getMethodæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¼ å…¥çš„å€¼ã€‚</strong></p></li><li><p><strong>è¿‡æ»¤å™¨é“¾æ”¾è¡Œçš„æ—¶å€™ç”¨wrapperã€‚ä»¥åçš„æ–¹æ³•è°ƒç”¨getMethodæ˜¯è°ƒç”¨requesWrapperçš„ã€‚</strong></p></li></ul></li></ul></li></ul><p><strong>Restä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·ï¼Œ</strong></p><ul><li>å¦‚PostManç›´æ¥å‘é€Putã€deleteç­‰æ–¹å¼è¯·æ±‚ï¼Œæ— éœ€Filterã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">hiddenmethod:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment">#å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</span><br></code></pre></div></td></tr></table></figure><h6 id="è¯·æ±‚æ˜ å°„åŸç†"><a href="#è¯·æ±‚æ˜ å°„åŸç†" class="headerlink" title="è¯·æ±‚æ˜ å°„åŸç†"></a>è¯·æ±‚æ˜ å°„åŸç†</h6><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/DispatcherServlet.png" alt="DispatcherServlet"></p><p>SpringMVCåŠŸèƒ½æœ€ç»ˆéƒ½ä¼šç»è¿‡ org.springframework.web.servlet.DispatcherServlet çš„ <code>doDispatch</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        HttpServletRequest processedRequest = request;<br>        HandlerExecutionChain mappedHandler = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">boolean</span> multipartRequestParsed = <span class="hljs-keyword">false</span>;<br><br>        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            ModelAndView mv = <span class="hljs-keyword">null</span>;<br>            Exception dispatchException = <span class="hljs-keyword">null</span>;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                processedRequest = checkMultipart(request);<br>                multipartRequestParsed = (processedRequest != request);<br><br>                <span class="hljs-comment">// æ‰¾åˆ°å½“å‰è¯·æ±‚ä½¿ç”¨å“ªä¸ªHandlerï¼ˆControllerçš„æ–¹æ³•ï¼‰å¤„ç†</span><br>                mappedHandler = getHandler(processedRequest);<br>                <br>                <span class="hljs-comment">//HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„ã€‚/xxx-&gt;&gt;xxxx</span><br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/handlerMappings.png" alt="handlerMappings"></p><p><strong>RequestMappingHandlerMapping</strong>ï¼šä¿å­˜äº†æ‰€æœ‰@RequestMapping å’Œhandlerçš„æ˜ å°„è§„åˆ™ã€‚</p><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/mappingRegistry.png" alt="mappingRegistry"></p><p>æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„éƒ½åœ¨HandlerMappingä¸­ã€‚</p><ul><li><p>SpringBootè‡ªåŠ¨é…ç½®æ¬¢è¿é¡µçš„ <code>WelcomePageHandlerMapping</code> ã€‚è®¿é—® /èƒ½è®¿é—®åˆ°index.htmlï¼›</p></li><li><p>SpringBootè‡ªåŠ¨é…ç½®äº†é»˜è®¤ çš„ <code>RequestMappingHandlerMapping</code></p></li><li><p>è¯·æ±‚è¿›æ¥ï¼ŒæŒ¨ä¸ªå°è¯•æ‰€æœ‰çš„HandlerMappingçœ‹æ˜¯å¦æœ‰è¯·æ±‚ä¿¡æ¯ã€‚</p></li><li><ul><li>å¦‚æœæœ‰å°±æ‰¾åˆ°è¿™ä¸ªè¯·æ±‚å¯¹åº”çš„handler</li><li>å¦‚æœæ²¡æœ‰å°±æ˜¯ä¸‹ä¸€ä¸ª HandlerMapping</li></ul></li><li><p>æˆ‘ä»¬éœ€è¦ä¸€äº›è‡ªå®šä¹‰çš„æ˜ å°„å¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±ç»™å®¹å™¨ä¸­æ”¾<strong>HandlerMapping</strong>ã€‚è‡ªå®šä¹‰ <strong>HandlerMapping</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> HandlerExecutionChain <span class="hljs-title">getHandler</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.handlerMappings != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (HandlerMapping mapping : <span class="hljs-keyword">this</span>.handlerMappings) &#123;<br>            HandlerExecutionChain handler = mapping.getHandler(request);<br>            <span class="hljs-keyword">if</span> (handler != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> handler;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>é»˜è®¤ä½¿ç”¨çš„æ˜¯ _method è¿™ä¸ªåç§°çš„å˜é‡ï¼Œç”¨äºæºå¸¦è¯·æ±‚æ–¹å¼<ul><li>è‡ªå®šä¹‰å˜é‡åç§°è¦è‡ªå®šä¹‰ Filter</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span></span>&#123;<br>    <span class="hljs-comment">//è‡ªå®šä¹‰filter</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HiddenHttpMethodFilter <span class="hljs-title">hiddenHttpMethodFilter</span><span class="hljs-params">()</span></span>&#123;<br>        HiddenHttpMethodFilter methodFilter = <span class="hljs-keyword">new</span> HiddenHttpMethodFilter();<br>        methodFilter.setMethodParam(<span class="hljs-string">&quot;_m&quot;</span>);<br>        <span class="hljs-keyword">return</span> methodFilter;<br>    &#125;    <br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="2-4-3-2-æ™®é€šå‚æ•°ä¸åŸºæœ¬æ³¨è§£"><a href="#2-4-3-2-æ™®é€šå‚æ•°ä¸åŸºæœ¬æ³¨è§£" class="headerlink" title="2.4.3.2 æ™®é€šå‚æ•°ä¸åŸºæœ¬æ³¨è§£"></a>2.4.3.2 æ™®é€šå‚æ•°ä¸åŸºæœ¬æ³¨è§£</h5><ul><li><code>@PathVariable</code> è·¯å¾„å˜é‡</li><li><code>@RequestHeader</code> è·å–è¯·æ±‚å¤´</li><li><code>@RequestParam</code> è·å–è¯·æ±‚å‚æ•°ï¼ˆæŒ‡é—®å·åçš„å‚æ•°ï¼Œurl?a=1&amp;b=2ï¼‰</li><li><code>@CookieValue</code> è·å–Cookieå€¼</li><li><code>@RequestAttribute</code> è·å–requeståŸŸå±æ€§</li><li><code>@RequestBody</code> è·å–è¯·æ±‚ä½“[POST]</li><li><code>@MatrixVariable</code> çŸ©é˜µå˜é‡</li><li><code>@ModelAttribute</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParameterTestController</span> </span>&#123;<br>    <br>    <span class="hljs-comment">//  car/2/owner/zhangsan</span><br>    <span class="hljs-meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">getCar</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable(&quot;username&quot;)</span> String name,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable</span> Map&lt;String,String&gt; pv,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader</span> Map&lt;String,String&gt; header,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam</span> Map&lt;String,String&gt; params,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue(&quot;_ga&quot;)</span> String _ga,</span></span><br><span class="hljs-function"><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue(&quot;_ga&quot;)</span> Cookie cookie)</span></span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><span class="hljs-comment">//        map.put(&quot;id&quot;,id);</span><br><span class="hljs-comment">//        map.put(&quot;name&quot;,name);</span><br><span class="hljs-comment">//        map.put(&quot;pv&quot;,pv);</span><br><span class="hljs-comment">//        map.put(&quot;userAgent&quot;,userAgent);</span><br><span class="hljs-comment">//        map.put(&quot;headers&quot;,header);</span><br>        map.put(<span class="hljs-string">&quot;age&quot;</span>,age);<br>        map.put(<span class="hljs-string">&quot;inters&quot;</span>,inters);<br>        map.put(<span class="hljs-string">&quot;params&quot;</span>,params);<br>        map.put(<span class="hljs-string">&quot;_ga&quot;</span>,_ga);<br>        System.out.println(cookie.getName()+<span class="hljs-string">&quot;===&gt;&quot;</span>+cookie.getValue());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">postMethod</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String content)</span></span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;content&quot;</span>,content);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-comment">//1ã€è¯­æ³•ï¼š è¯·æ±‚è·¯å¾„ï¼š/cars/sell;low=34;brand=byd,audi,yd</span><br>    <span class="hljs-comment">//2ã€SpringBooté»˜è®¤æ˜¯ç¦ç”¨äº†çŸ©é˜µå˜é‡çš„åŠŸèƒ½</span><br>    <span class="hljs-comment">//      æ‰‹åŠ¨å¼€å¯ï¼šåŸç†ã€‚å¯¹äºè·¯å¾„çš„å¤„ç†ã€‚UrlPathHelperè¿›è¡Œè§£æã€‚</span><br>    <span class="hljs-comment">//              removeSemicolonContentï¼ˆç§»é™¤åˆ†å·å†…å®¹ï¼‰æ”¯æŒçŸ©é˜µå˜é‡çš„</span><br>    <span class="hljs-comment">//3ã€çŸ©é˜µå˜é‡å¿…é¡»æœ‰urlè·¯å¾„å˜é‡æ‰èƒ½è¢«è§£æ</span><br>    <span class="hljs-meta">@GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">carsSell</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(&quot;low&quot;)</span> Integer low,</span></span><br><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;String&gt; brand,</span></span><br><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-meta">@PathVariable(&quot;path&quot;)</span> String path)</span></span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;low&quot;</span>,low);<br>        map.put(<span class="hljs-string">&quot;brand&quot;</span>,brand);<br>        map.put(<span class="hljs-string">&quot;path&quot;</span>,path);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-comment">// /boss/1;age=20/2;age=10</span><br>    <span class="hljs-meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">boss</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span> Integer bossAge,</span></span><br><span class="hljs-function"><span class="hljs-params">                    <span class="hljs-meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span> Integer empAge)</span></span>&#123;<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>        map.put(<span class="hljs-string">&quot;bossAge&quot;</span>,bossAge);<br>        map.put(<span class="hljs-string">&quot;empAge&quot;</span>,empAge);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="2-5-æ•°æ®è®¿é—®"><a href="#2-5-æ•°æ®è®¿é—®" class="headerlink" title="2.5 æ•°æ®è®¿é—®"></a>2.5 æ•°æ®è®¿é—®</h3><h4 id="2-5-1-SQL"><a href="#2-5-1-SQL" class="headerlink" title="2.5.1 SQL"></a>2.5.1 SQL</h4><h6 id="1ã€æ•°æ®æºçš„è‡ªåŠ¨é…ç½®-HikariDataSource"><a href="#1ã€æ•°æ®æºçš„è‡ªåŠ¨é…ç½®-HikariDataSource" class="headerlink" title="1ã€æ•°æ®æºçš„è‡ªåŠ¨é…ç½® - HikariDataSource"></a>1ã€æ•°æ®æºçš„è‡ªåŠ¨é…ç½® - HikariDataSource</h6><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/hypocrite30/ImgBed/raw/master/img/SpringBoot/jdbc-starter.png" alt="jdbc-starter"></p><p>æ•°æ®åº“é©±åŠ¨ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆå¯¼å…¥JDBCåœºæ™¯ï¼Œå®˜æ–¹ä¸å¯¼å…¥é©±åŠ¨ï¼Ÿå®˜æ–¹ä¸çŸ¥é“æˆ‘ä»¬æ¥ä¸‹è¦æ“ä½œä»€ä¹ˆæ•°æ®åº“ã€‚</p><p>æ•°æ®åº“ç‰ˆæœ¬å’Œé©±åŠ¨ç‰ˆæœ¬å¯¹åº”</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">é»˜è®¤ç‰ˆæœ¬ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>8.0.22<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!--            &lt;version&gt;5.1.49&lt;/version&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>æƒ³è¦ä¿®æ”¹ç‰ˆæœ¬<br>1ã€ç›´æ¥ä¾èµ–å¼•å…¥å…·ä½“ç‰ˆæœ¬ï¼ˆmavençš„å°±è¿‘ä¾èµ–åŸåˆ™ï¼‰<br>2ã€é‡æ–°å£°æ˜ç‰ˆæœ¬ï¼ˆmavençš„å±æ€§çš„å°±è¿‘ä¼˜å…ˆåŸåˆ™ï¼‰<br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.49<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h5 id="2ã€åˆ†æè‡ªåŠ¨é…ç½®"><a href="#2ã€åˆ†æè‡ªåŠ¨é…ç½®" class="headerlink" title="2ã€åˆ†æè‡ªåŠ¨é…ç½®"></a>2ã€åˆ†æè‡ªåŠ¨é…ç½®</h5><ul><li><p>DataSourceAutoConfiguration ï¼š æ•°æ®æºçš„è‡ªåŠ¨é…ç½®</p></li><li><ul><li>ä¿®æ”¹æ•°æ®æºç›¸å…³çš„é…ç½®ï¼š<strong>spring.datasource</strong></li><li><strong>æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œæ˜¯è‡ªå·±å®¹å™¨ä¸­æ²¡æœ‰DataSourceæ‰è‡ªåŠ¨é…ç½®çš„</strong></li><li>åº•å±‚é…ç½®å¥½çš„è¿æ¥æ± æ˜¯ï¼š<strong>HikariDataSource</strong></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Conditional(PooledDataSourceCondition.class)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span><br><span class="hljs-meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span><br><span class="hljs-meta">DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span><br><span class="hljs-meta">DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PooledDataSourceConfiguration</span></span><br></code></pre></div></td></tr></table></figure><ul><li><p>DataSourceTransactionManagerAutoConfigurationï¼š äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®</p></li><li><p>JdbcTemplateAutoConfigurationï¼š <strong>JdbcTemplateçš„è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥æ¥å¯¹æ•°æ®åº“è¿›è¡Œcrud</strong></p></li><li><ul><li>å¯ä»¥ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹@ConfigurationProperties(prefix = <strong>â€œspring.jdbcâ€</strong>) æ¥ä¿®æ”¹JdbcTemplate</li><li>@Bean@Primary   JdbcTemplateï¼›å®¹å™¨ä¸­æœ‰è¿™ä¸ªç»„ä»¶</li></ul></li><li><p>JndiDataSourceAutoConfigurationï¼š jndiçš„è‡ªåŠ¨é…ç½®</p></li><li><p>XADataSourceAutoConfigurationï¼š åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„</p></li></ul><h5 id="3ã€ä¿®æ”¹é…ç½®é¡¹"><a href="#3ã€ä¿®æ”¹é…ç½®é¡¹" class="headerlink" title="3ã€ä¿®æ”¹é…ç½®é¡¹"></a>3ã€ä¿®æ”¹é…ç½®é¡¹</h5><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br></code></pre></div></td></tr></table></figure><h5 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Boot05WebAdminApplicationTests</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<br><br><span class="hljs-comment">//        jdbcTemplate.queryForObject(&quot;select * from account_tbl&quot;)</span><br><span class="hljs-comment">//        jdbcTemplate.queryForList(&quot;select * from account_tbl&quot;,)</span><br>        Long aLong = jdbcTemplate.queryForObject(<span class="hljs-string">&quot;select count(*) from account_tbl&quot;</span>, Long.class);<br>        log.info(<span class="hljs-string">&quot;è®°å½•æ€»æ•°ï¼š&#123;&#125;&quot;</span>,aLong);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>é¸£è°¢ï¼š</p><p><a href="https://spring.io/projects/spring-boot">https://spring.io/projects/spring-boot</a></p><p><a href="https://yuque.com/atguigu/springboot">https://yuque.com/atguigu/springboot</a></p><p><a href="https://blog.csdn.net/weixin_40753536/article/details/81285046">https://blog.csdn.net/weixin_40753536/article/details/81285046</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Algorithm</title>
    <link href="/2021/03/27/Algorithm/Algorithm/"/>
    <url>/2021/03/27/Algorithm/Algorithm/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ¦´Algorithm"><a href="#ğŸ¦´Algorithm" class="headerlink" title="ğŸ¦´Algorithm"></a>ğŸ¦´Algorithm</h1><p> ğŸ“• Juejinï¼š<a href="https://juejin.cn/user/668945886743486">https://juejin.cn/user/668945886743486</a> é™„è§£é¢˜è¯¦è§£</p><p>ğŸ’» GitHubï¼š<a href="https://github.com/hypocrite30/LeetCode">https://github.com/hypocrite30/LeetCode</a> ä»£ç ä»“åº“</p><p><strong>æ¬¢è¿å…³æ³¨ï¼Œäº¤æµå­¦ä¹ ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Centos 6æ— æ³•ä½¿ç”¨yumè§£å†³åŠæ³•</title>
    <link href="/2021/03/27/Linux/Centos%206%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8yum%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <url>/2021/03/27/Linux/Centos%206%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8yum%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos-6æ— æ³•ä½¿ç”¨yumè§£å†³åŠæ³•"><a href="#Centos-6æ— æ³•ä½¿ç”¨yumè§£å†³åŠæ³•" class="headerlink" title="Centos 6æ— æ³•ä½¿ç”¨yumè§£å†³åŠæ³•"></a>Centos 6æ— æ³•ä½¿ç”¨yumè§£å†³åŠæ³•</h1><p>CentOS 6å·²ç»éšç€2020å¹´11æœˆçš„ç»“æŸè¿›å…¥äº†EOLï¼ˆReaches End of Lifeï¼‰ï¼Œä¸è¿‡æœ‰ä¸€äº›è€è®¾å¤‡ä¾ç„¶éœ€è¦æ”¯æŒï¼ŒCentOSå®˜æ–¹ä¹Ÿç»™è¿™äº›è¿˜ä¸æƒ³æŠŠCentOS 6æ‰”è¿›åƒåœ¾å †çš„ç”¨æˆ·ä¿ç•™äº†æœ€åä¸€ä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œåªæ˜¯è¿™ä¸ªé•œåƒä¸ä¼šå†æœ‰æ›´æ–°äº†</p><p>å®˜æ–¹ä¾¿åœ¨12æœˆ2æ—¥æ­£å¼å°†CentOS 6ç›¸å…³çš„è½¯ä»¶æºç§»å‡ºäº†å®˜æ–¹æºï¼Œéšä¹‹è€Œæ¥é€çº§é•œåƒä¹Ÿä¼šé™†ç»­å°†å…¶åˆ é™¤ã€‚</p><p>ä¸è¿‡æœ‰ä¸€äº›è€è®¾å¤‡ä¾ç„¶éœ€è¦ç»´æŒåœ¨å½“å‰ç³»ç»Ÿï¼ŒCentOSå®˜æ–¹ä¹Ÿç»™è¿™äº›è¿˜ä¸æƒ³æŠŠCentOS 6æ‰”è¿›åƒåœ¾å †çš„ç”¨æˆ·ä¿ç•™äº†å„ä¸ªç‰ˆæœ¬è½¯ä»¶æºçš„é•œåƒï¼Œåªæ˜¯è¿™ä¸ªè½¯ä»¶æºä¸ä¼šå†æœ‰æ›´æ–°äº†ã€‚</p><h2 id="ä¸€ã€ä¸€é”®ä¿®å¤"><a href="#ä¸€ã€ä¸€é”®ä¿®å¤" class="headerlink" title="ä¸€ã€ä¸€é”®ä¿®å¤"></a>ä¸€ã€ä¸€é”®ä¿®å¤</h2><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sed -i <span class="hljs-string">&quot;s|enabled=1|enabled=0|g&quot;</span> <span class="hljs-regexp">/etc/yum</span><span class="hljs-regexp">/pluginconf.d/</span>fastestmirror.conf<br>mv <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo /</span>etc<span class="hljs-regexp">/yum.repos.d/</span>CentOS-Base.repo.backup<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo https:/</span><span class="hljs-regexp">/www.xmpan.com/</span>Centos-<span class="hljs-number">6</span>-Vault-Aliyun.repo <br>yum clean all<br>yum makecache<br></code></pre></div></td></tr></table></figure><h2 id="äºŒã€æ‰‹åŠ¨ä¿®å¤"><a href="#äºŒã€æ‰‹åŠ¨ä¿®å¤" class="headerlink" title="äºŒã€æ‰‹åŠ¨ä¿®å¤"></a>äºŒã€æ‰‹åŠ¨ä¿®å¤</h2><p>é¦–å…ˆæŠŠfastestmirrorså…³äº†</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">#ç¼–è¾‘</span><br>vi <span class="hljs-regexp">/etc/yum</span><span class="hljs-regexp">/pluginconf.d/</span>fastestmirror.conf<br><span class="hljs-comment">#ä¿®æ”¹</span><br>enable=<span class="hljs-number">0</span><br><span class="hljs-comment">#æˆ–è€…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span><br>sed -i <span class="hljs-string">&quot;s|enabled=1|enabled=0|g&quot;</span> <span class="hljs-regexp">/etc/yum</span><span class="hljs-regexp">/pluginconf.d/</span>fastestmirror.conf<br></code></pre></div></td></tr></table></figure><p>å…ˆæŠŠä¹‹å‰çš„repoæŒªåˆ°å¤‡ä»½ï¼Œç„¶åä¸‹é¢ä¸¤ä¸ªäºŒé€‰ä¸€</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">mv <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo /</span>etc<span class="hljs-regexp">/yum.repos.d/</span>CentOS-Base.repo.bak<br></code></pre></div></td></tr></table></figure><p>æ›¿æ¢ä¸ºå®˜æ–¹Vaultæº(æµ·å¤–æœåŠ¡å™¨ç”¨)</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo https:/</span><span class="hljs-regexp">/www.xmpan.com/</span>Centos-<span class="hljs-number">6</span>-Vault-Official.repo<br></code></pre></div></td></tr></table></figure><p>æˆ–è€…æ›¿æ¢ä¸ºé˜¿é‡Œäº‘Vaulté•œåƒ(å›½å†…æœåŠ¡å™¨ç”¨)</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo https:/</span><span class="hljs-regexp">/www.xmpan.com/</span>Centos-<span class="hljs-number">6</span>-Vault-Aliyun.repo<br></code></pre></div></td></tr></table></figure><blockquote><p>ä»¥ä¸Šè½¬è‡ªï¼šç†ŠçŒ«ç•”</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaæ‰‹åŠ¨å®ç°è¿­ä»£å™¨ã€‚(LeetCode 341)</title>
    <link href="/2021/03/23/JavaSE/Java%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E8%BF%AD%E4%BB%A3%E5%99%A8%E3%80%82(LeetCode%20341)/"/>
    <url>/2021/03/23/JavaSE/Java%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E8%BF%AD%E4%BB%A3%E5%99%A8%E3%80%82(LeetCode%20341)/</url>
    
    <content type="html"><![CDATA[<h1 id="341-æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨"><a href="#341-æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨" class="headerlink" title="341. æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨"></a>341. æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨</h1><hr><p><a href="https://imgtu.com/i/6T7qHO"><img src="https://z3.ax1x.com/2021/03/23/6T7qHO.png" alt="leetCode 341"></a></p><p><a href="https://leetcode-cn.com/problems/flatten-nested-list-iterator/">https://leetcode-cn.com/problems/flatten-nested-list-iterator/</a></p><ul><li>å…ˆå£°æ˜ <code>NestedInteger</code> çš„ç»“æ„ï¼ˆé¢˜ç›®ç»™å‡ºï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NestedInteger</span> </span>&#123;<br><br>    <span class="hljs-comment">// @return true if this NestedInteger holds a single integer, rather than a nested list.</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isInteger</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">// @return the single integer that this NestedInteger holds, if it holds a single integer</span><br>    <span class="hljs-comment">// Return null if this NestedInteger holds a nested list</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getInteger</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">// @return the nested list that this NestedInteger holds, if it holds a nested list</span><br>    <span class="hljs-comment">// Return null if this NestedInteger holds a single integer</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;NestedInteger&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="è¿­ä»£å™¨ï¼ˆæ•ˆç‡æœ€é«˜ï¼‰"><a href="#è¿­ä»£å™¨ï¼ˆæ•ˆç‡æœ€é«˜ï¼‰" class="headerlink" title="è¿­ä»£å™¨ï¼ˆæ•ˆç‡æœ€é«˜ï¼‰"></a>è¿­ä»£å™¨ï¼ˆæ•ˆç‡æœ€é«˜ï¼‰</h2><ul><li>æ‰‹åŠ¨éå†ï¼Œå°†éå†ç»“æœå­˜åœ¨é›†åˆä¸­ï¼Œç„¶åç”Ÿæˆè¿­ä»£å™¨ï¼Œå…¶ä»–æ“ä½œåŸºäºæ­¤è¿­ä»£å™¨å³å¯ã€‚</li><li>éå†æ–¹å¼æ˜¯DFSï¼Œå› ä¸ºæ­¤ç»“æ„å¯ä»¥è”ç³»åˆ°æ•°æ®ç»“æ„ä¸­çš„ <code>æ ‘</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * use Java Iterator</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NestedIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;<br><br>    <span class="hljs-keyword">private</span> Iterator&lt;Integer&gt; iterator;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">NestedIterator</span><span class="hljs-params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;<br>        List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (NestedInteger node : nestedList) &#123;<br>            DFS(node, list);<br>        &#125;<br>        <span class="hljs-keyword">this</span>.iterator = list.iterator(); <span class="hljs-comment">// all the operation use list&#x27;s iterator</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> iterator.next();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> iterator.hasNext();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * DFS get every element into List res;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DFS</span><span class="hljs-params">(NestedInteger node, List&lt;Integer&gt; res)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (node.isInteger()) &#123;<br>            res.add(node.getInteger());<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (NestedInteger child : node.getList()) &#123;<br>            DFS(child, res);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="é˜Ÿåˆ—-DFSï¼ˆç”¨é˜Ÿåˆ—å®ç°-Iteratorï¼‰"><a href="#é˜Ÿåˆ—-DFSï¼ˆç”¨é˜Ÿåˆ—å®ç°-Iteratorï¼‰" class="headerlink" title="é˜Ÿåˆ— + DFSï¼ˆç”¨é˜Ÿåˆ—å®ç° Iteratorï¼‰"></a>é˜Ÿåˆ— + DFSï¼ˆç”¨é˜Ÿåˆ—å®ç° Iteratorï¼‰</h2><ul><li>é“ç†åŒä¸Šï¼ŒDFSæ‰‹åŠ¨éå†ï¼Œå°†éå†ç»“æœå­˜åœ¨é˜Ÿåˆ—ä¸­</li><li>ç”¨é˜Ÿåˆ—æ‰‹åŠ¨å®ç° <code>iterator</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * use DFS and Queue</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NestedIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;<br><br>    Deque&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> ArrayDeque&lt;Integer&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">NestedIterator</span><span class="hljs-params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;<br>        DFS(nestedList);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hasNext() ? queue.pollFirst() : -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> !queue.isEmpty();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * DFS the nestedList, offer the elements into the queue</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DFS</span><span class="hljs-params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (NestedInteger elem : nestedList) &#123;<br>            <span class="hljs-keyword">if</span> (elem.isInteger()) &#123; <span class="hljs-comment">// elem is Integer, offer the queue</span><br>                queue.addLast(elem.getInteger());<br>            &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">// elem is List, DFS the list and offer the elements into queue</span><br>                DFS(elem.getList());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æ ˆ-é€’å½’-Stack-Recursion"><a href="#æ ˆ-é€’å½’-Stack-Recursion" class="headerlink" title="æ ˆ + é€’å½’ (Stack + Recursion)"></a>æ ˆ + é€’å½’ (Stack + Recursion)</h2><ul><li>ä¸åŒäºé˜Ÿåˆ—çš„æ˜¯ï¼Œé˜Ÿåˆ—è¦åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå°†éå†çš„ç»“æœå…¨éƒ¨å¤„ç†å¥½ï¼Œæœ€åæŒ‰ç…§é¡ºåºè¿›è¡Œæ“ä½œå³å¯ã€‚</li><li>åˆ©ç”¨æ ˆçš„æ€æƒ³æ˜¯ï¼Œå…ˆå°†è¿™äº› <code>NestedInteger</code>æŒ‰é¡ºåºï¼ˆå€’åºï¼‰å­˜æ”¾åœ¨æ ˆä¸­ï¼Œè€Œè¦ä½¿ç”¨é‡Œé¢çš„å…ƒç´ æ—¶ï¼Œå†ä¸€æ­¥æ­¥çš„<strong>æ‹†å°</strong>å‡ºæ¥ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * use Stack and Recursion</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NestedIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;<br><br>    Deque&lt;NestedInteger&gt; stack = <span class="hljs-keyword">new</span> ArrayDeque&lt;NestedInteger&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">NestedIterator</span><span class="hljs-params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = nestedList.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span> ; i--) &#123;<br>            stack.push(nestedList.get(i));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hasNext() ? stack.pop().getInteger() : -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (stack.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">// stack not empty, judge the peek elem&#x27;s type(List/Integer)</span><br>            NestedInteger elem = stack.peek();<br>            <span class="hljs-keyword">if</span> (elem.isInteger()) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// peek elem is list, iterate the list to push elem into the stack</span><br>                elem = stack.pop();<br>                List&lt;NestedInteger&gt; list = elem.getList();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = list.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>                    stack.push(list.get(i));<br>                &#125;<br>                <span class="hljs-keyword">return</span> hasNext();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Mybatis-plus</title>
    <link href="/2021/03/20/SSM/mybatis-plus/"/>
    <url>/2021/03/20/SSM/mybatis-plus/</url>
    
    <content type="html"><![CDATA[<h3 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis Plus"></a>MyBatis Plus</h3><p>å›½äº§çš„å¼€æºæ¡†æ¶ï¼ŒåŸºäº MyBatis</p><p>æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ç®€åŒ– MyBatis çš„å¼€å‘ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="MyBatis-Plus-å¿«é€Ÿä¸Šæ‰‹"><a href="#MyBatis-Plus-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="MyBatis Plus å¿«é€Ÿä¸Šæ‰‹"></a>MyBatis Plus å¿«é€Ÿä¸Šæ‰‹</h3><p>Spring Boot(2.3.0) + MyBatis Plusï¼ˆå›½äº§çš„å¼€æºæ¡†æ¶ï¼Œå¹¶æ²¡æœ‰æ¥å…¥åˆ° Spring å®˜æ–¹å­µåŒ–å™¨ä¸­ï¼‰</p><p>1ã€åˆ›å»º Maven å·¥ç¨‹</p><p><a href="https://imgtu.com/i/cAs0KO"><img src="https://z3.ax1x.com/2021/03/31/cAs0KO.png" alt="cAs0KO.png"></a></p><p>2ã€pom.xml å¼•å…¥ MyBatis Plus çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.1.tmp<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>3ã€åˆ›å»ºå®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>4ã€åˆ›å»º Mapper æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.entity.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">User</span>&gt; </span>&#123;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>5ã€application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db?useUnicode=true&amp;characterEncoding=UTF-8</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br></code></pre></div></td></tr></table></figure><p>6ã€å¯åŠ¨ç±»éœ€è¦æ·»åŠ  @MapperScan(â€œmapperæ‰€åœ¨çš„åŒ…â€)ï¼Œå¦åˆ™æ— æ³•åŠ è½½ Mppaer beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus;<br><br><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@MapperScan(&quot;com.southwind.mybatisplus.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisplusApplication</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(MybatisplusApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>7ã€æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.mapper;<br><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMapperTest</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper mapper;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>        mapper.selectList(<span class="hljs-keyword">null</span>).forEach(System.out::println);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><blockquote><p>@TableName</p></blockquote><p>æ˜ å°„æ•°æ®åº“çš„è¡¨å</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>@TableId</p></blockquote><p>è®¾ç½®ä¸»é”®æ˜ å°„ï¼Œvalue æ˜ å°„ä¸»é”®å­—æ®µå</p><p>type è®¾ç½®ä¸»é”®ç±»å‹ï¼Œä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">AUTO(<span class="hljs-number">0</span>),<br>NONE(<span class="hljs-number">1</span>),<br>INPUT(<span class="hljs-number">2</span>),<br>ASSIGN_ID(<span class="hljs-number">3</span>),<br>ASSIGN_UUID(<span class="hljs-number">4</span>),<br><span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span><br><span class="hljs-meta">@Deprecated</span><br>ID_WORKER(<span class="hljs-number">3</span>),<br><span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span><br><span class="hljs-meta">@Deprecated</span><br>ID_WORKER_STR(<span class="hljs-number">3</span>),<br><span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span><br><span class="hljs-meta">@Deprecated</span><br>UUID(<span class="hljs-number">4</span>);<br></code></pre></div></td></tr></table></figure><table><thead><tr><th>å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>AUTO</td><td>æ•°æ®åº“è‡ªå¢</td></tr><tr><td>NONE</td><td>MP set ä¸»é”®ï¼Œé›ªèŠ±ç®—æ³•å®ç°</td></tr><tr><td>INPUT</td><td>éœ€è¦å¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼</td></tr><tr><td>ASSIGN_ID</td><td>MP åˆ†é… IDï¼ŒLongã€Integerã€String</td></tr><tr><td>ASSIGN_UUID</td><td>åˆ†é… UUIDï¼ŒStrinig</td></tr></tbody></table><p>INPUT å¦‚æœå¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨èµ‹å€¼ï¼Œåˆ™æ•°æ®åº“é€šè¿‡è‡ªå¢çš„æ–¹å¼ç»™ä¸»é”®èµ‹å€¼ï¼Œå¦‚æœå¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼ï¼Œåˆ™å­˜å…¥è¯¥å€¼ã€‚</p><p>AUTO é»˜è®¤å°±æ˜¯æ•°æ®åº“è‡ªå¢ï¼Œå¼€å‘è€…æ— éœ€èµ‹å€¼ã€‚</p><p>ASSIGN_ID MP è‡ªåŠ¨èµ‹å€¼ï¼Œé›ªèŠ±ç®—æ³•ã€‚</p><p>ASSIGN_UUID ä¸»é”®çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Stringï¼Œè‡ªåŠ¨ç”Ÿæˆ UUID è¿›è¡Œèµ‹å€¼</p><blockquote><p>@TableField</p></blockquote><p>æ˜ å°„éä¸»é”®å­—æ®µï¼Œvalue æ˜ å°„å­—æ®µå</p><p>exist è¡¨ç¤ºæ˜¯å¦ä¸ºæ•°æ®åº“å­—æ®µ falseï¼Œå¦‚æœå®ä½“ç±»ä¸­çš„æˆå‘˜å˜é‡åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”çš„å­—æ®µï¼Œåˆ™å¯ä»¥ä½¿ç”¨ existï¼ŒVOã€DTO</p><p>select è¡¨ç¤ºæ˜¯å¦æŸ¥è¯¢è¯¥å­—æ®µ</p><p>fill è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨å¡«å……ï¼Œå°†å¯¹è±¡å­˜å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œç”± MyBatis Plus è‡ªåŠ¨ç»™æŸäº›å­—æ®µèµ‹å€¼ï¼Œcreate_timeã€update_time</p><p>1ã€ç»™è¡¨æ·»åŠ  create_timeã€update_time å­—æ®µ</p><p>2ã€å®ä½“ç±»ä¸­æ·»åŠ æˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-meta">@TableField(value = &quot;name&quot;,select = false)</span><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String gender;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>3ã€åˆ›å»ºè‡ªåŠ¨å¡«å……å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.handler;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MetaObjectHandler</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.setFieldValByName(<span class="hljs-string">&quot;createTime&quot;</span>,<span class="hljs-keyword">new</span> Date(),metaObject);<br>        <span class="hljs-keyword">this</span>.setFieldValByName(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-keyword">new</span> Date(),metaObject);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.setFieldValByName(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-keyword">new</span> Date(),metaObject);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>@Version</p></blockquote><p>æ ‡è®°ä¹è§‚é”ï¼Œé€šè¿‡ version å­—æ®µæ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œå½“ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»¥ version ä½œä¸ºæ¡ä»¶ï¼Œå½“æ¡ä»¶æˆç«‹çš„æ—¶å€™æ‰ä¼šä¿®æ”¹æˆåŠŸã€‚</p><p>version = 2</p><p>çº¿ç¨‹ 1:update â€¦ set version = 2  where version = 1</p><p>çº¿ç¨‹2 ï¼šupdate â€¦ set version = 2 where version = 1</p><p>1ã€æ•°æ®åº“è¡¨æ·»åŠ  version å­—æ®µï¼Œé»˜è®¤å€¼ä¸º 1</p><p>2ã€å®ä½“ç±»æ·»åŠ  version æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”æ·»åŠ  @Version </p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-meta">@TableField(value = &quot;name&quot;,select = false)</span><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String gender;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-meta">@Version</span><br>    <span class="hljs-keyword">private</span> Integer version;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>3ã€æ³¨å†Œé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.config;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisPlusConfig</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> OptimisticLockerInterceptor <span class="hljs-title">optimisticLockerInterceptor</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OptimisticLockerInterceptor();<br>    &#125;<br>    <br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>@EnumValue</p></blockquote><p>1ã€é€šç”¨æšä¸¾ç±»æ³¨è§£ï¼Œå°†æ•°æ®åº“å­—æ®µæ˜ å°„æˆå®ä½“ç±»çš„æšä¸¾ç±»å‹æˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.enums;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.EnumValue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">StatusEnum</span> </span>&#123;<br>    WORK(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;ä¸Šç­&quot;</span>),<br>    REST(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;ä¼‘æ¯&quot;</span>);<br><br>    StatusEnum(Integer code, String msg) &#123;<br>        <span class="hljs-keyword">this</span>.code = code;<br>        <span class="hljs-keyword">this</span>.msg = msg;<br>    &#125;<br><br>    <span class="hljs-meta">@EnumValue</span><br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-keyword">private</span> String msg;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.enums.StatusEnum;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-meta">@TableField(value = &quot;name&quot;,select = false)</span><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String gender;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-meta">@Version</span><br>    <span class="hljs-keyword">private</span> Integer version;<br>    <span class="hljs-keyword">private</span> StatusEnum status;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">type-enums-package:</span> <br>  <span class="hljs-string">com.southwind.mybatisplus.enums</span><br></code></pre></div></td></tr></table></figure><p>2ã€å®ç°æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.enums;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.enums.IEnum;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">AgeEnum</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IEnum</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;<br>    ONE(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;ä¸€å²&quot;</span>),<br>    TWO(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;ä¸¤å²&quot;</span>),<br>    THREE(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;ä¸‰å²&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-keyword">private</span> String msg;<br><br>    AgeEnum(Integer code, String msg) &#123;<br>        <span class="hljs-keyword">this</span>.code = code;<br>        <span class="hljs-keyword">this</span>.msg = msg;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getValue</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.code;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>@TableLogic</p></blockquote><p>æ˜ å°„é€»è¾‘åˆ é™¤</p><p>1ã€æ•°æ®è¡¨æ·»åŠ  deleted å­—æ®µ</p><p>2ã€å®ä½“ç±»æ·»åŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.enums.AgeEnum;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.enums.StatusEnum;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-meta">@TableField(value = &quot;name&quot;,select = false)</span><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> AgeEnum age;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String gender;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-meta">@Version</span><br>    <span class="hljs-keyword">private</span> Integer version;<br>    <span class="hljs-meta">@TableField(value = &quot;status&quot;)</span><br>    <span class="hljs-keyword">private</span> StatusEnum statusEnum;<br>    <span class="hljs-meta">@TableLogic</span><br>    <span class="hljs-keyword">private</span> Integer deleted;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>3ã€application.yml æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">global-config:</span><br>  <span class="hljs-attr">db-config:</span><br>    <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//mapper.selectList(null);</span><br>QueryWrapper wrapper = <span class="hljs-keyword">new</span> QueryWrapper();<br><span class="hljs-comment">//        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="hljs-comment">//        map.put(&quot;name&quot;,&quot;å°çº¢&quot;);</span><br><span class="hljs-comment">//        map.put(&quot;age&quot;,3);</span><br><span class="hljs-comment">//        wrapper.allEq(map);</span><br><span class="hljs-comment">//        wrapper.gt(&quot;age&quot;,2);</span><br><span class="hljs-comment">//        wrapper.ne(&quot;name&quot;,&quot;å°çº¢&quot;);</span><br><span class="hljs-comment">//        wrapper.ge(&quot;age&quot;,2);</span><br><br><span class="hljs-comment">//like &#x27;%å°&#x27;</span><br><span class="hljs-comment">//        wrapper.likeLeft(&quot;name&quot;,&quot;å°&quot;);</span><br><span class="hljs-comment">//like &#x27;å°%&#x27;</span><br><span class="hljs-comment">//        wrapper.likeRight(&quot;name&quot;,&quot;å°&quot;);</span><br><br><span class="hljs-comment">//inSQL</span><br><span class="hljs-comment">//        wrapper.inSql(&quot;id&quot;,&quot;select id from user where id &lt; 10&quot;);</span><br><span class="hljs-comment">//        wrapper.inSql(&quot;age&quot;,&quot;select age from user where age &gt; 3&quot;);</span><br><br><span class="hljs-comment">//        wrapper.orderByDesc(&quot;age&quot;);</span><br><br><span class="hljs-comment">//        wrapper.orderByAsc(&quot;age&quot;);</span><br><span class="hljs-comment">//        wrapper.having(&quot;id &gt; 8&quot;);</span><br><br>mapper.selectList(wrapper).forEach(System.out::println);<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//        System.out.println(mapper.selectById(7));</span><br><span class="hljs-comment">//        mapper.selectBatchIds(Arrays.asList(7,8,9)).forEach(System.out::println);</span><br><br><span class="hljs-comment">//Map åªèƒ½åšç­‰å€¼åˆ¤æ–­ï¼Œé€»è¾‘åˆ¤æ–­éœ€è¦ä½¿ç”¨ Wrapper æ¥å¤„ç†</span><br><span class="hljs-comment">//        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="hljs-comment">//        map.put(&quot;id&quot;,7);</span><br><span class="hljs-comment">//        mapper.selectByMap(map).forEach(System.out::println);</span><br><br>QueryWrapper wrapper = <span class="hljs-keyword">new</span> QueryWrapper();<br>wrapper.eq(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-number">7</span>);<br><span class="hljs-comment">////        System.out.println(mapper.selectCount(wrapper));</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        //å°†æŸ¥è¯¢çš„ç»“æœé›†å°è£…åˆ°Mapä¸­</span><br><span class="hljs-comment">//        mapper.selectMaps(wrapper).forEach(System.out::println);</span><br><span class="hljs-comment">//        System.out.println(&quot;-------------------&quot;);</span><br><span class="hljs-comment">//        mapper.selectList(wrapper).forEach(System.out::println);</span><br><br><span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">//        Page&lt;User&gt; page = new Page&lt;&gt;(2,2);</span><br><span class="hljs-comment">//        Page&lt;User&gt; result = mapper.selectPage(page,null);</span><br><span class="hljs-comment">//        System.out.println(result.getSize());</span><br><span class="hljs-comment">//        System.out.println(result.getTotal());</span><br><span class="hljs-comment">//        result.getRecords().forEach(System.out::println);</span><br><br><span class="hljs-comment">//        Page&lt;Map&lt;String,Object&gt;&gt; page = new Page&lt;&gt;(1,2);</span><br><span class="hljs-comment">//        mapper.selectMapsPage(page,null).getRecords().forEach(System.out::println);</span><br><br><span class="hljs-comment">//        mapper.selectObjs(null).forEach(System.out::println);</span><br><br><br>System.out.println(mapper.selectOne(wrapper));<br></code></pre></div></td></tr></table></figure><h3 id="è‡ªå®šä¹‰-SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰"><a href="#è‡ªå®šä¹‰-SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰" class="headerlink" title="è‡ªå®šä¹‰ SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰"></a>è‡ªå®šä¹‰ SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.entity;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductVO</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer category;<br>    <span class="hljs-keyword">private</span> Integer count;<br>    <span class="hljs-keyword">private</span> String description;<br>    <span class="hljs-keyword">private</span> Integer userId;<br>    <span class="hljs-keyword">private</span> String userName;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.entity.ProductVO;<br><span class="hljs-keyword">import</span> com.southwind.mybatisplus.entity.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">User</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Select(&quot;select p.*,u.name userName from product p,user u where p.user_id = u.id and u.id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-function">List&lt;ProductVO&gt; <span class="hljs-title">productList</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">User user = <span class="hljs-keyword">new</span> User();<br>user.setTitle(<span class="hljs-string">&quot;å°æ˜&quot;</span>);<br>user.setAge(<span class="hljs-number">22</span>);<br>mapper.insert(user);<br>System.out.println(user);<br></code></pre></div></td></tr></table></figure><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//mapper.deleteById(1);</span><br><span class="hljs-comment">//        mapper.deleteBatchIds(Arrays.asList(7,8));</span><br><span class="hljs-comment">//        QueryWrapper wrapper = new QueryWrapper();</span><br><span class="hljs-comment">//        wrapper.eq(&quot;age&quot;,14);</span><br><span class="hljs-comment">//        mapper.delete(wrapper);</span><br><br>Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-number">10</span>);<br>mapper.deleteByMap(map);<br></code></pre></div></td></tr></table></figure><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>        <span class="hljs-regexp">//u</span>pdate ... version = <span class="hljs-number">3</span> where version = <span class="hljs-number">2</span><br><span class="hljs-regexp">//</span>        User user = mapper.selectById(<span class="hljs-number">7</span>);<br><span class="hljs-regexp">//</span>        user.setTitle(<span class="hljs-string">&quot;ä¸€å·&quot;</span>);<br><span class="hljs-regexp">//</span><br><span class="hljs-regexp">//</span>        <span class="hljs-regexp">//u</span>pdate ... version = <span class="hljs-number">3</span> where version = <span class="hljs-number">2</span><br><span class="hljs-regexp">//</span>        User user1 = mapper.selectById(<span class="hljs-number">7</span>);<br><span class="hljs-regexp">//</span>        user1.setTitle(<span class="hljs-string">&quot;äºŒå·&quot;</span>);<br><span class="hljs-regexp">//</span><br><span class="hljs-regexp">//</span>        mapper.updateById(user1);<br><span class="hljs-regexp">//</span>        mapper.updateById(user);<br><br>User user = mapper.selectById(<span class="hljs-number">1</span>);<br>user.setTitle(<span class="hljs-string">&quot;å°çº¢&quot;</span>);<br>QueryWrapper wrapper = new QueryWrapper();<br>wrapper.eq(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">22</span>);<br>mapper.update(user,wrapper);<br></code></pre></div></td></tr></table></figure><h3 id="MyBatisPlus-è‡ªåŠ¨ç”Ÿæˆ"><a href="#MyBatisPlus-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="MyBatisPlus è‡ªåŠ¨ç”Ÿæˆ"></a>MyBatisPlus è‡ªåŠ¨ç”Ÿæˆ</h3><p>æ ¹æ®æ•°æ®è¡¨è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»ã€Mapperã€Serviceã€ServiceImplã€Controller</p><p>1ã€pom.xml å¯¼å…¥ MyBatis Plus Generator</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.1.tmp<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.velocity<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>velocity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Velocityï¼ˆé»˜è®¤ï¼‰ã€Freemarkerã€Beetl</p><p>2ã€å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.southwind.mybatisplus;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//åˆ›å»ºgeneratorå¯¹è±¡</span><br>        AutoGenerator autoGenerator = <span class="hljs-keyword">new</span> AutoGenerator();<br>        <span class="hljs-comment">//æ•°æ®æº</span><br>        DataSourceConfig dataSourceConfig = <span class="hljs-keyword">new</span> DataSourceConfig();<br>        dataSourceConfig.setDbType(DbType.MYSQL);<br>        dataSourceConfig.setUrl(<span class="hljs-string">&quot;jdbc:mysql://ip:3306/db?useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>);<br>        dataSourceConfig.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>        dataSourceConfig.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br>        dataSourceConfig.setDriverName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>        autoGenerator.setDataSource(dataSourceConfig);<br>        <span class="hljs-comment">//å…¨å±€é…ç½®</span><br>        GlobalConfig globalConfig = <span class="hljs-keyword">new</span> GlobalConfig();<br>        globalConfig.setOutputDir(System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>)+<span class="hljs-string">&quot;/src/main/java&quot;</span>);<br>        globalConfig.setOpen(<span class="hljs-keyword">false</span>);<br>        globalConfig.setAuthor(<span class="hljs-string">&quot;southwind&quot;</span>);<br>        globalConfig.setServiceName(<span class="hljs-string">&quot;%sService&quot;</span>);<br>        autoGenerator.setGlobalConfig(globalConfig);<br>        <span class="hljs-comment">//åŒ…ä¿¡æ¯</span><br>        PackageConfig packageConfig = <span class="hljs-keyword">new</span> PackageConfig();<br>        packageConfig.setParent(<span class="hljs-string">&quot;com.southwind.mybatisplus&quot;</span>);<br>        packageConfig.setModuleName(<span class="hljs-string">&quot;generator&quot;</span>);<br>        packageConfig.setController(<span class="hljs-string">&quot;controller&quot;</span>);<br>        packageConfig.setService(<span class="hljs-string">&quot;service&quot;</span>);<br>        packageConfig.setServiceImpl(<span class="hljs-string">&quot;service.impl&quot;</span>);<br>        packageConfig.setMapper(<span class="hljs-string">&quot;mapper&quot;</span>);<br>        packageConfig.setEntity(<span class="hljs-string">&quot;entity&quot;</span>);<br>        autoGenerator.setPackageInfo(packageConfig);<br>        <span class="hljs-comment">//é…ç½®ç­–ç•¥</span><br>        StrategyConfig strategyConfig = <span class="hljs-keyword">new</span> StrategyConfig();<br>        strategyConfig.setEntityLombokModel(<span class="hljs-keyword">true</span>);<br>        strategyConfig.setNaming(NamingStrategy.underline_to_camel);<br>        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);<br>        autoGenerator.setStrategy(strategyConfig);<br><br>        autoGenerator.execute();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>æ¥è‡ªï¼š<a href="https://space.bilibili.com/434617924">https://space.bilibili.com/434617924</a></p><p><a href="https://mp.baomidou.com/">https://mp.baomidou.com/</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>SSM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Mybatis-9.28</title>
    <link href="/2021/03/20/SSM/mybatis/"/>
    <url>/2021/03/20/SSM/mybatis/</url>
    
    <content type="html"><![CDATA[<h2 id="Mybatis-9-28"><a href="#Mybatis-9-28" class="headerlink" title="Mybatis-9.28"></a>Mybatis-9.28</h2><p>ç¯å¢ƒï¼š</p><ul><li>JDK1.8</li><li>Mysql 5.7</li><li>maven 3.6.1</li><li>IDEA</li></ul><p>å›é¡¾ï¼š</p><ul><li>JDBC</li><li>Mysql</li><li>JavaåŸºç¡€</li><li>Maven</li><li>Junit</li></ul><p>SSMæ¡†æ¶ï¼šé…ç½®æ–‡ä»¶çš„ã€‚  æœ€å¥½çš„æ–¹å¼ï¼šçœ‹å®˜ç½‘æ–‡æ¡£ï¼›</p><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><h3 id="1-1ã€ä»€ä¹ˆæ˜¯Mybatis"><a href="#1-1ã€ä»€ä¹ˆæ˜¯Mybatis" class="headerlink" title="1.1ã€ä»€ä¹ˆæ˜¯Mybatis"></a>1.1ã€ä»€ä¹ˆæ˜¯Mybatis</h3><div align=center><img src="https://z3.ax1x.com/2021/03/31/cAwfYV.png" alt="cAwfYV.png" border="0" /></div><ul><li>MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„<strong>æŒä¹…å±‚æ¡†æ¶</strong></li><li>å®ƒæ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚</li><li>MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚</li><li>MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿç±»å‹ã€æ¥å£å’Œ Java çš„ POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</li><li>MyBatis æœ¬æ˜¯<a href="https://baike.baidu.com/item/apache/6265">apache</a>çš„ä¸€ä¸ªå¼€æºé¡¹ç›®<a href="https://baike.baidu.com/item/iBatis">iBatis</a>, 2010å¹´è¿™ä¸ªé¡¹ç›®ç”±apache software foundation è¿ç§»åˆ°äº†google codeï¼Œå¹¶ä¸”æ”¹åä¸ºMyBatis ã€‚</li><li>2013å¹´11æœˆè¿ç§»åˆ°Githubã€‚</li></ul><p>å¦‚ä½•è·å¾—Mybatisï¼Ÿ</p><ul><li><p>mavenä»“åº“ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>Github ï¼š <a href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p></li><li><p>ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p></li></ul><h3 id="1-2ã€æŒä¹…åŒ–"><a href="#1-2ã€æŒä¹…åŒ–" class="headerlink" title="1.2ã€æŒä¹…åŒ–"></a>1.2ã€æŒä¹…åŒ–</h3><p>æ•°æ®æŒä¹…åŒ–</p><ul><li>æŒä¹…åŒ–å°±æ˜¯å°†ç¨‹åºçš„æ•°æ®åœ¨æŒä¹…çŠ¶æ€å’Œç¬æ—¶çŠ¶æ€è½¬åŒ–çš„è¿‡ç¨‹</li><li>å†…å­˜ï¼š<strong>æ–­ç”µå³å¤±</strong></li><li>æ•°æ®åº“(Jdbc)ï¼Œioæ–‡ä»¶æŒä¹…åŒ–ã€‚</li><li>ç”Ÿæ´»ï¼šå†·è—. ç½å¤´ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆéœ€è¦éœ€è¦æŒä¹…åŒ–ï¼Ÿ</strong></p><ul><li><p>æœ‰ä¸€äº›å¯¹è±¡ï¼Œä¸èƒ½è®©ä»–ä¸¢æ‰ã€‚</p></li><li><p>å†…å­˜å¤ªè´µäº†</p></li></ul><h3 id="1-3ã€æŒä¹…å±‚"><a href="#1-3ã€æŒä¹…å±‚" class="headerlink" title="1.3ã€æŒä¹…å±‚"></a>1.3ã€æŒä¹…å±‚</h3><p>Daoå±‚ï¼ŒServiceå±‚ï¼ŒControllerå±‚â€¦.</p><ul><li>å®ŒæˆæŒä¹…åŒ–å·¥ä½œçš„ä»£ç å—</li><li>å±‚ç•Œé™ååˆ†æ˜æ˜¾ã€‚</li></ul><h3 id="1-4-ä¸ºä»€ä¹ˆéœ€è¦Mybatisï¼Ÿ"><a href="#1-4-ä¸ºä»€ä¹ˆéœ€è¦Mybatisï¼Ÿ" class="headerlink" title="1.4 ä¸ºä»€ä¹ˆéœ€è¦Mybatisï¼Ÿ"></a>1.4 ä¸ºä»€ä¹ˆéœ€è¦Mybatisï¼Ÿ</h3><ul><li>å¸®åŠ©ç¨‹åºçŒ¿å°†æ•°æ®å­˜å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</li><li>æ–¹ä¾¿</li><li>ä¼ ç»Ÿçš„JDBCä»£ç å¤ªå¤æ‚äº†ã€‚ç®€åŒ–ã€‚æ¡†æ¶ã€‚è‡ªåŠ¨åŒ–ã€‚</li><li>ä¸ç”¨Mybatisä¹Ÿå¯ä»¥ã€‚æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚ <strong>æŠ€æœ¯æ²¡æœ‰é«˜ä½ä¹‹åˆ†</strong></li><li>ä¼˜ç‚¹ï¼š<ul><li>ç®€å•æ˜“å­¦</li><li>çµæ´»</li><li>sqlå’Œä»£ç çš„åˆ†ç¦»ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§ã€‚</li><li>æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„ormå­—æ®µå…³ç³»æ˜ å°„</li><li>æä¾›å¯¹è±¡å…³ç³»æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡å…³ç³»ç»„å»ºç»´æŠ¤</li><li>æä¾›xmlæ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€sqlã€‚</li></ul></li></ul><p><strong>æœ€é‡è¦çš„ä¸€ç‚¹ï¼šä½¿ç”¨çš„äººå¤šï¼</strong></p><p>Spring   SpringMVC    SpringBoot</p><h2 id="2ã€ç¬¬ä¸€ä¸ªMybatisç¨‹åº"><a href="#2ã€ç¬¬ä¸€ä¸ªMybatisç¨‹åº" class="headerlink" title="2ã€ç¬¬ä¸€ä¸ªMybatisç¨‹åº"></a>2ã€ç¬¬ä¸€ä¸ªMybatisç¨‹åº</h2><p>æ€è·¯ï¼šæ­å»ºç¯å¢ƒâ€“&gt;å¯¼å…¥Mybatisâ€“&gt;ç¼–å†™ä»£ç â€“&gt;æµ‹è¯•ï¼</p><h3 id="2-1ã€æ­å»ºç¯å¢ƒ"><a href="#2-1ã€æ­å»ºç¯å¢ƒ" class="headerlink" title="2.1ã€æ­å»ºç¯å¢ƒ"></a>2.1ã€æ­å»ºç¯å¢ƒ</h3><p>æ­å»ºæ•°æ®åº“</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">CREATE DATABASE `mybatis`;<br><br>USE `mybatis`;<br><br>CREATE TABLE `user`(<br>  `id` INT(<span class="hljs-number">20</span>) NOT NULL PRIMARY KEY,<br>  `name` VARCHAR(<span class="hljs-number">30</span>) DEFAULT NULL,<br>  `pwd` VARCHAR(<span class="hljs-number">30</span>) DEFAULT NULL<br>)ENGINE=INNODB DEFAULT CHARSET=utf8;<br><br>INSERT INTO `user`(`id`,`name`,`pwd`) VALUES <br>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ç‹‚ç¥&#x27;</span>,<span class="hljs-string">&#x27;123456&#x27;</span>),<br>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,<span class="hljs-string">&#x27;123456&#x27;</span>),<br>(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;æå››&#x27;</span>,<span class="hljs-string">&#x27;123890&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>æ–°å»ºé¡¹ç›®</p><ol><li><p>æ–°å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®</p></li><li><p>åˆ é™¤srcç›®å½•</p></li><li><p>å¯¼å…¥mavenä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">   <br><span class="hljs-comment">&lt;!--å¯¼å…¥ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--mysqlé©±åŠ¨--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--mybatis--&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--junit--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="2-2ã€åˆ›å»ºä¸€ä¸ªæ¨¡å—"><a href="#2-2ã€åˆ›å»ºä¸€ä¸ªæ¨¡å—" class="headerlink" title="2.2ã€åˆ›å»ºä¸€ä¸ªæ¨¡å—"></a>2.2ã€åˆ›å»ºä¸€ä¸ªæ¨¡å—</h3></li></ol><ul><li><p>ç¼–å†™mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><br><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--configurationæ ¸å¿ƒé…ç½®æ–‡ä»¶--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true<span class="hljs-symbol">&amp;amp;</span>useUnicode=true<span class="hljs-symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>ç¼–å†™mybatiså·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//sqlSessionFactory --&gt; sqlSession</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisUtils</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sqlSessionFactory;<br><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//ä½¿ç”¨Mybatisç¬¬ä¸€æ­¥ï¼šè·å–sqlSessionFactoryå¯¹è±¡</span><br>            String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br>            InputStream inputStream = Resources.getResourceAsStream(resource);<br>            sqlSessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">//æ—¢ç„¶æœ‰äº† SqlSessionFactoryï¼Œé¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ä¸­è·å¾— SqlSession çš„å®ä¾‹äº†ã€‚</span><br>    <span class="hljs-comment">// SqlSession å®Œå…¨åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œ SQL å‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession  <span class="hljs-title">getSqlSession</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession();<br>    &#125;<br><br>&#125;<br><br></code></pre></div></td></tr></table></figure><h3 id="2-3ã€ç¼–å†™ä»£ç "><a href="#2-3ã€ç¼–å†™ä»£ç " class="headerlink" title="2.3ã€ç¼–å†™ä»£ç "></a>2.3ã€ç¼–å†™ä»£ç </h3></li><li><p>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-comment">//å®ä½“ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String pwd;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, String name, String pwd)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.id = id;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        <span class="hljs-keyword">this</span>.pwd = pwd;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPwd</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pwd;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPwd</span><span class="hljs-params">(String pwd)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pwd = pwd;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, pwd=&#x27;&quot;</span> + pwd + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure></li><li><p>Daoæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserList</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li><p>æ¥å£å®ç°ç±»ç”±åŸæ¥çš„UserDaoImplè½¬å˜ä¸ºä¸€ä¸ª Mapperé…ç½®æ–‡ä»¶.</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br>        <span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">                <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">                <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--namespace=ç»‘å®šä¸€ä¸ªå¯¹åº”çš„Dao/Mapperæ¥å£--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.kuang.dao.UserDao&quot;</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--selectæŸ¥è¯¢è¯­å¥--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>       select * from mybatis.user<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="2-4ã€æµ‹è¯•"><a href="#2-4ã€æµ‹è¯•" class="headerlink" title="2.4ã€æµ‹è¯•"></a>2.4ã€æµ‹è¯•</h3></li></ul><p>æ³¨æ„ç‚¹ï¼š</p><p>org.apache.ibatis.binding.BindingException: Type interface com.kuang.dao.UserDao is not known to the MapperRegistry.</p><p><strong>MapperRegistryæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œ mappers</p><ul><li><p>junitæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šè·å¾—SqlSessionå¯¹è±¡</span><br>    SqlSession sqlSession = MybatisUtils.getSqlSession();<br><br><br>    <span class="hljs-comment">//æ–¹å¼ä¸€ï¼šgetMapper</span><br>    UserDao userDao = sqlSession.getMapper(UserDao.class);<br>    List&lt;User&gt; userList = userDao.getUserList();<br><br>    <span class="hljs-keyword">for</span> (User user : userList) &#123;<br>        System.out.println(user);<br>    &#125;<br><br><br><br>    <span class="hljs-comment">//å…³é—­SqlSession</span><br>    sqlSession.close();<br>&#125;<br><br></code></pre></div></td></tr></table></figure></li></ul><p>ä½ ä»¬å¯ä»¥èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p><ol><li>é…ç½®æ–‡ä»¶æ²¡æœ‰æ³¨å†Œ</li><li>ç»‘å®šæ¥å£é”™è¯¯ã€‚</li><li>æ–¹æ³•åä¸å¯¹</li><li>è¿”å›ç±»å‹ä¸å¯¹</li><li>Mavenå¯¼å‡ºèµ„æºé—®é¢˜</li></ol><h2 id="3ã€CRUD"><a href="#3ã€CRUD" class="headerlink" title="3ã€CRUD"></a>3ã€CRUD</h2><h3 id="1ã€namespace"><a href="#1ã€namespace" class="headerlink" title="1ã€namespace"></a>1ã€namespace</h3><p>namespaceä¸­çš„åŒ…åè¦å’Œ Dao/mapper æ¥å£çš„åŒ…åä¸€è‡´ï¼</p><h3 id="2ã€select"><a href="#2ã€select" class="headerlink" title="2ã€select"></a>2ã€select</h3><p>é€‰æ‹©ï¼ŒæŸ¥è¯¢è¯­å¥;</p><ul><li>id : å°±æ˜¯å¯¹åº”çš„namespaceä¸­çš„æ–¹æ³•åï¼›</li><li>resultTypeï¼šSqlè¯­å¥æ‰§è¡Œçš„è¿”å›å€¼ï¼</li><li>parameterType ï¼š å‚æ•°ç±»å‹ï¼</li></ul><ol><li><p>ç¼–å†™æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·</span><br><span class="hljs-function">User <span class="hljs-title">getUserById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;<br></code></pre></div></td></tr></table></figure></li><li><p>ç¼–å†™å¯¹åº”çš„mapperä¸­çš„sqlè¯­å¥</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;getUserById&quot;</span> parameterType=<span class="hljs-string">&quot;int&quot;</span> resultType=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;<br>        select * from mybatis.user where id = #&#123;id&#125;<br>&lt;/select&gt;<br><br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getUserById</span><span class="hljs-params">()</span> </span>&#123;<br>    SqlSession sqlSession = MybatisUtils.getSqlSession();<br>   <br>    UserMapper mapper = sqlSession.getMapper(UserMapper.class);<br>   <br>    User user = mapper.getUserById(<span class="hljs-number">1</span>);<br>    System.out.println(user);<br>   <br>    sqlSession.close();<br>&#125;<br>   <br></code></pre></div></td></tr></table></figure><h3 id="3ã€Insert"><a href="#3ã€Insert" class="headerlink" title="3ã€Insert"></a>3ã€Insert</h3></li></ol><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯ä»¥ç›´æ¥å–å‡ºæ¥--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>    insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="4ã€update"><a href="#4ã€update" class="headerlink" title="4ã€update"></a>4ã€update</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>    update mybatis.user set name=#&#123;name&#125;,pwd=#&#123;pwd&#125;  where id = #&#123;id&#125; ;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><h3 id="5ã€Delete"><a href="#5ã€Delete" class="headerlink" title="5ã€Delete"></a>5ã€Delete</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span><br>    delete from mybatis.user where id = #&#123;id&#125;;<br><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å¢åˆ æ”¹éœ€è¦æäº¤äº‹åŠ¡ï¼</li></ul><h3 id="6ã€åˆ†æé”™è¯¯"><a href="#6ã€åˆ†æé”™è¯¯" class="headerlink" title="6ã€åˆ†æé”™è¯¯"></a>6ã€åˆ†æé”™è¯¯</h3><ul><li>æ ‡ç­¾ä¸è¦åŒ¹é…é”™</li><li>resource ç»‘å®šmapperï¼Œéœ€è¦ä½¿ç”¨è·¯å¾„ï¼</li><li>ç¨‹åºé…ç½®æ–‡ä»¶å¿…é¡»ç¬¦åˆè§„èŒƒï¼</li><li>NullPointerExceptionï¼Œæ²¡æœ‰æ³¨å†Œåˆ°èµ„æº!</li><li>è¾“å‡ºçš„xmlæ–‡ä»¶ä¸­å­˜åœ¨ä¸­æ–‡ä¹±ç é—®é¢˜ï¼</li><li>mavenèµ„æºæ²¡æœ‰å¯¼å‡ºé—®é¢˜ï¼</li></ul><h3 id="7ã€ä¸‡èƒ½Map"><a href="#7ã€ä¸‡èƒ½Map" class="headerlink" title="7ã€ä¸‡èƒ½Map"></a>7ã€ä¸‡èƒ½Map</h3><p>å‡è®¾ï¼Œæˆ‘ä»¬çš„å®ä½“ç±»ï¼Œæˆ–è€…æ•°æ®åº“ä¸­çš„è¡¨ï¼Œå­—æ®µæˆ–è€…å‚æ•°è¿‡å¤šï¼Œæˆ‘ä»¬åº”å½“è€ƒè™‘ä½¿ç”¨Mapï¼</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ä¸‡èƒ½çš„Map</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addUser2</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>;<br><br></code></pre></div></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!--å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯ä»¥ç›´æ¥å–å‡ºæ¥    ä¼ é€’mapçš„key--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><br>    insert into mybatis.user (id, pwd) values (#&#123;userid&#125;,#&#123;passWord&#125;);<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">@Test<br>public void addUser2()&#123;<br>    SqlSession sqlSession = MybatisUtils.getSqlSession();<br><br>    UserMapper mapper = sqlSession.getMapper(UserMapper.class);<br><br><br>    Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();<br><br>    map.put(&quot;userid&quot;,5);<br>    map.put(&quot;passWord&quot;,&quot;2222333&quot;);<br><br>    mapper.addUser2(map);<br><br>    sqlSession.close();<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p>Mapä¼ é€’å‚æ•°ï¼Œç›´æ¥åœ¨sqlä¸­å–å‡ºkeyå³å¯ï¼    ã€parameterType=â€mapâ€ã€‘</p><p>å¯¹è±¡ä¼ é€’å‚æ•°ï¼Œç›´æ¥åœ¨sqlä¸­å–å¯¹è±¡çš„å±æ€§å³å¯ï¼ã€parameterType=â€Objectâ€ã€‘</p><p>åªæœ‰ä¸€ä¸ªåŸºæœ¬ç±»å‹å‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥åœ¨sqlä¸­å–åˆ°ï¼</p><p>å¤šä¸ªå‚æ•°ç”¨Mapï¼Œ<strong>æˆ–è€…æ³¨è§£ï¼</strong></p><h3 id="8ã€æ€è€ƒé¢˜"><a href="#8ã€æ€è€ƒé¢˜" class="headerlink" title="8ã€æ€è€ƒé¢˜"></a>8ã€æ€è€ƒé¢˜</h3><p>æ¨¡ç³ŠæŸ¥è¯¢æ€ä¹ˆå†™ï¼Ÿ</p><ol><li><p>Javaä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼ é€’é€šé…ç¬¦ % %</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">List&lt;User&gt; userList = mapper.getUserLike(<span class="hljs-string">&quot;%æ%&quot;</span>);<br></code></pre></div></td></tr></table></figure></li><li><p>åœ¨sqlæ‹¼æ¥ä¸­ä½¿ç”¨é€šé…ç¬¦ï¼</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">select * from mybatis.user where name like &quot;%&quot;#&#123;value&#125;&quot;%&quot;<br></code></pre></div></td></tr></table></figure></li></ol><h2 id="4ã€é…ç½®è§£æ"><a href="#4ã€é…ç½®è§£æ" class="headerlink" title="4ã€é…ç½®è§£æ"></a>4ã€é…ç½®è§£æ</h2><h3 id="1ã€æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#1ã€æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="1ã€æ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>1ã€æ ¸å¿ƒé…ç½®æ–‡ä»¶</h3><ul><li><p>mybatis-config.xml</p></li><li><p>MyBatis çš„é…ç½®æ–‡ä»¶åŒ…å«äº†ä¼šæ·±æ·±å½±å“ MyBatis è¡Œä¸ºçš„è®¾ç½®å’Œå±æ€§ä¿¡æ¯ã€‚ </p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">configurationï¼ˆé…ç½®ï¼‰<br>propertiesï¼ˆå±æ€§ï¼‰<br>settingsï¼ˆè®¾ç½®ï¼‰<br>typeAliasesï¼ˆç±»å‹åˆ«åï¼‰<br>typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰<br>objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰<br>pluginsï¼ˆæ’ä»¶ï¼‰<br>environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰<br>environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰<br>transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰<br>dataSourceï¼ˆæ•°æ®æºï¼‰<br>databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†ï¼‰<br>mappersï¼ˆæ˜ å°„å™¨ï¼‰<br></code></pre></div></td></tr></table></figure><h3 id="2ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰"><a href="#2ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰" class="headerlink" title="2ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰"></a>2ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰</h3></li></ul><p>MyBatis å¯ä»¥é…ç½®æˆé€‚åº”å¤šç§ç¯å¢ƒ</p><p><strong>ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚</strong></p><p>å­¦ä¼šä½¿ç”¨é…ç½®å¤šå¥—è¿è¡Œç¯å¢ƒï¼</p><p>Mybatisé»˜è®¤çš„äº‹åŠ¡ç®¡ç†å™¨å°±æ˜¯ JDBC  ï¼Œ è¿æ¥æ±  ï¼š POOLED</p><h3 id="3ã€å±æ€§ï¼ˆpropertiesï¼‰"><a href="#3ã€å±æ€§ï¼ˆpropertiesï¼‰" class="headerlink" title="3ã€å±æ€§ï¼ˆpropertiesï¼‰"></a>3ã€å±æ€§ï¼ˆpropertiesï¼‰</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡propertieså±æ€§æ¥å®ç°å¼•ç”¨é…ç½®æ–‡ä»¶</p><p>è¿™äº›å±æ€§éƒ½æ˜¯å¯å¤–éƒ¨é…ç½®ä¸”å¯åŠ¨æ€æ›¿æ¢çš„ï¼Œæ—¢å¯ä»¥åœ¨å…¸å‹çš„ Java å±æ€§æ–‡ä»¶ä¸­é…ç½®ï¼Œäº¦å¯é€šè¿‡ properties å…ƒç´ çš„å­å…ƒç´ æ¥ä¼ é€’ã€‚ã€db.propertiesã€‘</p><p><a href="https://imgtu.com/i/cABU8f"><img src="https://z3.ax1x.com/2021/03/31/cABU8f.png" alt="cABU8f.png"></a></p><p>ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶</p><p>db.properties</p><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">driver</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><br><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">123456</span><br></code></pre></div></td></tr></table></figure><p>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­æ˜ å…¥</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;db.properties&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;11111&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><ul><li>å¯ä»¥ç›´æ¥å¼•å…¥å¤–éƒ¨æ–‡ä»¶</li><li>å¯ä»¥åœ¨å…¶ä¸­å¢åŠ ä¸€äº›å±æ€§é…ç½®</li><li>å¦‚æœä¸¤ä¸ªæ–‡ä»¶æœ‰åŒä¸€ä¸ªå­—æ®µï¼Œä¼˜å…ˆä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶çš„ï¼</li></ul><h3 id="4ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰"><a href="#4ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰" class="headerlink" title="4ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰"></a>4ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰</h3><ul><li>ç±»å‹åˆ«åæ˜¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åå­—ã€‚â€˜</li><li>å­˜åœ¨çš„æ„ä¹‰ä»…åœ¨äºç”¨æ¥å‡å°‘ç±»å®Œå…¨é™å®šåçš„å†—ä½™ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯ä»¥ç»™å®ä½“ç±»èµ·åˆ«å--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;User&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…åï¼ŒMyBatis ä¼šåœ¨åŒ…åä¸‹é¢æœç´¢éœ€è¦çš„ Java Beanï¼Œæ¯”å¦‚ï¼š</p><p>æ‰«æå®ä½“ç±»çš„åŒ…ï¼Œå®ƒçš„é»˜è®¤åˆ«åå°±ä¸ºè¿™ä¸ªç±»çš„ ç±»åï¼Œé¦–å­—æ¯å°å†™ï¼</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯ä»¥ç»™å®ä½“ç±»èµ·åˆ«å--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.kuang.pojo&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>åœ¨å®ä½“ç±»æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ã€‚</p><p>å¦‚æœå®ä½“ç±»ååˆ†å¤šï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§ã€‚</p><p>ç¬¬ä¸€ç§å¯ä»¥DIYåˆ«åï¼Œç¬¬äºŒç§åˆ™Â·ä¸è¡ŒÂ·ï¼Œå¦‚æœéè¦æ”¹ï¼Œéœ€è¦åœ¨å®ä½“ä¸Šå¢åŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Alias(&quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;&#125;<br></code></pre></div></td></tr></table></figure><h3 id="5ã€è®¾ç½®"><a href="#5ã€è®¾ç½®" class="headerlink" title="5ã€è®¾ç½®"></a>5ã€è®¾ç½®</h3><p>è¿™æ˜¯ MyBatis ä¸­æä¸ºé‡è¦çš„è°ƒæ•´è®¾ç½®ï¼Œå®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚ </p><p><a href="https://imgtu.com/i/cAB65q"><img src="https://z3.ax1x.com/2021/03/31/cAB65q.png" alt="cAB65q.png"></a></p><p><img src="https://upload-images.jianshu.io/upload_images/22416923-5fb07cc49d386349.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1569657672791.png"></p><h3 id="6ã€å…¶ä»–é…ç½®"><a href="#6ã€å…¶ä»–é…ç½®" class="headerlink" title="6ã€å…¶ä»–é…ç½®"></a>6ã€å…¶ä»–é…ç½®</h3><ul><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory">objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰</a></li><li>pluginsæ’ä»¶<ul><li>mybatis-generator-core</li><li>mybatis-plus</li><li>é€šç”¨mapper</li></ul></li></ul><h3 id="7ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰"><a href="#7ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰" class="headerlink" title="7ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰"></a>7ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰</h3><p>MapperRegistryï¼šæ³¨å†Œç»‘å®šæˆ‘ä»¬çš„Mapperæ–‡ä»¶ï¼›</p><p>æ–¹å¼ä¸€ï¼š ã€æ¨èä½¿ç”¨ã€‘</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ¯ä¸€ä¸ªMapper.XMLéƒ½éœ€è¦åœ¨Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œï¼--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;com/kuang/dao/UserMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®šæ³¨å†Œ</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ¯ä¸€ä¸ªMapper.XMLéƒ½éœ€è¦åœ¨Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œï¼--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.dao.UserMapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>æ¥å£å’Œä»–çš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒåï¼</li><li>æ¥å£å’Œä»–çš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼</li></ul><p>æ–¹å¼ä¸‰ï¼šä½¿ç”¨æ‰«æåŒ…è¿›è¡Œæ³¨å…¥ç»‘å®š</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ¯ä¸€ä¸ªMapper.XMLéƒ½éœ€è¦åœ¨Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œï¼--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.kuang.dao&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>æ¥å£å’Œä»–çš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒåï¼</li><li>æ¥å£å’Œä»–çš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼</li></ul><p>ç»ƒä¹ æ—¶é—´ï¼š</p><ul><li>å°†æ•°æ®åº“é…ç½®æ–‡ä»¶å¤–éƒ¨å¼•å…¥</li><li>å®ä½“ç±»åˆ«å</li><li>ä¿è¯UserMapper æ¥å£ å’Œ UserMapper .xml æ”¹ä¸ºä¸€è‡´ï¼å¹¶ä¸”æ”¾åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼</li></ul><h3 id="8ã€ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ"><a href="#8ã€ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ" class="headerlink" title="8ã€ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ"></a>8ã€ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ</h3><p><a href="https://imgtu.com/i/cAB5qJ"><img src="https://z3.ax1x.com/2021/03/31/cAB5qJ.png" alt="cAB5qJ.png"></a></p><p>ç”Ÿå‘½å‘¨æœŸï¼Œå’Œä½œç”¨åŸŸï¼Œæ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºé”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´éå¸¸ä¸¥é‡çš„<strong>å¹¶å‘é—®é¢˜</strong>ã€‚</p><p><strong>SqlSessionFactoryBuilderï¼š</strong></p><ul><li>ä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†</li><li>å±€éƒ¨å˜é‡</li></ul><p><strong>SqlSessionFactoryï¼š</strong></p><ul><li>è¯´ç™½äº†å°±æ˜¯å¯ä»¥æƒ³è±¡ä¸º ï¼šæ•°æ®åº“è¿æ¥æ± </li><li>SqlSessionFactory ä¸€æ—¦è¢«åˆ›å»ºå°±åº”è¯¥åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œ<strong>æ²¡æœ‰ä»»ä½•ç†ç”±ä¸¢å¼ƒå®ƒæˆ–é‡æ–°åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹ã€‚</strong> </li><li>å› æ­¤ SqlSessionFactory çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯åº”ç”¨ä½œç”¨åŸŸã€‚ </li><li>æœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨<strong>å•ä¾‹æ¨¡å¼</strong>æˆ–è€…é™æ€å•ä¾‹æ¨¡å¼ã€‚</li></ul><p><strong>SqlSession</strong></p><ul><li>è¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼</li><li>SqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„ä½œç”¨åŸŸæ˜¯è¯·æ±‚æˆ–æ–¹æ³•ä½œç”¨åŸŸã€‚</li><li>ç”¨å®Œä¹‹åéœ€è¦èµ¶ç´§å…³é—­ï¼Œå¦åˆ™èµ„æºè¢«å ç”¨ï¼</li></ul><p><a href="https://imgtu.com/i/cABOxO"><img src="https://z3.ax1x.com/2021/03/31/cABOxO.png" alt="cABOxO.png"></a></p><p>è¿™é‡Œé¢çš„æ¯ä¸€ä¸ªMapperï¼Œå°±ä»£è¡¨ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡ï¼</p><h2 id="5ã€è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜"><a href="#5ã€è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜" class="headerlink" title="5ã€è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜"></a>5ã€è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜</h2><h3 id="1ã€-é—®é¢˜"><a href="#1ã€-é—®é¢˜" class="headerlink" title="1ã€ é—®é¢˜"></a>1ã€ é—®é¢˜</h3><p>æ•°æ®åº“ä¸­çš„å­—æ®µ</p><p><a href="https://imgtu.com/i/cADSZd"><img src="https://z3.ax1x.com/2021/03/31/cADSZd.png" alt="cADSZd.png"></a></p><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ‹·è´ä¹‹å‰çš„ï¼Œæµ‹è¯•å®ä½“ç±»å­—æ®µä¸ä¸€è‡´çš„æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•å‡ºç°é—®é¢˜</p><p><a href="https://imgtu.com/i/cADEQS"><img src="https://z3.ax1x.com/2021/03/31/cADEQS.png" alt="cADEQS.png"></a></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">//    select * from mybatis.user where id = #&#123;id&#125;<br>//ç±»å‹å¤„ç†å™¨<br>//    select id,name,pwd from mybatis.user where id = #&#123;id&#125;<br></code></pre></div></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li><p>èµ·åˆ«å</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>    select id,name,pwd as password from mybatis.user where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ul><h3 id="2ã€resultMap"><a href="#2ã€resultMap" class="headerlink" title="2ã€resultMap"></a>2ã€resultMap</h3><p>ç»“æœé›†æ˜ å°„</p><figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript"><span class="hljs-built_in">id</span>   <span class="hljs-built_in">name</span>   pwd<br><span class="hljs-built_in">id</span>   <span class="hljs-built_in">name</span>   password<br></code></pre></div></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç»“æœé›†æ˜ å°„--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--columnæ•°æ®åº“ä¸­çš„å­—æ®µï¼Œpropertyå®ä½“ç±»ä¸­çš„å±æ€§--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;UserMap&quot;</span>&gt;</span><br>    select * from mybatis.user where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li><code>resultMap</code> å…ƒç´ æ˜¯ MyBatis ä¸­æœ€é‡è¦æœ€å¼ºå¤§çš„å…ƒç´ </li><li>ResultMap çš„è®¾è®¡æ€æƒ³æ˜¯ï¼Œå¯¹äºç®€å•çš„è¯­å¥æ ¹æœ¬ä¸éœ€è¦é…ç½®æ˜¾å¼çš„ç»“æœæ˜ å°„ï¼Œè€Œå¯¹äºå¤æ‚ä¸€ç‚¹çš„è¯­å¥åªéœ€è¦æè¿°å®ƒä»¬çš„å…³ç³»å°±è¡Œäº†ã€‚</li><li><code>ResultMap</code> æœ€ä¼˜ç§€çš„åœ°æ–¹åœ¨äºï¼Œè™½ç„¶ä½ å·²ç»å¯¹å®ƒç›¸å½“äº†è§£äº†ï¼Œä½†æ˜¯æ ¹æœ¬å°±ä¸éœ€è¦æ˜¾å¼åœ°ç”¨åˆ°ä»–ä»¬ã€‚</li><li> å¦‚æœä¸–ç•Œæ€»æ˜¯è¿™ä¹ˆç®€å•å°±å¥½äº†ã€‚</li></ul><h2 id="6ã€æ—¥å¿—"><a href="#6ã€æ—¥å¿—" class="headerlink" title="6ã€æ—¥å¿—"></a>6ã€æ—¥å¿—</h2><h3 id="6-1ã€æ—¥å¿—å·¥å‚"><a href="#6-1ã€æ—¥å¿—å·¥å‚" class="headerlink" title="6.1ã€æ—¥å¿—å·¥å‚"></a>6.1ã€æ—¥å¿—å·¥å‚</h3><p>å¦‚æœä¸€ä¸ªæ•°æ®åº“æ“ä½œï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦æ’é”™ã€‚æ—¥å¿—å°±æ˜¯æœ€å¥½çš„åŠ©æ‰‹ï¼</p><p>æ›¾ç»ï¼šsout ã€debug</p><p>ç°åœ¨ï¼šæ—¥å¿—å·¥å‚ï¼</p><p><a href="https://imgtu.com/i/cADmZj"><img src="https://z3.ax1x.com/2021/03/31/cADmZj.png" alt="cADmZj.png"></a></p><ul><li><p>SLF4J </p></li><li><p>LOG4J  ã€æŒæ¡ã€‘</p></li><li><p>LOG4J2</p></li><li><p> JDK_LOGGING</p></li><li><p>COMMONS_LOGGING</p></li><li><p>STDOUT_LOGGING   ã€æŒæ¡ã€‘</p></li><li><p>NO_LOGGING</p></li></ul><p>åœ¨Mybatisä¸­å…·ä½“ä½¿ç”¨é‚£ä¸ªä¸€æ—¥å¿—å®ç°ï¼Œåœ¨è®¾ç½®ä¸­è®¾å®šï¼</p><p><strong>STDOUT_LOGGINGæ ‡å‡†æ—¥å¿—è¾“å‡º</strong></p><p>åœ¨mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æˆ‘ä»¬çš„æ—¥å¿—ï¼</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p><a href="https://imgtu.com/i/cADuon"><img src="https://z3.ax1x.com/2021/03/31/cADuon.png" alt="cADuon.png"></a></p><h3 id="6-2ã€Log4j"><a href="#6-2ã€Log4j" class="headerlink" title="6.2ã€Log4j"></a>6.2ã€Log4j</h3><p>ä»€ä¹ˆæ˜¯Log4jï¼Ÿ</p><ul><li>Log4jæ˜¯<a href="https://baike.baidu.com/item/Apache/8512995">Apache</a>çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé€šè¿‡ä½¿ç”¨Log4jï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ—¥å¿—ä¿¡æ¯è¾“é€çš„ç›®çš„åœ°æ˜¯<a href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%8F%B0/2438626">æ§åˆ¶å°</a>ã€æ–‡ä»¶ã€<a href="https://baike.baidu.com/item/GUI">GUI</a>ç»„ä»¶</li><li>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶æ¯ä¸€æ¡æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼›</li><li>é€šè¿‡å®šä¹‰æ¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ ç»†è‡´åœ°æ§åˆ¶æ—¥å¿—çš„ç”Ÿæˆè¿‡ç¨‹ã€‚</li><li>é€šè¿‡ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/286550">é…ç½®æ–‡ä»¶</a>æ¥çµæ´»åœ°è¿›è¡Œé…ç½®ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨çš„ä»£ç ã€‚</li></ul><ol><li><p>å…ˆå¯¼å…¥log4jçš„åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>log4j.properties</p><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#å°†ç­‰çº§ä¸ºDEBUGçš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°consoleå’Œfileè¿™ä¸¤ä¸ªç›®çš„åœ°ï¼Œconsoleå’Œfileçš„å®šä¹‰åœ¨ä¸‹é¢çš„ä»£ç </span><br><span class="hljs-meta">log4j.rootLogger</span>=<span class="hljs-string">DEBUG,console,file</span><br><br><span class="hljs-comment">#æ§åˆ¶å°è¾“å‡ºçš„ç›¸å…³è®¾ç½®</span><br><span class="hljs-meta">log4j.appender.console</span> = <span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-meta">log4j.appender.console.Target</span> = <span class="hljs-string">System.out</span><br><span class="hljs-meta">log4j.appender.console.Threshold</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.appender.console.layout</span> = <span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-meta">log4j.appender.console.layout.ConversionPattern</span>=<span class="hljs-string">[%c]-%m%n</span><br><br><span class="hljs-comment">#æ–‡ä»¶è¾“å‡ºçš„ç›¸å…³è®¾ç½®</span><br><span class="hljs-meta">log4j.appender.file</span> = <span class="hljs-string">org.apache.log4j.RollingFileAppender</span><br><span class="hljs-meta">log4j.appender.file.File</span>=<span class="hljs-string">./log/kuang.log</span><br><span class="hljs-meta">log4j.appender.file.MaxFileSize</span>=<span class="hljs-string">10mb</span><br><span class="hljs-meta">log4j.appender.file.Threshold</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.appender.file.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-meta">log4j.appender.file.layout.ConversionPattern</span>=<span class="hljs-string">[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span><br><br><span class="hljs-comment">#æ—¥å¿—è¾“å‡ºçº§åˆ«</span><br><span class="hljs-meta">log4j.logger.org.mybatis</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.logger.java.sql</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.logger.java.sql.Statement</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.logger.java.sql.ResultSet</span>=<span class="hljs-string">DEBUG</span><br><span class="hljs-meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="hljs-string">DEBUG</span><br></code></pre></div></td></tr></table></figure></li><li><p>é…ç½®log4jä¸ºæ—¥å¿—çš„å®ç°</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>Log4jçš„ä½¿ç”¨ï¼ï¼Œç›´æ¥æµ‹è¯•è¿è¡Œåˆšæ‰çš„æŸ¥è¯¢</p><p><a href="https://imgtu.com/i/cAD1zT"><img src="https://z3.ax1x.com/2021/03/31/cAD1zT.png" alt="cAD1zT.png"></a></p></li></ol><p><strong>ç®€å•ä½¿ç”¨</strong></p><ol><li><p>åœ¨è¦ä½¿ç”¨Log4j çš„ç±»ä¸­ï¼Œå¯¼å…¥åŒ…  import org.apache.log4j.Logger;</p></li><li><p>æ—¥å¿—å¯¹è±¡ï¼Œå‚æ•°ä¸ºå½“å‰ç±»çš„class</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> Logger logger = Logger.getLogger(UserDaoTest.class);<br></code></pre></div></td></tr></table></figure></li><li><p>æ—¥å¿—çº§åˆ«</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">logger.info(<span class="hljs-string">&quot;info:è¿›å…¥äº†testLog4j&quot;</span>);<br>logger.debug(<span class="hljs-string">&quot;debug:è¿›å…¥äº†testLog4j&quot;</span>);<br>logger.error(<span class="hljs-string">&quot;error:è¿›å…¥äº†testLog4j&quot;</span>);<br></code></pre></div></td></tr></table></figure></li></ol><h2 id="7ã€åˆ†é¡µ"><a href="#7ã€åˆ†é¡µ" class="headerlink" title="7ã€åˆ†é¡µ"></a>7ã€åˆ†é¡µ</h2><p><strong>æ€è€ƒï¼šä¸ºä»€ä¹ˆè¦åˆ†é¡µï¼Ÿ</strong></p><ul><li>å‡å°‘æ•°æ®çš„å¤„ç†é‡</li></ul><h3 id="7-1ã€ä½¿ç”¨Limitåˆ†é¡µ"><a href="#7-1ã€ä½¿ç”¨Limitåˆ†é¡µ" class="headerlink" title="7.1ã€ä½¿ç”¨Limitåˆ†é¡µ"></a>7.1ã€ä½¿ç”¨Limitåˆ†é¡µ</h3><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">è¯­æ³•ï¼š<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> limit startIndex,pageSize;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> limit <span class="hljs-number">3</span>;  #[<span class="hljs-number">0</span>,n]<br></code></pre></div></td></tr></table></figure><p>ä½¿ç”¨Mybatiså®ç°åˆ†é¡µï¼Œæ ¸å¿ƒSQL</p><ol><li><p>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åˆ†é¡µ</span><br><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserByLimit</span><span class="hljs-params">(Map&lt;String,Integer&gt; map)</span></span>;<br></code></pre></div></td></tr></table></figure></li><li><p>Mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--//åˆ†é¡µ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByLimit&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;UserMap&quot;</span>&gt;</span><br>    select * from  mybatis.user limit #&#123;startIndex&#125;,#&#123;pageSize&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getUserByLimit</span><span class="hljs-params">()</span></span>&#123;<br>SqlSession sqlSession = MybatisUtils.getSqlSession();<br>UserMapper mapper = sqlSession.getMapper(UserMapper.class);<br><br>HashMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Integer&gt;();<br>    map.put(<span class="hljs-string">&quot;startIndex&quot;</span>,<span class="hljs-number">1</span>);<br>    map.put(<span class="hljs-string">&quot;pageSize&quot;</span>,<span class="hljs-number">2</span>);<br><br>    List&lt;User&gt; userList =  mapper.getUserByLimit(map);<br>    <span class="hljs-keyword">for</span> (User user : userList) &#123;<br>    System.out.println(user);<br>    &#125;<br><br>    sqlSession.close();<br>    &#125;<br><br></code></pre></div></td></tr></table></figure></li></ol><h3 id="7-2ã€RowBoundsåˆ†é¡µ"><a href="#7-2ã€RowBoundsåˆ†é¡µ" class="headerlink" title="7.2ã€RowBoundsåˆ†é¡µ"></a>7.2ã€RowBoundsåˆ†é¡µ</h3><p>ä¸å†ä½¿ç”¨SQLå®ç°åˆ†é¡µ</p><ol><li><p>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åˆ†é¡µ2</span><br><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserByRowBounds</span><span class="hljs-params">()</span></span>;<br></code></pre></div></td></tr></table></figure></li><li><p>mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åˆ†é¡µ2--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByRowBounds&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;UserMap&quot;</span>&gt;</span><br>    select * from  mybatis.user<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getUserByRowBounds</span><span class="hljs-params">()</span></span>&#123;<br>SqlSession sqlSession = MybatisUtils.getSqlSession();<br><br><span class="hljs-comment">//RowBoundså®ç°</span><br>RowBounds rowBounds = <span class="hljs-keyword">new</span> RowBounds(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br><br><span class="hljs-comment">//é€šè¿‡Javaä»£ç å±‚é¢å®ç°åˆ†é¡µ</span><br>List&lt;User&gt; userList = sqlSession.selectList(<span class="hljs-string">&quot;com.kuang.dao.UserMapper.getUserByRowBounds&quot;</span>,<span class="hljs-keyword">null</span>,rowBounds);<br><br>    <span class="hljs-keyword">for</span> (User user : userList) &#123;<br>    System.out.println(user);<br>    &#125;<br><br>    sqlSession.close();<br>    &#125;<br></code></pre></div></td></tr></table></figure></li></ol><h3 id="7-3ã€åˆ†é¡µæ’ä»¶"><a href="#7-3ã€åˆ†é¡µæ’ä»¶" class="headerlink" title="7.3ã€åˆ†é¡µæ’ä»¶"></a>7.3ã€åˆ†é¡µæ’ä»¶</h3><p><a href="https://imgtu.com/i/cAD8QU"><img src="https://z3.ax1x.com/2021/03/31/cAD8QU.png" alt="cAD8QU.png"></a></p><p>äº†è§£å³å¯ï¼Œä¸‡ä¸€ ä»¥åå…¬å¸çš„æ¶æ„å¸ˆï¼Œè¯´è¦ä½¿ç”¨ï¼Œä½ éœ€è¦çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼</p><h2 id="8ã€ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#8ã€ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="8ã€ä½¿ç”¨æ³¨è§£å¼€å‘"></a>8ã€ä½¿ç”¨æ³¨è§£å¼€å‘</h2><h3 id="8-1ã€é¢å‘æ¥å£ç¼–ç¨‹"><a href="#8-1ã€é¢å‘æ¥å£ç¼–ç¨‹" class="headerlink" title="8.1ã€é¢å‘æ¥å£ç¼–ç¨‹"></a>8.1ã€é¢å‘æ¥å£ç¼–ç¨‹</h3><p>- å¤§å®¶ä¹‹å‰éƒ½å­¦è¿‡é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¹Ÿå­¦ä¹ è¿‡æ¥å£ï¼Œä½†åœ¨çœŸæ­£çš„å¼€å‘ä¸­ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šé€‰æ‹©é¢å‘æ¥å£ç¼–ç¨‹<br>- <strong>æ ¹æœ¬åŸå›  :  ==è§£è€¦== , å¯æ‹“å±• , æé«˜å¤ç”¨ , åˆ†å±‚å¼€å‘ä¸­ , ä¸Šå±‚ä¸ç”¨ç®¡å…·ä½“çš„å®ç° , å¤§å®¶éƒ½éµå®ˆå…±åŒçš„æ ‡å‡† , ä½¿å¾—å¼€å‘å˜å¾—å®¹æ˜“ , è§„èŒƒæ€§æ›´å¥½</strong><br>- åœ¨ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿçš„å„ç§åŠŸèƒ½æ˜¯ç”±è®¸è®¸å¤šå¤šçš„ä¸åŒå¯¹è±¡åä½œå®Œæˆçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå„ä¸ªå¯¹è±¡å†…éƒ¨æ˜¯å¦‚ä½•å®ç°è‡ªå·±çš„,å¯¹ç³»ç»Ÿè®¾è®¡äººå‘˜æ¥è®²å°±ä¸é‚£ä¹ˆé‡è¦äº†ï¼›<br>- è€Œå„ä¸ªå¯¹è±¡ä¹‹é—´çš„åä½œå…³ç³»åˆ™æˆä¸ºç³»ç»Ÿè®¾è®¡çš„å…³é”®ã€‚å°åˆ°ä¸åŒç±»ä¹‹é—´çš„é€šä¿¡ï¼Œå¤§åˆ°å„æ¨¡å—ä¹‹é—´çš„äº¤äº’ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡ä¹‹åˆéƒ½æ˜¯è¦ç€é‡è€ƒè™‘çš„ï¼Œè¿™ä¹Ÿæ˜¯ç³»ç»Ÿè®¾è®¡çš„ä¸»è¦å·¥ä½œå†…å®¹ã€‚é¢å‘æ¥å£ç¼–ç¨‹å°±æ˜¯æŒ‡æŒ‰ç…§è¿™ç§æ€æƒ³æ¥ç¼–ç¨‹ã€‚</p><p><strong>å…³äºæ¥å£çš„ç†è§£</strong></p><p>- æ¥å£ä»æ›´æ·±å±‚æ¬¡çš„ç†è§£ï¼Œåº”æ˜¯å®šä¹‰ï¼ˆè§„èŒƒï¼Œçº¦æŸï¼‰ä¸å®ç°ï¼ˆåå®åˆ†ç¦»çš„åŸåˆ™ï¼‰çš„åˆ†ç¦»ã€‚<br>- æ¥å£çš„æœ¬èº«åæ˜ äº†ç³»ç»Ÿè®¾è®¡äººå‘˜å¯¹ç³»ç»Ÿçš„æŠ½è±¡ç†è§£ã€‚<br>- æ¥å£åº”æœ‰ä¸¤ç±»ï¼š<br>  - ç¬¬ä¸€ç±»æ˜¯å¯¹ä¸€ä¸ªä¸ªä½“çš„æŠ½è±¡ï¼Œå®ƒå¯å¯¹åº”ä¸ºä¸€ä¸ªæŠ½è±¡ä½“(abstract class)ï¼›<br>  - ç¬¬äºŒç±»æ˜¯å¯¹ä¸€ä¸ªä¸ªä½“æŸä¸€æ–¹é¢çš„æŠ½è±¡ï¼Œå³å½¢æˆä¸€ä¸ªæŠ½è±¡é¢ï¼ˆinterfaceï¼‰ï¼›<br>- ä¸€ä¸ªä½“æœ‰å¯èƒ½æœ‰å¤šä¸ªæŠ½è±¡é¢ã€‚æŠ½è±¡ä½“ä¸æŠ½è±¡é¢æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p><strong>ä¸‰ä¸ªé¢å‘åŒºåˆ«</strong></p><p>- é¢å‘å¯¹è±¡æ˜¯æŒ‡ï¼Œæˆ‘ä»¬è€ƒè™‘é—®é¢˜æ—¶ï¼Œä»¥å¯¹è±¡ä¸ºå•ä½ï¼Œè€ƒè™‘å®ƒçš„å±æ€§åŠæ–¹æ³• .<br>- é¢å‘è¿‡ç¨‹æ˜¯æŒ‡ï¼Œæˆ‘ä»¬è€ƒè™‘é—®é¢˜æ—¶ï¼Œä»¥ä¸€ä¸ªå…·ä½“çš„æµç¨‹ï¼ˆäº‹åŠ¡è¿‡ç¨‹ï¼‰ä¸ºå•ä½ï¼Œè€ƒè™‘å®ƒçš„å®ç° .<br>- æ¥å£è®¾è®¡ä¸éæ¥å£è®¾è®¡æ˜¯é’ˆå¯¹å¤ç”¨æŠ€æœ¯è€Œè¨€çš„ï¼Œä¸é¢å‘å¯¹è±¡ï¼ˆè¿‡ç¨‹ï¼‰ä¸æ˜¯ä¸€ä¸ªé—®é¢˜.æ›´å¤šçš„ä½“ç°å°±æ˜¯å¯¹ç³»ç»Ÿæ•´ä½“çš„æ¶æ„</p><h3 id="8-2ã€ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#8-2ã€ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="8.2ã€ä½¿ç”¨æ³¨è§£å¼€å‘"></a>8.2ã€ä½¿ç”¨æ³¨è§£å¼€å‘</h3><ol><li><p>æ³¨è§£åœ¨æ¥å£ä¸Šå®ç°</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Select(&quot;select * from user&quot;)</span><br><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>;<br></code></pre></div></td></tr></table></figure></li><li><p>éœ€è¦å†æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ç»‘å®šæ¥å£ï¼</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç»‘å®šæ¥å£--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.dao.UserMapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ol><p>æœ¬è´¨ï¼šåå°„æœºåˆ¶å®ç°</p><p>åº•å±‚ï¼šåŠ¨æ€ä»£ç†ï¼</p><p> <a href="https://imgtu.com/i/cADteJ"><img src="https://z3.ax1x.com/2021/03/31/cADteJ.png" alt="cADteJ.png"></a></p><p><strong>Mybatisè¯¦ç»†çš„æ‰§è¡Œæµç¨‹ï¼</strong></p><p><a href="https://imgtu.com/i/cADNw9"><img src="https://z3.ax1x.com/2021/03/31/cADNw9.png" alt="cADNw9.png"></a></p><h3 id="8-3ã€CRUD"><a href="#8-3ã€CRUD" class="headerlink" title="8.3ã€CRUD"></a>8.3ã€CRUD</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨å·¥å…·ç±»åˆ›å»ºçš„æ—¶å€™å®ç°è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession  <span class="hljs-title">getSqlSession</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> sqlSessionFactory.openSession(<span class="hljs-keyword">true</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç¼–å†™æ¥å£ï¼Œå¢åŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;<br><br>    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span><br>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">// æ–¹æ³•å­˜åœ¨å¤šä¸ªå‚æ•°ï¼Œæ‰€æœ‰çš„å‚æ•°å‰é¢å¿…é¡»åŠ ä¸Š @Param(&quot;id&quot;)æ³¨è§£</span><br>    <span class="hljs-meta">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-function">User <span class="hljs-title">getUserByID</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span></span>;<br><br><br>    <span class="hljs-meta">@Insert(&quot;insert into user(id,name,pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;password&#125;)&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span></span>;<br><br>    <br>    <span class="hljs-meta">@Update(&quot;update user set name=#&#123;name&#125;,pwd=#&#123;password&#125; where id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(User user)</span></span>;<br><br>    <br>    <span class="hljs-meta">@Delete(&quot;delete from user where id = #&#123;uid&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;uid&quot;)</span> <span class="hljs-keyword">int</span> id)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•ç±»</p><p>ã€æ³¨æ„ï¼šæˆ‘ä»¬å¿…é¡»è¦è®²æ¥å£æ³¨å†Œç»‘å®šåˆ°æˆ‘ä»¬çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ï¼ã€‘</p><p><strong>å…³äº@Param() æ³¨è§£</strong></p><ul><li>åŸºæœ¬ç±»å‹çš„å‚æ•°æˆ–è€…Stringç±»å‹ï¼Œéœ€è¦åŠ ä¸Š</li><li>å¼•ç”¨ç±»å‹ä¸éœ€è¦åŠ </li><li>å¦‚æœåªæœ‰ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„è¯ï¼Œå¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å»ºè®®å¤§å®¶éƒ½åŠ ä¸Šï¼</li><li>æˆ‘ä»¬åœ¨SQLä¸­å¼•ç”¨çš„å°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„ @Param() ä¸­è®¾å®šçš„å±æ€§åï¼</li></ul><p><strong>#{}     ${} åŒºåˆ«</strong></p><h2 id="9ã€Lombok"><a href="#9ã€Lombok" class="headerlink" title="9ã€Lombok"></a>9ã€Lombok</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Project Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java.<br>Never write another getter or equals method again, with one annotation your <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">has</span> <span class="hljs-title">a</span> <span class="hljs-title">fully</span> <span class="hljs-title">featured</span> <span class="hljs-title">builder</span>, <span class="hljs-title">Automate</span> <span class="hljs-title">your</span> <span class="hljs-title">logging</span> <span class="hljs-title">variables</span>, <span class="hljs-title">and</span> <span class="hljs-title">much</span> <span class="hljs-title">more</span>.</span><br></code></pre></div></td></tr></table></figure><ul><li>java library</li><li>plugs</li><li>build tools</li><li>with one annotation your class</li></ul><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li><p>åœ¨IDEAä¸­å®‰è£…Lombokæ’ä»¶ï¼</p></li><li><p>åœ¨é¡¹ç›®ä¸­å¯¼å…¥lombokçš„jaråŒ…</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>åœ¨å®ä½“ç±»ä¸ŠåŠ æ³¨è§£å³å¯ï¼</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br></code></pre></div></td></tr></table></figure></li></ol><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span> and <span class="hljs-meta">@Setter</span><br><span class="hljs-meta">@FieldNameConstants</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-meta">@EqualsAndHashCode</span><br><span class="hljs-meta">@AllArgsConstructor</span>, <span class="hljs-meta">@RequiredArgsConstructor</span> and <span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Log</span>, <span class="hljs-meta">@Log4j</span>, <span class="hljs-meta">@Log4j2</span>, <span class="hljs-meta">@Slf4j</span>, <span class="hljs-meta">@XSlf4j</span>, <span class="hljs-meta">@CommonsLog</span>, <span class="hljs-meta">@JBossLog</span>, <span class="hljs-meta">@Flogger</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-meta">@Singular</span><br><span class="hljs-meta">@Delegate</span><br><span class="hljs-meta">@Value</span><br><span class="hljs-meta">@Accessors</span><br><span class="hljs-meta">@Wither</span><br><span class="hljs-meta">@SneakyThrows</span><br></code></pre></div></td></tr></table></figure><p>è¯´æ˜ï¼š</p><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@Data</span>ï¼šæ— å‚æ„é€ ï¼Œgetã€setã€tostringã€hashcodeï¼Œequals<br><span class="hljs-variable">@AllArgsConstructor</span><br><span class="hljs-variable">@NoArgsConstructor</span><br><span class="hljs-variable">@EqualsAndHashCode</span><br><span class="hljs-variable">@ToString</span><br><span class="hljs-variable">@Getter</span><br></code></pre></div></td></tr></table></figure><h2 id="10ã€å¤šå¯¹ä¸€å¤„ç†"><a href="#10ã€å¤šå¯¹ä¸€å¤„ç†" class="headerlink" title="10ã€å¤šå¯¹ä¸€å¤„ç†"></a>10ã€å¤šå¯¹ä¸€å¤„ç†</h2><p>å¤šå¯¹ä¸€ï¼š</p><p><a href="https://imgtu.com/i/cADwJx"><img src="https://z3.ax1x.com/2021/03/31/cADwJx.png" alt="cADwJx.png"></a></p><ul><li>å¤šä¸ªå­¦ç”Ÿï¼Œå¯¹åº”ä¸€ä¸ªè€å¸ˆ</li><li>å¯¹äºå­¦ç”Ÿè¿™è¾¹è€Œè¨€ï¼Œ  <strong>å…³è”</strong> ..  å¤šä¸ªå­¦ç”Ÿï¼Œå…³è”ä¸€ä¸ªè€å¸ˆ  ã€å¤šå¯¹ä¸€ã€‘</li><li>å¯¹äºè€å¸ˆè€Œè¨€ï¼Œ <strong>é›†åˆ</strong> ï¼Œ ä¸€ä¸ªè€å¸ˆï¼Œæœ‰å¾ˆå¤šå­¦ç”Ÿ ã€ä¸€å¯¹å¤šã€‘</li></ul><p><a href="https://imgtu.com/i/cAD0W6"><img src="https://z3.ax1x.com/2021/03/31/cAD0W6.png" alt="cAD0W6.png"></a></p><p>SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `teacher` (<br>  `id` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>INNODB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher(`id`, `name`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;ç§¦è€å¸ˆ&#x27;</span>); <br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `student` (<br>  `id` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `tid` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  KEY `fktid` (`tid`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `fktid` <span class="hljs-keyword">FOREIGN</span> KEY (`tid`) <span class="hljs-keyword">REFERENCES</span> `teacher` (`id`)<br>) ENGINE<span class="hljs-operator">=</span>INNODB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8<br><br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `student` (`id`, `name`, `tid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;å°æ˜&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>); <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `student` (`id`, `name`, `tid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;å°çº¢&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>); <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `student` (`id`, `name`, `tid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;å°å¼ &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>); <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `student` (`id`, `name`, `tid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;å°æ&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>); <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `student` (`id`, `name`, `tid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;å°ç‹&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br></code></pre></div></td></tr></table></figure><h3 id="æµ‹è¯•ç¯å¢ƒæ­å»º"><a href="#æµ‹è¯•ç¯å¢ƒæ­å»º" class="headerlink" title="æµ‹è¯•ç¯å¢ƒæ­å»º"></a>æµ‹è¯•ç¯å¢ƒæ­å»º</h3><ol><li>å¯¼å…¥lombok</li><li>æ–°å»ºå®ä½“ç±» Teacherï¼ŒStudent</li><li>å»ºç«‹Mapperæ¥å£</li><li>å»ºç«‹Mapper.XMLæ–‡ä»¶</li><li>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ç»‘å®šæ³¨å†Œæˆ‘ä»¬çš„Mapperæ¥å£æˆ–è€…æ–‡ä»¶ï¼ã€æ–¹å¼å¾ˆå¤šï¼Œéšå¿ƒé€‰ã€‘</li><li>æµ‹è¯•æŸ¥è¯¢æ˜¯å¦èƒ½å¤ŸæˆåŠŸï¼</li></ol><h3 id="æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†"><a href="#æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†" class="headerlink" title="æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†"></a>æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    æ€è·¯:</span><br><span class="hljs-comment">        1. æŸ¥è¯¢æ‰€æœ‰çš„å­¦ç”Ÿä¿¡æ¯</span><br><span class="hljs-comment">        2. æ ¹æ®æŸ¥è¯¢å‡ºæ¥çš„å­¦ç”Ÿçš„tidï¼Œå¯»æ‰¾å¯¹åº”çš„è€å¸ˆï¼  å­æŸ¥è¯¢</span><br><span class="hljs-comment">    --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudent&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;StudentTeacher&quot;</span>&gt;</span><br>    select * from student<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;StudentTeacher&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--å¤æ‚çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬å¤„ç† å¯¹è±¡ï¼š association é›†åˆï¼š collection --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Teacher&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;getTeacher&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span><br>    select * from teacher where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><h3 id="æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†"><a href="#æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†" class="headerlink" title="æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†"></a>æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudent2&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;StudentTeacher2&quot;</span>&gt;</span><br>    select s.id sid,s.name sname,t.name tname<br>    from student s,teacher t<br>    where s.tid = t.id;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;StudentTeacher2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tname&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>å›é¡¾Mysql å¤šå¯¹ä¸€æŸ¥è¯¢æ–¹å¼ï¼š</p><ul><li>å­æŸ¥è¯¢</li><li>è”è¡¨æŸ¥è¯¢</li></ul><h2 id="11ã€ä¸€å¯¹å¤šå¤„ç†"><a href="#11ã€ä¸€å¯¹å¤šå¤„ç†" class="headerlink" title="11ã€ä¸€å¯¹å¤šå¤„ç†"></a>11ã€ä¸€å¯¹å¤šå¤„ç†</h2><p>æ¯”å¦‚ï¼šä¸€ä¸ªè€å¸ˆæ‹¥æœ‰å¤šä¸ªå­¦ç”Ÿï¼</p><p>å¯¹äºè€å¸ˆè€Œè¨€ï¼Œå°±æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»!</p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><ol><li>ç¯å¢ƒæ­å»ºï¼Œå’Œåˆšæ‰ä¸€æ ·</li></ol><p><strong>å®ä½“ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> tid;<br><br>&#125;<br><br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teacher</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">//ä¸€ä¸ªè€å¸ˆæ‹¥æœ‰å¤šä¸ªå­¦ç”Ÿ</span><br>    <span class="hljs-keyword">private</span> List&lt;Student&gt; students;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†-1"><a href="#æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†-1" class="headerlink" title="æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†"></a>æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><br><span class="hljs-comment">&lt;!--æŒ‰ç»“æœåµŒå¥—æŸ¥è¯¢--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;TeacherStudent&quot;</span>&gt;</span><br>    select s.id sid, s.name sname, t.name tname,t.id tid<br>    from student s,teacher t<br>    where s.tid = t.id and t.id = #&#123;tid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;TeacherStudent&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tname&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--å¤æ‚çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬å¤„ç† å¯¹è±¡ï¼š association é›†åˆï¼š collection</span><br><span class="hljs-comment">    javaType=&quot;&quot; æŒ‡å®šå±æ€§çš„ç±»å‹ï¼</span><br><span class="hljs-comment">    é›†åˆä¸­çš„æ³›å‹ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ofTypeè·å–</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span>/&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;tid&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†-1"><a href="#æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†-1" class="headerlink" title="æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†"></a>æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher2&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;TeacherStudent2&quot;</span>&gt;</span><br>    select * from mybatis.teacher where id = #&#123;tid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;TeacherStudent2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;ArrayList&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;Student&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;getStudentByTeacherId&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudentByTeacherId&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>    select * from mybatis.student where tid = #&#123;tid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol><li>å…³è” - association   ã€å¤šå¯¹ä¸€ã€‘</li><li>é›†åˆ - collection   ã€ä¸€å¯¹å¤šã€‘</li><li>javaType    &amp;   ofType<ol><li>JavaType  ç”¨æ¥æŒ‡å®šå®ä½“ç±»ä¸­å±æ€§çš„ç±»å‹</li><li>ofType  ç”¨æ¥æŒ‡å®šæ˜ å°„åˆ°Listæˆ–è€…é›†åˆä¸­çš„ pojoç±»å‹ï¼Œæ³›å‹ä¸­çš„çº¦æŸç±»å‹ï¼</li></ol></li></ol><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>ä¿è¯SQLçš„å¯è¯»æ€§ï¼Œå°½é‡ä¿è¯é€šä¿—æ˜“æ‡‚</li><li>æ³¨æ„ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€ä¸­ï¼Œå±æ€§åå’Œå­—æ®µçš„é—®é¢˜ï¼</li><li>å¦‚æœé—®é¢˜ä¸å¥½æ’æŸ¥é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨æ—¥å¿— ï¼Œ å»ºè®®ä½¿ç”¨ Log4j</li></ul><p><strong>æ…¢SQL       1s        1000s</strong>      </p><p>é¢è¯•é«˜é¢‘</p><ul><li>Mysqlå¼•æ“</li><li>InnoDBåº•å±‚åŸç†</li><li>ç´¢å¼•</li><li>ç´¢å¼•ä¼˜åŒ–ï¼</li></ul><h2 id="12ã€åŠ¨æ€-SQL"><a href="#12ã€åŠ¨æ€-SQL" class="headerlink" title="12ã€åŠ¨æ€ SQL"></a>12ã€åŠ¨æ€ SQL</h2><p>==<strong>ä»€ä¹ˆæ˜¯åŠ¨æ€SQLï¼šåŠ¨æ€SQLå°±æ˜¯æŒ‡æ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„SQLè¯­å¥</strong>==</p><p>åˆ©ç”¨åŠ¨æ€ SQL è¿™ä¸€ç‰¹æ€§å¯ä»¥å½»åº•æ‘†è„±è¿™ç§ç—›è‹¦ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">åŠ¨æ€ SQL å…ƒç´ å’Œ JSTL æˆ–åŸºäºç±»ä¼¼ XML çš„æ–‡æœ¬å¤„ç†å™¨ç›¸ä¼¼ã€‚åœ¨ MyBatis ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæœ‰å¾ˆå¤šå…ƒç´ éœ€è¦èŠ±æ—¶é—´äº†è§£ã€‚MyBatis 3 å¤§å¤§ç²¾ç®€äº†å…ƒç´ ç§ç±»ï¼Œç°åœ¨åªéœ€å­¦ä¹ åŸæ¥ä¸€åŠçš„å…ƒç´ ä¾¿å¯ã€‚MyBatis é‡‡ç”¨åŠŸèƒ½å¼ºå¤§çš„åŸºäº OGNL çš„è¡¨è¾¾å¼æ¥æ·˜æ±°å…¶å®ƒå¤§éƒ¨åˆ†å…ƒç´ ã€‚<br><br>if<br>choose (when, otherwise)<br>trim (where, set)<br>foreach<br></code></pre></div></td></tr></table></figure><h3 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h3><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `blog` (<br>  `id` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åšå®¢id&#x27;</span>,<br>  `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åšå®¢æ ‡é¢˜&#x27;</span>,<br>  `author` <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åšå®¢ä½œè€…&#x27;</span>,<br>  `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  `views` <span class="hljs-type">int</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æµè§ˆé‡&#x27;</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8<br><br></code></pre></div></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªåŸºç¡€å·¥ç¨‹</p><ol><li><p>å¯¼åŒ…</p></li><li><p>ç¼–å†™é…ç½®æ–‡ä»¶</p></li><li><p>ç¼–å†™å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String author;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> views;<br>    <br>    <br>&#125;<br></code></pre></div></td></tr></table></figure></li><li><p>ç¼–å†™å®ä½“ç±»å¯¹åº”Mapperæ¥å£ å’Œ Mapper.XMLæ–‡ä»¶</p></li></ol><h3 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryBlogIF&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;blog&quot;</span>&gt;</span><br>    select * from mybatis.blog where 1=1<br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span><br>        and title = #&#123;title&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span><br>        and author = #&#123;author&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose (when, otherwise)"></a>choose (when, otherwise)</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryBlogChoose&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;blog&quot;</span>&gt;</span><br>    select * from mybatis.blog<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span><br>                title = #&#123;title&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span><br>                and author = #&#123;author&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span><br>                and views = #&#123;views&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="trim-where-set"><a href="#trim-where-set" class="headerlink" title="trim (where,set)"></a>trim (where,set)</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">select * from mybatis.blog<br><span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span><br>        title = #&#123;title&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span><br>        and author = #&#123;author&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateBlog&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><br>    update mybatis.blog<br>    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span><br>            title = #&#123;title&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span><br>            author = #&#123;author&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>    where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><p>==<strong>æ‰€è°“çš„åŠ¨æ€SQLï¼Œæœ¬è´¨è¿˜æ˜¯SQLè¯­å¥ ï¼Œ åªæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨SQLå±‚é¢ï¼Œå»æ‰§è¡Œä¸€ä¸ªé€»è¾‘ä»£ç </strong>==</p><p>if</p><p>where ï¼Œ set  ï¼Œ choose ï¼Œwhen</p><h3 id="SQLç‰‡æ®µ"><a href="#SQLç‰‡æ®µ" class="headerlink" title="SQLç‰‡æ®µ"></a>SQLç‰‡æ®µ</h3><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå°†ä¸€äº›åŠŸèƒ½çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œæ–¹ä¾¿å¤ç”¨ï¼</p><ol><li><p>ä½¿ç”¨SQLæ ‡ç­¾æŠ½å–å…¬å…±çš„éƒ¨åˆ†</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;if-title-author&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span><br>        title = #&#123;title&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span><br>        and author = #&#123;author&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ä½¿ç”¨Includeæ ‡ç­¾å¼•ç”¨å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryBlogIF&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;blog&quot;</span>&gt;</span><br>    select * from mybatis.blog<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;if-title-author&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>æœ€å¥½åŸºäºå•è¡¨æ¥å®šä¹‰SQLç‰‡æ®µï¼</li><li>ä¸è¦å­˜åœ¨whereæ ‡ç­¾</li></ul><h3 id="Foreach"><a href="#Foreach" class="headerlink" title="Foreach"></a>Foreach</h3><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <br><br>  <span class="hljs-operator">&lt;</span>foreach item<span class="hljs-operator">=</span>&quot;id&quot; collection<span class="hljs-operator">=</span>&quot;ids&quot;<br>      <span class="hljs-keyword">open</span><span class="hljs-operator">=</span>&quot;(&quot; separator<span class="hljs-operator">=</span>&quot;or&quot; <span class="hljs-keyword">close</span><span class="hljs-operator">=</span>&quot;)&quot;<span class="hljs-operator">&gt;</span><br>        #&#123;id&#125;<br>  <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br><br>(id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">or</span> id<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">or</span> id<span class="hljs-operator">=</span><span class="hljs-number">3</span>)<br><br></code></pre></div></td></tr></table></figure><p><a href="https://imgtu.com/i/cADrQO"><img src="https://z3.ax1x.com/2021/03/31/cADrQO.png" alt="cADrQO.png"></a></p><p><a href="https://imgtu.com/i/cADyOe"><img src="https://z3.ax1x.com/2021/03/31/cADyOe.png" alt="cADyOe.png"></a></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        select * from mybatis.blog where 1=1 and (id=1 or id = 2 or id=3)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        æˆ‘ä»¬ç°åœ¨ä¼ é€’ä¸€ä¸ªä¸‡èƒ½çš„map ï¼Œ è¿™mapä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªé›†åˆï¼</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryBlogForeach&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;blog&quot;</span>&gt;</span><br>    select * from mybatis.blog<br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;and (&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;or&quot;</span>&gt;</span><br>            id = #&#123;id&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><p>==åŠ¨æ€SQLå°±æ˜¯åœ¨æ‹¼æ¥SQLè¯­å¥ï¼Œæˆ‘ä»¬åªè¦ä¿è¯SQLçš„æ­£ç¡®æ€§ï¼ŒæŒ‰ç…§SQLçš„æ ¼å¼ï¼Œå»æ’åˆ—ç»„åˆå°±å¯ä»¥äº†==</p><p>å»ºè®®ï¼š</p><ul><li>ç°åœ¨Mysqlä¸­å†™å‡ºå®Œæ•´çš„SQL,å†å¯¹åº”çš„å»ä¿®æ”¹æˆä¸ºæˆ‘ä»¬çš„åŠ¨æ€SQLå®ç°é€šç”¨å³å¯ï¼</li></ul><h2 id="13ã€ç¼“å­˜-ï¼ˆäº†è§£ï¼‰"><a href="#13ã€ç¼“å­˜-ï¼ˆäº†è§£ï¼‰" class="headerlink" title="13ã€ç¼“å­˜ ï¼ˆäº†è§£ï¼‰"></a>13ã€ç¼“å­˜ ï¼ˆäº†è§£ï¼‰</h2><h3 id="13-1ã€ç®€ä»‹"><a href="#13-1ã€ç®€ä»‹" class="headerlink" title="13.1ã€ç®€ä»‹"></a>13.1ã€ç®€ä»‹</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">æŸ¥è¯¢  ï¼š  è¿æ¥æ•°æ®åº“ ï¼Œè€—èµ„æºï¼<br>ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœï¼Œç»™ä»–æš‚å­˜åœ¨ä¸€ä¸ªå¯ä»¥ç›´æ¥å–åˆ°çš„åœ°æ–¹ï¼<span class="hljs-comment">--&gt; å†…å­˜ ï¼š ç¼“å­˜</span><br><br>æˆ‘ä»¬å†æ¬¡æŸ¥è¯¢ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥èµ°ç¼“å­˜ï¼Œå°±ä¸ç”¨èµ°æ•°æ®åº“äº†<br></code></pre></div></td></tr></table></figure><ol><li><p>ä»€ä¹ˆæ˜¯ç¼“å­˜ [ Cache ]ï¼Ÿ</p><ul><li>å­˜åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶æ•°æ®ã€‚</li><li>å°†ç”¨æˆ·ç»å¸¸æŸ¥è¯¢çš„æ•°æ®æ”¾åœ¨ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œç”¨æˆ·å»æŸ¥è¯¢æ•°æ®å°±ä¸ç”¨ä»ç£ç›˜ä¸Š(å…³ç³»å‹æ•°æ®åº“æ•°æ®æ–‡ä»¶)æŸ¥è¯¢ï¼Œä»ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œè§£å†³äº†é«˜å¹¶å‘ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ã€‚</li></ul></li><li><p>ä¸ºä»€ä¹ˆä½¿ç”¨ç¼“å­˜ï¼Ÿ</p><ul><li>å‡å°‘å’Œæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ã€‚</li></ul></li><li><p>ä»€ä¹ˆæ ·çš„æ•°æ®èƒ½ä½¿ç”¨ç¼“å­˜ï¼Ÿ</p><ul><li>ç»å¸¸æŸ¥è¯¢å¹¶ä¸”ä¸ç»å¸¸æ”¹å˜çš„æ•°æ®ã€‚ã€å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‘</li></ul></li></ol><h3 id="13-2ã€Mybatisç¼“å­˜"><a href="#13-2ã€Mybatisç¼“å­˜" class="headerlink" title="13.2ã€Mybatisç¼“å­˜"></a>13.2ã€Mybatisç¼“å­˜</h3><ul><li><p>MyBatisåŒ…å«ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æŸ¥è¯¢ç¼“å­˜ç‰¹æ€§ï¼Œå®ƒå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®šåˆ¶å’Œé…ç½®ç¼“å­˜ã€‚ç¼“å­˜å¯ä»¥æå¤§çš„æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p>MyBatisç³»ç»Ÿä¸­é»˜è®¤å®šä¹‰äº†ä¸¤çº§ç¼“å­˜ï¼š<strong>ä¸€çº§ç¼“å­˜</strong>å’Œ<strong>äºŒçº§ç¼“å­˜</strong></p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€çº§ç¼“å­˜å¼€å¯ã€‚ï¼ˆSqlSessionçº§åˆ«çš„ç¼“å­˜ï¼Œä¹Ÿç§°ä¸ºæœ¬åœ°ç¼“å­˜ï¼‰</p></li><li><p>äºŒçº§ç¼“å­˜éœ€è¦æ‰‹åŠ¨å¼€å¯å’Œé…ç½®ï¼Œä»–æ˜¯åŸºäºnamespaceçº§åˆ«çš„ç¼“å­˜ã€‚</p></li><li><p>ä¸ºäº†æé«˜æ‰©å±•æ€§ï¼ŒMyBatiså®šä¹‰äº†ç¼“å­˜æ¥å£Cacheã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°Cacheæ¥å£æ¥è‡ªå®šä¹‰äºŒçº§ç¼“å­˜</p></li></ul></li></ul><h3 id="13-3ã€ä¸€çº§ç¼“å­˜"><a href="#13-3ã€ä¸€çº§ç¼“å­˜" class="headerlink" title="13.3ã€ä¸€çº§ç¼“å­˜"></a>13.3ã€ä¸€çº§ç¼“å­˜</h3><ul><li>ä¸€çº§ç¼“å­˜ä¹Ÿå«æœ¬åœ°ç¼“å­˜ï¼š  SqlSession<ul><li>ä¸æ•°æ®åº“åŒä¸€æ¬¡ä¼šè¯æœŸé—´æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼šæ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­ã€‚</li><li>ä»¥åå¦‚æœéœ€è¦è·å–ç›¸åŒçš„æ•°æ®ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿ï¼Œæ²¡å¿…é¡»å†å»æŸ¥è¯¢æ•°æ®åº“ï¼›</li></ul></li></ul><p>æµ‹è¯•æ­¥éª¤ï¼š</p><ol><li>å¼€å¯æ—¥å¿—ï¼</li><li>æµ‹è¯•åœ¨ä¸€ä¸ªSesionä¸­æŸ¥è¯¢ä¸¤æ¬¡ç›¸åŒè®°å½•</li><li>æŸ¥çœ‹æ—¥å¿—è¾“å‡º</li></ol><p><a href="https://imgtu.com/i/cAD2TA"><img src="https://z3.ax1x.com/2021/03/31/cAD2TA.png" alt="cAD2TA.png"></a></p><p>ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</p><ol><li><p>æŸ¥è¯¢ä¸åŒçš„ä¸œè¥¿</p></li><li><p>å¢åˆ æ”¹æ“ä½œï¼Œå¯èƒ½ä¼šæ”¹å˜åŸæ¥çš„æ•°æ®ï¼Œæ‰€ä»¥å¿…å®šä¼šåˆ·æ–°ç¼“å­˜ï¼</p><p><a href="https://imgtu.com/i/cADTOg"><img src="https://z3.ax1x.com/2021/03/31/cADTOg.png" alt="cADTOg.png"></a></p></li></ol><ol start="3"><li><p>æŸ¥è¯¢ä¸åŒçš„Mapper.xml</p></li><li><p>æ‰‹åŠ¨æ¸…ç†ç¼“å­˜ï¼</p><p><a href="https://imgtu.com/i/cADHmQ"><img src="https://z3.ax1x.com/2021/03/31/cADHmQ.png" alt="cADHmQ.png"></a></p></li></ol><p>å°ç»“ï¼šä¸€çº§ç¼“å­˜é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œåªåœ¨ä¸€æ¬¡SqlSessionä¸­æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯æ‹¿åˆ°è¿æ¥åˆ°å…³é—­è¿æ¥è¿™ä¸ªåŒºé—´æ®µï¼</p><p>ä¸€çº§ç¼“å­˜å°±æ˜¯ä¸€ä¸ªMapã€‚</p><h3 id="13-4ã€äºŒçº§ç¼“å­˜"><a href="#13-4ã€äºŒçº§ç¼“å­˜" class="headerlink" title="13.4ã€äºŒçº§ç¼“å­˜"></a>13.4ã€äºŒçº§ç¼“å­˜</h3><ul><li>äºŒçº§ç¼“å­˜ä¹Ÿå«å…¨å±€ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜ä½œç”¨åŸŸå¤ªä½äº†ï¼Œæ‰€ä»¥è¯ç”Ÿäº†äºŒçº§ç¼“å­˜</li><li>åŸºäºnamespaceçº§åˆ«çš„ç¼“å­˜ï¼Œä¸€ä¸ªåç§°ç©ºé—´ï¼Œå¯¹åº”ä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼›</li><li>å·¥ä½œæœºåˆ¶<ul><li>ä¸€ä¸ªä¼šè¯æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šè¢«æ”¾åœ¨å½“å‰ä¼šè¯çš„ä¸€çº§ç¼“å­˜ä¸­ï¼›</li><li>å¦‚æœå½“å‰ä¼šè¯å…³é—­äº†ï¼Œè¿™ä¸ªä¼šè¯å¯¹åº”çš„ä¸€çº§ç¼“å­˜å°±æ²¡äº†ï¼›ä½†æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ˜¯ï¼Œä¼šè¯å…³é—­äº†ï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®è¢«ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼›</li><li>æ–°çš„ä¼šè¯æŸ¥è¯¢ä¿¡æ¯ï¼Œå°±å¯ä»¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–å†…å®¹ï¼›</li><li>ä¸åŒçš„mapperæŸ¥å‡ºçš„æ•°æ®ä¼šæ”¾åœ¨è‡ªå·±å¯¹åº”çš„ç¼“å­˜ï¼ˆmapï¼‰ä¸­ï¼›</li></ul></li></ul><p>æ­¥éª¤ï¼š</p><ol><li><p>å¼€å¯å…¨å±€ç¼“å­˜</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ˜¾ç¤ºçš„å¼€å¯å…¨å±€ç¼“å­˜--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>åœ¨è¦ä½¿ç”¨äºŒçº§ç¼“å­˜çš„Mapperä¸­å¼€å¯</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åœ¨å½“å‰Mapper.xmlä¸­ä½¿ç”¨äºŒçº§ç¼“å­˜--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">cache</span>/&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‚æ•°</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åœ¨å½“å‰Mapper.xmlä¸­ä½¿ç”¨äºŒçº§ç¼“å­˜--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">cache</span>   <span class="hljs-attr">eviction</span>=<span class="hljs-string">&quot;FIFO&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">&quot;60000&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;512&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">readOnly</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•</p><ol><li><p>é—®é¢˜:æˆ‘ä»¬éœ€è¦å°†å®ä½“ç±»åºåˆ—åŒ–ï¼å¦åˆ™å°±ä¼šæŠ¥é”™ï¼</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">Caused by: java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.NotSerializableException</span>: com<span class="hljs-selector-class">.kuang</span><span class="hljs-selector-class">.pojo</span>.User<br></code></pre></div></td></tr></table></figure></li></ol></li></ol><p>å°ç»“ï¼š</p><ul><li>åªè¦å¼€å¯äº†äºŒçº§ç¼“å­˜ï¼Œåœ¨åŒä¸€ä¸ªMapperä¸‹å°±æœ‰æ•ˆ</li><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå…ˆæ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­ï¼›</li><li>åªæœ‰å½“ä¼šè¯æäº¤ï¼Œæˆ–è€…å…³é—­çš„æ—¶å€™ï¼Œæ‰ä¼šæäº¤åˆ°äºŒçº§ç¼“å†²ä¸­ï¼</li></ul><h3 id="13-5ã€ç¼“å­˜åŸç†"><a href="#13-5ã€ç¼“å­˜åŸç†" class="headerlink" title="13.5ã€ç¼“å­˜åŸç†"></a>13.5ã€ç¼“å­˜åŸç†</h3><p><a href="https://imgtu.com/i/cArQ7d"><img src="https://z3.ax1x.com/2021/03/31/cArQ7d.png" alt="cArQ7d.png"></a></p><h3 id="13-6ã€è‡ªå®šä¹‰ç¼“å­˜-ehcache"><a href="#13-6ã€è‡ªå®šä¹‰ç¼“å­˜-ehcache" class="headerlink" title="13.6ã€è‡ªå®šä¹‰ç¼“å­˜-ehcache"></a>13.6ã€è‡ªå®šä¹‰ç¼“å­˜-ehcache</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">Ehcacheæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºJavaåˆ†å¸ƒå¼ç¼“å­˜ã€‚ä¸»è¦é¢å‘é€šç”¨ç¼“å­˜<br></code></pre></div></td></tr></table></figure><p>è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨ehcacheï¼Œå…ˆè¦å¯¼åŒ…ï¼</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.caches<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>åœ¨mapperä¸­æŒ‡å®šä½¿ç”¨æˆ‘ä»¬çš„ehcacheç¼“å­˜å®ç°ï¼</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åœ¨å½“å‰Mapper.xmlä¸­ä½¿ç”¨äºŒçº§ç¼“å­˜--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span><br></code></pre></div></td></tr></table></figure><p>ehcache.xml</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">updateCheck</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">       diskStoreï¼šä¸ºç¼“å­˜è·¯å¾„ï¼Œehcacheåˆ†ä¸ºå†…å­˜å’Œç£ç›˜ä¸¤çº§ï¼Œæ­¤å±æ€§å®šä¹‰ç£ç›˜çš„ç¼“å­˜ä½ç½®ã€‚å‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š</span><br><span class="hljs-comment">       user.home â€“ ç”¨æˆ·ä¸»ç›®å½•</span><br><span class="hljs-comment">       user.dir  â€“ ç”¨æˆ·å½“å‰å·¥ä½œç›®å½•</span><br><span class="hljs-comment">       java.io.tmpdir â€“ é»˜è®¤ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-comment">     --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">diskStore</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;./tmpdir/Tmp_EhCache&quot;</span>/&gt;</span><br>    <br>    &lt;defaultCache<br>            eternal=&quot;false&quot;<br>            maxElementsInMemory=&quot;10000&quot;<br>            overflowToDisk=&quot;false&quot;<br>            diskPersistent=&quot;false&quot;<br>            timeToIdleSeconds=&quot;1800&quot;<br>            timeToLiveSeconds=&quot;259200&quot;<br>            memoryStoreEvictionPolicy=&quot;LRU&quot;/&gt;<br> <br>    &lt;cache<br>            name=&quot;cloud_user&quot;<br>            eternal=&quot;false&quot;<br>            maxElementsInMemory=&quot;5000&quot;<br>            overflowToDisk=&quot;false&quot;<br>            diskPersistent=&quot;false&quot;<br>            timeToIdleSeconds=&quot;1800&quot;<br>            timeToLiveSeconds=&quot;1800&quot;<br>            memoryStoreEvictionPolicy=&quot;LRU&quot;/&gt;<br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">       defaultCacheï¼šé»˜è®¤ç¼“å­˜ç­–ç•¥ï¼Œå½“ehcacheæ‰¾ä¸åˆ°å®šä¹‰çš„ç¼“å­˜æ—¶ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªç¼“å­˜ç­–ç•¥ã€‚åªèƒ½å®šä¹‰ä¸€ä¸ªã€‚</span><br><span class="hljs-comment">     --&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">      name:ç¼“å­˜åç§°ã€‚</span><br><span class="hljs-comment">      maxElementsInMemory:ç¼“å­˜æœ€å¤§æ•°ç›®</span><br><span class="hljs-comment">      maxElementsOnDiskï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ã€‚</span><br><span class="hljs-comment">      eternal:å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œä¸€ä½†è®¾ç½®äº†ï¼Œtimeoutå°†ä¸èµ·ä½œç”¨ã€‚</span><br><span class="hljs-comment">      overflowToDisk:æ˜¯å¦ä¿å­˜åˆ°ç£ç›˜ï¼Œå½“ç³»ç»Ÿå½“æœºæ—¶</span><br><span class="hljs-comment">      timeToIdleSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“eternal=falseå¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§ã€‚</span><br><span class="hljs-comment">      timeToLiveSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰å…è®¸å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚æœ€å¤§æ—¶é—´ä»‹äºåˆ›å»ºæ—¶é—´å’Œå¤±æ•ˆæ—¶é—´ä¹‹é—´ã€‚ä»…å½“eternal=falseå¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯0.ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å­˜æ´»æ—¶é—´æ— ç©·å¤§ã€‚</span><br><span class="hljs-comment">      diskPersistentï¼šæ˜¯å¦ç¼“å­˜è™šæ‹Ÿæœºé‡å¯æœŸæ•°æ® Whether the disk store persists between restarts of the Virtual Machine. The default value is false.</span><br><span class="hljs-comment">      diskSpoolBufferSizeMBï¼šè¿™ä¸ªå‚æ•°è®¾ç½®DiskStoreï¼ˆç£ç›˜ç¼“å­˜ï¼‰çš„ç¼“å­˜åŒºå¤§å°ã€‚é»˜è®¤æ˜¯30MBã€‚æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒºã€‚</span><br><span class="hljs-comment">      diskExpiryThreadIntervalSecondsï¼šç£ç›˜å¤±æ•ˆçº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚</span><br><span class="hljs-comment">      memoryStoreEvictionPolicyï¼šå½“è¾¾åˆ°maxElementsInMemoryé™åˆ¶æ—¶ï¼ŒEhcacheå°†ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥å»æ¸…ç†å†…å­˜ã€‚é»˜è®¤ç­–ç•¥æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ã€‚ä½ å¯ä»¥è®¾ç½®ä¸ºFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æˆ–æ˜¯LFUï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚</span><br><span class="hljs-comment">      clearOnFlushï¼šå†…å­˜æ•°é‡æœ€å¤§æ—¶æ˜¯å¦æ¸…é™¤ã€‚</span><br><span class="hljs-comment">      memoryStoreEvictionPolicy:å¯é€‰ç­–ç•¥æœ‰ï¼šLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé»˜è®¤ç­–ç•¥ï¼‰ã€FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ã€LFUï¼ˆæœ€å°‘è®¿é—®æ¬¡æ•°ï¼‰ã€‚</span><br><span class="hljs-comment">      FIFOï¼Œfirst in first outï¼Œè¿™ä¸ªæ˜¯å¤§å®¶æœ€ç†Ÿçš„ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</span><br><span class="hljs-comment">      LFUï¼Œ Less Frequently Usedï¼Œå°±æ˜¯ä¸Šé¢ä¾‹å­ä¸­ä½¿ç”¨çš„ç­–ç•¥ï¼Œç›´ç™½ä¸€ç‚¹å°±æ˜¯è®²ä¸€ç›´ä»¥æ¥æœ€å°‘è¢«ä½¿ç”¨çš„ã€‚å¦‚ä¸Šé¢æ‰€è®²ï¼Œç¼“å­˜çš„å…ƒç´ æœ‰ä¸€ä¸ªhitå±æ€§ï¼Œhitå€¼æœ€å°çš„å°†ä¼šè¢«æ¸…å‡ºç¼“å­˜ã€‚</span><br><span class="hljs-comment">      LRUï¼ŒLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼Œç¼“å­˜çš„å…ƒç´ æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå½“ç¼“å­˜å®¹é‡æ»¡äº†ï¼Œè€Œåˆéœ€è¦è…¾å‡ºåœ°æ–¹æ¥ç¼“å­˜æ–°çš„å…ƒç´ çš„æ—¶å€™ï¼Œé‚£ä¹ˆç°æœ‰ç¼“å­˜å…ƒç´ ä¸­æ—¶é—´æˆ³ç¦»å½“å‰æ—¶é—´æœ€è¿œçš„å…ƒç´ å°†è¢«æ¸…å‡ºç¼“å­˜ã€‚</span><br><span class="hljs-comment">   --&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span><br><br></code></pre></div></td></tr></table></figure><p>Redisæ•°æ®åº“æ¥åšç¼“å­˜ï¼  K-V</p><blockquote><p>Fromï¼š<a href="https://www.kuangstudy.com/">https://www.kuangstudy.com/</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>SSM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Java For-loop&amp; For-each &amp; Iterator æ•ˆç‡åˆ†æ</title>
    <link href="/2021/03/16/JavaSE/Java%20For-loop&amp;%20For-each%20&amp;%20Iterator%20%E6%95%88%E7%8E%87%E5%88%86%E6%9E%90/"/>
    <url>/2021/03/16/JavaSE/Java%20For-loop&amp;%20For-each%20&amp;%20Iterator%20%E6%95%88%E7%8E%87%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<ul><li><p><code>public static native long nanoTime();</code>  æ¥æµ‹è¯•æ—¶é—´ï¼Œä¸»ç¨‹åºå¤–å›´è·å–å½“å‰æ—¶é—´ï¼Œç„¶åä½œå·®å¾—åˆ°è¿è¡Œæ—¶é—´ã€‚</p></li><li><p>ç¨‹åºä¸­åŒæ—¶æµ‹è¯• <code>ArrayList</code>å’Œ <code>LinkedList</code>ä¸¤ç§å®ç°æ–¹å¼çš„éå†æ•ˆç‡ï¼Œä»£è¡¨äº†æ•°ç»„å’Œé“¾è¡¨ä¸¤ç§æ•°æ®ç»“æ„ã€‚</p></li><li><p>æˆå‘˜å˜é‡ <code>public static final int MAGNITUDE = 10000;</code>ç”¨æ¥æ§åˆ¶æ•°æ®çš„ <code>æ•°é‡çº§</code>ã€‚</p></li><li><p>åˆå§‹åŒ–å£°æ˜ä¸¤ç§ <code>List&lt;String&gt;</code>ï¼Œå¹¶é€’å¢å˜é‡è‡³æ•°é‡çº§å¤§å°ï¼Œè¿‡ç¨‹ä¸­è½¬åŒ–ä¸º String å­˜å‚¨åˆ°é›†åˆå½“ä¸­ï¼Œä½œä¸ºå®éªŒæ•°æ®ã€‚</p></li><li><p>æµ‹è¯•çš„è¿è¡Œç¨‹åºé€»è¾‘æ˜¯ï¼šå°†é›†åˆä¸­çš„æ•°æ®å–å‡ºæ¥ï¼Œå¹¶èµ‹å€¼ç»™å¦ä¸€ä¸ªå…ƒç´  <code>str</code>ã€‚ä½†æ˜¯è¿™é‡Œå­˜åœ¨æ—¶é—´å¤æ‚åº¦çš„åŒºåˆ«ï¼Œ <code>ArrayList</code>ä¸­çš„ <code>get(int index)</code>åœ¨æ•°ç»„å®ç°ä¸Š æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸æ•°çº§içš„ <code>O(1)</code>ï¼Œè€Œ <code>LinkedList</code>ä¸­çš„ <code>get(int index)</code>åœ¨é“¾è¡¨å®ç°ä¸Š æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§ <code>O(n)</code>ï¼Œä½†æ˜¯æµ‹è¯•çš„ <code>ArrayList</code>å’Œ <code>LinkedList</code>çš„æ—¶é—´æ¯”è¾ƒæ˜¯<code>åŒæ•°æ®ç»“æ„</code>ä¹‹é—´æ¯”è¾ƒï¼Œç¬¦åˆæ§åˆ¶å˜é‡æ³•ï¼Œæ‰€ä»¥ä¸éœ€è¦ç»“æœä¸Šçš„ æ•°å€¼ï¼Œè€Œå…³æ³¨ è¿è¡Œæ—¶é—´çš„ <code>æ—¶é—´æ•°é‡çº§</code>ï¼Œè¿™æ ·æ¯”è¾ƒæ‰æœ‰æ„ä¹‰ã€‚</p></li></ul><h2 id="æµ‹è¯•ä»£ç ï¼š"><a href="#æµ‹è¯•ä»£ç ï¼š" class="headerlink" title="æµ‹è¯•ä»£ç ï¼š"></a>æµ‹è¯•ä»£ç ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAGNITUDE = <span class="hljs-number">10000</span>;    <span class="hljs-comment">// æ•°é‡çº§</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">testForloop</span><span class="hljs-params">(List&lt;String&gt; list)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> start, end;<br>        String str = <span class="hljs-keyword">null</span>;<br>        start = System.nanoTime();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAGNITUDE; i++) &#123;<br>            str = list.get(i);<br>        &#125;<br>        end = System.nanoTime();<br>        <span class="hljs-keyword">return</span> end - start;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">testForeach</span><span class="hljs-params">(List&lt;String&gt; list)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> start, end;<br>        String str = <span class="hljs-keyword">null</span>;<br>        start = System.nanoTime();<br>        <span class="hljs-keyword">for</span> (String s : list) &#123;<br>            str = s;<br>        &#125;<br>        end = System.nanoTime();<br>        <span class="hljs-keyword">return</span> end - start;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">testIterator</span><span class="hljs-params">(List&lt;String&gt; list)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> start, end;<br>        String str = <span class="hljs-keyword">null</span>;<br>        start = System.nanoTime();<br>        Iterator&lt;String&gt; iterator = list.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            str = iterator.next();<br>        &#125;<br>        end = System.nanoTime();<br>        <span class="hljs-keyword">return</span> end - start;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">/* initialize */</span><br>        List&lt;String&gt; arrayList = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>        List&lt;String&gt; linkedList = <span class="hljs-keyword">new</span> LinkedList&lt;String&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAGNITUDE; i++) &#123;<br>            arrayList.add(String.valueOf(i));<br>            linkedList.add(String.valueOf(i));<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;========Test for ArrayList========&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;For loop: &quot;</span> + testForloop(arrayList));<br>        System.out.println(<span class="hljs-string">&quot;Foreach: &quot;</span> + testForeach(arrayList));<br>        System.out.println(<span class="hljs-string">&quot;Iterator: &quot;</span> + testIterator(arrayList));<br><br>        System.out.println(<span class="hljs-string">&quot;========Test for LinkedList========&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;For loop: &quot;</span> + testForloop(linkedList));<br>        System.out.println(<span class="hljs-string">&quot;Foreach: &quot;</span> + testForeach(linkedList));<br>        System.out.println(<span class="hljs-string">&quot;Iterator: &quot;</span> + testIterator(linkedList));<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ul><li>å¦‚ä¸Šæ–‡åˆ†æï¼š<code>åŒæ•°æ®ç»“æ„</code> æ¯”è¾ƒåŸåˆ™ã€‚</li></ul><h3 id="æ•°é‡çº§ï¼š1-000"><a href="#æ•°é‡çº§ï¼š1-000" class="headerlink" title="æ•°é‡çº§ï¼š1,000"></a>æ•°é‡çº§ï¼š1,000</h3><blockquote><p>========Test for ArrayList========<br>For loop: 99000<br>Foreach: 321700<br>Iterator: 194500<br>========Test for LinkedList========<br>For loop: 1215800<br>Foreach: 341500<br>Iterator: 94900</p></blockquote><h3 id="æ•°é‡çº§ï¼š10-000"><a href="#æ•°é‡çº§ï¼š10-000" class="headerlink" title="æ•°é‡çº§ï¼š10,000"></a>æ•°é‡çº§ï¼š10,000</h3><blockquote><p>========Test for ArrayList========<br>For loop: 933200<br>Foreach: 942500<br>Iterator: 585800<br>========Test for LinkedList========<br>For loop: 129958500<br>Foreach: 1433000<br>Iterator: 967600</p></blockquote><h3 id="æ•°é‡çº§ï¼š100-000"><a href="#æ•°é‡çº§ï¼š100-000" class="headerlink" title="æ•°é‡çº§ï¼š100,000"></a>æ•°é‡çº§ï¼š100,000</h3><blockquote><p>========Test for ArrayList========<br>For loop: 3730800<br>Foreach: 6669800<br>Iterator: 5215100<br>========Test for LinkedList========<br>For loop: 18907275800<br>Foreach: 7468100<br>Iterator: 5632400</p></blockquote><ul><li><code>ArrayList</code>ï¼šåœ¨å°æ•°é‡çº§ä¸Šï¼ŒFor-loopæ•ˆç‡ä¼šé«˜ä¸€ç‚¹ï¼ŒFor &lt; Iterator &lt; For-eachï¼Œè¿™é‡Œå¾—å‡ºçš„ç»“è®ºæ ¹æ®æ—¶é—´æ¶ˆè€—å¾—å‡ºï¼Œæ— æ³•ä»”ç»†æ¯”è¾ƒæ•ˆç‡é«˜ä½ï¼Œæ•°é‡çº§å°æ—¶ï¼ŒForæ•ˆç‡é«˜ä¸€ç‚¹ï¼Œæ•´ä½“æ¥è¯´ï¼Œä¸‰è€…é€Ÿåº¦çº§åˆ«å·®ä¸å¤šã€‚</li><li><code>LinkedList</code>ï¼šé“¾è¡¨ä¸­å¾ˆæ˜æ˜¾ For loop æ•ˆç‡å°±ä½å¾ˆå¤šäº†ã€‚For-eachå’ŒIteratorç›¸å·®ä¸å¤§ã€‚æ•°é‡å¤§ï¼ˆä¸€èˆ¬è¶…è¿‡ 100,000çº§åˆ«ï¼‰æ•ˆæœæ›´æ˜æ˜¾ã€‚Iterator &lt; For-each &lt; &lt;&lt;For-loopã€‚Iteratorå’ŒFor-eachæ•ˆç‡åœ¨é“¾è¡¨ä¸­å·®ä¸å¤šï¼ŒForå·®ä¸€äº›å°±æ˜¯äº†ã€‚</li></ul><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li><p> For-each å’Œ Iterator åŸºæœ¬éƒ½åœ¨ä¸€ä¸ªæ•°é‡çº§ä¸Šï¼Œè¿™å¯èƒ½ä¸ For-each å°±æ˜¯åŸºäº Iterator å®ç°çš„ï¼Œè‡³äº For-each ä¼šç¨å¾®æ…¢ä¸€ç‚¹ï¼Œå¯èƒ½æ˜¯ For-each éšå¼è½¬æ¢ Iterator è€—è´¹å¤šä½™æ—¶é—´ï¼Œ</p></li><li><p><code>ArrayList</code>åŸºäºæ•°ç»„ï¼Œindexéƒ½æ˜¯ç¡®å®šçš„ï¼Œåœ¨æŸ¥æ”¹åé¢æ•ˆç‡ä¼šé«˜ä¸€ç‚¹ï¼Œè‡ªç„¶å¸¦ç€ä¸‹è¡¨çš„ For æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚<code>LinkedList</code>åŸºäºé“¾è¡¨ï¼ŒæŸ¥æ”¹å¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼Œä½†å®ƒæ˜¯<code>åŒå‘å¾ªç¯å¸¦å¤´èŠ‚ç‚¹çš„é“¾è¡¨</code>ï¼Œå¢åˆ ä¼šæ¯”æ•°ç»„å¿«ï¼Œè¿™ä¸¤ç§æ•°æ®ç»“æ„çš„æ¯”è¾ƒå·®åˆ«å°±åœ¨è¿™ï¼Œå®é™…ä¸­è¿˜æ˜¯è¦çœ‹åœ¨å“ªæ–¹é¢çš„åº”ç”¨æ¥ç¡®å®šã€‚</p></li></ul><h2 id="å·¥ç¨‹ä¸­ä¸‰ç§å¾ªç¯çš„ä½¿ç”¨å»ºè®®ã€‚"><a href="#å·¥ç¨‹ä¸­ä¸‰ç§å¾ªç¯çš„ä½¿ç”¨å»ºè®®ã€‚" class="headerlink" title="å·¥ç¨‹ä¸­ä¸‰ç§å¾ªç¯çš„ä½¿ç”¨å»ºè®®ã€‚"></a>å·¥ç¨‹ä¸­ä¸‰ç§å¾ªç¯çš„ä½¿ç”¨å»ºè®®ã€‚</h2><ul><li><code>ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆç¬¬58æ¡</code>ä¸­å»ºè®®ï¼Œä¸€èˆ¬é‡‡ç”¨ Foreach è¿›è¡Œå¾ªç¯ï¼Œå› ä¸ºå®ƒåœ¨ <code>ç®€æ´æ€§</code>å’Œ <code>é¢„é˜²Bug</code>ä¸Šä¼˜äºFor-loop å’Œ Iteratorï¼ˆç¡®åˆ‡è¯´æ˜¯ Iterator é…åˆ while ä½¿ç”¨ï¼‰</li></ul><p><code>ç®€æ´æ€§</code>å°±ä¸éœ€è¦å¤šé˜è¿°äº†ï¼Œå…‰çœ‹ä»£ç é‡å’Œå¯è¯»æ€§ï¼Œå°±çŸ¥é“ For-each çš„<code>ç®€æ´æ€§</code>ç‰¹ç‚¹ã€‚</p><h4 id="For-each-ä¼˜åŠ¿äº-while-loop"><a href="#For-each-ä¼˜åŠ¿äº-while-loop" class="headerlink" title="For-each ä¼˜åŠ¿äº while-loop"></a>For-each ä¼˜åŠ¿äº while-loop</h4><hr><h5 id="é¢„é˜²Bug"><a href="#é¢„é˜²Bug" class="headerlink" title="é¢„é˜²Bug"></a>é¢„é˜²Bug</h5><ul><li>è¯´åˆ°é¢„é˜²Bugï¼Œè¿™é‡Œç‰µæ¶‰åˆ° ç¬¬57æ¡ ä¸­çš„ <code>å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–</code>ã€‚</li></ul><h5 id="ä¸ºä»€ä¹ˆè¦â€œå°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–â€"><a href="#ä¸ºä»€ä¹ˆè¦â€œå°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–â€" class="headerlink" title="ä¸ºä»€ä¹ˆè¦â€œå°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–â€"></a>ä¸ºä»€ä¹ˆè¦â€œå°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–â€</h5><p>ä¹¦ä¸­æåˆ°ï¼ŒåŸå› ç±»ä¼¼äº ç¬¬15æ¡çš„æœ¬è´¨ï¼Œ<code>ä½¿ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æœ€å°åŒ–</code>ã€‚å°†å±€éƒ¨å˜é‡ä½œç”¨åŸŸæœ€å°åŒ–ï¼Œå¯ä»¥å¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¹¶é™ä½å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p><blockquote><p> å¾ªç¯ä¸­æä¾›äº†ç‰¹æ®Šçš„æœºä¼šæ¥å°†å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–ã€‚æ— è®ºæ˜¯ä¼ ç»Ÿçš„forå¾ªç¯ï¼Œè¿˜æ˜¯for-eachå½¢å¼çš„ for å¾ªç¯ï¼Œéƒ½å…è®¸å£°æ˜<strong>å¾ªç¯å˜é‡</strong>ï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸè¢«é™å®š<strong>åœ¨æ­£å¥½éœ€è¦çš„èŒƒå›´</strong>ä¹‹å†…ã€‚å¦‚æœåœ¨å¾ªç¯ç»ˆæ­¢ä¹‹åä¸å†éœ€è¦å¾ªç¯å˜é‡çš„å†…å®¹ï¼Œfor-loopå°±ä¼˜å…ˆäº while loopã€‚</p></blockquote><ul><li>å¦‚ä¸‹æ˜¯ä¸€ç§éå†é›†åˆçš„é¦–é€‰åšæ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Preferred idiom for iterating over a collection or array</span><br><span class="hljs-keyword">for</span> (Element e : c) &#123;<br>    ... <span class="hljs-comment">// Do Someting with e</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>å¦‚æœéœ€è¦è®¿é—®è¿­ä»£å™¨ï¼Œå¯èƒ½è¦è°ƒç”¨å®ƒçš„ remove æ–¹æ³•ï¼Œé¦–é€‰åšæ³•æ˜¯åˆ©ç”¨ä¼ ç»Ÿçš„ for å¾ªç¯æ›¿ä»£ for-each å¾ªç¯ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Idiom for iterating when you need the iterator</span><br><span class="hljs-keyword">for</span> (Iterator&lt;Element&gt; i = c.iterator(); i.hasNext(); ) &#123;<br>    Element e = i.next();<br>    ... <span class="hljs-comment">// Do someting with e and i</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæœ‰äº›æ—¶å€™ä¸èƒ½ç”¨ for-each ï¼Œå®ƒçš„å®ç°è¿˜æ˜¯åŸºäº iterator çš„ <code>hasNext() + next()</code>ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦åœ¨å¾ªç¯è¿‡ç¨‹ä¸­å¯¹é›†åˆè¿›è¡Œæ“ä½œï¼Œæ­¤æ—¶å°±å¿…é¡»ä½¿ç”¨ iterator å¯¹è±¡è¿›è¡Œæ“ä½œäº†ï¼Œå› ä¸ºä½¿ç”¨ iterator å¾ªç¯æ—¶ï¼Œé›†åˆçš„æ“ä½œæƒå°±äº¤ç»™äº† iteratorï¼Œè™½ç„¶å¯ä»¥ç”¨é›†åˆå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå¦‚ <code>romove()</code>ä½†è¿™æ ·ä¼šç ´å iterator åˆå§‹åŒ–çš„ç»“æœï¼Œå¯¼è‡´æœ€ç»ˆç¨‹åºè¿è¡Œçš„ç»“æœä¸é¢„æœŸåå·®å¾ˆå¤§ï¼Œè¿™é‡Œå¼•ç”¨æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼Œæœ‰ Java åœ¨ iterator ä¸­ remove() çš„ bugè¯¦è§£ã€‚</p><blockquote><p><a href="https://www.jianshu.com/p/642d6fd39013">https://www.jianshu.com/p/642d6fd39013</a></p></blockquote><ul><li>è‡³äºä¸ºä»€ä¹ˆ for loop è¦æ¯” while loop æ›´å¥½ï¼Œå‚è€ƒä¸€ä¸‹ä»£ç ç‰‡æ®µï¼Œè¿ç»­çš„ä¸¤ä¸ª whIle loopï¼Œä»¥åŠå‡ºç°çš„ä¸€ä¸ª bug</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Iterator&lt;Element&gt; i = c.iterator();<br><span class="hljs-keyword">while</span> (i.hasNext()) &#123;<br>    doSometing(i.next());<br>&#125;<br>...<br>Iterator&lt;Element&gt; i2 = c.iterator();<br><span class="hljs-keyword">while</span> (i.hasNext()) &#123;   <span class="hljs-comment">// This is bug!</span><br>    doSometing(i2.next());<br>&#125;<br></code></pre></div></td></tr></table></figure><p>åœ¨ç¬¬äºŒä¸ª while loop ä¸­ï¼Œä½¿ç”¨äº† è¿­ä»£å™¨ <code>i</code> çš„åˆ¤æ–­ï¼Œå®é™…æ“ä½œçš„æ˜¯ <code>i2</code> éå†çš„å¯¹è±¡ï¼Œbug å°±åœ¨è¿™é‡Œï¼Œå®é™…å·¥ç¨‹ä¸­ï¼Œå› ä¸º   è¿­ä»£å™¨ <code>i</code>çš„äº§ç”Ÿæ˜¯åœ¨ while loop å¤–é¢çš„ï¼Œä½œç”¨äºåŒ…å«äº†æ•´æ®µç¨‹åºï¼ŒåŒ…æ‹¬ while loop ä½¿ç”¨ç»“æŸä¹‹åï¼ŒåŠ ä¸Šä¸­é—´æœ‰å…¶ä»–çš„é€»è¾‘ä»£ç ï¼Œéš¾å…ä¼šä¸å°å¿ƒä½¿ç”¨åˆ°ä¸Šé¢æ®‹ä½™çš„ è¿­ä»£å™¨<code>i</code>ï¼Œè¿™å°±é€ æˆå¾ˆä¸¥é‡çš„ bugï¼Œè€Œä¸ä¼šè½»æ˜“è¢«å‘ç°ï¼ŒIDEä¹Ÿä¸ä¼šæŠ¥é”™ã€‚ æ‰€ä»¥è¦åˆ©ç”¨å¥½ for loop å£°æ˜è¿­ä»£å™¨ï¼Œæ§åˆ¶å®ƒçš„ä½œç”¨èŒƒå›´ã€‚</p><p>ä¸Šé¢çš„bugç¨‹åºæœ€ç»ˆçš„ç»“æœæ˜¯ä¸‹é¢çš„ while loop ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºåœ¨ä¸Šé¢çš„ while loop æ‰§è¡Œç»“æŸä¹‹åï¼Œè¿­ä»£å™¨ <code>i</code>å°±ä¼šéå†åˆ°å°½å¤´ï¼Œè¿™æ ·ç»§ç»­åˆ¤æ–­ <code>i.hasNext()</code>åªä¼šè¿”å› <code>false</code>ã€‚</p><h4 id="For-each-ä¼˜åŠ¿äº-For-loop"><a href="#For-each-ä¼˜åŠ¿äº-For-loop" class="headerlink" title="For-each ä¼˜åŠ¿äº For-loop"></a>For-each ä¼˜åŠ¿äº For-loop</h4><hr><ul><li>ä»¥ä¸‹é¢ä¸€ä¸ª ä¸¤å±‚é›†åˆåµŒå¥—è¿­ä»£å‡ºç°çš„ bug æ¥å±•å¼€è®¨è®º</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Can you spot the bug?</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Suit</span> </span>&#123;CLUB, DIAMOND, HEART, SPADE&#125;<br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Rank</span> </span>&#123;<br>    ACE, DEUCE, THREE, FOUR, FIVE, SIX, SEVEN,<br>    EIGHT, NINE, TEN, JACK, QUEEN, KING<br>&#125;<br>...<br><span class="hljs-keyword">static</span> Collection&lt;Suit&gt; suits = Arrays.asList(Suit.values());<br><span class="hljs-keyword">static</span> Collection&lt;Rank&gt; ranks = Arrays.asList(Rank.values());<br><br>List&lt;Card&gt; deck = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><span class="hljs-keyword">for</span> (Iterator&lt;Suit&gt; i = suits.iterator(); i.hasNext(); )<br>    <span class="hljs-keyword">for</span> (Iterator&lt;Rank&gt; j = ranks.iterator(); j.hasNext(); )<br>        deck.add(<span class="hljs-keyword">new</span> Card(i.next(), j.next()));<br>    <br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œçš„bugæ¯”è¾ƒéš¾æ‰¾ï¼Œå¯èƒ½å¾ˆå¤šå¤§å¸ˆä¹Ÿä¼šçŠ¯è¿™ä¸ªé”™è¯¯ã€‚bugåœ¨äºï¼Œåœ¨è¿­ä»£å™¨ä¸Šå¯¹å¤–éƒ¨çš„é›†åˆ suits è°ƒç”¨å¤ªå¤š <code>next</code> æ–¹æ³•ï¼Œå®ƒåº”è¯¥ä»å¤–éƒ¨çš„å¾ªç¯è¿›è¡Œè°ƒç”¨ï¼Œä»¥ä¾¿æ¯ç§èŠ±è‰²éƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä½†å®ƒå´æ˜¯ä»å†…éƒ¨å¾ªç¯è°ƒç”¨ï¼Œå› æ­¤æ¯æ¬¡ç‰Œè°ƒç”¨ä¸€æ¬¡ã€‚åœ¨ç”¨å®Œæ‰€æœ‰èŠ±è‰²ä¹‹åï¼Œå¾ªç¯å°±ä¼šæŠ›å‡º <code>NoSuchElementException</code>å¼‚å¸¸ã€‚</p><p>å¦‚æœç¢°å·§å¤–éƒ¨é›†åˆçš„å¤§å°æ˜¯å†…éƒ¨é›†åˆå¤§å°çš„å‡ å€ï¼ˆå¯èƒ½å› ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„é›†åˆï¼‰ï¼Œå¾ªç¯å°±ä¼šæ­£å¸¸ç»ˆæ­¢ï¼Œä½†æ˜¯å®é™…å®Œæˆæƒ…å†µè·Ÿé¢„æœŸæ˜¯æœ‰å‡ºå…¥çš„ã€‚</p><ul><li>ä¸‹é¢æ˜¯æ‰“å°ä¸€å¯¹éª°å­å‡ºç°çš„æ‰€æœ‰å¯èƒ½æƒ…å†µï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Same bug, different symptom!</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Face</span> </span>&#123;ONE, TWO, THREE, FOUR, FIVE, SIX&#125;<br>Collection&lt;Face&gt; faces = EnumSet.allOf(Face.class);<br><br><span class="hljs-keyword">for</span> (Iterator&lt;Face&gt; i = faces.iterator(); i.hasNext(); )<br>    <span class="hljs-keyword">for</span> (Iterator&lt;Face&gt; j = faces.iterator(); i.hasNext(); )<br>        System.out.println(i.next() + <span class="hljs-string">&quot; &quot;</span> + j.next());<br></code></pre></div></td></tr></table></figure><blockquote><p>ONE ONE<br>TWO TWO<br>THREE THREE<br>FOUR FOUR<br>FIVE FIVE<br>SIX SIX</p></blockquote><p>åŒæ ·çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯é‡å¤è°ƒç”¨ <code>next</code>ã€‚è¿™ç§ç¨‹åºä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥å¾€å¾€æ‰¾bugä¼šç‰¹åˆ«éš¾å—ã€‚</p><ul><li>ä¸‹é¢å¼€å§‹ä¿®æ­£æ­¤ bug</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Fixed, but ugly - so we need for-each</span><br><span class="hljs-keyword">for</span> (Iterator&lt;Suit&gt; i = suits.iterator(); i.hasNext(); ) &#123;<br>    Suit suit = i.next();<br>    <span class="hljs-keyword">for</span> (Iterator&lt;Rank&gt; j = ranks.iterator(); j.hasNext(); )<br>        deck.add(<span class="hljs-keyword">new</span> Card(suit, j.next()));<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>è‡³æ­¤å¼•å‡º for-each ï¼Œè®©è¿™ä¸ªé—®é¢˜å®Œå…¨æ¶ˆå¤±ï¼Œå¹¶ä¸”äº§ç”Ÿçš„ä»£ç ä¹Ÿèƒ½å¾ˆç®€æ´ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Preferred idiom for neat iteration on collections and arrays</span><br><span class="hljs-keyword">for</span> (Suit suit : suits)<br>    <span class="hljs-keyword">for</span> (Rank rank : ranks)<br>        deck.add(<span class="hljs-keyword">new</span> Card(suit, rank));<br></code></pre></div></td></tr></table></figure><h4 id="For-each-æ— æ³•ä½¿ç”¨çš„åœ°æ–¹"><a href="#For-each-æ— æ³•ä½¿ç”¨çš„åœ°æ–¹" class="headerlink" title="For-each æ— æ³•ä½¿ç”¨çš„åœ°æ–¹"></a>For-each æ— æ³•ä½¿ç”¨çš„åœ°æ–¹</h4><hr><ul><li><code>è§£æ„è¿‡æ»¤</code>ï¼šå¦‚æœéœ€è¦éå†é›†åˆï¼Œå¹¶åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿ä½¿ç”¨å®ƒçš„ remove æ–¹æ³•ã€‚ä½¿ç”¨ Java 8 ä¸­æ·»åŠ çš„ Collection çš„ <code>removeIf</code>ï¼Œå¸¸å¸¸å¯ä»¥é¿å…æ˜¾å¼éå†ã€‚</li><li><code>è½¬æ¢</code>ï¼šå¦‚æœéœ€è¦éå†åˆ—è¡¨æˆ–è€…æ•°ç»„ï¼Œå¹¶å–ä»£å®ƒçš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å…ƒç´ å€¼ï¼Œå°±éœ€è¦åˆ—è¡¨è¿­ä»£å™¨æˆ–è€…æ•°ç»„ç´¢å¼•ï¼Œä»¥ä¾¿è®¾ç½®å…ƒç´ çš„å€¼ã€‚</li><li><code>å¹³è¡Œè¿­ä»£</code>ï¼šå¦‚æœéœ€è¦å¹¶è¡Œåœ°éå†å¤šä¸ªé›†åˆï¼Œå°±éœ€è¦æ˜¾å¼åœ°æ§åˆ¶è¿­ä»£å™¨æˆ–è€…ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–è€…ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥å‰è¿›ï¼ˆå°±å¦‚ä¸Šè¿°æœ‰é—®é¢˜çš„ç‰Œå’Œéª°å­çš„ç¤ºä¾‹ä¸­æ— æ„é—´æ‰€ç¤ºèŒƒçš„é‚£æ ·ï¼‰</li></ul><h4 id="For-each-æ‹“å±•ä½¿ç”¨"><a href="#For-each-æ‹“å±•ä½¿ç”¨" class="headerlink" title="For-each æ‹“å±•ä½¿ç”¨"></a>For-each æ‹“å±•ä½¿ç”¨</h4><ul><li>for-each ä¸æ­¢èƒ½éå†é›†åˆå’Œæ•°ç»„ï¼Œè¿˜èƒ½éå†å®ç° <code>Iterable</code>æ¥å£çš„ä»»ä½•å¯¹è±¡ï¼Œåªéœ€è¦å®ç°æ¥å£å¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Iterable</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Returns an iterator over elements of type &#123;<span class="hljs-doctag">@code</span> T&#125;.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> an Iterator.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Iterator&lt;T&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span></span>;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">forEach</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-keyword">super</span> T&gt; action)</span> </span>&#123;<br>        Objects.requireNonNull(action);<br>        <span class="hljs-keyword">for</span> (T t : <span class="hljs-keyword">this</span>) &#123;<br>            action.accept(t);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»è€Œè¨€ä¹‹ï¼Œä¸ä¼ ç»Ÿçš„forå¾ªç¯ç›¸æ¯”ï¼Œfor-eachå¾ªç¯åœ¨ç®€æ´æ€§ã€çµæ´»æ€§ä»¥åŠå‡ºé”™é¢„é˜²æ€§æ–¹é¢éƒ½å æœ‰ç»å¯¹ä¼˜åŠ¿ï¼Œå¹¶ä¸”<strong>æ²¡æœ‰æ€§èƒ½æƒ©ç½š</strong>çš„é—®é¢˜ã€‚å› æ­¤ï¼Œå½“å¯ä»¥é€‰æ‹©çš„æ—¶å€™ï¼Œfor-eachå¾ªç¯åº”è¯¥ä¼˜å…ˆäºforå¾ªç¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaåœ¨Iteratorä¸­remove &amp; ConcurrentModificationExceptioné—®é¢˜</title>
    <link href="/2021/03/15/JavaSE/Java%20%E5%9C%A8Iterator%E4%B8%AD%20remove%20&amp;%20ConcurrentModificationException%E9%97%AE%E9%A2%98/"/>
    <url>/2021/03/15/JavaSE/Java%20%E5%9C%A8Iterator%E4%B8%AD%20remove%20&amp;%20ConcurrentModificationException%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        List&lt;String&gt; arrayList = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>        arrayList.add(<span class="hljs-string">&quot;a&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;b&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;c&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;d&quot;</span>);<br><br>        Iterator&lt;String&gt; iterator = arrayList.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            String cur = iterator.next();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;b&quot;</span>.equals(cur)) &#123;<br>                arrayList.remove(cur);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(cur + <span class="hljs-string">&quot; &quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">/*for (String s : arrayList) &#123;</span><br><span class="hljs-comment">            if (&quot;b&quot;.equals(s)) &#123;</span><br><span class="hljs-comment">                arrayList.remove(s);</span><br><span class="hljs-comment">            &#125; else &#123;</span><br><span class="hljs-comment">                System.out.println(s + &quot; &quot;);</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;*/</span><br>        System.out.println(arrayList);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>for-eachå®é™…å°±æ˜¯éšå¼ä½¿ç”¨ iterator éå†é›†åˆï¼Œä¸Šé¢çš„ä¾‹å­ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶åˆ é™¤å¤±è´¥ã€‚</li></ul><blockquote><p>a<br>Exception in thread â€œmainâ€ java.util.ConcurrentModificationException<br>    at java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:937)<br>    at java.base/java.util.ArrayList$Itr.next(ArrayList.java:891)<br>    at Solution.main(Solution.java:14)</p></blockquote><ul><li>ç„¶è€Œåˆ é™¤<strong>å€’æ•°ç¬¬äºŒä¸ª</strong>å…ƒç´ å´ä¸ä¼šæŠ¥é”™</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        List&lt;String&gt; arrayList = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>        arrayList.add(<span class="hljs-string">&quot;a&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;b&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;c&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;d&quot;</span>);<br><br>        Iterator&lt;String&gt; iterator = arrayList.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            String cur = iterator.next();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;c&quot;</span>.equals(cur)) &#123;<br>                arrayList.remove(cur);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(cur + <span class="hljs-string">&quot; &quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">/*for (String s : arrayList) &#123;</span><br><span class="hljs-comment">            if (&quot;c&quot;.equals(s)) &#123;</span><br><span class="hljs-comment">                arrayList.remove(s);</span><br><span class="hljs-comment">            &#125; else &#123;</span><br><span class="hljs-comment">                System.out.println(s + &quot; &quot;);</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;*/</span><br>        System.out.println(arrayList);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>a<br>b<br>[a, b, d]</p></blockquote><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li><p>é¦–å…ˆå…ˆè§‚å¯Ÿ ArrayList çš„ <code>iterator()</code>ï¼Œçœ‹è¿­ä»£å™¨æ€ä¹ˆæ„é€ ã€‚</p></li><li><p>ArrayList çš„ çˆ¶ç±» <code>AbstractList</code>ä¸­</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Itr();<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>Itr æ˜¯é‡Œé¢çš„å†…éƒ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Itr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Index of element to be returned by subsequent call to next.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">int</span> cursor = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Index of element returned by most recent call to next or</span><br><span class="hljs-comment">     * previous.  Reset to -1 if this element is deleted by a call</span><br><span class="hljs-comment">     * to remove.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">int</span> lastRet = -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * The modCount value that the iterator believes that the backing</span><br><span class="hljs-comment">     * List should have.  If this expectation is violated, the iterator</span><br><span class="hljs-comment">     * has detected concurrent modification.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">int</span> expectedModCount = modCount;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> cursor != size();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;<br>        checkForComodification();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">int</span> i = cursor;<br>            E next = get(i);<br>            lastRet = i;<br>            cursor = i + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> next;<br>        &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;<br>            checkForComodification();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (lastRet &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException();<br>        checkForComodification();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            AbstractList.<span class="hljs-keyword">this</span>.remove(lastRet);<br>            <span class="hljs-keyword">if</span> (lastRet &lt; cursor)<br>                cursor--;<br>            lastRet = -<span class="hljs-number">1</span>;<br>            expectedModCount = modCount;<br>        &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkForComodification</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (modCount != expectedModCount)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p><code>cursor</code>ï¼šä¸‹ä¸€ä¸ªè¦è®¿é—®çš„å…ƒç´ çš„ç´¢å¼•</p></li><li><p><code>lastRet</code>ï¼šä¸Šä¸€ä¸ªè®¿é—®çš„å…ƒç´ çš„ç´¢å¼•</p></li><li><p><code>expectedModCount</code>æ˜¯æœŸæœ›çš„è¯¥ List è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œåˆå§‹åŒ–ä¸º<code>modCount</code></p></li><li><p><code>modCount</code>æ˜¯AbstractList çš„ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚</p></li></ul><blockquote><p>The number of times this list has been structurally modified. Structural modifications are those that change the size of the list, or otherwise perturb it in such a fashion that iterations in progress may yield incorrect results.<br>This field is used by the iterator and list iterator implementation returned by the iterator and listIterator methods. If the value of this field changes unexpectedly, the iterator (or list iterator) will throw a ConcurrentModificationException in response to the next, remove, previous, set or add operations. This provides fail-fast behavior, rather than non-deterministic behavior in the face of concurrent modification during iteration.<br>Use of this field by subclasses is optional. If a subclass wishes to provide fail-fast iterators (and list iterators), then it merely has to increment this field in its add(int, E) and remove(int) methods (and any other methods that it overrides that result in structural modifications to the list). A single call to add(int, E) or remove(int) must add no more than one to this field, or the iterators (and list iterators) will throw bogus ConcurrentModificationExceptions. If an implementation does not wish to provide fail-fast iterators, this field may be ignored.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> modCount = <span class="hljs-number">0</span>;<br></code></pre></div></td></tr></table></figure><ul><li>ç»“æ„ä¿®æ”¹æ˜¯æŒ‡é‚£äº›æ”¹å˜åˆ—è¡¨å¤§å°çš„ä¿®æ”¹ï¼Œæˆ–è€…ä»¥æŸç§æ–¹å¼æ‰°ä¹±åˆ—è¡¨ï¼Œä½¿å¾—æ­£åœ¨è¿›è¡Œçš„è¿­ä»£å¯èƒ½äº§ç”Ÿä¸æ­£ç¡®çš„ç»“æœã€‚</li><li>æ­¤å­—æ®µç”±è¿­ä»£å™¨å’Œ<code>listIterator</code>æ–¹æ³•è¿”å›çš„è¿­ä»£å™¨å’Œåˆ—è¡¨è¿­ä»£å™¨å®ç°ä½¿ç”¨ã€‚å¦‚æœæ­¤å­—æ®µçš„å€¼æ„å¤–æ›´æ”¹ï¼Œè¿­ä»£å™¨ï¼ˆæˆ–åˆ—è¡¨è¿­ä»£å™¨ï¼‰å°†æŠ›å‡º<code>ConcurrentModificationException</code>ä»¥å“åº”<code>next</code>ã€<code>remove</code>ã€previousã€<code>set</code>æˆ–<code>add</code>æ“ä½œã€‚è¿™æä¾›äº†<code>å¿«é€Ÿå¤±è´¥</code>çš„è¡Œä¸ºã€‚</li></ul><ul><li>æ·±å…¥ ArrayList é‡Œè§‚å¯Ÿ <code>next()</code></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;<br>    checkForComodification();<br>    <span class="hljs-keyword">int</span> i = cursor;<br>    <span class="hljs-keyword">if</span> (i &gt;= size)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();<br>    Object[] elementData = ArrayList.<span class="hljs-keyword">this</span>.elementData;<br>    <span class="hljs-keyword">if</span> (i &gt;= elementData.length)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>    cursor = i + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> (E) elementData[lastRet = i];<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkForComodification</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (modCount != expectedModCount)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li><p>æŠ›å‡ºçš„<code>ConcurrentModificationException</code>å¼‚å¸¸æ˜¯<code>checkForComodification()</code>æŠ›å‡ºçš„ã€‚</p></li><li><p>æ¡ä»¶æ˜¯ï¼š<code>modCount != expectedModCount</code></p></li></ul><p>æ‰€ä»¥åœ¨ add remove çš„è¿‡ç¨‹ä¸­ <code>modCount</code>ä¼šè‡ªå¢è‡ªå‡ã€‚å¦‚æœç”¨é›†åˆçš„ <code>remove</code>åˆ™ List çš„<code>modCount</code>å‡å°‘ä¸€ï¼Œè€Œ Iterator çš„ <code>expectedModCount</code>ä¸å˜ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><ul><li>è‡³äºä¸ºä»€ä¹ˆå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ åˆ é™¤ä¸ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ Iterator éå†çš„ç‰¹ç‚¹ã€‚</li></ul><p>while + iterator çš„ç»„åˆæ˜¯éœ€è¦å…ˆåˆ¤ç©º <code>hasNext()</code>ï¼Œç„¶åå†<code>next()</code>ï¼Œæœ€åæ‰ <code>remove()</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå¯ä»¥è‡ªè¡Œå®éªŒï¼Œè°ƒæ¢ next å’Œ removeã€‚</p><p>å› ä¸ºè¦å…ˆ nextï¼Œå°†æ¸¸æ ‡<code>è¶Šè¿‡</code>å½“å‰çš„å…ƒç´ ï¼Œç„¶åå†å†³å®šè¦æ€ä¹ˆæ“ä½œå½“å‰çš„ï¼ˆæ¸¸æ ‡å‰é¢çš„ï¼‰è¿™ä¸ªå…ƒç´ ï¼Œå³æ¸¸æ ‡æ˜¯æ’åœ¨ å½“å‰å…ƒç´  å’Œ ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä¸­é—´ï¼ˆå¯ä»¥è¿™ä¹ˆç†è§£ï¼‰ã€‚</p><p>åˆ é™¤å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ çš„æ—¶å€™ï¼ŒcursoræŒ‡å‘<code>æœ€åä¸€ä¸ªå…ƒç´ </code>ï¼Œè€Œæ­¤æ—¶åˆ æ‰äº†å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ åï¼Œcursorå’Œsize()æ­£å¥½ç›¸ç­‰äº†ï¼Œæ‰€ä»¥<code>hasNext()</code>è¿”å›falseï¼Œéå†ç»“æŸï¼ŒæˆåŠŸçš„åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p><h2 id="å»ºè®®ç”¨æ³•"><a href="#å»ºè®®ç”¨æ³•" class="headerlink" title="å»ºè®®ç”¨æ³•"></a>å»ºè®®ç”¨æ³•</h2><ul><li><p>ä¸€ä¸ªåŸåˆ™æ˜¯ï¼Œå°½é‡åœ¨éå†çš„è¿‡ç¨‹ä¸­ä¸è¦å¯¹åŸé›†åˆè¿›è¡Œå¢åˆ ï¼Œå®¹æ˜“æ”¹å˜åŸç»“æ„ï¼Œå¯ä»¥ç”¨ immutable çš„æ€æƒ³ï¼Œé‡æ–°å°è£…ä¸€ä¸ªé›†åˆã€‚</p></li><li><p>è¦ remove() ï¼Œåˆ™è¦åœ¨ <code>iterator()</code>ä¸Šé¢æ¥è¿›è¡Œ <code>remove()</code>ï¼Œå› ä¸ºIteratorè¿­ä»£ï¼Œå°±æŠŠæ“ä½œæƒäº¤ç»™äº† Iteratorï¼Œå°±ä¸è¦å†ç”¨åŸé›†åˆè¿›è¡Œæ“ä½œäº†ã€‚</p></li><li><p>æ­£ç¡®ç”¨æ³•ï¼š</p></li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        List&lt;String&gt; arrayList = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>        arrayList.add(<span class="hljs-string">&quot;a&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;b&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;c&quot;</span>);<br>        arrayList.add(<span class="hljs-string">&quot;d&quot;</span>);<br><br>        Iterator&lt;String&gt; iterator = arrayList.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            String cur = iterator.next();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;a&quot;</span>.equals(cur)) &#123;<br>                iterator.remove();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(cur + <span class="hljs-string">&quot; &quot;</span>);<br>            &#125;<br>        &#125;<br>        System.out.println(arrayList);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>b<br>c<br>d<br>[b, c, d]</p></blockquote><ul><li>ä»¥ä¸Šåˆ†ææ˜¯åŸºäº <code>ArrayList</code>ï¼ŒåŸºäºé“¾è¡¨çš„ LinkedListé“ç†å¤§åŒå°å¼‚ï¼Œæ€æƒ³ä¸å˜ï¼Œæµ‹è¯•çš„ç»“æœä¹Ÿæ˜¯ä¸å˜çš„ã€‚</li><li>æ—¢ç„¶æ­£ç¡®æ˜¯ ä½¿ç”¨ iterator æ¥æ“ä½œé›†åˆï¼Œå°±åº”è¯¥å»é˜…è¯» iterator é‡Œçš„ next() å®ç°ï¼Œè€Œä¸åº”è¯¥å»çœ‹ ArrayList é‡Œçš„å®ç°ï¼Œè¦æ›´æ·±å…¥äº†è§£å°±å»é˜…è¯»æºç å§ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaç®—æ³•ç«èµ›å¸¸ç”¨æ¨¡æ¿</title>
    <link href="/2021/02/10/JavaSE/Java%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E5%B8%B8%E7%94%A8%E6%A8%A1%E6%9D%BF/"/>
    <url>/2021/02/10/JavaSE/Java%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E5%B8%B8%E7%94%A8%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaç®—æ³•ç«èµ›å¸¸ç”¨æ¨¡æ¿"><a href="#Javaç®—æ³•ç«èµ›å¸¸ç”¨æ¨¡æ¿" class="headerlink" title="Javaç®—æ³•ç«èµ›å¸¸ç”¨æ¨¡æ¿"></a>Javaç®—æ³•ç«èµ›å¸¸ç”¨æ¨¡æ¿</h1><h2 id="ä¸€ã€è¾“å…¥è¾“å‡º"><a href="#ä¸€ã€è¾“å…¥è¾“å‡º" class="headerlink" title="ä¸€ã€è¾“å…¥è¾“å‡º"></a>ä¸€ã€è¾“å…¥è¾“å‡º</h2><h3 id="ç®€å•è¾“å…¥"><a href="#ç®€å•è¾“å…¥" class="headerlink" title="ç®€å•è¾“å…¥"></a>ç®€å•è¾“å…¥</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner <br><span class="hljs-keyword">import</span> java.io.BufferedInputStream;<br><br>Scanner sc1 = <span class="hljs-keyword">new</span> Scanner(System.in);<br>Scanner sc2 = <span class="hljs-keyword">new</span> Scanner(<span class="hljs-keyword">new</span> BufferedInputStream(System.in));<br><span class="hljs-comment">// sc2ç”¨åˆ°ç¼“å†²æµï¼Œè¯»å…¥æ›´å¿«</span><br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        long t1, t2, t3;<br>        Scanner sc1 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Scanner(System.<span class="hljs-params">in</span>)</span>;<br>        Scanner sc2 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Scanner(<span class="hljs-params">new</span> BufferedInputStream(System.<span class="hljs-params">in</span>)</span>);<br><br>        t1 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>nano<span class="hljs-constructor">Time()</span>;<br>        String next = sc1.next<span class="hljs-literal">()</span>;<br>        t2 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>nano<span class="hljs-constructor">Time()</span>;<br>        t3 = t2 - t1;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;sc1:&quot;</span> + t3);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(next);<br><br>        t1 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>nano<span class="hljs-constructor">Time()</span>;<br>        String next2 = sc2.next<span class="hljs-literal">()</span>;<br>        t2 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>nano<span class="hljs-constructor">Time()</span>;<br>        t3 = t2 - t1;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;sc2:&quot;</span> + t3);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(next2);<br>    &#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>abc<br>sc1:7968695900<br>abc<br>abc<br>sc2:1945031900<br>abc</p></blockquote><h3 id="å¤æ‚è¾“å…¥"><a href="#å¤æ‚è¾“å…¥" class="headerlink" title="å¤æ‚è¾“å…¥"></a>å¤æ‚è¾“å…¥</h3><div class="hljs code-wrapper"><pre><code>    å¦‚ï¼š1,2,3,4,5</code></pre></div><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>    Scanner sc = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Scanner(System.<span class="hljs-params">in</span>)</span>;<br>    String str = sc.next<span class="hljs-literal">()</span>;<br>    String<span class="hljs-literal">[]</span> split = str.split(<span class="hljs-string">&quot;,&quot;</span>);<br>    <span class="hljs-built_in">int</span><span class="hljs-literal">[]</span> strInt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span><span class="hljs-literal">[<span class="hljs-identifier">split</span>.<span class="hljs-identifier">length</span>]</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; split.length; i++) &#123;<br>        strInt<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-params">split</span>[<span class="hljs-params">i</span>])</span>;<br>    &#125;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">strInt</span>)</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>1,2,3,4,5<br>[1, 2, 3, 4, 5]</p></blockquote><h3 id="æ–‡ä»¶è¾“å…¥"><a href="#æ–‡ä»¶è¾“å…¥" class="headerlink" title="æ–‡ä»¶è¾“å…¥"></a>æ–‡ä»¶è¾“å…¥</h3><div class="hljs code-wrapper"><pre><code>    ç”¨äºå¤§æ•°æ®çš„è¯»å…¥ï¼Œä¸ç”¨æ‰‹åŠ¨è¾“å…¥é‚£ä¹ˆéº»çƒ¦ã€‚BufferedInputStreamç¼“å†²æµæ¥åŠ é€Ÿï¼Œæ–‡ä»¶è¾“å…¥æµç”¨**ç»å¯¹è·¯å¾„**ï¼Œé¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œè¦ä¸å°±æŠŠèµ„æºæ–‡ä»¶æ”¾åœ¨srcç›®å½•ä¸‹ã€‚</code></pre></div><figure class="highlight haxe"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) throws FileNotFoundException &#123;<br>    Scanner sc = <span class="hljs-keyword">new</span> <span class="hljs-type">Scanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BufferedInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-type"></span><br><span class="hljs-type"></span>    FileInputStream(<span class="hljs-string">&quot;E:\\input.txt&quot;</span>)));<br>    List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">while</span> (sc.hasNext()) &#123;<br>        list.add(sc.nextInt());<br>    &#125;<br>    System.out.println(list);<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="äºŒã€æ•°æ®ç±»å‹"><a href="#äºŒã€æ•°æ®ç±»å‹" class="headerlink" title="äºŒã€æ•°æ®ç±»å‹"></a>äºŒã€æ•°æ®ç±»å‹</h2><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><ul><li>æŒ‰ç…§ç©ºæ ¼åˆ†å‰²å­—ç¬¦ä¸²</li></ul><figure class="highlight processing"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs processing"><span class="hljs-keyword">String</span>[] s=<span class="hljs-built_in">str</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; +&quot;</span>);<br><span class="hljs-keyword">String</span>[] s=<span class="hljs-built_in">str</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;\\s+&quot;</span>);<br><span class="hljs-comment">// ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åˆ†å‰²</span><br></code></pre></div></td></tr></table></figure><ul><li><p><strong>public int indexOf(String str)ï¼š</strong>è¿”å›å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°strçš„ä½ç½®ï¼›</p></li><li><p><strong>public int indexOf(String str,int fromIndex)ï¼š</strong>è¿”å›å­—ç¬¦ä¸²ä»fromIndexå¼€å§‹ç¬¬ä¸€æ¬¡å‡ºç°strçš„ä½ç½®ï¼›</p></li><li><p><strong>public String substring(int beginIndex)ï¼š</strong>è¿”å›è¯¥å­—ç¬¦ä¸²ä»beginIndexå¼€å§‹åˆ°ç»“å°¾çš„å­å­—ç¬¦ä¸²ï¼›</p></li><li><p><strong>public String substring(int beginIndex,int endIndex)ï¼š</strong>è¿”å›è¯¥å­—ç¬¦ä¸²ä»beginIndexå¼€å§‹åˆ°endsIndexç»“å°¾çš„å­å­—ç¬¦ä¸²</p></li><li><p><strong>public char[] toCharArray ()</strong> <strong>ï¼š</strong>å°†æ­¤å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å­—ç¬¦æ•°ç»„</p></li><li><p><strong>public String replace (CharSequence target, CharSequence replacement)</strong> <strong>ï¼š</strong>å°†ä¸targetåŒ¹é…çš„å­—ç¬¦ä¸²ä½¿ç”¨replacementå­—ç¬¦ä¸²æ›¿æ¢ã€‚</p></li><li><p><strong>String replaceAll(String regex, String replacement)ï¼š</strong>ä½¿ç”¨ç»™å®šçš„ replacement æ›¿æ¢æ­¤å­—ç¬¦ä¸²æ‰€æœ‰åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²</p></li></ul><figure class="highlight processing"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs processing"><span class="hljs-keyword">String</span> ss=<span class="hljs-built_in">str</span>.replaceAll(<span class="hljs-string">&quot; +&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>);<br><span class="hljs-keyword">String</span> ss=<span class="hljs-built_in">str</span>.replaceAll(<span class="hljs-string">&quot;\\s+&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>);<br><span class="hljs-comment">// äºŒè€…éƒ½èƒ½æŠŠä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼æ¢æˆé€—å·</span><br></code></pre></div></td></tr></table></figure><h3 id="å¤§æ•°"><a href="#å¤§æ•°" class="headerlink" title="å¤§æ•°"></a>å¤§æ•°</h3><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-comment">//BigDecimalç±»å‹æ„é€ æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-title">BigDecimal</span><span class="hljs-params">(double val)</span></span><br>          <span class="hljs-comment">//å°† double è½¬æ¢ä¸º BigDecimalï¼Œåè€…æ˜¯ double çš„äºŒè¿›åˆ¶æµ®ç‚¹å€¼å‡†ç¡®çš„åè¿›åˆ¶è¡¨ç¤ºå½¢å¼ã€‚</span><br><span class="hljs-function"><span class="hljs-title">BigDecimal</span><span class="hljs-params">(int val)</span></span><br>          <span class="hljs-comment">//å°† int è½¬æ¢ä¸º BigDecimalã€‚</span><br><span class="hljs-function"><span class="hljs-title">BigDecimal</span><span class="hljs-params">(long val)</span></span><br>          <span class="hljs-comment">//å°† long è½¬æ¢ä¸º BigDecimalã€‚</span><br><span class="hljs-function"><span class="hljs-title">BigDecimal</span><span class="hljs-params">(String val)</span></span><br>          <span class="hljs-comment">//å°† BigDecimal çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼è½¬æ¢ä¸º BigDecimalã€‚</span><br><span class="hljs-comment">//BigIntegerç±»å‹æ„é€ æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(int val)</span></span><br>          <span class="hljs-comment">//å°† int è½¬æ¢ä¸º BigIntegerã€‚</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(String val)</span></span><br>          <span class="hljs-comment">//å°† BigDecimal çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼è½¬æ¢ä¸º BigIntegerã€‚</span><br><span class="hljs-comment">//BigIntegerè½¬æ¢æ–¹æ³•</span><br>BigInteger valueOf(long val)<br>          <span class="hljs-comment">//è¿”å›å…¶å€¼ç­‰äºæŒ‡å®š long çš„å€¼çš„ BigIntegerã€‚</span><br>  <span class="hljs-comment">//å¦‚ï¼šBigInteger bi1=new BigInteger(1000);</span><br><span class="hljs-comment">//é€šç”¨æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.max</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//è¿”å›æœ€å¤§æ•°</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.min</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//è¿”å›æœ€å°æ•°</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.add</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//ç›¸å½“äºï¼š+</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.subtract</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//ç›¸å½“äºï¼š-</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.multiply</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//ç›¸å½“äºï¼š*</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.divide</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//ç›¸å½“äºï¼š/</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.mod</span>(BigInteger(BigDecimal))<br>    <span class="hljs-comment">//ç›¸å½“äºï¼š%</span><br><span class="hljs-function"><span class="hljs-title">BigInteger</span><span class="hljs-params">(BigDecimal)</span></span><span class="hljs-selector-class">.abs</span>()<br>    <span class="hljs-comment">//è¿”å›å…¶å€¼æ˜¯æ­¤ BigIntege(BigDecimal)r çš„ç»å¯¹å€¼çš„ BigInteger(BigDecimal)ã€‚</span><br></code></pre></div></td></tr></table></figure><h3 id="Calendarç±»"><a href="#Calendarç±»" class="headerlink" title="Calendarç±»"></a>Calendarç±»</h3><ul><li>Calendarå®ä¾‹åŒ–</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">Calendar calendar = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br></code></pre></div></td></tr></table></figure><ul><li><strong>YEAR</strong>       æŒ‡ç¤ºå¹´çš„ get å’Œ set çš„å­—æ®µæ•°å­—ã€‚</li><li><strong>MONTH</strong>  æŒ‡ç¤ºæœˆä»½çš„ get å’Œ set çš„å­—æ®µæ•°å­—ã€‚</li><li><strong>DATE</strong>       æŒ‡ç¤ºæ—¥çš„ get å’Œ set çš„å­—æ®µæ•°å­—ã€‚-</li><li><strong>HOUR</strong>       get å’Œ set çš„å­—æ®µæ•°å­—,æŒ‡ç¤ºå½“å¤©ä¸­çš„æŸå°æ—¶</li><li><strong>MINUTE</strong> get å’Œ set çš„å­—æ®µæ•°å­—,æŒ‡ç¤ºå½“å‰å°æ—¶ä¸­çš„æŸåˆ†é’Ÿ</li><li><strong>SECOND</strong> get å’Œ set çš„å­—æ®µæ•°å­—,æŒ‡ç¤ºå½“å‰åˆ†é’Ÿä¸­çš„æŸç§’</li><li><strong>DAY_OF_MONTH</strong>   get å’Œ set çš„å­—æ®µæ•°å­—, æŒ‡ç¤ºä»¥æœˆä¸ºèµ·ç‚¹è¿‡äº†å‡ å¤©ã€‚</li><li><strong>DAY_OF_WEEK</strong>   get å’Œ set çš„å­—æ®µæ•°å­—, æŒ‡ç¤ºä»¥å‘¨ä¸ºèµ·ç‚¹è¿‡äº†å‡ å¤©ã€‚</li><li><strong>DAY_OF_YEAR</strong>   get å’Œ set çš„å­—æ®µæ•°å­—, æŒ‡ç¤ºä»¥å¹´ä¸ºèµ·ç‚¹è¿‡äº†å‡ å¤©ã€‚</li><li><strong>DAY_OF_WEEK_IN_MONTH</strong>   get å’Œ set çš„å­—æ®µæ•°å­—, æŒ‡ç¤ºå½“å‰æœˆä¸­çš„ç¬¬å‡ ä¸ªæ˜ŸæœŸã€‚</li></ul><blockquote><p>public static final int SUNDAY = 1;</p><p>public static final int JANUARY = 0;</p><p>ä»¥ä¸Šè¡¨ç¤ºï¼Œä¸€å‘¨çš„å¼€å§‹æ˜¯å‘¨æ—¥ï¼Œå³ä¸º1ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ä¸€å¹´çš„å¼€å§‹æ˜¯ä¸€æœˆï¼Œå³ä¸º0ï¼Œæ‰€ä»¥å¯¹æœˆçš„è®¾ç½®è¦ - 1ï¼Œå¯¹æœˆçš„è¯»å–è¦ + 1</p></blockquote><div class="hljs code-wrapper"><pre><code>    `get(int field); `// è·å–ç»™å®šå­—æ®µçš„å€¼ï¼Œfieldå³ä¸Šé¢çš„å­—æ®µæ•°å­—</code></pre></div><figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata">Calendar calendar = Calendar.getInstance();<br><span class="hljs-comment">// è®¾ç½®æ—¥æœŸä¸º: 2020.1.21</span><br>calendar.<span class="hljs-keyword">set</span>(Calendar.YEAR, 2020);<br>calendar.<span class="hljs-keyword">set</span>(Calendar.MONTH, 0);<br>calendar.<span class="hljs-keyword">set</span>(Calendar.DAY_OF_MONTH, 21);<br><span class="hljs-comment">// è·å–2020.1.21æ˜¯æ˜ŸæœŸå‡ </span><br>System.<span class="hljs-keyword">out</span>.<span class="hljs-keyword">print</span>(calendar.<span class="hljs-built_in">get</span>(Calendar.DAY_OF_WEEK));<br><br>è¾“å‡ºï¼š<br>3 <span class="hljs-comment">// 3ä»£è¡¨æ˜ŸæœŸäºŒ</span><br></code></pre></div></td></tr></table></figure><h4 id="Calendarç±»ä¸Dateç±»çš„è½¬æ¢"><a href="#Calendarç±»ä¸Dateç±»çš„è½¬æ¢" class="headerlink" title="Calendarç±»ä¸Dateç±»çš„è½¬æ¢"></a>Calendarç±»ä¸Dateç±»çš„è½¬æ¢</h4><ul><li><p>Dateç±»</p><div class="hljs code-wrapper"><pre><code>  Date date = new Date();  System.out.println(&quot;æ¯«ç§’:&quot;+date.getTime());//è¾“å…¥æ¯«ç§’     //æ—¶é—´è½¬å­—ç¬¦ä¸²  SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);  String time = sdf.format(date);  System.out.println(&quot;æ—¶é—´è½¬å­—ç¬¦ä¸²:&quot;+time);     //åˆ©ç”¨å­—ç¬¦ä¸²æ¥è½¬æ—¶é—´æ ¼å¼ï¼ˆè®°å¾—æŠ›å‡ºå¼‚å¸¸ï¼‰  String time02 = &quot;2018-09-05&quot;;  SimpleDateFormat  sdf2 = new SimpleDateFormat (&quot;yyyy-MM-dd&quot;);  Date date2 = sdf2.parse(time02);  System.out.println(&quot;å­—ç¬¦ä¸²è½¬æ—¶é—´æ ¼å¼ï¼š&quot;+date2);</code></pre></div></li><li><p>Calendarç±»</p><div class="hljs code-wrapper"><pre><code>  // ä½¿ç”¨é»˜è®¤æ—¶åŒºå’Œè¯­è¨€ç¯å¢ƒè·å¾—ä¸€ä¸ªæ—¥å†  Calendar cal = Calendar.getInstance();  // èµ‹å€¼æ—¶å¹´æœˆæ—¥æ—¶åˆ†ç§’å¸¸ç”¨çš„6ä¸ªå€¼ï¼Œæ³¨æ„æœˆä»½ä¸‹æ ‡ä»0å¼€å§‹ï¼Œæ‰€ä»¥å–æœˆä»½è¦+1  System.out.println(&quot;å¹´:&quot; + cal.get(Calendar.YEAR));  System.out.println(&quot;æœˆ:&quot; + (cal.get(Calendar.MONTH) + 1));  System.out.println(&quot;æ—¥:&quot; + cal.get(Calendar.DAY_OF_MONTH));  System.out.println(&quot;æ—¶:&quot; + cal.get(Calendar.HOUR_OF_DAY));  System.out.println(&quot;åˆ†:&quot; + cal.get(Calendar.MINUTE));  System.out.println(&quot;ç§’:&quot; + cal.get(Calendar.SECOND));     //æ‰‹åŠ¨è®¾ç½®æŸä¸ªæ—¥æœŸ  Calendar cal02 = Calendar.getInstance();  //æ³¨æ„ï¼Œè®¾ç½®æ—¶é—´çš„æ—¶å€™æœˆä»½çš„ä¸‹æ ‡æ˜¯åœ¨0å¼€å§‹çš„  //è®¾ç½®æ—¶é—´ä¸ä¸€å®šè¦è¿™6ä¸ªå‚æ•°3ä¸ªå‚æ•°ä¹Ÿæ˜¯å¯ä»¥çš„  cal02.set(2018,9,1,12,0,0);//äºŒé›¶ä¸€å…«å¹´åæœˆä¸€å·åäºŒç‚¹  System.out.println(cal02.getTime());//getTime()è¿”å›Dateç±»å‹</code></pre></div></li><li><p>Calendarè½¬æ¢ä¸ºDate</p></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">Calendar cal = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>Date date = cal.get<span class="hljs-constructor">Time()</span>;<br>SimpleDateFormat simpleDateFormat = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>)</span>;<br>String s = simpleDateFormat.format(date);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;æ—¶é—´ä¸º====&quot;</span>+s);<br></code></pre></div></td></tr></table></figure><ul><li>Dateè½¬æ¢ä¸ºCalendar</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">Date date2 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Date()</span>;<br>Calendar cal2 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>cal2.set<span class="hljs-constructor">Time(<span class="hljs-params">date2</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(cal2.get(Calendar.YEAR) +<span class="hljs-string">&quot;-&quot;</span>+(cal2.get(Calendar.MONTH)+<span class="hljs-number">1</span>)+<span class="hljs-string">&quot;-&quot;</span>+cal2.get(Calendar.DATE));<br></code></pre></div></td></tr></table></figure><p>ä¾‹é¢˜ï¼š</p><p>ä»é”®ç›˜è¾“å…¥ä¸€ä¸ªæ—¥æœŸï¼Œæ ¼å¼ä¸ºyyyy-M-d</p><p>è¦æ±‚è®¡ç®—è¯¥æ—¥æœŸä¸1949å¹´10æœˆ1æ—¥è·ç¦»å¤šå°‘å¤©</p><p>ä¾‹å¦‚ï¼š</p><p>ç”¨æˆ·è¾“å…¥äº†ï¼š1949-10-2 ç¨‹åºè¾“å‡ºï¼š1</p><p>ç”¨æˆ·è¾“å…¥äº†ï¼š1949-11-1 ç¨‹åºè¾“å‡ºï¼š31</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        Calendar cal = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>        Scanner sc = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Scanner(<span class="hljs-params">new</span> BufferedInputStream(System.<span class="hljs-params">in</span>)</span>);<br>        String s = sc.next<span class="hljs-literal">()</span>;<br>        String<span class="hljs-literal">[]</span> str = s.split(<span class="hljs-string">&quot;-&quot;</span>);<br>        cal.set(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-params">str</span>[0])</span>, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-params">str</span>[1])</span> - <span class="hljs-number">1</span>, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-params">str</span>[2])</span>);<br>        Calendar standard = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>        standard.set(<span class="hljs-number">1949</span>, <span class="hljs-number">10</span> - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>        long t1 = cal.get<span class="hljs-constructor">TimeInMillis()</span>;<br>        long t2 = standard.get<span class="hljs-constructor">TimeInMillis()</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println((t1 - t2)<span class="hljs-operator"> / </span>(<span class="hljs-number">1000</span><span class="hljs-operator"> * </span><span class="hljs-number">60</span><span class="hljs-operator"> * </span><span class="hljs-number">60</span><span class="hljs-operator"> * </span><span class="hljs-number">24</span>) + <span class="hljs-number">1</span>);<br>    &#125;<br></code></pre></div></td></tr></table></figure><h2 id="åŒç«¯é˜Ÿåˆ—"><a href="#åŒç«¯é˜Ÿåˆ—" class="headerlink" title="åŒç«¯é˜Ÿåˆ—"></a>åŒç«¯é˜Ÿåˆ—</h2><div class="hljs code-wrapper"><pre><code>    å®šä¹‰ï¼šï¼ˆå¸¸ç”¨ï¼‰</code></pre></div><blockquote><p>Deque<Integer> q=new LinkedList<Integer>();</p></blockquote><p>LinkedListåº•å±‚æ˜¯é“¾è¡¨ï¼ŒArrayDequeåº•å±‚æ˜¯æ•°ç»„å®ç°</p><ul><li><p><code>offerFirst / addFirst(Object e);</code> é˜Ÿé¦–æ’å…¥</p></li><li><p><code>offerLast / addLast(Object e); </code>é˜Ÿå°¾æ’å…¥</p></li><li><p><code>pollFirst(); </code>é˜Ÿé¦–åˆ é™¤</p></li><li><p><code>pollLast(); </code>é˜Ÿå°¾åˆ é™¤</p></li><li><p><code>peekFirst(); </code>é˜Ÿé¦–è·å–</p></li><li><p><code>peekLast(); </code>é˜Ÿå°¾è·å–</p></li></ul><h2 id="è¿›åˆ¶è½¬æ¢"><a href="#è¿›åˆ¶è½¬æ¢" class="headerlink" title="è¿›åˆ¶è½¬æ¢"></a>è¿›åˆ¶è½¬æ¢</h2><h3 id="å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²-gt-åè¿›åˆ¶æ•´æ•°"><a href="#å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²-gt-åè¿›åˆ¶æ•´æ•°" class="headerlink" title="å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²-&gt;åè¿›åˆ¶æ•´æ•°"></a>å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²-&gt;åè¿›åˆ¶æ•´æ•°</h3><ul><li>public static Integer valueOf(int i)</li><li>public static Integer valueOf(String s)</li><li>public static Integer valueOf(String s, int radix) - radixä¸ºså­—ç¬¦ä¸²ç¬¦åˆçš„è¿›åˆ¶</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(12)</span>);<span class="hljs-comment">//12</span><br> <br><span class="hljs-comment">// åè¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(<span class="hljs-string">&quot;12&quot;</span>)</span>);<span class="hljs-comment">//12</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(<span class="hljs-string">&quot;12&quot;</span>,10)</span>);<span class="hljs-comment">//12</span><br> <br><span class="hljs-comment">// äºŒè¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(<span class="hljs-string">&quot;1100&quot;</span>, 2)</span>);<span class="hljs-comment">//12</span><br> <br><span class="hljs-comment">// 8è¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(<span class="hljs-string">&quot;1100&quot;</span>, 8)</span>);<span class="hljs-comment">//576</span><br> <br><span class="hljs-comment">// 16è¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>value<span class="hljs-constructor">Of(<span class="hljs-string">&quot;1100&quot;</span>, 16)</span>);<span class="hljs-comment">//4352</span><br></code></pre></div></td></tr></table></figure><p>åŒç†ï¼Œç”¨ public static int parseInt(String s)æˆ– public static int parseInt(String s, int radix)è½¬æ¢ä¸ºintå‹</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-comment">// åè¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;12&quot;</span>)</span>); <span class="hljs-comment">// 12</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;12&quot;</span>, 10)</span>); <span class="hljs-comment">// 12</span><br> <br><span class="hljs-comment">// äºŒè¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;1100&quot;</span>, 2)</span>); <span class="hljs-comment">// 12</span><br> <br><span class="hljs-comment">// 8è¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;1100&quot;</span>, 8)</span>); <span class="hljs-comment">// 576</span><br> <br><span class="hljs-comment">// 16è¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;1100&quot;</span>, 16)</span>); <span class="hljs-comment">// 4352</span><br> <br><span class="hljs-comment">// 32è¿›åˆ¶å­—ç¬¦ä¸² =&gt; åè¿›åˆ¶æ•´æ•°</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;1100&quot;</span>, 32)</span>); <span class="hljs-comment">// 33792</span><br></code></pre></div></td></tr></table></figure><h3 id="åè¿›åˆ¶æ•´æ•°-gt-å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²"><a href="#åè¿›åˆ¶æ•´æ•°-gt-å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²" class="headerlink" title="åè¿›åˆ¶æ•´æ•°-&gt;å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²"></a>åè¿›åˆ¶æ•´æ•°-&gt;å…¶ä»–è¿›åˆ¶å­—ç¬¦ä¸²</h3><ul><li>public static String toBinaryString(int i) - è½¬äºŒè¿›åˆ¶</li><li>public static String toOctalString(int i) - è½¬å…«è¿›åˆ¶</li><li>public static String toHexString(int i) - è½¬åå…­è¿›åˆ¶</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> n = <span class="hljs-number">12</span>;<br><span class="hljs-comment">// åè¿›åˆ¶æ•´æ•° -&gt; åè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">n</span>)</span>);<span class="hljs-comment">// 12</span><br> <br><span class="hljs-comment">// åè¿›åˆ¶æ•´æ•° -&gt; äºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">n</span>, 2)</span>);<span class="hljs-comment">// 1100</span><br> <br><span class="hljs-comment">// åè¿›åˆ¶æ•´æ•° -&gt; 8è¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">n</span>, 8)</span>);<span class="hljs-comment">// 14</span><br> <br><span class="hljs-comment">// åè¿›åˆ¶æ•´æ•° -&gt; 16è¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">n</span>, 16)</span>);<span class="hljs-comment">// c</span><br> <br><span class="hljs-comment">// åè¿›åˆ¶æ•´æ•° -&gt; 32è¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">n</span>, 32)</span>);<span class="hljs-comment">// c</span><br></code></pre></div></td></tr></table></figure><h2 id="è‡ªå®šä¹‰æ’åº"><a href="#è‡ªå®šä¹‰æ’åº" class="headerlink" title="è‡ªå®šä¹‰æ’åº"></a>è‡ªå®šä¹‰æ’åº</h2><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>    <span class="hljs-built_in">String</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>[] &#123;<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>, <span class="hljs-string">&quot;1111&quot;</span>&#125;;<br>    <span class="hljs-comment">// æŒ‰ç…§é•¿åº¦é™åº</span><br>    Arrays.sort(arr, (s1, s2) -&gt; &#123;<br>        <span class="hljs-keyword">return</span> s2.length() - s1.length();<br>    &#125;);<br>    System.out.println(Arrays.toString(arr));<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æ•°ç»„æ±‚å’Œ"><a href="#æ•°ç»„æ±‚å’Œ" class="headerlink" title="æ•°ç»„æ±‚å’Œ"></a>æ•°ç»„æ±‚å’Œ</h2><ul><li>Arrayså·¥å…·ç±»è½¬streamå†æ±‚å’Œ</li></ul><figure class="highlight smali"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs smali">int[]<span class="hljs-built_in"> array </span>=<span class="hljs-built_in"> new </span>int[]&#123;1,2,3&#125;;<br>Arrays.stream(array).sum();<br></code></pre></div></td></tr></table></figure><ul><li>for loop æ±‚å’Œï¼Œè™½ç„¶ä»£ç é‡æ¯”ä¸Šé¢çš„å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯æ•ˆç‡æ¯”ä¸Šé¢çš„é«˜å¾ˆå¤šï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨for loopæ±‚å’Œï¼Œåˆ«æèŠ±é‡Œèƒ¡å“¨çš„</li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>javaä¸­æ•°ç»„å¤šç§éå†æ±‚å’Œçš„æ•ˆç‡åˆ†æ</title>
    <link href="/2021/02/01/JavaSE/java%E4%B8%AD%E6%95%B0%E7%BB%84%E5%A4%9A%E7%A7%8D%E9%81%8D%E5%8E%86%E6%B1%82%E5%92%8C%E7%9A%84%E6%95%88%E7%8E%87%E5%88%86%E6%9E%90/"/>
    <url>/2021/02/01/JavaSE/java%E4%B8%AD%E6%95%B0%E7%BB%84%E5%A4%9A%E7%A7%8D%E9%81%8D%E5%8E%86%E6%B1%82%E5%92%8C%E7%9A%84%E6%95%88%E7%8E%87%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="javaä¸­æ•°ç»„å¤šç§éå†æ±‚å’Œçš„æ•ˆç‡åˆ†æ"><a href="#javaä¸­æ•°ç»„å¤šç§éå†æ±‚å’Œçš„æ•ˆç‡åˆ†æ" class="headerlink" title="javaä¸­æ•°ç»„å¤šç§éå†æ±‚å’Œçš„æ•ˆç‡åˆ†æ"></a>javaä¸­æ•°ç»„å¤šç§éå†æ±‚å’Œçš„æ•ˆç‡åˆ†æ</h1><h2 id="intå‹æ•°ç»„çš„éå†æ±‚å’Œæ•ˆç‡åˆ†æ"><a href="#intå‹æ•°ç»„çš„éå†æ±‚å’Œæ•ˆç‡åˆ†æ" class="headerlink" title="intå‹æ•°ç»„çš„éå†æ±‚å’Œæ•ˆç‡åˆ†æ"></a>intå‹æ•°ç»„çš„éå†æ±‚å’Œæ•ˆç‡åˆ†æ</h2><ul><li>è½¬æ¢æˆæµçš„å½¢å¼ï¼Œå†æ±‚å’Œã€‚IntStream.of(a).sum();</li><li>å¦ä¸€ç§è½¬æ¢æµæ±‚å’Œçš„æ–¹å¼ï¼ŒArrays.stream(a).sum();</li><li>æ™®é€šfor loop æ±‚å’Œï¼šfor i</li><li>å¢å¼ºfor loop æ±‚å’Œï¼šfor-each</li></ul><p>æµ‹è¯•æ–¹æ³•ä½¿ç”¨çš„æ˜¯ System.nanoTime() æ±‚å‡ºæ±‚å’Œæ®µçš„è¿è¡Œæ—¶é—´ï¼Œå•ä½ä¸ºçº³ç§’(10^-9 s)</p><h3 id="æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š"><a href="#æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š"></a>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">100</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>            a[i] = i + <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">long</span> l1, l2;<br>        <span class="hljs-keyword">int</span> sum1, sum2, sum3 = <span class="hljs-number">0</span>, sum4 = <span class="hljs-number">0</span>;<br><br>        l1 = System.nanoTime();<br>        sum1 = IntStream.of(a).sum();<br>        l2 = System.nanoTime();<br>        System.out.print(<span class="hljs-string">&quot;IntStream.of(a).sum(): &quot;</span>);<br>        System.out.println(sum1);<br>        System.out.println(l2 - l1);<br><br>        l1 = System.nanoTime();<br>        sum2 = Arrays.stream(a).sum();<br>        l2 = System.nanoTime();<br>        System.out.print(<span class="hljs-string">&quot;Arrays.stream(a).sum(): &quot;</span>);<br>        System.out.println(sum2);<br>        System.out.println(l2 - l1);<br><br>        l1 = System.nanoTime();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; a.length; i++) &#123;<br>            sum3 += a[i];<br>        &#125;<br>        l2 = System.nanoTime();<br>        System.out.print(<span class="hljs-string">&quot;for loop: &quot;</span>);<br>        System.out.println(sum3);<br>        System.out.println(l2 - l1);<br><br>        l1 = System.nanoTime();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : a) &#123;<br>            sum4 += i;<br>        &#125;<br>        l2 = System.nanoTime();<br>        System.out.print(<span class="hljs-string">&quot;iterator loop: &quot;</span>);<br>        System.out.println(sum4);<br>        System.out.println(l2 - l1);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>IntStream.of(a).sum(): 5050<br>24215600<br>Arrays.stream(a).sum(): 5050<br>184000<br>for loop: 5050<br>1600<br>iterator loop: 5050<br>1800</p></blockquote><p>æ±‚å’Œç»“æœéƒ½æ˜¯æ­£ç¡®çš„ã€‚æ‰€ä»¥æ ¹æ®æœ€åæ±‚å’Œé€Ÿåº¦è¿›è¡Œæ’åºï¼Œæ•ˆç‡ä»ä½åˆ°é«˜ï¼š</p><blockquote><p>IntStream.of(A).sum() &lt; Arrays.stream(A).sum() &lt; iterator loop &lt; for loop</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è™šæ‹Ÿæœºä¸‹Linuxé…ç½®é™æ€ipï¼Œä½¿å¾—XShellæˆåŠŸè¿æ¥</title>
    <link href="/2021/01/23/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8BLinux%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%EF%BC%8C%E4%BD%BF%E5%BE%97XShell%E6%88%90%E5%8A%9F%E8%BF%9E%E6%8E%A5/"/>
    <url>/2021/01/23/Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8BLinux%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%EF%BC%8C%E4%BD%BF%E5%BE%97XShell%E6%88%90%E5%8A%9F%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="è™šæ‹Ÿæœºä¸‹Linuxé…ç½®é™æ€ipï¼Œä½¿å¾—XShellæˆåŠŸè¿æ¥"><a href="#è™šæ‹Ÿæœºä¸‹Linuxé…ç½®é™æ€ipï¼Œä½¿å¾—XShellæˆåŠŸè¿æ¥" class="headerlink" title="è™šæ‹Ÿæœºä¸‹Linuxé…ç½®é™æ€ipï¼Œä½¿å¾—XShellæˆåŠŸè¿æ¥"></a>è™šæ‹Ÿæœºä¸‹Linuxé…ç½®é™æ€ipï¼Œä½¿å¾—XShellæˆåŠŸè¿æ¥</h1><ul><li>Linuxï¼šcentOS6.7</li><li>è™šæ‹Ÿæœºï¼šVMware Workstation Pro15</li><li>SSHå®¢æˆ·ç«¯ï¼šXShell6</li></ul><h2 id="ä¸€ã€é…ç½®VMwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"><a href="#ä¸€ã€é…ç½®VMwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨" class="headerlink" title="ä¸€ã€é…ç½®VMwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"></a>ä¸€ã€é…ç½®VMwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</h2><p>è¿›VMwareä¹‹å‰ï¼Œå³é”®ï¼Œç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€ï¼Œåé¢éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå…ˆä¸è¦å¼€è™šæ‹Ÿæœº</p><blockquote><p>èœå•æ ï¼ˆæœ€é¡¶ä¸Šä¸€æ ï¼‰ -&gt; ç¼–è¾‘ -&gt;  è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</p></blockquote><p><a href="https://imgtu.com/i/sTn2BF"><img src="https://z3.ax1x.com/2021/01/23/sTn2BF.png" alt="sTn2BF.png"></a></p><p>æŒ‰ç…§â‘ â‘¡é…ç½®ï¼Œ<strong>æŠŠâ‘¢çš„å­ç½‘IPè®°ä½</strong>ï¼Œåé¢è¦ç”¨åˆ°ã€‚</p><p>ç„¶åç‚¹å‡»â‘£è¿›å…¥NATè®¾ç½®ã€‚</p><p><img src="https://s3.ax1x.com/2021/01/23/sT1Epd.png" alt="NATè®¾ç½®"></p><p>â‘ ä¸­é…ç½®<strong>é»˜è®¤ç½‘å…³</strong>ï¼Œå…¶ä¸­å‰ä¸‰å¤§ä½è¦ä¸å‰é¢è®°ä½çš„å­ç½‘IPå‰é¢ç›¸åŒï¼Œåé¢é»˜è®¤ä¼šé…ç½®2ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚ç„¶åè¯¥é»˜è®¤ç½‘å…³192.168.248.2è¦è®°ä½ï¼Œåé¢éœ€è¦ç”¨åˆ°ã€‚</p><p>â‘¡ç…§åšå°±è¡Œ</p><p>â‘¢æŒ‰ç¡®å®šè¿”å›ä¸Šå›¾ï¼Œå†ç‚¹å‡»ä¸‹æ ç¡®å®šå°±å¯ä»¥ä¿å­˜è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„é…ç½®ã€‚</p><h2 id="äºŒã€é…ç½®VMware-Network-Adapter-VMnet8çš„æŒ‡å®šIP"><a href="#äºŒã€é…ç½®VMware-Network-Adapter-VMnet8çš„æŒ‡å®šIP" class="headerlink" title="äºŒã€é…ç½®VMware Network Adapter VMnet8çš„æŒ‡å®šIP"></a>äºŒã€é…ç½®VMware Network Adapter VMnet8çš„æŒ‡å®šIP</h2><blockquote><p> windowsè®¾ç½® -&gt; ç½‘ç»œå’ŒInternet -&gt; æ›´æ”¹é€‚é…å™¨é€‰é¡¹ -&gt;  å³é”®VMware Network Adapter VMnet8è¿›å…¥å±æ€§</p></blockquote><p><a href="https://imgchr.com/i/sT86w6"><img src="https://s3.ax1x.com/2021/01/23/sT86w6.png" alt="sT86w6.png"></a></p><p><a href="https://imgchr.com/i/sT8vlj"><img src="https://s3.ax1x.com/2021/01/23/sT8vlj.png" alt="sT8vlj.png"></a></p><p><a href="https://imgchr.com/i/sTGUBt"><img src="https://s3.ax1x.com/2021/01/23/sTGUBt.png" alt="VMnet8å±æ€§"></a></p><p>â‘ é€‰æ‹©IPv4çš„é¡¹ç›®ï¼Œâ‘¡ç„¶åè¿›å…¥å±æ€§ã€‚</p><p><a href="https://imgchr.com/i/sTGqD1"><img src="https://s3.ax1x.com/2021/01/23/sTGqD1.png" alt="sTGqD1.png"></a></p><p>é»˜è®¤æ˜¯è‡ªåŠ¨è·å¾—IPåœ°å€ï¼Œå‹¾é€‰â€œä½¿ç”¨ä¸‹é¢çš„IPåœ°å€â€è‡ªå®šä¹‰IP</p><p>â‘ é…ç½®IPåœ°å€ï¼Œå‰ä¸‰ä½åŒè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨é…ç½®çš„å­ç½‘IPå‰ä¸‰ä½ç›¸åŒï¼Œæœ€åä¸€ä½çš„1è‡ªå®šä¹‰ï¼Œè¿™é‡Œæˆ‘è®¾ç½®ä¸º1</p><p>â‘¡é…å®Œâ‘ ä¸€èˆ¬å­ç½‘æ©ç ä¼šè‡ªåŠ¨å¡«å¥½ï¼Œæ²¡è‡ªåŠ¨è¡¥ä¸Šå°±å¡«ä¸Šè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨é‡Œçš„å­ç½‘æ©ç ã€‚</p><p>â‘¢é»˜è®¤ç½‘å…³å°±æ˜¯å¹²èœè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨é‡Œé¢NATè®¾ç½®é‡Œçš„é‚£ä¸ªé»˜è®¤ç½‘å…³ã€‚</p><p>â‘£ç¡®å®šä¿å­˜ï¼Œç„¶åå†ç¡®å®šå°±ä¿å­˜æˆåŠŸäº†ã€‚</p><h2 id="ä¸‰ã€é…ç½®ç½‘ç»œé€‚é…å™¨"><a href="#ä¸‰ã€é…ç½®ç½‘ç»œé€‚é…å™¨" class="headerlink" title="ä¸‰ã€é…ç½®ç½‘ç»œé€‚é…å™¨"></a>ä¸‰ã€é…ç½®ç½‘ç»œé€‚é…å™¨</h2><p>ç®¡ç†å‘˜æ¨¡å¼è¿›å…¥VMwareï¼Œé€‰æ‹©è¦é…ç½®çš„é‚£å°è™šæ‹Ÿæœºï¼Œè¿›å…¥ç½‘ç»œé€‚é…å™¨</p><p><a href="https://imgchr.com/i/sTYOfO"><img src="https://s3.ax1x.com/2021/01/23/sTYOfO.png" alt="sTYOfO.png"></a></p><p><a href="https://imgchr.com/i/sTtE9S"><img src="https://s3.ax1x.com/2021/01/23/sTtE9S.png" alt="sTtE9S.png"></a></p><p>å¦‚å›¾é…ç½®å³å¯ã€‚</p><h2 id="å››ã€é…ç½®ifcfg-eth0æ–‡ä»¶"><a href="#å››ã€é…ç½®ifcfg-eth0æ–‡ä»¶" class="headerlink" title="å››ã€é…ç½®ifcfg-eth0æ–‡ä»¶"></a>å››ã€é…ç½®ifcfg-eth0æ–‡ä»¶</h2><p>æ‰“å¼€è™šæ‹Ÿæœºï¼Œå»ºè®®ç”¨rootç”¨æˆ·ç™»å½•ï¼Œæ–¹ä¾¿åé¢å¯¹ifcfg-eth0æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚</p><p>æ‰“å¼€terminalç»ˆç«¯ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š<strong>vim /etc/sysconfig/network-scripts/ifcfg-eth0</strong></p><p>è¿™æ˜¯ä½¿ç”¨ç»ˆç«¯vimçš„æ–¹å¼ä¿®æ”¹ï¼Œä¸ä¼švimæ“ä½œçš„è‡ªè¡Œç™¾åº¦ï¼Œæˆ–è€…æ ¹æ®ä¸Šé¢çš„è·¯åŠ²å»æ‰¾ifcfg-eth0æ–‡ä»¶æ‰“å¼€è¿›è¡Œä¿®æ”¹ã€‚</p><p>ä¸‹é¢çš„é…ç½®å»ºè®®å¯¹å­—æ®µè¿›è¡Œå¤åˆ¶ï¼Œé˜²æ­¢é…é”™ã€‚</p><ol><li><strong>ä»¥ä¸‹è¿›è¡Œä¿®æ”¹</strong></li></ol><ul><li>ONBOOT=yes  # ç³»ç»Ÿå¯åŠ¨æ—¶æ˜¯å¦è®¾ç½®æ­¤ç½‘ç»œæ¥å£ï¼Œè®¾ç½®ä¸ºyesæ—¶ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶æ¿€æ´»æ­¤è®¾å¤‡ã€‚</li><li>BOOTPROTO=static  # é™æ€æ¨¡å¼</li></ul><ol start="2"><li><strong>å°†ä¸‹é¢çš„å­—æ®µè¿½åŠ åˆ°æœ€åä¸€è¡Œï¼Œæ ¹æ®æ³¨é‡Šè¿›è¡Œç›¸åº”çš„é…ç½®</strong></li></ol><ul><li>IPADDR=192.168.248.128    # è‡ªå®šä¹‰çš„IPåœ°å€ï¼Œç”¨XShellå¯¹æœåŠ¡å™¨è¿›è¡Œè¿æ¥çš„IPï¼Œå‰ä¸‰ä½ä¸å‰é¢ä¿æŒä¸€è‡´</li><li>NETMASK=255.255.255.0    # å­ç½‘æ©ç </li><li>NETWORK=192.168.248.0   #  ç½‘ç»œåœ°å€ï¼Œä¸è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨è®¾ç½®çš„ä¸€æ ·</li><li>BROADCAST=192.168.248.255  # å¹¿æ’­åœ°å€ï¼Œå‰ä¸‰ä½ä¸å‰é¢ä¸€è‡´ï¼Œæœ€åä¸€ä½255</li><li>DNS1=192.168.248.2  # DNSåœ°å€ï¼Œä¸é»˜è®¤ç½‘å…³ç›¸åŒ</li><li>GATEWAY=192.168.248.2  # é»˜è®¤ç½‘å…³</li></ul><p>ç„¶åesc : wqä¿å­˜</p><p>é€€å‡ºåï¼Œç»ˆç«¯è¾“å…¥æŒ‡ä»¤ï¼š<strong>service network restart</strong>  é‡å¯ç½‘ç»œ</p><p>ç„¶å ping baidu.comï¼Œçœ‹èƒ½ä¸èƒ½pingé€šï¼Œèƒ½è¯´æ˜èƒ½ä¸Šç½‘ã€‚</p><p>è¾“å…¥æŒ‡ä»¤ï¼šifconfigï¼ŒæŸ¥çœ‹åˆšæ‰è‡ªå®šä¹‰çš„é™æ€ipåœ°å€æ˜¯å¦é…ç½®æˆåŠŸã€‚</p><p><a href="https://imgchr.com/i/sTa2DJ"><img src="https://s3.ax1x.com/2021/01/23/sTa2DJ.png" alt="sTa2DJ.png"></a></p><h2 id="äº”ã€SSHå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨"><a href="#äº”ã€SSHå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨" class="headerlink" title="äº”ã€SSHå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨"></a>äº”ã€SSHå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨</h2><p>å¯ä»¥å…ˆæœ¬åœ°cmdä¸­ping ä¸€ä¸‹æœåŠ¡å™¨</p><p><a href="https://imgchr.com/i/sTdFbj"><img src="https://s3.ax1x.com/2021/01/23/sTdFbj.png" alt="sTdFbj.png"></a></p><p>å¦‚å›¾èƒ½pingé€šï¼Œæ¥ä¸‹æ¥è¿›å…¥XShellï¼Œå°†è¯¥ipè¿æ¥å°±å¯ä»¥äº†ï¼Œè‡³æ­¤è™šæ‹Ÿæœºé™æ€IPé…ç½®ç»“æŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è´Ÿæ•°å–æ¨¡è¿ç®—</title>
    <link href="/2020/05/27/JavaSE/%E8%B4%9F%E6%95%B0%E5%8F%96%E6%A8%A1%E8%BF%90%E7%AE%97/"/>
    <url>/2020/05/27/JavaSE/%E8%B4%9F%E6%95%B0%E5%8F%96%E6%A8%A1%E8%BF%90%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h1 id="è´Ÿæ•°å–æ¨¡è¿ç®—"><a href="#è´Ÿæ•°å–æ¨¡è¿ç®—" class="headerlink" title="è´Ÿæ•°å–æ¨¡è¿ç®—"></a>è´Ÿæ•°å–æ¨¡è¿ç®—</h1><hr><h2 id="ä¸€ã€å¼•ä¾‹"><a href="#ä¸€ã€å¼•ä¾‹" class="headerlink" title="ä¸€ã€å¼•ä¾‹"></a>ä¸€ã€å¼•ä¾‹</h2><div class="hljs code-wrapper"><pre><code>System.out.println(&quot;3 % 5 = &quot; + 3 % 5);System.out.println(&quot;-3 % 5 = &quot; + -3 % 5);System.out.println(&quot;3 % -5 = &quot; + 3 % -5);System.out.println(&quot;-3 % -5 = &quot; + -3 % -5);</code></pre></div><blockquote><p> 3 % 5 = 3<br> -3 % 5 = -3<br> 3 % -5 = 3<br> -3 % -5 = -3  </p></blockquote><h3 id="è§„å¾‹"><a href="#è§„å¾‹" class="headerlink" title="è§„å¾‹"></a>è§„å¾‹</h3><blockquote><p>è¢«é™¤æ•°æ˜¯è´Ÿæ•°ï¼Œåˆ™å–æ¨¡åç¬¦å·ä¹Ÿä¸ºè´Ÿ</p></blockquote><blockquote><p>è¢«é™¤æ•°æ˜¯æ­£æ•°ï¼Œåˆ™å–æ¨¡åç¬¦å·ä¹Ÿä¸ºæ­£</p></blockquote><blockquote><p>ç»“æœçš„ç¬¦å·ä¸é™¤æ•°çš„æ­£è´Ÿå·æ— å…³</p></blockquote><h2 id="äºŒã€æ•´æ•°é™¤æ³•é—®é¢˜"><a href="#äºŒã€æ•´æ•°é™¤æ³•é—®é¢˜" class="headerlink" title="äºŒã€æ•´æ•°é™¤æ³•é—®é¢˜"></a>äºŒã€æ•´æ•°é™¤æ³•é—®é¢˜</h2><ul><li><p>å‘ä¸Šå–æ•´(Ceiling) å‘Xè½´æ­£æ–¹å‘å–æ•´ï¼Œå³å–æ¯”å®é™…ç»“æœç¨å¤§çš„æ•°<br>æ¯”å¦‚ï¼š17 / 8 == 3ï¼Œ 8 / 3 == 3ï¼Œ-9 / 4 == -2</p></li><li><p>å‘ä¸‹å–æ•´(Floor) å‘Xè½´è´Ÿæ–¹å‘å–æ•´ï¼Œå³å–æ¯”å®é™…ç»“æœç¨å°çš„æ•°<br>æ¯”å¦‚ï¼š17 / 8 == 2ï¼Œ 8 / 3 == 2ï¼Œ-9 / 4 == -3</p></li><li><p>å‘é›¶å–æ•´(Truncate) å‘åŸç‚¹æ–¹å‘å–æ•´ï¼Œå³ç›´æ¥çœç•¥å°æ•°éƒ¨åˆ†ï¼Œå–æ•´<br>æ¯”å¦‚ï¼š17 / 8 == 2ï¼Œ 8 / 3 == 2ï¼Œ-9 / 4 == -2</p></li></ul><h2 id="ä¸‰ã€å–æ¨¡é€šç”¨å…¬å¼"><a href="#ä¸‰ã€å–æ¨¡é€šç”¨å…¬å¼" class="headerlink" title="ä¸‰ã€å–æ¨¡é€šç”¨å…¬å¼"></a>ä¸‰ã€å–æ¨¡é€šç”¨å…¬å¼</h2><blockquote><p>a % b = r</p></blockquote><blockquote><p>r = a - (a/b) * b</p></blockquote><h2 id="å››ã€è®¡ç®—æœºè¯­è¨€å·®å¼‚æ€§"><a href="#å››ã€è®¡ç®—æœºè¯­è¨€å·®å¼‚æ€§" class="headerlink" title="å››ã€è®¡ç®—æœºè¯­è¨€å·®å¼‚æ€§"></a>å››ã€è®¡ç®—æœºè¯­è¨€å·®å¼‚æ€§</h2><ul><li><p>C/Java<br>é‡‡ç”¨Truncateé™¤æ³•ï¼Œå³å‘é›¶å–æ•´</p></li><li><p>Python<br>é‡‡ç”¨Flooré™¤æ³•ï¼Œå³å‘ä¸‹å–æ•´</p></li></ul><h2 id="äº”ã€Truncateé™¤æ³•çš„é—®é¢˜"><a href="#äº”ã€Truncateé™¤æ³•çš„é—®é¢˜" class="headerlink" title="äº”ã€Truncateé™¤æ³•çš„é—®é¢˜"></a>äº”ã€Truncateé™¤æ³•çš„é—®é¢˜</h2><p>åœ¨ä¸€äº›é¢˜ç›®ä¸­ï¼Œæ•°ç»„å…ƒç´ å¯èƒ½å‡ºç°è´Ÿæ•°ï¼Œè¿™æ ·å¯¼è‡´å–æ¨¡çš„æ—¶å€™ï¼Œä¼šå‡ºç°å–æ•´é—®é¢˜çš„æ­§ä¹‰</p><blockquote><p>åœ¨Javaä¸­ï¼Œé»˜è®¤Truncateé™¤æ³•ï¼Œä¸ºé¿å…æ­§ä¹‰å¯ä»¥ä½¿ç”¨ï¼š</p></blockquote><blockquote><p>1ã€ä½¿ç”¨Math.floorModæ–¹æ³•è¿›è¡ŒFlooré™¤æ³•</p></blockquote><blockquote><p>2ã€å¦‚åœ¨å‰ç¼€å’Œè®¡ç®—ä¸­ï¼Œç”¨<br>int modulus = <strong>(sum % K + K) % k</strong>;<br>è€Œä¸ç”¨ <strong>sum % k</strong>ï¼Œé¿å…è´Ÿæ•°å¹²æ‰°ç»“æœ</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaSE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
  
  
  <entry>
    <title>404</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>about</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[<h1 id="ABOUT-ME"><a href="#ABOUT-ME" class="headerlink" title="ABOUT ME"></a>ABOUT ME</h1><p>ğŸ“­ How to reach me: </p><ul><li><a href="mailto:1027093394@qq.com">1027093394@qq.com</a></li><li><a href="mailto:cwh1027093394@gmail.com">cwh1027093394@gmail.com</a></li></ul><p>ğŸ”— My Site:</p><ul><li><strong>Blog</strong>: <a href="https://hypocrite30.top/">https://hypocrite30.top/</a></li><li><strong>JueJin</strong>: <a href="https://juejin.cn/user/668945886743486">https://juejin.cn/user/668945886743486</a></li><li><strong>Github</strong>: <a href="https://github.com/hypocrite30">https://github.com/hypocrite30</a></li></ul><p>ğŸ“ Learning <strong>Computer science and technology</strong></p><p>ğŸ’— Favor: <strong>Music</strong>ğŸµ <strong>Guitar</strong>ğŸ¸<strong>Coding</strong>ğŸ’» <strong>Blogging</strong>ğŸ–Š <strong>Basketball</strong>ğŸ€ <strong>Gaming</strong>ğŸ® <strong>Exercising</strong>ğŸ’ª</p><p>ğŸ“™ Mottoï¼š<strong>To see the world as it is and to love it.</strong></p><h1 id="ABOUT-BLOG"><a href="#ABOUT-BLOG" class="headerlink" title="ABOUT BLOG"></a>ABOUT BLOG</h1><p>åšå®¢ä½œä¸ºå­¦ä¹ è®°å½•ï¼ŒPower by Hexo &amp; Github Pageï¼Œæ­å¾—ç²—ç³™è¯·è§è°…ã€‚æœ‰éœ€æ±‚æˆ–ç–‘é—® mail ä¸æˆ‘äº¤æµã€‚æ–‡ç« æœ‰é”™è¯¯æˆ–ç–æ¼è¯·å¤šæŒ‡æ­£ï¼Œä¸èƒœæ„Ÿæ¿€ï¼</p>]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†ç±»</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
</search>
